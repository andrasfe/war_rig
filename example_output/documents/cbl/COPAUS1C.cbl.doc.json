{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-28T14:55:16.220421",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUS1C is a CICS COBOL program that displays detailed information about an authorization message. It retrieves authorization details from an IMS database, allows users to mark authorizations as fraudulent, and links to another program (COPAUS2C) to handle fraud updates.",
    "business_context": "This program is part of a card authorization demo application, providing a detailed view of authorization messages for review and potential fraud flagging.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      5,
      23
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area passed between CICS programs, containing account ID, authorization keys, and other relevant data.",
      "copybook": "COCOM01Y",
      "citation": [
        171,
        204
      ]
    },
    {
      "name": "PENDING-AUTH-SUMMARY",
      "io_type": "IMS_SEGMENT",
      "description": "IMS segment containing summary information about a pending authorization.",
      "copybook": "CIPAUSMY",
      "citation": [
        441
      ]
    },
    {
      "name": "PENDING-AUTH-DETAILS",
      "io_type": "IMS_SEGMENT",
      "description": "IMS segment containing detailed information about a pending authorization.",
      "copybook": "CIPAUDTY",
      "citation": [
        467
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1A",
      "io_type": "CICS_MAP",
      "description": "BMS map displaying authorization details to the user.",
      "copybook": "COPAU01",
      "citation": [
        382,
        390
      ]
    },
    {
      "name": "WS-FRAUD-DATA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area passed to COPAUS2C containing fraud related data.",
      "copybook": null,
      "citation": [
        250
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS0C",
      "call_type": "CICS_XCTL",
      "purpose": "Returns to the previous screen (Authorization Summary).",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 368
    },
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "Handles fraud reporting and updating.",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Authorization response codes are translated to 'A' (Approved) or 'D' (Declined) for display.",
      "logic_summary": "If PA-AUTH-RESP-CODE is '00', AUTHRSPO is set to 'A' and the color is set to green. Otherwise, AUTHRSPO is set to 'D' and the color is set to red.",
      "conditions": [
        "IF PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        311,
        315
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Decline reason codes are translated to a user-friendly description using a table lookup.",
      "logic_summary": "The program searches WS-DECLINE-REASON-TAB for a matching DECL-CODE. If found, the corresponding DECL-DESC is displayed. If not found, a default error message is displayed.",
      "conditions": [
        "WHEN DECL-CODE(WS-DECL-RSN-IDX) = PA-AUTH-RESP-REASON"
      ],
      "citation": [
        319,
        325
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-ACCT-ID",
          "CDEMO-CPVD-PAU-SELECTED",
          "CDEMO-PGM-REENTER",
          "CDEMO-TO-PROGRAM",
          "CDEMO-CUST-ID"
        ],
        "citation": [
          171,
          211,
          214
        ]
      },
      {
        "source": "PENDING-AUTH-SUMMARY",
        "fields_used": [
          "PA-ACCT-ID",
          "PA-AUTHORIZATION-KEY"
        ],
        "citation": [
          436,
          437
        ]
      },
      {
        "source": "PENDING-AUTH-DETAILS",
        "fields_used": [
          "PA-CARD-NUM",
          "PA-AUTH-ORIG-DATE",
          "PA-AUTH-ORIG-TIME",
          "PA-APPROVED-AMT",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-PROCESSING-CODE",
          "PA-POS-ENTRY-MODE",
          "PA-MESSAGE-SOURCE",
          "PA-MERCHANT-CATAGORY-CODE",
          "PA-CARD-EXPIRY-DATE",
          "PA-AUTH-TYPE",
          "PA-TRANSACTION-ID",
          "PA-MATCH-STATUS",
          "PA-AUTH-FRAUD",
          "PA-FRAUD-RPT-DATE",
          "PA-MERCHANT-NAME",
          "PA-MERCHANT-ID",
          "PA-MERCHANT-CITY",
          "PA-MERCHANT-STATE",
          "PA-MERCHANT-ZIP",
          "PA-FRAUD-CONFIRMED",
          "PA-FRAUD-REMOVED"
        ],
        "citation": [
          295,
          297,
          303,
          308,
          311,
          319,
          331,
          332,
          333,
          334,
          336,
          340,
          341,
          342,
          345,
          347,
          352,
          353,
          354,
          355,
          356,
          236,
          237
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHTMO",
          "AUTHAMTO",
          "AUTHRSPO",
          "AUTHRSPC",
          "AUTHRSNO",
          "AUTHCDO",
          "POSEMDO",
          "AUTHSRCO",
          "MCCCDO",
          "CRDEXPO",
          "AUTHTYPO",
          "TRNIDO",
          "AUTHMTCO",
          "AUTHFRDO",
          "MERNAMEO",
          "MERIDO",
          "MERCITYO",
          "MERSTO",
          "MERZIPO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO",
          "ERRMSGO"
        ],
        "citation": [
          295,
          301,
          306,
          309,
          312,
          314,
          321,
          325,
          331,
          332,
          333,
          334,
          336,
          340,
          341,
          342,
          345,
          352,
          353,
          354,
          355,
          356,
          413,
          414,
          415,
          416,
          422,
          428,
          377
        ]
      },
      {
        "destination": "WS-FRAUD-DATA",
        "fields_written": [
          "WS-FRD-ACCT-ID",
          "WS-FRD-CUST-ID",
          "WS-FRAUD-AUTH-RECORD"
        ],
        "citation": [
          245,
          246,
          244
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Formats the authorization date from YYMMDD to MM/DD/YY.",
        "citation": [
          297,
          298,
          299,
          300,
          301
        ]
      },
      {
        "input_field": "PA-AUTH-ORIG-TIME",
        "output_field": "AUTHTMO",
        "transformation_description": "Formats the authorization time from HHMMSS to HH:MM:SS.",
        "citation": [
          303,
          304,
          305,
          306
        ]
      },
      {
        "input_field": "PA-APPROVED-AMT",
        "output_field": "AUTHAMTO",
        "transformation_description": "Moves the approved amount to the output field.",
        "citation": [
          308,
          309
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines the CARDDEMO-COMMAREA structure for inter-program communication.",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines the BMS map structure for the authorization view screen.",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Defines screen titles.",
      "location": "WORKING_STORAGE",
      "citation": 126
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Defines current date variables.",
      "location": "WORKING_STORAGE",
      "citation": 129
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Defines common messages.",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CSMSG02Y",
      "purpose": "Defines abend variables.",
      "location": "WORKING_STORAGE",
      "citation": 135
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines the PENDING-AUTH-SUMMARY IMS segment layout.",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines the PENDING-AUTH-DETAILS IMS segment layout.",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "Defines CICS AID keys.",
      "location": "WORKING_STORAGE",
      "citation": 148
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "Defines BMS communication area.",
      "location": "WORKING_STORAGE",
      "citation": 149
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the main paragraph that controls the program's overall flow. It first initializes variables and checks if the program is being called for the first time or re-entered. If it's the first time, it initializes the CARDDEMO-COMMAREA and returns to the previous screen (COPAUS0C). If it's a re-entry, it receives the screen input, evaluates the EIBAID (CICS attention identifier) to determine the user's action (ENTER, PF3, PF5, PF8, or other), and performs the corresponding action. Based on the AID key pressed, it will either process the enter key, return to the previous screen, mark the authorization as fraud, process the PF8 key to read the next authorization record, or display an error message for an invalid key. Finally, it returns control to CICS with the updated COMMAREA.",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 169
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 175
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 177
        },
        {
          "target": "RECEIVE-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 179
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 182
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 183
        },
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 186
        },
        {
          "target": "MARK-AUTH-FRAUD",
          "call_type": "performs",
          "line": 188
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 189
        },
        {
          "target": "PROCESS-PF8-KEY",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 192
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 194
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 197
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph processes the ENTER key press. It initializes the COPAU1AO map and checks if the account ID and authorization key are valid (numeric and not spaces/low-values). If valid, it moves the account ID and authorization key to working storage variables and performs READ-AUTH-RECORD to retrieve the authorization details from the IMS database. If the PSB is scheduled, it takes a syncpoint. If the account ID or authorization key are invalid, it sets the error flag. Finally, it calls POPULATE-AUTH-DETAILS to populate the screen fields with the retrieved data.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS",
        "TAKE-SYNCPOINT"
      ],
      "citation": [
        208,
        228
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 216
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 220
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 227
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS0C.cbl",
          "function": "MAIN-PARA",
          "line": 226,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 175,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 182,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 194,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "This paragraph handles the process of marking or unmarking an authorization as fraudulent. It moves the account ID and authorization key to working storage and calls READ-AUTH-RECORD to retrieve the authorization details. It then checks if the authorization is already marked as fraud. If it is, it removes the fraud flag; otherwise, it sets the fraud flag. It moves the PENDING-AUTH-DETAILS to WS-FRAUD-AUTH-RECORD, the account ID to WS-FRD-ACCT-ID, and the customer ID to WS-FRD-CUST-ID. It then links to the COPAUS2C program to update the fraud status. Based on the return from COPAUS2C, it either updates the authorization details and takes a syncpoint or rolls back the changes and displays an error message. Finally, it calls POPULATE-AUTH-DETAILS to refresh the screen with the updated information.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK"
      ],
      "citation": [
        230,
        266
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 234
        },
        {
          "target": "UPDATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 255
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 258
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 261
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 265
        },
        {
          "target": "WS-PGM-AUTH-FRAUD",
          "call_type": "calls",
          "line": 248
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 188,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "This paragraph handles the processing when the PF8 key is pressed, which is intended to display the next authorization record. It moves the account ID and authorization key to working storage and calls READ-AUTH-RECORD to retrieve the current authorization details. It then calls READ-NEXT-AUTH-RECORD to retrieve the next authorization record from the IMS database. If the PSB is scheduled, it takes a syncpoint. If the end of the authorization records is reached (AUTHS-EOF), it sets a flag to prevent screen erasure and displays a message indicating that the last authorization has been reached. Otherwise, it moves the authorization key of the next record to CDEMO-CPVD-PAU-SELECTED and calls POPULATE-AUTH-DETAILS to display the details of the next authorization record.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS",
        "TAKE-SYNCPOINT"
      ],
      "citation": [
        268,
        289
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 273
        },
        {
          "target": "READ-NEXT-AUTH-RECORD",
          "call_type": "performs",
          "line": 274
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 278
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 287
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS0C.cbl",
          "function": "MAIN-PARA",
          "line": 243,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 191,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph populates the authorization details on the screen (COPAU1AO) based on the data retrieved from the IMS database. It checks if there are any errors (ERR-FLG-OFF). If no errors, it moves various fields from the PENDING-AUTH-DETAILS segment to the corresponding output fields on the screen, formatting the date and time as needed. It translates the authorization response code to 'A' (Approved) or 'D' (Declined) and sets the corresponding color. It also searches the WS-DECLINE-REASON-TAB to find the description for the decline reason code. It handles fraud confirmation status and populates the merchant information. If there are errors, it skips populating the screen fields.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 227,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 265,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 287,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "This paragraph prepares the COMMAREA for returning to the previous screen (COPAUS0C) and then transfers control to that program using CICS XCTL. It moves the current transaction ID and program ID to the CARDDEMO-COMMAREA, sets the program context to zero, and sets the program enter flag to true. It then executes the CICS XCTL command to transfer control to the program specified in CDEMO-TO-PROGRAM, passing the CARDDEMO-COMMAREA.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        360,
        371
      ],
      "outgoing_calls": [
        {
          "target": "CDEMO-TO-PROGRAM",
          "call_type": "calls",
          "line": 367
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS0C.cbl",
          "function": "MAIN-PARA",
          "line": 237,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 169,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 186,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph sends the authorization view screen (COPAU1A) to the terminal. It first calls POPULATE-HEADER-INFO to populate the header information on the screen. It then moves any error messages to the ERRMSGO field on the screen. It checks the SEND-ERASE-FLG to determine whether to erase the screen before sending the map. If SEND-ERASE-YES is true, it sends the map with the ERASE option; otherwise, it sends the map without erasing the screen. The CURSOR option is used to position the cursor on the screen.",
      "called_by": [
        "MAIN-PARA",
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "SCHEDULE-PSB"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        373,
        396
      ],
      "outgoing_calls": [
        {
          "target": "POPULATE-HEADER-INFO",
          "call_type": "performs",
          "line": 375
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 177,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 183,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 189,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 192,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 197,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 461,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 487,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-NEXT-AUTH-RECORD",
          "line": 516,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 550,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "SCHEDULE-PSB",
          "line": 601,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph receives data from the authorization view screen (COPAU1A) when the user interacts with it. It executes the CICS RECEIVE command to receive the data from the specified map and mapset into the COPAU1AI structure. The NOHANDLE option is used to prevent CICS from handling any exceptions that may occur during the receive operation.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        398,
        406
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 179,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "This paragraph populates the header information on the authorization view screen (COPAU1AO). It moves the current date and time to working storage variables. It then moves the title, transaction name, program name, current date, and current time to the corresponding output fields on the screen.",
      "called_by": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        409,
        429
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS0C.cbl",
          "function": "SEND-PAULST-SCREEN",
          "line": 690,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "SEND-AUTHVIEW-SCREEN",
          "line": 375,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph reads the authorization summary and detail records from the IMS database. It first calls SCHEDULE-PSB to schedule the PSB. It then moves the account ID and authorization key to the corresponding fields in the PENDING-AUTH-SUMMARY segment. It executes a DLI GU (Get Unique) command to retrieve the PENDING-AUTH-SUMMARY segment based on the account ID. If the segment is found, it executes a DLI GNP (Get Next within Parent) command to retrieve the PENDING-AUTH-DETAILS segment based on the authorization key. Error handling is performed by checking the DIBSTAT value after each DLI call. If an error occurs, an error message is constructed and displayed on the screen.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        431,
        491
      ],
      "outgoing_calls": [
        {
          "target": "SCHEDULE-PSB",
          "call_type": "performs",
          "line": 433
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 461
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 487
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 216,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 234,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 273,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph reads the next authorization detail record from the IMS database. It executes a DLI GNP (Get Next within Parent) command to retrieve the next PENDING-AUTH-DETAILS segment. Error handling is performed by checking the DIBSTAT value after the DLI call. If an error occurs, an error message is constructed and displayed on the screen. The AUTHS-EOF flag is set if the end of the database is reached.",
      "called_by": [
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        493,
        518
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 516
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 274,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph updates the PENDING-AUTH-DETAILS segment in the IMS database with the fraud information. It moves the WS-FRAUD-AUTH-RECORD to the PENDING-AUTH-DETAILS segment. It then executes a DLI REPL (Replace) command to update the segment in the database. Error handling is performed by checking the DIBSTAT value after the DLI call. If the update is successful, it takes a syncpoint and displays a message indicating whether the authorization was marked or removed as fraud. If an error occurs, it rolls back the changes and displays an error message.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        520,
        552
      ],
      "outgoing_calls": [
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 533
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 540
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 550
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 255,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "This paragraph takes a CICS syncpoint to commit the changes made to the database. It executes the CICS SYNCPOINT command.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "PROCESS-PF8-KEY",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        557,
        560
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 220,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 278,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 533,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "This paragraph rolls back any uncommitted changes made to the database. It executes the CICS SYNCPOINT ROLLBACK command.",
      "called_by": [
        "MARK-AUTH-FRAUD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        565,
        569
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 258,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 261,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 540,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "This paragraph schedules the PSB (Program Specification Block) for IMS database access. It executes a DLI SCHD (Schedule) command to schedule the PSB named in PSB-NAME. It checks the DIBSTAT value after the DLI call. If the PSB was already scheduled, it terminates the PSB and schedules it again. If an error occurs during scheduling, an error message is constructed and displayed on the screen.",
      "called_by": [
        "READ-AUTH-RECORD"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        574,
        603
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 601
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS0C.cbl",
          "function": "GET-AUTH-SUMMARY",
          "line": 969,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 433,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "EIBCALEN = 0",
      "action": "Initializes CARDDEMO-COMMAREA and returns to the previous screen.",
      "citation": [
        165,
        169
      ]
    },
    {
      "condition": "CDEMO-ACCT-ID is not NUMERIC or CDEMO-CPVD-PAU-SELECTED is SPACES or LOW-VALUES",
      "action": "Sets ERR-FLG-ON to TRUE.",
      "citation": [
        211,
        224
      ]
    },
    {
      "condition": "EIBRESP not equal to DFHRESP(NORMAL) during LINK to COPAUS2C",
      "action": "Performs ROLL-BACK.",
      "citation": [
        253,
        261
      ]
    },
    {
      "condition": "WS-FRD-UPDT-SUCCESS is false after LINK to COPAUS2C",
      "action": "Moves WS-FRD-ACT-MSG to WS-MESSAGE and performs ROLL-BACK.",
      "citation": [
        254,
        257,
        258
      ]
    },
    {
      "condition": "DIBSTAT indicates an error during IMS operations (READ-AUTH-RECORD, READ-NEXT-AUTH-RECORD, UPDATE-AUTH-DETAILS, SCHEDULE-PSB)",
      "action": "Sets WS-ERR-FLG to 'Y', constructs an error message, and displays it on the screen.",
      "citation": [
        453,
        479,
        508,
        542,
        593
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "Returns control to CICS.",
      "citation": 202
    },
    {
      "command": "XCTL",
      "resource": "CDEMO-TO-PROGRAM",
      "purpose": "Transfers control to another CICS program.",
      "citation": 368
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Sends the authorization view screen to the terminal.",
      "citation": 382
    },
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A",
      "purpose": "Receives data from the authorization view screen.",
      "citation": 401
    },
    {
      "command": "LINK",
      "resource": "COPAUS2C",
      "purpose": "Links to the fraud processing program.",
      "citation": 248
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Takes a syncpoint to commit changes.",
      "citation": 558
    },
    {
      "command": "SYNCPOINT ROLLBACK",
      "resource": null,
      "purpose": "Rolls back uncommitted changes.",
      "citation": 567
    }
  ],
  "open_questions": [
    {
      "question": "What is the purpose of the DISPLAY statement on line 523?",
      "context": "It is unclear why the PA-FRAUD-RPT-DATE is being displayed to the console.",
      "suggestion": "Check the program's execution environment or related documentation to determine if this is for debugging or logging purposes."
    }
  ],
  "dead_code": [],
  "flow_diagram": "flowchart TD\n    %% Title: COPAUS1C.cbl\n    MAIN_PARA[\"MAIN-PARA\"]\n    MARK_AUTH_FRAUD[\"MARK-AUTH-FRAUD\"]\n    PROCESS_ENTER_KEY[\"PROCESS-ENTER-KEY\"]\n    PROCESS_PF8_KEY[\"PROCESS-PF8-KEY\"]\n    RECEIVE_AUTHVIEW_SCREEN[\"RECEIVE-AUTHVIEW-SCREEN\"]\n    RETURN_TO_PREV_SCREEN[\"RETURN-TO-PREV-SCREEN\"]\n    SEND_AUTHVIEW_SCREEN[\"SEND-AUTHVIEW-SCREEN\"]\n    POPULATE_AUTH_DETAILS[\"POPULATE-AUTH-DETAILS\"]\n    READ_AUTH_RECORD[\"READ-AUTH-RECORD\"]\n    ROLL_BACK[\"ROLL-BACK\"]\n    UPDATE_AUTH_DETAILS[\"UPDATE-AUTH-DETAILS\"]\n    WS_PGM_AUTH_FRAUD__ext([\"WS-PGM-AUTH-FRAUD\"])\n    POPULATE_HEADER_INFO[\"POPULATE-HEADER-INFO\"]\n    TAKE_SYNCPOINT[\"TAKE-SYNCPOINT\"]\n    READ_NEXT_AUTH_RECORD[\"READ-NEXT-AUTH-RECORD\"]\n    SCHEDULE_PSB[\"SCHEDULE-PSB\"]\n    CDEMO_TO_PROGRAM__ext([\"CDEMO-TO-PROGRAM\"])\n    MAIN_PARA --> MARK_AUTH_FRAUD\n    MAIN_PARA --> PROCESS_ENTER_KEY\n    MAIN_PARA --> PROCESS_PF8_KEY\n    MAIN_PARA --> RECEIVE_AUTHVIEW_SCREEN\n    MAIN_PARA --> RETURN_TO_PREV_SCREEN\n    MAIN_PARA --> SEND_AUTHVIEW_SCREEN\n    MARK_AUTH_FRAUD --> POPULATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD --> READ_AUTH_RECORD\n    MARK_AUTH_FRAUD --> ROLL_BACK\n    MARK_AUTH_FRAUD --> UPDATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD -.->|calls| WS_PGM_AUTH_FRAUD__ext\n    PROCESS_ENTER_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_ENTER_KEY --> READ_AUTH_RECORD\n    PROCESS_ENTER_KEY --> TAKE_SYNCPOINT\n    PROCESS_PF8_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_PF8_KEY --> READ_AUTH_RECORD\n    PROCESS_PF8_KEY --> READ_NEXT_AUTH_RECORD\n    PROCESS_PF8_KEY --> TAKE_SYNCPOINT\n    READ_AUTH_RECORD --> SCHEDULE_PSB\n    READ_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    READ_NEXT_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    RETURN_TO_PREV_SCREEN -.->|calls| CDEMO_TO_PROGRAM__ext\n    SCHEDULE_PSB --> SEND_AUTHVIEW_SCREEN\n    SEND_AUTHVIEW_SCREEN --> POPULATE_HEADER_INFO\n    UPDATE_AUTH_DETAILS --> ROLL_BACK\n    UPDATE_AUTH_DETAILS --> SEND_AUTHVIEW_SCREEN\n    UPDATE_AUTH_DETAILS --> TAKE_SYNCPOINT"
}