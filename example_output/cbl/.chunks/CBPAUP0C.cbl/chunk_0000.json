{
  "batch_idx": 0,
  "total_batches": 2,
  "template": {
    "header": {
      "program_id": "CBPAUP0C",
      "file_name": "cbl/CBPAUP0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T03:51:01.416818",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "CBPAUP0C is a batch utility that purges expired pending authorizations from an IMS database named AUTHDB. It sequentially reads authorization summary segments (PAUTSUM0), then for each summary, reads associated detail segments (PAUTDTL1), checks if the authorization date is expired based on a configurable number of days, deletes qualified detail records, and deletes the summary record if no approved/declined authorizations remain. Periodic checkpoints are taken based on processing frequency, and final statistics on reads and deletes are displayed.",
      "business_context": "Automated cleanup of stale pending authorization data in a financial authorization system to prevent database bloat and enforce expiry policies.",
      "program_type": "BATCH",
      "citations": [
        1,
        7,
        9,
        13,
        23,
        36
      ]
    },
    "inputs": [
      {
        "name": "SYSIN",
        "io_type": "PARAMETER",
        "description": "Program parameters including P-EXPIRY-DAYS, P-CHKP-FREQ, P-CHKP-DIS-FREQ, P-DEBUG-FLAG",
        "copybook": null,
        "citation": [
          55
        ]
      },
      {
        "name": "PAUTSUM0",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization summary segments from IMS AUTHDB database",
        "copybook": "PENDING-AUTH-SUMMARY",
        "citation": [
          88,
          91
        ]
      },
      {
        "name": "PAUTDTL1",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization detail segments from IMS AUTHDB database, parented under summary",
        "copybook": "PENDING-AUTH-DETAILS",
        "citation": [
          119,
          122
        ]
      }
    ],
    "outputs": [
      {
        "name": "DISPLAY STATISTICS",
        "io_type": "REPORT",
        "description": "Final summary of WS-NO-SUMRY-READ, WS-NO-SUMRY-DELETED, WS-NO-DTL-READ, WS-NO-DTL-DELETED",
        "copybook": null,
        "citation": [
          38,
          40,
          41,
          42,
          43
        ]
      },
      {
        "name": "IMS AUTHDB DELETES",
        "io_type": "IMS_SEGMENT",
        "description": "Expired PAUTDTL1 detail segments and PAUTSUM0 summary segments with zero counts",
        "copybook": null,
        "citation": [
          16,
          23
        ]
      }
    ],
    "called_programs": [],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Set default expiry days to 5 if parameter not numeric",
        "logic_summary": "MOVE P-EXPIRY-DAYS TO WS-EXPIRY-DAYS IF NUMERIC ELSE MOVE 5",
        "conditions": [
          "P-EXPIRY-DAYS IS NUMERIC"
        ],
        "citation": [
          62,
          65
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Default checkpoint frequency to 5 if parameter invalid",
        "logic_summary": "MOVE 5 TO P-CHKP-FREQ IF SPACES OR 0 OR LOW-VALUES",
        "conditions": [
          "P-CHKP-FREQ = SPACES OR 0 OR LOW-VALUES"
        ],
        "citation": [
          67,
          68
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Authorization qualifies for deletion if age in days exceeds expiry threshold",
        "logic_summary": "Compute WS-AUTH-DATE as 99999 - PA-AUTH-DATE-9C, WS-DAY-DIFF as CURRENT-YYDDD - WS-AUTH-DATE, qualify if >= WS-EXPIRY-DAYS",
        "conditions": [
          "WS-DAY-DIFF >= WS-EXPIRY-DAYS"
        ],
        "citation": [
          144,
          146,
          148
        ]
      },
      {
        "rule_id": "BR004",
        "description": "Decrement appropriate summary counters when detail qualifies for delete",
        "logic_summary": "If PA-AUTH-RESP-CODE = '00' subtract from approved count/amt else from declined",
        "conditions": [
          "PA-AUTH-RESP-CODE = '00'"
        ],
        "citation": [
          151,
          152,
          155
        ]
      },
      {
        "rule_id": "BR005",
        "description": "Delete summary if both approved and declined auth counts are <= 0",
        "logic_summary": "IF PA-APPROVED-AUTH-CNT <= 0 AND PA-APPROVED-AUTH-CNT <= 0 (note: likely typo for declined)",
        "conditions": [
          "PA-APPROVED-AUTH-CNT <= 0"
        ],
        "citation": [
          23
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "SYSIN",
          "fields_used": [
            "P-EXPIRY-DAYS",
            "P-CHKP-FREQ",
            "P-CHKP-DIS-FREQ",
            "P-DEBUG-FLAG"
          ],
          "citation": [
            55
          ]
        },
        {
          "source": "PAUTSUM0",
          "fields_used": [
            "PA-ACCT-ID"
          ],
          "citation": [
            98
          ]
        },
        {
          "source": "PAUTDTL1",
          "fields_used": [
            "PA-AUTH-DATE-9C",
            "PA-AUTH-RESP-CODE",
            "PA-APPROVED-AMT",
            "PA-TRANSACTION-AMT"
          ],
          "citation": [
            144,
            151
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "IMS AUTHDB (PAUTDTL1)",
          "fields_written": [
            "deleted expired details"
          ],
          "citation": [
            16
          ]
        },
        {
          "destination": "IMS AUTHDB (PAUTSUM0)",
          "fields_written": [
            "deleted empty summaries"
          ],
          "citation": [
            23
          ]
        },
        {
          "destination": "SYSPRINT",
          "fields_written": [
            "WS-NO-SUMRY-READ",
            "WS-NO-SUMRY-DELETED",
            "WS-NO-DTL-READ",
            "WS-NO-DTL-DELETED"
          ],
          "citation": [
            40,
            41,
            42,
            43
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-AUTH-DATE-9C",
          "output_field": "WS-AUTH-DATE",
          "transformation_description": "WS-AUTH-DATE = 99999 - PA-AUTH-DATE-9C to convert to YYDDD format",
          "citation": [
            144
          ]
        },
        {
          "input_field": "CURRENT-YYDDD",
          "output_field": "WS-DAY-DIFF",
          "transformation_description": "WS-DAY-DIFF = CURRENT-YYDDD - WS-AUTH-DATE to compute age in days",
          "citation": [
            146
          ]
        },
        {
          "input_field": "P-EXPIRY-DAYS",
          "output_field": "WS-EXPIRY-DAYS",
          "transformation_description": "Direct move if numeric, else default to 5",
          "citation": [
            62
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "PENDING-AUTH-SUMMARY",
        "purpose": "Data structure for IMS PAUTSUM0 authorization summary segment including PA-ACCT-ID, PA-APPROVED-AUTH-CNT, PA-APPROVED-AUTH-AMT",
        "location": "WORKING_STORAGE",
        "citation": 90
      },
      {
        "copybook_name": "PENDING-AUTH-DETAILS",
        "purpose": "Data structure for IMS PAUTDTL1 authorization detail segment including PA-AUTH-DATE-9C, PA-AUTH-RESP-CODE, PA-APPROVED-AMT, PA-TRANSACTION-AMT",
        "location": "WORKING_STORAGE",
        "citation": 122
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "CBPAUP0C",
        "summary": null,
        "purpose": "This is the program entry point paragraph, though minimally defined in the provided code snippet. Its primary purpose is to initiate the main processing flow by transferring control to MAIN-PARA implicitly via standard COBOL execution. It consumes no specific inputs beyond program-level environment. It produces no direct outputs but enables the overall cleanup orchestration. No business logic decisions are implemented here. No error handling is performed within this paragraph. It calls CIPAUSMY and CIPAUDTY as per static analysis, likely for IMS PCB setup or utility functions not visible in snippet. Control flows to MAIN-PARA for initialization and looping.",
        "called_by": [],
        "calls": [
          "CIPAUSMY",
          "CIPAUDTY"
        ],
        "citation": [
          23,
          23
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MAIN-PARA",
        "summary": null,
        "purpose": "This is the primary orchestration paragraph controlling the overall expired authorization cleanup flow. It begins by performing 1000-INITIALIZE to set up dates, parameters, and defaults from SYSIN. It then performs 2000-FIND-NEXT-AUTH-SUMMARY to read the first summary record. It enters an outer loop PERFORM UNTIL ERR-FLG-ON OR END-OF-AUTHDB, which iterates over summaries until end or error. Within the outer loop, it performs an inner PERFORM UNTIL NO-MORE-AUTHS: reading details via 3000-FIND-NEXT-AUTH-DTL, checking expiry via 4000-CHECK-IF-EXPIRED, deleting qualified details via 5000-DELETE-AUTH-DTL if QUALIFIED-FOR-DELETE, and looping to next detail. After inner loop, if PA-APPROVED-AUTH-CNT <= 0 (noting apparent code duplication/typo), it performs 6000-DELETE-AUTH-SUMMARY. It checks if WS-AUTH-SMRY-PROC-CNT > P-CHKP-FREQ to perform 9000-TAKE-CHECKPOINT and reset counter. It then loops to next summary. Upon outer loop exit, it takes a final checkpoint, displays processing statistics (reads/deletes for summaries/details), and GOBACKs. Error conditions propagate via flags/branches from subordinates, with abends delegated.",
        "called_by": [
          "CBPAUP0C"
        ],
        "calls": [
          "1000-INITIALIZE",
          "2000-FIND-NEXT-AUTH-SUMMARY",
          "3000-FIND-NEXT-AUTH-DTL",
          "4000-CHECK-IF-EXPIRED",
          "5000-DELETE-AUTH-DTL",
          "6000-DELETE-AUTH-SUMMARY",
          "9000-TAKE-CHECKPOINT"
        ],
        "citation": [
          136,
          182
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-INITIALIZE",
        "summary": null,
        "purpose": "This paragraph handles program initialization, consuming system dates and SYSIN parameters. It reads CURRENT-DATE from DATE and CURRENT-YYDDD from DAY, and PRM-INFO from SYSIN containing expiry days, checkpoint frequencies, and debug flag. It sets WS-EXPIRY-DAYS to P-EXPIRY-DAYS if numeric else defaults to 5; defaults P-CHKP-FREQ to 5 if invalid; defaults P-CHKP-DIS-FREQ to 10 if invalid; sets P-DEBUG-FLAG to 'N' if not 'Y'. It displays startup messages including parameters and date. Business logic enforces parameter validation with defaults for robustness. No file I/O or deletes; outputs to display. No subordinate calls. Errors in parameters are handled silently via defaults. Control returns via 1000-EXIT.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [],
        "citation": [
          183,
          211
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-EXIT",
        "summary": null,
        "purpose": "This is a simple exit paragraph for 1000-INITIALIZE. Its sole purpose is to EXIT, returning control to the caller (MAIN-PARA). It consumes no data. It produces no outputs or modifications. No business logic, conditions, or error handling. No calls made. Ensures clean flow return after initialization.",
        "called_by": [
          "1000-INITIALIZE"
        ],
        "calls": [],
        "citation": [
          212,
          215
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
        "summary": null,
        "purpose": "This paragraph retrieves the next pending authorization summary segment from IMS AUTHDB using unqualified GN call. It conditionally displays debug info if DEBUG-ON. It executes DLI GN on PAUTSUM0 into PENDING-AUTH-SUMMARY using PAUT-PCB-NUM. Evaluates DIBSTAT: if blank, sets NOT-END-OF-AUTHDB, increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT, moves PA-ACCT-ID to WS-CURR-APP-ID. If 'GB', sets END-OF-AUTHDB. Other statuses display error details and perform 9999-ABEND. Business logic handles successful read, EOF, and errors. Inputs from IMS PCB; outputs flags/counters. Error handling abends on failure. Returns via 2000-EXIT.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "9999-ABEND"
        ],
        "citation": [
          216,
          242
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-EXIT",
        "summary": null,
        "purpose": "Simple exit paragraph for 2000-FIND-NEXT-AUTH-SUMMARY. Performs EXIT to return control to MAIN-PARA loop. No inputs consumed, no outputs produced, no logic or errors handled, no calls.",
        "called_by": [
          "2000-FIND-NEXT-AUTH-SUMMARY"
        ],
        "calls": [],
        "citation": [
          243,
          247
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
        "summary": null,
        "purpose": "Retrieves next authorization detail segment under current summary using qualified GNP call. Displays debug read count if DEBUG-ON. Executes DLI GNP on PAUTDTL1 into PENDING-AUTH-DETAILS via PAUT-PCB-NUM. Evaluates DIBSTAT: blank sets MORE-AUTHS and inc WS-NO-DTL-READ; 'GE' or 'GB' sets NO-MORE-AUTHS; other displays errors (status, app ID, read count) and 9999-ABEND. Inputs IMS PCB/prior summary; outputs flags/counters. Business logic distinguishes path/parent/end. Errors abend. Drives inner loop termination.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "9999-ABEND"
        ],
        "citation": [
          248,
          272
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3000-EXIT",
        "summary": null,
        "purpose": "Simple exit for 3000-FIND-NEXT-AUTH-DTL, EXIT to MAIN-PARA. No data flow, logic, errors, or calls.",
        "called_by": [
          "3000-FIND-NEXT-AUTH-DTL"
        ],
        "calls": [],
        "citation": [
          273,
          276
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "4000-CHECK-IF-EXPIRED",
        "summary": null,
        "purpose": "Determines if current detail authorization is expired. Computes WS-AUTH-DATE = 99999 - PA-AUTH-DATE-9C and WS-DAY-DIFF = CURRENT-YYDDD - WS-AUTH-DATE. If WS-DAY-DIFF >= WS-EXPIRY-DAYS, sets QUALIFIED-FOR-DELETE and adjusts summary counters: if PA-AUTH-RESP-CODE='00' decrement approved count/amt else declined count/amt. Else sets NOT-QUALIFIED-FOR-DELETE. Inputs detail fields/date; outputs flags and modified summary counters (PA-APPROVED-AUTH-CNT etc.). Core business logic for expiry check and counter maintenance. No errors/files; no calls. Flags drive delete decision in MAIN-PARA.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [],
        "citation": [
          277,
          298
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "4000-EXIT",
        "summary": null,
        "purpose": "Simple exit for 4000-CHECK-IF-EXPIRED, EXIT to MAIN-PARA. Minimal, no logic/data/errors/calls.",
        "called_by": [
          "4000-CHECK-IF-EXPIRED"
        ],
        "calls": [],
        "citation": [
          299,
          302
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "DIBSTAT OTHER than '  ' or 'GB' in summary read",
        "action": "DISPLAY error details and PERFORM 9999-ABEND",
        "citation": [
          102
        ]
      },
      {
        "condition": "DIBSTAT OTHER than '  ', 'GE', 'GB' in detail read",
        "action": "DISPLAY error details and PERFORM 9999-ABEND",
        "citation": [
          131
        ]
      },
      {
        "condition": "ERR-FLG-ON",
        "action": "Terminate outer loop in MAIN-PARA",
        "citation": [
          9
        ]
      },
      {
        "condition": "END-OF-AUTHDB",
        "action": "Terminate outer loop after setting from 'GB'",
        "citation": [
          100
        ]
      },
      {
        "condition": "NO-MORE-AUTHS",
        "action": "Terminate inner detail loop",
        "citation": [
          13
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [],
    "open_questions": [
      {
        "question": "Implementation details of 5000-DELETE-AUTH-DTL, 6000-DELETE-AUTH-SUMMARY, 9000-TAKE-CHECKPOINT, 9999-ABEND",
        "context": "Source code snippet cuts off before these paragraphs; only referenced in PERFORMs and calls",
        "suggestion": "Provide full source file to analyze DLI delete calls, checkpoint logic, and abend procedure"
      },
      {
        "question": "Exact copybook definitions and full working storage layout",
        "context": "No COPY statements or WS definitions visible in snippet",
        "suggestion": "Include preceding divisions or separate copybook files"
      },
      {
        "question": "Line number discrepancies between outline and snippet",
        "context": "Outline cites MAIN-PARA at 136-182 but snippet shows logic at ~3-47",
        "suggestion": "Confirm full file line numbering"
      },
      {
        "question": "Purpose of called programs CIPAUSMY, CIPAUDTY",
        "context": "Referenced in outline for CBPAUP0C but no CALL statements in snippet",
        "suggestion": "Static analysis log or full code"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-23T20:51:01.419616"
}