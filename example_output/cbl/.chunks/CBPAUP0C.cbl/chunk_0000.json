{
  "batch_idx": 0,
  "total_batches": 2,
  "template": {
    "header": {
      "program_id": "CBPAUP0C",
      "file_name": "CBPAUP0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T17:33:42.538381",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This program CBPAUP0C deletes expired authorization details from the IMS database. It reads authorization summary and detail segments, checks if the authorization is expired based on a configurable expiry period, and deletes the detail segment if expired, also updating summary counts. The program takes checkpoint periodically and displays summary statistics before terminating.",
      "business_context": "This program likely serves in an authorization management process, ensuring that outdated authorizations are removed from the system to maintain data accuracy and compliance.",
      "program_type": "BATCH",
      "citations": [
        5,
        14,
        47
      ]
    },
    "inputs": [
      {
        "name": "SYSIN",
        "io_type": "PARAMETER",
        "description": "Contains parameter information (PRM-INFO) including expiry days (P-EXPIRY-DAYS), checkpoint frequency (P-CHKP-FREQ), display frequency (P-CHKP-DIS-FREQ), and debug flag (P-DEBUG-FLAG).",
        "copybook": null,
        "citation": [
          55,
          58
        ]
      },
      {
        "name": "PAUTSUM0",
        "io_type": "IMS_SEGMENT",
        "description": "Pending Authorization Summary segment from IMS database, containing summary information about authorizations.",
        "copybook": null,
        "citation": [
          89,
          90
        ]
      },
      {
        "name": "PAUTDTL1",
        "io_type": "IMS_SEGMENT",
        "description": "Pending Authorization Details segment from IMS database, containing details of individual authorizations.",
        "copybook": null,
        "citation": [
          120,
          121
        ]
      }
    ],
    "outputs": [
      {
        "name": "IMS Database (PAUTSUM0, PAUTDTL1)",
        "io_type": "IMS_SEGMENT",
        "description": "The program modifies and deletes authorization detail (PAUTDTL1) and summary (PAUTSUM0) segments in the IMS database.",
        "copybook": null,
        "citation": [
          17,
          24
        ]
      },
      {
        "name": "SYSOUT",
        "io_type": "REPORT",
        "description": "Displays program start message, parameter information, current date, and summary statistics of processed and deleted records.",
        "copybook": null,
        "citation": [
          56,
          58,
          59,
          40,
          41,
          42,
          43
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "CIPAUSMY",
        "call_type": "UNKNOWN",
        "purpose": "UNKNOWN",
        "parameters": [],
        "citation": null
      },
      {
        "program_name": "CIPAUDTY",
        "call_type": "UNKNOWN",
        "purpose": "UNKNOWN",
        "parameters": [],
        "citation": null
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Authorization details are considered expired if the difference between the current date and the authorization date is greater than or equal to the configured expiry days.",
        "logic_summary": "Calculates the difference between the current date (CURRENT-YYDDD) and the authorization date (PA-AUTH-DATE-9C), and compares it to the expiry days (WS-EXPIRY-DAYS).",
        "conditions": [
          "WS-DAY-DIFF >= WS-EXPIRY-DAYS"
        ],
        "citation": [
          146,
          148
        ]
      },
      {
        "rule_id": "BR002",
        "description": "If an authorization detail is expired and the authorization response code is '00' (approved), the approved authorization count and amount in the summary record are decremented.",
        "logic_summary": "Checks PA-AUTH-RESP-CODE and subtracts from PA-APPROVED-AUTH-CNT and PA-APPROVED-AUTH-AMT if the code is '00'.",
        "conditions": [
          "PA-AUTH-RESP-CODE = '00'"
        ],
        "citation": [
          151,
          152,
          153
        ]
      },
      {
        "rule_id": "BR003",
        "description": "If an authorization detail is expired and the authorization response code is not '00' (declined), the declined authorization count and amount in the summary record are decremented.",
        "logic_summary": "Checks PA-AUTH-RESP-CODE and subtracts from PA-DECLINED-AUTH-CNT and PA-TRANSACTION-AMT if the code is not '00'.",
        "conditions": [
          "PA-AUTH-RESP-CODE not = '00'"
        ],
        "citation": [
          151,
          155,
          156
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "SYSIN",
          "fields_used": [
            "P-EXPIRY-DAYS",
            "P-CHKP-FREQ",
            "P-CHKP-DIS-FREQ",
            "P-DEBUG-FLAG"
          ],
          "citation": [
            55
          ]
        },
        {
          "source": "PAUTSUM0",
          "fields_used": [
            "PA-ACCT-ID",
            "PA-APPROVED-AUTH-CNT",
            "PA-APPROVED-AUTH-AMT",
            "PA-DECLINED-AUTH-CNT",
            "PA-DECLINED-AUTH-AMT"
          ],
          "citation": [
            90
          ]
        },
        {
          "source": "PAUTDTL1",
          "fields_used": [
            "PA-AUTH-DATE-9C",
            "PA-AUTH-RESP-CODE",
            "PA-APPROVED-AMT",
            "PA-TRANSACTION-AMT"
          ],
          "citation": [
            121
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "PAUTSUM0",
          "fields_written": [
            "PA-APPROVED-AUTH-CNT",
            "PA-APPROVED-AUTH-AMT",
            "PA-DECLINED-AUTH-CNT",
            "PA-DECLINED-AUTH-AMT"
          ],
          "citation": [
            152,
            153,
            155,
            156
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "P-EXPIRY-DAYS",
          "output_field": "WS-EXPIRY-DAYS",
          "transformation_description": "Moves the value of P-EXPIRY-DAYS to WS-EXPIRY-DAYS if P-EXPIRY-DAYS is numeric; otherwise, moves 5 to WS-EXPIRY-DAYS.",
          "citation": [
            63,
            65
          ]
        },
        {
          "input_field": "PA-AUTH-DATE-9C",
          "output_field": "WS-AUTH-DATE",
          "transformation_description": "Calculates WS-AUTH-DATE by subtracting PA-AUTH-DATE-9C from 99999.",
          "citation": [
            144
          ]
        },
        {
          "input_field": "CURRENT-YYDDD, WS-AUTH-DATE",
          "output_field": "WS-DAY-DIFF",
          "transformation_description": "Calculates WS-DAY-DIFF by subtracting WS-AUTH-DATE from CURRENT-YYDDD.",
          "citation": [
            146
          ]
        }
      ]
    },
    "copybooks_used": [],
    "paragraphs": [
      {
        "paragraph_name": "CBPAUP0C",
        "summary": null,
        "purpose": "This is the program entry point. It is a simple paragraph that calls two other programs, CIPAUSMY and CIPAUDTY, before terminating. The purpose of these called programs is unknown from the provided code snippet. Without further context, it's impossible to determine the exact function or data flow within these external calls. The program does not perform any data manipulation or decision-making logic directly within this paragraph.",
        "called_by": [],
        "calls": [
          "CIPAUSMY",
          "CIPAUDTY"
        ],
        "citation": [
          1,
          1
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MAIN-PARA",
        "summary": null,
        "purpose": "This paragraph is the main control loop of the program. It first performs 1000-INITIALIZE to set up the program environment. Then, it enters a loop that continues until either an error flag (ERR-FLG-ON) is set or the end of the authorization database (END-OF-AUTHDB) is reached. Inside this main loop, it retrieves the next authorization summary record using 2000-FIND-NEXT-AUTH-SUMMARY. A nested loop then processes authorization details associated with the current summary record, using 3000-FIND-NEXT-AUTH-DTL to retrieve each detail. For each detail record, 4000-CHECK-IF-EXPIRED determines if the authorization has expired, and if so, 5000-DELETE-AUTH-DTL is performed to remove the expired detail. After processing all details for a summary, 6000-DELETE-AUTH-SUMMARY is called if the approved authorization count is zero. Periodically, based on WS-AUTH-SMRY-PROC-CNT and P-CHKP-FREQ, 9000-TAKE-CHECKPOINT is performed to save the program's state. Finally, the program displays summary statistics about the number of records read and deleted before terminating.",
        "called_by": [],
        "calls": [
          "1000-INITIALIZE",
          "2000-FIND-NEXT-AUTH-SUMMARY",
          "3000-FIND-NEXT-AUTH-DTL",
          "4000-CHECK-IF-EXPIRED",
          "5000-DELETE-AUTH-DTL",
          "6000-DELETE-AUTH-SUMMARY",
          "9000-TAKE-CHECKPOINT",
          "9000-TAKE-CHECKPOINT"
        ],
        "citation": [
          3,
          47
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-INITIALIZE",
        "summary": null,
        "purpose": "This paragraph initializes the program environment. It accepts the current date and day from the system. It then accepts parameter information (PRM-INFO) from SYSIN, displaying it along with the current date. It checks if the expiry days (P-EXPIRY-DAYS), checkpoint frequency (P-CHKP-FREQ), and display frequency (P-CHKP-DIS-FREQ) parameters are numeric and not spaces/zeros/low-values. If P-EXPIRY-DAYS is numeric, its value is moved to WS-EXPIRY-DAYS; otherwise, 5 is moved to WS-EXPIRY-DAYS. If P-CHKP-FREQ is spaces, 0, or low-values, 5 is moved to it. If P-CHKP-DIS-FREQ is spaces, 0, or low-values, 10 is moved to it. Finally, it checks if the debug flag (P-DEBUG-FLAG) is not 'Y', and if so, moves 'N' to it. This paragraph ensures that the program has valid configuration values before proceeding with the main processing logic.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [],
        "citation": [
          49,
          77
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, marking the end of the 1000-INITIALIZE paragraph. It serves as a standard exit point for the PERFORM THRU construct used in COBOL.",
        "called_by": [],
        "calls": [],
        "citation": [
          78,
          79
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
        "summary": null,
        "purpose": "This paragraph retrieves the next authorization summary record from the IMS database. It first checks if the debug flag is on and displays a debug message. Then, it executes a DLI GN (Get Next) command to read the PAUTSUM0 segment into PENDING-AUTH-SUMMARY. The DIBSTAT value is then evaluated to determine the status of the read. If DIBSTAT is '  ' (success), NOT-END-OF-AUTHDB is set to TRUE, counters WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT are incremented, and PA-ACCT-ID is moved to WS-CURR-APP-ID. If DIBSTAT is 'GB' (end of database), END-OF-AUTHDB is set to TRUE. If DIBSTAT is any other value, an error message is displayed along with the number of summary records read, and the program abends using 9999-ABEND. This paragraph handles the retrieval of authorization summary records and any associated errors.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "9999-ABEND"
        ],
        "citation": [
          81,
          107
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, marking the end of the 2000-FIND-NEXT-AUTH-SUMMARY paragraph. It serves as a standard exit point for the PERFORM THRU construct used in COBOL.",
        "called_by": [],
        "calls": [],
        "citation": [
          109,
          110
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
        "summary": null,
        "purpose": "This paragraph retrieves the next authorization detail record from the IMS database. It first checks if the debug flag is on and displays a debug message. Then, it executes a DLI GNP (Get Next within Parent) command to read the PAUTDTL1 segment into PENDING-AUTH-DETAILS. The DIBSTAT value is then evaluated to determine the status of the read. If DIBSTAT is '  ' (success), MORE-AUTHS is set to TRUE, and the WS-NO-DTL-READ counter is incremented. If DIBSTAT is 'GE' or 'GB' (end of group or database), NO-MORE-AUTHS is set to TRUE. If DIBSTAT is any other value, an error message is displayed along with the summary account ID and the number of detail records read, and the program abends using 9999-ABEND. This paragraph handles the retrieval of authorization detail records and any associated errors.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "9999-ABEND"
        ],
        "citation": [
          112,
          136
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3000-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, marking the end of the 3000-FIND-NEXT-AUTH-DTL paragraph. It serves as a standard exit point for the PERFORM THRU construct used in COBOL.",
        "called_by": [],
        "calls": [],
        "citation": [
          138,
          139
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "4000-CHECK-IF-EXPIRED",
        "summary": null,
        "purpose": "This paragraph determines if an authorization detail record is expired. It calculates WS-AUTH-DATE by subtracting PA-AUTH-DATE-9C from 99999. Then, it calculates WS-DAY-DIFF by subtracting WS-AUTH-DATE from CURRENT-YYDDD. If WS-DAY-DIFF is greater than or equal to WS-EXPIRY-DAYS, QUALIFIED-FOR-DELETE is set to TRUE. If the authorization response code (PA-AUTH-RESP-CODE) is '00' (approved), the approved authorization count (PA-APPROVED-AUTH-CNT) and amount (PA-APPROVED-AUTH-AMT) in the summary record are decremented. Otherwise (if the response code is not '00'), the declined authorization count (PA-DECLINED-AUTH-CNT) and transaction amount (PA-TRANSACTION-AMT) in the summary record are decremented. If the authorization is not expired, NOT-QUALIFIED-FOR-DELETE is set to TRUE. This paragraph implements the core business rule for determining authorization expiry and updating the summary record accordingly.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [],
        "citation": [
          141,
          162
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "4000-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, marking the end of the 4000-CHECK-IF-EXPIRED paragraph. It serves as a standard exit point for the PERFORM THRU construct used in COBOL.",
        "called_by": [],
        "calls": [],
        "citation": [
          164,
          165
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "DIBSTAT not equal to '  ', 'GB', or 'GE' in 2000-FIND-NEXT-AUTH-SUMMARY",
        "action": "DISPLAY error message and ABEND",
        "citation": [
          102,
          105
        ]
      },
      {
        "condition": "DIBSTAT not equal to '  ', 'GB', or 'GE' in 3000-FIND-NEXT-AUTH-DTL",
        "action": "DISPLAY error message and ABEND",
        "citation": [
          131,
          134
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [],
    "open_questions": [
      {
        "question": "What is the purpose of programs CIPAUSMY and CIPAUDTY called at the beginning of CBPAUP0C?",
        "context": "The code does not provide any information about the function of these programs.",
        "suggestion": "Review the documentation or source code for CIPAUSMY and CIPAUDTY."
      },
      {
        "question": "What is the structure of the IMS segments PAUTSUM0 and PAUTDTL1?",
        "context": "The code only shows the usage of these segments, not their definition.",
        "suggestion": "Review the IMS database schema or copybooks associated with these segments."
      },
      {
        "question": "What is the purpose of the 5000-DELETE-AUTH-DTL, 6000-DELETE-AUTH-SUMMARY and 9000-TAKE-CHECKPOINT paragraphs?",
        "context": "The provided code snippet does not include these paragraphs.",
        "suggestion": "Review the complete source code to understand the purpose of these paragraphs."
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-24T10:33:42.545886"
}