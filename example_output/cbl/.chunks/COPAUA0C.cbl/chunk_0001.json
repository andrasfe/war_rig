{
  "batch_idx": 1,
  "total_batches": 5,
  "template": {
    "header": {
      "program_id": "COPAUA0C",
      "file_name": "cbl/COPAUA0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:25:06.537029",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This CICS online program processes credit card authorization requests received from an MQ queue. It extracts and parses the request message containing transaction details like card number, amount, merchant info, then reads related records from VSAM files (XREF, ACCOUNT) to validate and gather data for an authorization decision. It orchestrates reads, decision making, response sending via MQ, and writing auth summary to a database if card is found.",
      "business_context": "Credit card authorization processing for transactions from merchants via POS, involving card validation against cross-reference, account, and customer master files.",
      "program_type": "ONLINE_CICS",
      "citations": [
        351,
        386,
        438
      ]
    },
    "inputs": [
      {
        "name": "REQUEST-MQ",
        "io_type": "CICS_QUEUE",
        "description": "Incoming authorization request messages in comma-delimited string format containing auth date, time, card num, amount, merchant details, etc.",
        "copybook": null,
        "citation": [
          386,
          433
        ]
      },
      {
        "name": "WS-CCXREF-FILE",
        "io_type": "FILE_VSAM",
        "description": "Card cross-reference file used to lookup account ID by card number.",
        "copybook": "CARD-XREF-RECORD",
        "citation": [
          472,
          515
        ]
      },
      {
        "name": "WS-ACCTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Account master file containing account details, read using account ID from XREF.",
        "copybook": "ACCOUNT-RECORD",
        "citation": [
          520,
          563
        ]
      }
    ],
    "outputs": [
      {
        "name": "RESPONSE-MQ",
        "io_type": "CICS_QUEUE",
        "description": "Authorization response sent back via MQ (inferred from 7100-SEND-RESPONSE).",
        "copybook": null,
        "citation": [
          438
        ]
      },
      {
        "name": "AUTH-SUMMARY-DB",
        "io_type": "FILE_VSAM",
        "description": "Updated authorization summary record written to database if card found.",
        "copybook": null,
        "citation": [
          438
        ]
      }
    ],
    "called_programs": [],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Approve authorization by default unless subsequent checks fail.",
        "logic_summary": "Sets APPROVE-AUTH to TRUE at start of processing.",
        "conditions": [
          "SET APPROVE-AUTH TO TRUE"
        ],
        "citation": [
          438
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Only read account, customer, auth summary, and profile if card found in XREF.",
        "logic_summary": "Conditional PERFORMs after checking CARD-FOUND-XREF.",
        "conditions": [
          "IF CARD-FOUND-XREF"
        ],
        "citation": [
          438,
          472
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "REQUEST-MQ",
          "fields_used": [
            "PA-RQ-AUTH-DATE",
            "PA-RQ-CARD-NUM",
            "PA-RQ-TRANSACTION-ID"
          ],
          "citation": [
            351,
            386
          ]
        },
        {
          "source": "WS-CCXREF-FILE",
          "fields_used": [
            "XREF-ACCT-ID"
          ],
          "citation": [
            472
          ]
        },
        {
          "source": "WS-ACCTFILENAME",
          "fields_used": [
            "ACCOUNT-RECORD fields"
          ],
          "citation": [
            520
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "PA-RQ-* fields",
          "fields_written": [
            "PA-RQ-TRANSACTION-AMT"
          ],
          "citation": [
            351
          ]
        },
        {
          "destination": "AUTH-SUMMARY-DB",
          "fields_written": [
            "Authorization summary"
          ],
          "citation": [
            438
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "WS-TRANSACTION-AMT-AN",
          "output_field": "PA-RQ-TRANSACTION-AMT",
          "transformation_description": "Numeric conversion using FUNCTION NUMVAL on alphanumeric amount from UNSTRING.",
          "citation": [
            351
          ]
        },
        {
          "input_field": "PA-RQ-CARD-NUM",
          "output_field": "XREF-CARD-NUM",
          "transformation_description": "Direct MOVE to key for XREF file read.",
          "citation": [
            472
          ]
        },
        {
          "input_field": "XREF-ACCT-ID",
          "output_field": "WS-CARD-RID-ACCT-ID",
          "transformation_description": "MOVE to construct RIDFLD for account file read.",
          "citation": [
            520
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "CARD-XREF-RECORD",
        "purpose": "Defines structure for card cross-reference VSAM record including XREF-CARD-NUM and XREF-ACCT-ID.",
        "location": "WORKING_STORAGE",
        "citation": 472
      },
      {
        "copybook_name": "ACCOUNT-RECORD",
        "purpose": "Defines structure for account master VSAM record.",
        "location": "WORKING_STORAGE",
        "citation": 520
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "2100-EXTRACT-REQUEST-MSG",
        "summary": null,
        "purpose": "This paragraph parses the incoming MQ request buffer into individual authorization request fields using UNSTRING delimited by commas. It consumes the raw buffer data from W01-GET-BUFFER after MQGET in prior paragraph, extracting fields like PA-RQ-AUTH-DATE, PA-RQ-CARD-NUM, merchant details, and transaction amount as alphanumeric. It produces populated PA-RQ-* working storage fields, including numeric conversion of transaction amount via FUNCTION NUMVAL into PA-RQ-TRANSACTION-AMT and WS-TRANSACTION-AMT. No business decisions or error handling here; it's pure data extraction. No calls to other paragraphs. Control flows to 2100-EXIT.",
        "called_by": [],
        "calls": [],
        "citation": [
          351,
          381
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2100-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply executes EXIT to return control to the calling paragraph. It consumes no inputs and produces no outputs. No business logic, decisions, error handling, or calls. Serves as a thru-exit point for 2100-EXTRACT-REQUEST-MSG.",
        "called_by": [],
        "calls": [],
        "citation": [
          382,
          385
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3100-READ-REQUEST-MQ",
        "summary": null,
        "purpose": "This paragraph reads the next authorization request message from the MQ queue using CALL 'MQGET' with options for no-syncpoint, wait interval, convert, and fail-if-quiescing. It consumes MQ connection/handle (W01-HCONN-REQUEST, W01-HOBJ-REQUEST) and sets message descriptor fields like MQMD-FORMAT to STRING. On success (MQCC-OK), it saves correlid and reply-to queue name, populates W01-DATALEN and buffer for subsequent parsing. On failure, if no message available (MQRC-NO-MSG-AVAILABLE), sets NO-MORE-MSG-AVAILABLE flag; otherwise, logs critical CICS error via 9500-LOG-ERROR with codes and 'FAILED TO READ REQUEST MQ' message using PA-CARD-NUM as key. Error handling distinguishes non-critical EOF from critical MQ errors. Calls 9500-LOG-ERROR on MQ failures.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          386,
          433
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "3100-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply executes EXIT to return control to the calling paragraph. It consumes no inputs and produces no outputs. No business logic, decisions, error handling, or calls. Serves as a thru-exit point for 3100-READ-REQUEST-MQ.",
        "called_by": [],
        "calls": [],
        "citation": [
          434,
          437
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5000-PROCESS-AUTH",
        "summary": null,
        "purpose": "This is the main authorization processing orchestration paragraph that handles a single request after extraction. It consumes parsed PA-RQ-* fields and flags like CARD-FOUND-XREF, setting initial APPROVE-AUTH to TRUE. It first performs 1200-SCHEDULE-PSB for PSB setup, then assumes/sets card and account found flags, and conditionally reads XREF, ACCT, CUST, AUTH-SUMMARY, PROFILE based on CARD-FOUND-XREF. After reads, it performs decision making (6000-MAKE-DECISION), sends response (7100-SEND-RESPONSE), and if card found, writes auth to DB (8000-WRITE-AUTH-TO-DB). No direct error handling here; relies on subordinate paragraphs. Calls multiple read and processing paragraphs to gather data for auth decision.",
        "called_by": [],
        "calls": [
          "1200-SCHEDULE-PSB",
          "5100-READ-XREF-RECORD",
          "5200-READ-ACCT-RECORD",
          "5300-READ-CUST-RECORD",
          "5500-READ-AUTH-SUMMRY",
          "5600-READ-PROFILE-DATA",
          "6000-MAKE-DECISION",
          "7100-SEND-RESPONSE",
          "8000-WRITE-AUTH-TO-DB"
        ],
        "citation": [
          438,
          467
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5000-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply executes EXIT to return control to the calling paragraph. It consumes no inputs and produces no outputs. No business logic, decisions, error handling, or calls. Serves as a thru-exit point for 5000-PROCESS-AUTH.",
        "called_by": [],
        "calls": [],
        "citation": [
          468,
          471
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5100-READ-XREF-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the card cross-reference record from VSAM file WS-CCXREF-FILE using CICS READ DATASET with key XREF-CARD-NUM from PA-RQ-CARD-NUM. It consumes PA-RQ-CARD-NUM moved to XREF-CARD-NUM and populates CARD-XREF-RECORD area. On NORMAL resp, sets CARD-FOUND-XREF TRUE; on NOTFND, sets CARD-NFOUND-XREF and NFOUND-ACCT-IN-MSTR TRUE, logs WARNING 'A001' 'CARD NOT FOUND IN XREF'; on other errors, logs CRITICAL 'C001' CICS error with resp/reas codes. Error handling via EVALUATE on WS-RESP-CD triggers 9500-LOG-ERROR with appropriate severity and event key. Provides XREF-ACCT-ID for subsequent account read. Calls 9500-LOG-ERROR on errors.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          472,
          515
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5100-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply executes EXIT to return control to the calling paragraph. It consumes no inputs and produces no outputs. No business logic, decisions, error handling, or calls. Serves as a thru-exit point for 5100-READ-XREF-RECORD.",
        "called_by": [],
        "calls": [],
        "citation": [
          516,
          519
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5200-READ-ACCT-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the account record from VSAM file WS-ACCTFILENAME using CICS READ DATASET with RIDFLD constructed from XREF-ACCT-ID. It consumes XREF-ACCT-ID moved to WS-CARD-RID-ACCT-ID-X and populates ACCOUNT-RECORD area. On NORMAL resp, sets FOUND-ACCT-IN-MSTR TRUE; on NOTFND, sets NFOUND-ACCT-IN-MSTR TRUE, logs WARNING 'A002' 'ACCT NOT FOUND IN XREF'; on other errors, logs CRITICAL 'C002' CICS error with resp/reas codes and event key WS-CARD-RID-ACCT-ID-X. Error handling via EVALUATE on WS-RESP-CD triggers 9500-LOG-ERROR. Provides account data for further processing like customer read.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          520,
          563
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5200-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply executes EXIT to return control to the calling paragraph. It consumes no inputs and produces no outputs. No business logic, decisions, error handling, or calls. Serves as a thru-exit point for 5200-READ-ACCT-RECORD.",
        "called_by": [],
        "calls": [],
        "citation": [
          564,
          567
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "MQGET WS-COMPCODE NOT = MQCC-OK and WS-REASON NOT = MQRC-NO-MSG-AVAILABLE",
        "action": "Set critical CICS error, PERFORM 9500-LOG-ERROR with 'M003' and MQ codes",
        "citation": [
          386
        ]
      },
      {
        "condition": "CICS READ XREF WS-RESP-CD = NOTFND",
        "action": "Set warning APP error 'A001', PERFORM 9500-LOG-ERROR",
        "citation": [
          472
        ]
      },
      {
        "condition": "CICS READ XREF WS-RESP-CD OTHER",
        "action": "Set critical CICS error 'C001', PERFORM 9500-LOG-ERROR",
        "citation": [
          472
        ]
      },
      {
        "condition": "CICS READ ACCT WS-RESP-CD = NOTFND",
        "action": "Set warning APP error 'A002', PERFORM 9500-LOG-ERROR",
        "citation": [
          520
        ]
      },
      {
        "condition": "CICS READ ACCT WS-RESP-CD OTHER",
        "action": "Set critical CICS error 'C002', PERFORM 9500-LOG-ERROR",
        "citation": [
          520
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "READ DATASET",
        "resource": "WS-CCXREF-FILE",
        "purpose": "Retrieve card cross-reference record by card number key.",
        "citation": 472
      },
      {
        "command": "READ DATASET",
        "resource": "WS-ACCTFILENAME",
        "purpose": "Retrieve account record by account ID RIDFLD.",
        "citation": 520
      }
    ],
    "open_questions": [
      {
        "question": "What are the contents and logic of called paragraphs like 1200-SCHEDULE-PSB, 5300-READ-CUST-RECORD, 6000-MAKE-DECISION?",
        "context": "AST snippet does not include these paragraphs.",
        "suggestion": "Provide full AST or source for remaining paragraphs."
      },
      {
        "question": "What is the program entry point and overall mainline flow?",
        "context": "Only partial paragraphs provided; no MAIN or 0000-INIT visible.",
        "suggestion": "Include earlier AST sections."
      },
      {
        "question": "Details of copybooks for PA-RQ-*, W01-*, MQM-* structures?",
        "context": "Fields referenced but no COPY statements in snippet.",
        "suggestion": "Analyze WORKING-STORAGE SECTION."
      },
      {
        "question": "Exact output queue for responses and DB file for AUTH summary?",
        "context": "Inferred from PERFORMs but not detailed in snippet.",
        "suggestion": "Examine 7100-SEND-RESPONSE and 8000-WRITE-AUTH-TO-DB."
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:25:06.538632"
}