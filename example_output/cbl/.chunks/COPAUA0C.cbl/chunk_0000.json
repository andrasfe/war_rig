{
  "batch_idx": 0,
  "total_batches": 5,
  "template": {
    "header": {
      "program_id": "COPAUA0C",
      "file_name": "cbl/COPAUA0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:21:23.456223",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "COPAUA0C is a CICS COBOL program that processes authorization requests from an IBM MQ request queue in a loop until a processing limit is reached or no more messages are available. It initializes by retrieving MQ trigger message data via CICS RETRIEVE, opens the request queue using MQOPEN, schedules an IMS PSB, extracts and processes each auth request involving IMS database reads and updates, commits via SYNCPOINT, and terminates by closing resources. The program logs errors to a common routine and returns to CICS upon completion.",
      "business_context": "Serves credit card or payment authorization processing, validating card/account status from IMS databases (XREF, ACCT, CUST, AUTH-SUMMARY), making approve/decline decisions, and inserting auth records.",
      "program_type": "ONLINE_CICS",
      "citations": [
        23,
        220,
        230,
        323
      ]
    },
    "inputs": [
      {
        "name": "MQTM",
        "io_type": "CICS_COMMAREA",
        "description": "MQ trigger message containing queue name (MQTM-QNAME) and trigger data (MQTM-TRIGGERDATA) retrieved via CICS RETRIEVE to initialize request queue name",
        "copybook": "MQTM",
        "citation": [
          237
        ]
      },
      {
        "name": "WS-REQUEST-QNAME (MQ Request Queue)",
        "io_type": "OTHER",
        "description": "IBM MQ queue for authorization request messages, read via MQGET in 3100-READ-REQUEST-MQ",
        "copybook": null,
        "citation": [
          323,
          389
        ]
      },
      {
        "name": "IMS Databases (XREF, ACCT, CUST, AUTH-SUMMARY)",
        "io_type": "IMS_SEGMENT",
        "description": "IMS DL/I segments read for card cross-reference, account, customer, and auth summary records during auth processing",
        "copybook": null,
        "citation": [
          510,
          520,
          530,
          550
        ]
      }
    ],
    "outputs": [
      {
        "name": "Response MQ Queue",
        "io_type": "OTHER",
        "description": "IBM MQ queue for sending authorization responses via MQPUT in 7100-SEND-RESPONSE",
        "copybook": null,
        "citation": [
          710
        ]
      },
      {
        "name": "IMS AUTH Records",
        "io_type": "IMS_SEGMENT",
        "description": "Updated/inserted authorization records and summary in IMS databases",
        "copybook": null,
        "citation": [
          840,
          850
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "MQOPEN",
        "call_type": "DYNAMIC_CALL",
        "purpose": "Opens the MQ request queue for input-shared access",
        "parameters": [
          "W01-HCONN-REQUEST",
          "MQM-OD-REQUEST",
          "WS-OPTIONS",
          "W01-HOBJ-REQUEST"
        ],
        "citation": 260
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Approve or decline auth based on account status, available balance, and card validity",
        "logic_summary": "Reads XREF/ACCT/CUST, computes available amount, checks limits in 5000-PROCESS-AUTH and 6000-MAKE-DECISION",
        "conditions": [
          "CARD-FOUND-XREF",
          "FOUND-ACCT-IN-MSTR",
          "WS-AVAILABLE-AMT >= PA-RQ-TRANSACTION-AMT"
        ],
        "citation": [
          500,
          600,
          666
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Limit processing to WS-REQSTS-PROCESS-LIMIT messages per run",
        "logic_summary": "Increment WS-MSG-PROCESSED and exit loop if exceeds limit",
        "conditions": [
          "WS-MSG-PROCESSED > WS-REQSTS-PROCESS-LIMIT"
        ],
        "citation": [
          323
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Log critical errors (MQ open fail, IMS PSB sched fail) and continue or abend based on ERR-CRITICAL",
        "logic_summary": "Set error flags and PERFORM 9500-LOG-ERROR on compcode != OK or status != OK",
        "conditions": [
          "WS-COMPCODE = MQCC-OK",
          "STATUS-OK"
        ],
        "citation": [
          260,
          292
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "MQTM",
          "fields_used": [
            "MQTM-QNAME",
            "MQTM-TRIGGERDATA"
          ],
          "citation": [
            237
          ]
        },
        {
          "source": "MQ Request Queue",
          "fields_used": [
            "Request message data"
          ],
          "citation": [
            310
          ]
        },
        {
          "source": "IMS XREF/ACCT/CUST/AUTH-SUMMARY",
          "fields_used": [
            "XREF-CARD-NUM",
            "PA-ACCT-ID",
            "WS-CARD-RID-CUST-ID"
          ],
          "citation": [
            510,
            520,
            530,
            550
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "IMS AUTH-SUMMARY",
          "fields_written": [
            "XREF-ACCT-ID",
            "PA-ACCT-ID"
          ],
          "citation": [
            840
          ]
        },
        {
          "destination": "IMS AUTH Records",
          "fields_written": [
            "PA-CARD-NUM",
            "PA-RL-AUTH-RESP-CODE",
            "PA-RL-AUTH-RESP-REASON"
          ],
          "citation": [
            850
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "MQTM-QNAME",
          "output_field": "WS-REQUEST-QNAME",
          "transformation_description": "Direct MOVE from retrieved MQ trigger message to working storage queue name",
          "citation": [
            237
          ]
        },
        {
          "input_field": "MQOO-INPUT-SHARED",
          "output_field": "WS-OPTIONS",
          "transformation_description": "COMPUTE for MQ open options",
          "citation": [
            260
          ]
        },
        {
          "input_field": "PA-RQ-TRANSACTION-AMT raw",
          "output_field": "PA-RQ-TRANSACTION-AMT",
          "transformation_description": "COMPUTE transaction amount from request message",
          "citation": [
            376
          ]
        },
        {
          "input_field": "Account balance fields",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "COMPUTE available amount for auth decision (lines 666 and 674)",
          "citation": [
            666
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "MQTM",
        "purpose": "Defines MQ trigger message structure with QNAME and TRIGGERDATA",
        "location": "WORKING_STORAGE",
        "citation": 237
      },
      {
        "copybook_name": "MQM-OD-REQUEST",
        "purpose": "MQ object descriptor for request queue open (MQOD-OBJECTTYPE, MQOD-OBJECTNAME)",
        "location": "WORKING_STORAGE",
        "citation": 255
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "COPAUA0C",
        "summary": null,
        "purpose": "This is the program entry point paragraph identified at line 23, likely the initial control section before MAIN-PARA. Its primary purpose is to serve as the starting point for program execution under CICS. It consumes no specific inputs beyond environment variables like EIB. It produces no direct outputs but transfers control to MAIN-PARA. No business logic or decisions are implemented here based on available analysis. No error handling is performed. It calls multiple MQ-related subroutines like CMQODV, CMQMDV, CMQV (11+ total), likely for MQ structure initialization or validation before main processing. These calls support MQ environment setup for queue operations.",
        "called_by": [],
        "calls": [
          "CMQODV",
          "CMQMDV",
          "CMQV"
        ],
        "citation": [
          23,
          23
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MAIN-PARA",
        "summary": null,
        "purpose": "MAIN-PARA is the primary orchestration paragraph that controls the overall program flow from lines 220-229. It begins by performing 1000-INITIALIZE THRU 1000-EXIT to set up MQ queue and IMS PSB. Next, it performs 2000-MAIN-PROCESS THRU 2000-EXIT to handle the message processing loop. Finally, it performs 9000-TERMINATE THRU 9000-EXIT for cleanup, followed by EXEC CICS RETURN to end the transaction. It consumes no direct data inputs but relies on initialization results like WS-REQUEST-QNAME. It produces program completion status via return to CICS. No specific business decisions are made here; it delegates all logic. Errors from subordinates are handled downstream via 9500-LOG-ERROR. It calls 1000-INITIALIZE, 2000-MAIN-PROCESS, and 9000-TERMINATE sequentially for structured flow.",
        "called_by": [
          "COPAUA0C"
        ],
        "calls": [
          "1000-INITIALIZE",
          "2000-MAIN-PROCESS",
          "9000-TERMINATE"
        ],
        "citation": [
          220,
          229
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-INITIALIZE",
        "summary": null,
        "purpose": "1000-INITIALIZE handles program startup setup from lines 230-248. It consumes MQ trigger data via EXEC CICS RETRIEVE INTO(MQTM) NOHANDLE. If EIBRESP = NORMAL (decision point 1), it moves MQTM-QNAME to WS-REQUEST-QNAME and MQTM-TRIGGERDATA to WS-TRIGGER-DATA (transforms 3 variables). It sets WS-WAIT-INTERVAL to 5000. It then performs 1100-OPEN-REQUEST-QUEUE THRU 1100-EXIT to open MQ queue and 3100-READ-REQUEST-MQ THRU 3100-EXIT for initial read. Outputs are initialized working storage flags and queue handle. Business logic checks CICS response for normal retrieval (line 237 error handling hint). Errors set via NOHANDLE but checked. Calls subordinates for MQ open/read setup.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "1100-OPEN-REQUEST-QUEUE",
          "3100-READ-REQUEST-MQ"
        ],
        "citation": [
          230,
          248
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1000-EXIT",
        "summary": null,
        "purpose": "1000-EXIT is the exit routine for 1000-INITIALIZE from lines 249-254. Its primary purpose is to return control to the calling paragraph after initialization completes. It consumes no inputs or data. It produces no outputs or modifications. No business logic, decisions, or conditions are evaluated. No error handling is performed as errors are managed prior. It is called exclusively by 1000-INITIALIZE at its end. It simply executes EXIT with no further actions.",
        "called_by": [
          "1000-INITIALIZE"
        ],
        "calls": [],
        "citation": [
          249,
          254
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1100-OPEN-REQUEST-QUEUE",
        "summary": null,
        "purpose": "1100-OPEN-REQUEST-QUEUE opens the MQ request queue from lines 255-285. It consumes WS-REQUEST-QNAME and sets MQOD-OBJECTTYPE to MQOT-Q, MQOD-OBJECTNAME (transforms 12 variables including WS-CODE-DISPLAY, MQOT-Q). Computes WS-OPTIONS = MQOO-INPUT-SHARED (line 260). Calls MQOPEN USING connection, descriptor, options, obtaining handle. If WS-COMPCODE = MQCC-OK (decision 1), sets WS-REQUEST-MQ-OPEN TRUE. Else (decision 2-3), sets ERR-LOCATION 'M001', ERR-CRITICAL TRUE, ERR-MQ TRUE, moves codes to ERR-CODE-1/2, ERR-MESSAGE 'REQ MQ OPEN ERROR', performs 9500-LOG-ERROR. Outputs queue handle or error flags. Business logic ensures shared input access for concurrent reads. Errors trigger logging without abend.",
        "called_by": [
          "1000-INITIALIZE"
        ],
        "calls": [
          "MQOPEN",
          "9500-LOG-ERROR"
        ],
        "citation": [
          255,
          285
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1100-EXIT",
        "summary": null,
        "purpose": "1100-EXIT is the exit routine for 1100-OPEN-REQUEST-QUEUE from lines 286-291. Its role is to cleanly return control after queue open attempt. No data consumed or produced. No logic, conditions, or errors handled. Called only by 1100-OPEN-REQUEST-QUEUE. Executes simple EXIT.",
        "called_by": [
          "1100-OPEN-REQUEST-QUEUE"
        ],
        "calls": [],
        "citation": [
          286,
          291
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1200-SCHEDULE-PSB",
        "summary": null,
        "purpose": "1200-SCHEDULE-PSB schedules the IMS PSB from lines 292-318. It consumes PSB-NAME and executes DLI SCHD NODHABEND, moves DIBSTAT to IMS-RETURN-CODE (transforms 8 variables). If PSB-SCHEDULED-MORE-THAN-ONCE (decision 1), executes DLI TERM then SCHD again, updates IMS-RETURN-CODE. If STATUS-OK (decision 2), sets IMS-PSB-SCHD TRUE. Else (decision 3), sets ERR-LOCATION 'I001', ERR-CRITICAL/ERR-IMS TRUE, moves code to ERR-CODE-1, ERR-MESSAGE 'IMS SCHD FAILED', performs 9500-LOG-ERROR. Outputs PSB schedule status flag. Business logic handles rescheduling if multiply scheduled. Errors logged without immediate abend.",
        "called_by": [
          "1000-INITIALIZE"
        ],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          292,
          318
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "1200-EXIT",
        "summary": null,
        "purpose": "1200-EXIT serves as exit for 1200-SCHEDULE-PSB from lines 319-322. Purpose is control return post-PSB scheduling. No inputs/outputs/modifications. No decisions or error handling. Called by 1200-SCHEDULE-PSB. Simple EXIT.",
        "called_by": [
          "1200-SCHEDULE-PSB"
        ],
        "calls": [],
        "citation": [
          319,
          322
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-MAIN-PROCESS",
        "summary": null,
        "purpose": "2000-MAIN-PROCESS manages the core message processing loop from lines 323-346. It loops PERFORM UNTIL NO-MORE-MSG-AVAILABLE OR WS-LOOP-END (has loops, 4 decisions). For each iteration, performs 2100-EXTRACT-REQUEST-MSG THRU EXIT to parse message, 5000-PROCESS-AUTH THRU EXIT for auth logic (transforms IMS-PSB-NOT-SCHD, WS-LOOP-END, WS-MSG-PROCESSED). Adds 1 to WS-MSG-PROCESSED. Executes CICS SYNCPOINT for commit. Sets IMS-PSB-NOT-SCHD TRUE (unschedules PSB?). If WS-MSG-PROCESSED > WS-REQSTS-PROCESS-LIMIT (decision), sets WS-LOOP-END TRUE; else performs 3100-READ-REQUEST-MQ THRU EXIT. Inputs are MQ messages; outputs processed counts, IMS updates, response queue msgs. Business logic limits batch size, commits per message. Errors delegated to callees.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "2100-EXTRACT-REQUEST-MSG",
          "5000-PROCESS-AUTH",
          "3100-READ-REQUEST-MQ"
        ],
        "citation": [
          323,
          346
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "2000-EXIT",
        "summary": null,
        "purpose": "2000-EXIT exits the main process loop from lines 347-350. Role is to return control after loop termination. No data I/O or logic. No errors or calls. Called by 2000-MAIN-PROCESS. EXIT only.",
        "called_by": [
          "2000-MAIN-PROCESS"
        ],
        "calls": [],
        "citation": [
          347,
          350
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "EIBRESP != DFHRESP(NORMAL) after CICS RETRIEVE",
        "action": "NOHANDLE ignores, skips moves (partial handling)",
        "citation": [
          237
        ]
      },
      {
        "condition": "WS-COMPCODE != MQCC-OK after MQOPEN",
        "action": "Set error flags, log via 9500-LOG-ERROR",
        "citation": [
          260
        ]
      },
      {
        "condition": "STATUS != OK after IMS PSB SCHD",
        "action": "Set error flags, log via 9500-LOG-ERROR",
        "citation": [
          292
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "RETRIEVE",
        "resource": "MQTM",
        "purpose": "Retrieve MQ trigger message data into working storage",
        "citation": 237
      },
      {
        "command": "RETURN",
        "resource": null,
        "purpose": "Return control to CICS after termination",
        "citation": 229
      },
      {
        "command": "SYNCPOINT",
        "resource": null,
        "purpose": "Commit IMS and CICS updates per message",
        "citation": 323
      }
    ],
    "open_questions": [
      {
        "question": "Full details of unshown paragraphs (2100-EXTRACT-REQUEST-MSG, 3100-READ-REQUEST-MQ, 5000-PROCESS-AUTH, etc.)",
        "context": "AST snippet incomplete; only up to 2000-EXIT provided",
        "suggestion": "Provide full AST or source for remaining paragraphs"
      },
      {
        "question": "Exact copybook names and locations for all structures (e.g., PA-RL-AUTH-RESP-REASON, IMS segments)",
        "context": "Inferred from variable usage but not explicitly COPY statements in AST",
        "suggestion": "Scan for COPY statements in full source"
      },
      {
        "question": "Response queue name and exact MQPUT details",
        "context": "Inferred from 7100-SEND-RESPONSE but not in AST snippet",
        "suggestion": "Analyze 7100-SEND-RESPONSE AST"
      },
      {
        "question": "Calling transaction ID or commarea details",
        "context": "CICS RETRIEVE source unclear (TS queue? commarea?)",
        "suggestion": "Check EIB fields or full WORKING-STORAGE"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:21:23.458316"
}