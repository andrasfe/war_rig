{
  "batch_idx": 2,
  "total_batches": 5,
  "template": {
    "header": {
      "program_id": "COPAUA0C",
      "file_name": "COPAUA0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T17:40:33.606276",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This COBOL program is a CICS transaction that processes authorization requests. It retrieves customer and account information, makes an authorization decision based on available credit, and sends a response to a reply queue.",
      "business_context": "Authorization of credit card transactions.",
      "program_type": "ONLINE_CICS",
      "citations": [
        6,
        95,
        167
      ]
    },
    "inputs": [
      {
        "name": "CUSTOMER-RECORD",
        "io_type": "FILE_VSAM",
        "description": "Customer information, read based on customer ID.",
        "copybook": null,
        "citation": [
          10
        ]
      },
      {
        "name": "PENDING-AUTH-SUMMARY",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization summary data from IMS.",
        "copybook": null,
        "citation": [
          54
        ]
      },
      {
        "name": "XREF-CUST-ID",
        "io_type": "CICS_COMMAREA",
        "description": "Customer ID from the input COMMAREA.",
        "copybook": null,
        "citation": [
          4
        ]
      },
      {
        "name": "XREF-ACCT-ID",
        "io_type": "CICS_COMMAREA",
        "description": "Account ID from the input COMMAREA.",
        "copybook": null,
        "citation": [
          51
        ]
      },
      {
        "name": "PA-RQ-CARD-NUM",
        "io_type": "CICS_COMMAREA",
        "description": "Card number from the input COMMAREA.",
        "copybook": null,
        "citation": [
          90
        ]
      },
      {
        "name": "PA-RQ-TRANSACTION-ID",
        "io_type": "CICS_COMMAREA",
        "description": "Transaction ID from the input COMMAREA.",
        "copybook": null,
        "citation": [
          91
        ]
      },
      {
        "name": "PA-RQ-AUTH-TIME",
        "io_type": "CICS_COMMAREA",
        "description": "Authorization time from the input COMMAREA.",
        "copybook": null,
        "citation": [
          92
        ]
      },
      {
        "name": "PA-RQ-TRANSACTION-AMT",
        "io_type": "CICS_COMMAREA",
        "description": "Transaction amount from the input COMMAREA.",
        "copybook": null,
        "citation": [
          124
        ]
      }
    ],
    "outputs": [
      {
        "name": "MQM-MD-REPLY",
        "io_type": "CICS_QUEUE",
        "description": "Authorization response message sent to a reply queue.",
        "copybook": null,
        "citation": [
          189
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "MQPUT1",
        "call_type": "STATIC_CALL",
        "purpose": "To put the authorization response message on the reply queue.",
        "parameters": [
          "W02-HCONN-REPLY",
          "MQM-OD-REPLY",
          "MQM-MD-REPLY",
          "MQM-PUT-MESSAGE-OPTIONS",
          "W02-BUFFLEN",
          "W02-PUT-BUFFER",
          "WS-COMPCODE",
          "WS-REASON"
        ],
        "citation": 187
      },
      {
        "program_name": "9500-LOG-ERROR",
        "call_type": "STATIC_CALL",
        "purpose": "To log any errors encountered during processing.",
        "parameters": [],
        "citation": 28
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Decline authorization if the transaction amount exceeds the available credit.",
        "logic_summary": "Compares WS-TRANSACTION-AMT to WS-AVAILABLE-AMT. If the transaction amount is greater, DECLINE-AUTH is set to TRUE.",
        "conditions": [
          "WS-TRANSACTION-AMT > WS-AVAILABLE-AMT"
        ],
        "citation": [
          98,
          106
        ]
      },
      {
        "rule_id": "BR002",
        "description": "If no authorization summary is found, use account master data to determine available credit.",
        "logic_summary": "If FOUND-PAUT-SMRY-SEG is false, the program checks FOUND-ACCT-IN-MSTR and uses ACCT-CREDIT-LIMIT and ACCT-CURR-BAL to calculate available credit.",
        "conditions": [
          "NOT FOUND-PAUT-SMRY-SEG",
          "FOUND-ACCT-IN-MSTR"
        ],
        "citation": [
          95,
          103
        ]
      },
      {
        "rule_id": "BR003",
        "description": "If no account is found in the account master, decline the authorization.",
        "logic_summary": "If FOUND-ACCT-IN-MSTR is false, DECLINE-AUTH is set to TRUE.",
        "conditions": [
          "NOT FOUND-ACCT-IN-MSTR"
        ],
        "citation": [
          110,
          111
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "CUSTOMER-RECORD",
          "fields_used": [],
          "citation": [
            10
          ]
        },
        {
          "source": "PENDING-AUTH-SUMMARY",
          "fields_used": [
            "PA-CREDIT-LIMIT",
            "PA-CREDIT-BALANCE"
          ],
          "citation": [
            54,
            96,
            97
          ]
        },
        {
          "source": "ACCT-MASTER",
          "fields_used": [
            "ACCT-CREDIT-LIMIT",
            "ACCT-CURR-BAL"
          ],
          "citation": [
            104,
            105
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "MQM-MD-REPLY",
          "fields_written": [
            "MQMD-MSGTYPE",
            "MQMD-CORRELID",
            "MQMD-MSGID",
            "MQMD-REPLYTOQ",
            "MQMD-REPLYTOQMGR",
            "MQMD-PERSISTENCE",
            "MQMD-EXPIRY",
            "MQMD-FORMAT"
          ],
          "citation": [
            173,
            174,
            175,
            176,
            177,
            178,
            179,
            180
          ]
        },
        {
          "destination": "W02-PUT-BUFFER",
          "fields_written": [
            "PA-RL-CARD-NUM",
            "PA-RL-TRANSACTION-ID",
            "PA-RL-AUTH-ID-CODE",
            "PA-RL-AUTH-RESP-CODE",
            "PA-RL-AUTH-RESP-REASON",
            "WS-APPROVED-AMT-DIS"
          ],
          "citation": [
            159
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-RQ-TRANSACTION-AMT",
          "output_field": "WS-TRANSACTION-AMT",
          "transformation_description": "Implicit move of transaction amount to working storage for comparison.",
          "citation": [
            98,
            106
          ]
        },
        {
          "input_field": "PA-CREDIT-LIMIT, PA-CREDIT-BALANCE",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "Calculates available credit by subtracting the credit balance from the credit limit.",
          "citation": [
            96,
            97
          ]
        },
        {
          "input_field": "ACCT-CREDIT-LIMIT, ACCT-CURR-BAL",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "Calculates available credit by subtracting the current balance from the credit limit using account master data.",
          "citation": [
            104,
            105
          ]
        }
      ]
    },
    "copybooks_used": [],
    "paragraphs": [
      {
        "paragraph_name": "5300-READ-CUST-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the customer record from the VSAM file specified by WS-CUSTFILENAME. It first moves the XREF-CUST-ID to WS-CARD-RID-CUST-ID for use as the record ID. It then executes a CICS READ command to retrieve the CUSTOMER-RECORD. The CICS response code (WS-RESP-CD) is evaluated to determine if the read was successful. If the record is found (NORMAL), FOUND-CUST-IN-MSTR is set to TRUE. If the record is not found (NOTFND), NFOUND-CUST-IN-MSTR is set to TRUE, an error message is constructed, and 9500-LOG-ERROR is performed. If any other error occurs, an error message with the CICS response codes is constructed, and 9500-LOG-ERROR is performed. The paragraph consumes XREF-CUST-ID and produces CUSTOMER-RECORD. It calls 9500-LOG-ERROR in case of errors.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          1,
          43
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5300-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, providing a standard exit point for the 5300-READ-CUST-RECORD paragraph. It does not consume any inputs or produce any outputs. It serves as a return point after the customer record is read and processed. No business logic or error handling is performed here. It is called by 5300-READ-CUST-RECORD after the CICS READ command and subsequent error handling.",
        "called_by": [],
        "calls": [],
        "citation": [
          45,
          46
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-READ-AUTH-SUMMRY",
        "summary": null,
        "purpose": "This paragraph reads the pending authorization summary from the IMS database. It moves the XREF-ACCT-ID to PA-ACCT-ID and then executes a DLI GU (Get Unique) command to retrieve the PAUTSUM0 segment into PENDING-AUTH-SUMMARY. The IMS return code (DIBSTAT) is moved to IMS-RETURN-CODE and evaluated. If the status is OK, FOUND-PAUT-SMRY-SEG is set to TRUE. If the segment is not found, NFOUND-PAUT-SMRY-SEG is set to TRUE. If any other error occurs, an error message is constructed, and 9500-LOG-ERROR is performed. This paragraph consumes XREF-ACCT-ID and produces PENDING-AUTH-SUMMARY. It calls 9500-LOG-ERROR in case of errors.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          48,
          73
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, providing a standard exit point for the 5500-READ-AUTH-SUMMRY paragraph. It does not consume any inputs or produce any outputs. It serves as a return point after the pending authorization summary is read and processed. No business logic or error handling is performed here. It is called by 5500-READ-AUTH-SUMMRY after the IMS READ command and subsequent error handling.",
        "called_by": [],
        "calls": [],
        "citation": [
          75,
          76
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-READ-PROFILE-DATA",
        "summary": null,
        "purpose": "This paragraph currently contains only a CONTINUE statement, indicating that it does not perform any actions. It is likely a placeholder for future functionality to read profile data. It does not consume any inputs or produce any outputs. No business logic or error handling is performed here. It does not call any other paragraphs or programs.",
        "called_by": [],
        "calls": [],
        "citation": [
          78,
          82
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, providing a standard exit point for the 5600-READ-PROFILE-DATA paragraph. It does not consume any inputs or produce any outputs. It serves as a return point after the profile data is (or would be) read and processed. No business logic or error handling is performed here. It is called by 5600-READ-PROFILE-DATA.",
        "called_by": [],
        "calls": [],
        "citation": [
          84,
          85
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-MAKE-DECISION",
        "summary": null,
        "purpose": "This paragraph makes the authorization decision based on available credit. It moves data from request fields (PA-RQ-*) to response fields (PA-RL-*). If a pending authorization summary is found (FOUND-PAUT-SMRY-SEG), it calculates available credit using PA-CREDIT-LIMIT and PA-CREDIT-BALANCE. Otherwise, if an account is found in the account master (FOUND-ACCT-IN-MSTR), it calculates available credit using ACCT-CREDIT-LIMIT and ACCT-CURR-BAL. If neither is found, the authorization is declined. If the transaction amount exceeds the available credit, the authorization is declined (DECLINE-AUTH is set to TRUE). If the authorization is declined, PA-RL-AUTH-RESP-CODE is set to '05', and PA-RL-APPROVED-AMT is set to 0. Otherwise, PA-RL-AUTH-RESP-CODE is set to '00', and PA-RL-APPROVED-AMT is set to the transaction amount. Finally, PA-RL-AUTH-RESP-REASON is set based on various conditions like card not found, insufficient funds, etc. The paragraph consumes PA-RQ-* fields, PENDING-AUTH-SUMMARY, and ACCT-MASTER. It produces PA-RL-* fields and WS-APPROVED-AMT. It does not call any other paragraphs.",
        "called_by": [],
        "calls": [],
        "citation": [
          87,
          162
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, providing a standard exit point for the 6000-MAKE-DECISION paragraph. It does not consume any inputs or produce any outputs. It serves as a return point after the authorization decision is made. No business logic or error handling is performed here. It is called by 6000-MAKE-DECISION after the authorization logic is complete.",
        "called_by": [],
        "calls": [],
        "citation": [
          164,
          165
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-SEND-RESPONSE",
        "summary": null,
        "purpose": "This paragraph sends the authorization response to a reply queue using MQSeries. It sets the MQSeries message descriptor (MQM-MD-REPLY) fields, including message type, correlation ID, message ID, reply-to queue, persistence, expiry, and format. It then calls MQPUT1 to put the message on the reply queue specified by WS-REPLY-QNAME. If the MQPUT1 call fails, an error message is constructed, and 9500-LOG-ERROR is performed. The paragraph consumes WS-REPLY-QNAME, WS-SAVE-CORRELID, and W02-PUT-BUFFER. It produces the MQSeries message on the reply queue. It calls MQPUT1 and 9500-LOG-ERROR.",
        "called_by": [],
        "calls": [
          "MQPUT1",
          "9500-LOG-ERROR"
        ],
        "citation": [
          167,
          209
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-EXIT",
        "summary": null,
        "purpose": "This paragraph simply contains the EXIT statement, providing a standard exit point for the 7100-SEND-RESPONSE paragraph. It does not consume any inputs or produce any outputs. It serves as a return point after the authorization response is sent. No business logic or error handling is performed here. It is called by 7100-SEND-RESPONSE after the MQPUT1 call and subsequent error handling.",
        "called_by": [],
        "calls": [],
        "citation": [
          211,
          212
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "WS-RESP-CD NOT = DFHRESP(NORMAL)",
        "action": "Log error and potentially abend (if critical error)",
        "citation": [
          16,
          30
        ]
      },
      {
        "condition": "IMS GET SUMMARY FAILED",
        "action": "Log error and set error flags",
        "citation": [
          64
        ]
      },
      {
        "condition": "WS-COMPCODE NOT = MQCC-OK",
        "action": "Log error and set error flags",
        "citation": [
          196
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "READ",
        "resource": "WS-CUSTFILENAME",
        "purpose": "Read customer record from VSAM file.",
        "citation": 6
      }
    ],
    "open_questions": [
      {
        "question": "What is the structure of the CUSTOMER-RECORD?",
        "context": "The copybook for CUSTOMER-RECORD is not provided, so its fields are unknown.",
        "suggestion": "Examine the copybook definition for CUSTOMER-RECORD."
      },
      {
        "question": "What is the structure of the PENDING-AUTH-SUMMARY?",
        "context": "The copybook for PENDING-AUTH-SUMMARY is not provided, so its fields are unknown.",
        "suggestion": "Examine the copybook definition for PENDING-AUTH-SUMMARY."
      },
      {
        "question": "What is the purpose of the PAUT-PCB-NUM?",
        "context": "It is used in the IMS call, but the meaning is unclear without more context.",
        "suggestion": "Consult IMS documentation or related code."
      },
      {
        "question": "What is the structure of the W02-PUT-BUFFER?",
        "context": "The copybook for W02-PUT-BUFFER is not provided, so its fields are unknown.",
        "suggestion": "Examine the copybook definition for W02-PUT-BUFFER."
      },
      {
        "question": "What is the purpose of the WS-CUSTFILENAME variable?",
        "context": "It is used as the DATASET name in the CICS READ command, but its origin and value are unknown.",
        "suggestion": "Trace the variable's initialization or definition."
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-24T10:40:33.607406"
}