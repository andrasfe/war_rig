{
  "batch_idx": 2,
  "total_batches": 5,
  "template": {
    "header": {
      "program_id": "COPAUA0C",
      "file_name": "cbl/COPAUA0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:29:46.999724",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This COBOL module handles credit card authorization decision processing. It reads customer records from a VSAM file using CICS, retrieves pending authorization summary segments from IMS, evaluates transaction amounts against available credit limits from either IMS summary or account master data, sets approval or decline status with specific reason codes, and sends a formatted response message to an MQ reply queue.",
      "business_context": "Credit card transaction authorization service, determining if a requested transaction amount can be approved based on customer account limits and status.",
      "program_type": "ONLINE_CICS",
      "citations": [
        568,
        616,
        657,
        738
      ]
    },
    "inputs": [
      {
        "name": "WS-CUSTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Customer master file containing account details like credit limit and balance, keyed by customer ID",
        "copybook": "CUSTOMER-RECORD",
        "citation": [
          568,
          570
        ]
      },
      {
        "name": "PAUTSUM0",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization summary segment from IMS database, containing credit limit and balance for the account",
        "copybook": "PENDING-AUTH-SUMMARY",
        "citation": [
          616,
          618
        ]
      },
      {
        "name": "PA-RQ-*",
        "io_type": "PARAMETER",
        "description": "Request data including card number, transaction ID, auth time, and transaction amount from prior processing",
        "copybook": null,
        "citation": [
          657
        ]
      }
    ],
    "outputs": [
      {
        "name": "WS-REPLY-QNAME",
        "io_type": "OTHER",
        "description": "MQ reply queue receiving formatted authorization response including card num, transaction ID, response code, reason, and approved amount",
        "copybook": null,
        "citation": [
          738,
          760
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "MQPUT1",
        "call_type": "DYNAMIC_CALL",
        "purpose": "Puts the authorization response message onto the MQ reply queue",
        "parameters": [
          "W02-HCONN-REPLY",
          "MQM-OD-REPLY",
          "MQM-MD-REPLY",
          "MQM-PUT-MESSAGE-OPTIONS",
          "W02-BUFFLEN",
          "W02-PUT-BUFFER"
        ],
        "citation": 760
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Decline authorization if transaction amount exceeds available credit limit",
        "logic_summary": "Computes available amount as credit limit minus balance from IMS summary or account master; sets DECLINE-AUTH and INSUFFICIENT-FUND if exceeded",
        "conditions": [
          "FOUND-PAUT-SMRY-SEG",
          "WS-TRANSACTION-AMT > WS-AVAILABLE-AMT"
        ],
        "citation": [
          657,
          665
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Decline authorization if customer, account, or card not found",
        "logic_summary": "Sets DECLINE-AUTH on NFOUND flags; assigns reason code '3100'",
        "conditions": [
          "NFOUND-CUST-IN-MSTR",
          "NFOUND-ACCT-IN-MSTR",
          "CARD-NFOUND-XREF"
        ],
        "citation": [
          657,
          685
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Assign specific decline reason codes based on failure type",
        "logic_summary": "EVALUATE on decline flags to set PA-RL-AUTH-RESP-REASON like '4100' for insufficient funds, '4200' for inactive, etc.",
        "conditions": [
          "INSUFFICIENT-FUND",
          "CARD-NOT-ACTIVE"
        ],
        "citation": [
          685,
          695
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "WS-CUSTFILENAME",
          "fields_used": [
            "ACCT-CREDIT-LIMIT",
            "ACCT-CURR-BAL"
          ],
          "citation": [
            568
          ]
        },
        {
          "source": "PAUTSUM0",
          "fields_used": [
            "PA-CREDIT-LIMIT",
            "PA-CREDIT-BALANCE"
          ],
          "citation": [
            616
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "WS-REPLY-QNAME",
          "fields_written": [
            "PA-RL-AUTH-RESP-CODE",
            "PA-RL-AUTH-RESP-REASON",
            "PA-RL-APPROVED-AMT"
          ],
          "citation": [
            738
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-CREDIT-LIMIT",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "Computes available amount as credit limit minus credit balance if IMS summary found",
          "citation": [
            665
          ]
        },
        {
          "input_field": "ACCT-CREDIT-LIMIT",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "Fallback computation using account master credit limit minus current balance if no IMS summary",
          "citation": [
            672
          ]
        },
        {
          "input_field": "PA-RL-*",
          "output_field": "W02-PUT-BUFFER",
          "transformation_description": "Strings response fields delimited by comma into MQ buffer with length pointer",
          "citation": [
            710
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "CUSTOMER-RECORD",
        "purpose": "Defines structure for customer master record loaded from VSAM file",
        "location": "WORKING_STORAGE",
        "citation": 570
      },
      {
        "copybook_name": "PENDING-AUTH-SUMMARY",
        "purpose": "Defines IMS pending auth summary segment structure",
        "location": "WORKING_STORAGE",
        "citation": 618
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "5300-READ-CUST-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the customer record from the VSAM customer master file using CICS READ with key derived from XREF-CUST-ID. It moves XREF-CUST-ID to WS-CARD-RID-CUST-ID and uses WS-CARD-RID-CUST-ID-X as RIDFLD into CUSTOMER-RECORD. On normal response (DFHRESP(NORMAL)), sets FOUND-CUST-IN-MSTR to TRUE. On NOTFND, sets NFOUND-CUST-IN-MSTR, logs warning error 'A003' with message 'CUST NOT FOUND IN XREF' via 9500-LOG-ERROR. For other responses, logs critical CICS error 'C003' with codes and message 'FAILED TO READ CUST FILE' via 9500-LOG-ERROR. No outputs are written; flags and error structures are updated for caller. It implements error handling for file not found and I/O failures, distinguishing warnings from critical errors. Called from main flow to fetch customer data before decision making.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          568,
          611
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5300-EXIT",
        "summary": null,
        "purpose": "This is the exit paragraph for 5300-READ-CUST-RECORD. It executes a simple EXIT statement to return control to the calling paragraph. No inputs are consumed or outputs produced in this paragraph. No business logic, conditions, validations, or error handling is performed. No other paragraphs or programs are called. It serves solely as a procedural exit point after the read and error handling logic completes, ensuring clean flow return.",
        "called_by": [],
        "calls": [],
        "citation": [
          612,
          615
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-READ-AUTH-SUMMRY",
        "summary": null,
        "purpose": "This paragraph retrieves the pending authorization summary segment from IMS using EXEC DLI GU on PAUT-PCB-NUM with key PA-ACCT-ID from XREF-ACCT-ID into PENDING-AUTH-SUMMARY. It moves XREF-ACCT-ID to PA-ACCT-ID before the call. Evaluates DIBSTAT/IMS-RETURN-CODE: sets FOUND-PAUT-SMRY-SEG on STATUS-OK, NFOUND-PAUT-SMRY-SEG on SEGMENT-NOT-FOUND. On other statuses, logs critical IMS error 'I002' with IMS return code and message 'IMS GET SUMMARY FAILED' via 9500-LOG-ERROR. Inputs are PCB and key data; outputs flags and potential error log. Error handling treats non-OK/non-NOTFND as critical failures. Used to fetch summary credit data for limit checks.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          616,
          642
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-EXIT",
        "summary": null,
        "purpose": "This is the exit paragraph for 5500-READ-AUTH-SUMMRY. It executes a simple EXIT statement to return control to the calling paragraph. No inputs are consumed or outputs produced. No business logic, conditions, or error handling occurs. No calls are made. It functions purely as an exit point post-IMS retrieval and evaluation.",
        "called_by": [],
        "calls": [],
        "citation": [
          643,
          646
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-READ-PROFILE-DATA",
        "summary": null,
        "purpose": "This paragraph is intended to read profile data but currently contains only a CONTINUE statement, performing no actual I/O or data operations. It consumes no inputs and produces no outputs or modifications. No conditions are checked, no business logic implemented, and no error handling present. No flags are set or other paragraphs called. Likely a placeholder for future profile retrieval logic in the authorization process. As-is, it does nothing substantive upon invocation.",
        "called_by": [],
        "calls": [],
        "citation": [
          647,
          652
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-EXIT",
        "summary": null,
        "purpose": "This is the exit paragraph for 5600-READ-PROFILE-DATA. It executes EXIT to return control to caller. No data I/O, logic, or changes occur. No errors handled or calls made. Standard exit point after non-functional continue.",
        "called_by": [],
        "calls": [],
        "citation": [
          653,
          656
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-MAKE-DECISION",
        "summary": null,
        "purpose": "This paragraph orchestrates the authorization decision logic. It first copies request data to response linkage fields: PA-RQ-CARD-NUM to PA-RL-CARD-NUM, etc. If IMS summary found, computes WS-AVAILABLE-AMT as PA-CREDIT-LIMIT minus PA-CREDIT-BALANCE; declines if WS-TRANSACTION-AMT exceeds it, setting INSUFFICIENT-FUND. Falls back to account master if no summary and account found, computing from ACCT-CREDIT-LIMIT minus ACCT-CURR-BAL. Declines if no account found. Sets AUTH-RESP-DECLINED/APPROVED, response code '05'/'00', approved amt to 0 or transaction amt. Assigns reason '3100' for not-founds, '4100' insufficient, etc., via EVALUATE. Edits WS-APPROVED-AMT-DISPLAY and STRINGs response fields into W02-PUT-BUFFER with length. Inputs from prior reads/flags/WS-TRANSACTION-AMT; outputs updated PA-RL-* and buffer for MQ. Implements core business rules for credit checks without explicit error handling beyond flags.",
        "called_by": [],
        "calls": [],
        "citation": [
          657,
          733
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-EXIT",
        "summary": null,
        "purpose": "This is the exit paragraph for 6000-MAKE-DECISION. Executes EXIT to return control. No inputs/outputs modified, no logic or errors handled. No calls. Exit after decision and buffer prep.",
        "called_by": [],
        "calls": [],
        "citation": [
          734,
          737
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-SEND-RESPONSE",
        "summary": null,
        "purpose": "This paragraph sends the authorization response via MQPUT1 to reply queue WS-REPLY-QNAME. Sets MQMD/MQOD fields: object type queue, msg type reply, correl ID from saved, format STRING, non-persistent, etc. Computes options NO-SYNCPOINT + DEFAULT-CONTEXT. Calls MQPUT1 with connection, OD, MD, options, buffer length, buffer, capturing compcode/reason. On non-MQCC-OK, logs critical MQ error 'M004' with codes and 'FAILED TO PUT ON REPLY MQ' via 9500-LOG-ERROR. Inputs MQ structures and W02-PUT-BUFFER from prior; outputs message to queue or error log. Handles MQ put failures as critical errors. Final step to return decision to requester.",
        "called_by": [],
        "calls": [
          "MQPUT1",
          "9500-LOG-ERROR"
        ],
        "citation": [
          738,
          781
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-EXIT",
        "summary": null,
        "purpose": "Exit paragraph for 7100-SEND-RESPONSE. Simple EXIT to caller. No data changes, logic, or handling. No calls. Post-MQ send exit.",
        "called_by": [],
        "calls": [],
        "citation": [
          782,
          785
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "WS-RESP-CD = DFHRESP(NOTFND)",
        "action": "Set NFOUND-CUST-IN-MSTR, log warning 'A003' via 9500-LOG-ERROR",
        "citation": [
          580
        ]
      },
      {
        "condition": "WS-RESP-CD OTHER than NORMAL/NOTFND",
        "action": "Log critical CICS 'C003' via 9500-LOG-ERROR",
        "citation": [
          590
        ]
      },
      {
        "condition": "IMS-RETURN-CODE OTHER than OK/SEGMENT-NOT-FOUND",
        "action": "Log critical IMS 'I002' via 9500-LOG-ERROR",
        "citation": [
          630
        ]
      },
      {
        "condition": "WS-COMPCODE NOT = MQCC-OK",
        "action": "Log critical MQ 'M004' via 9500-LOG-ERROR",
        "citation": [
          765
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "READ",
        "resource": "WS-CUSTFILENAME",
        "purpose": "Retrieve customer record by RIDFLD key",
        "citation": 570
      }
    ],
    "open_questions": [
      {
        "question": "Source of input variables like XREF-CUST-ID, WS-TRANSACTION-AMT, flags (FOUND-ACCT-IN-MSTR, etc.)",
        "context": "Not defined in provided AST paragraphs; likely set in earlier unshown paragraphs or LINKAGE",
        "suggestion": "Analyze preceding paragraphs (e.g., 0000-MAIN to 5200)"
      },
      {
        "question": "Full copybook definitions and locations",
        "context": "Structures like CUSTOMER-RECORD referenced but COPY statements not in AST",
        "suggestion": "Scan full source for COPYBOOK usage"
      },
      {
        "question": "Program invocation context (CICS transaction ID, calling program)",
        "context": "No ENTRY or LINKAGE shown; assumes CICS online",
        "suggestion": "Review PROCEDURE DIVISION header and LINKAGE SECTION"
      },
      {
        "question": "Details of 9500-LOG-ERROR and WS-CUSTFILENAME value",
        "context": "Called but not shown; filename dynamic?",
        "suggestion": "Analyze 9500 paragraph and WORKING-STORAGE init"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:29:47.001162"
}