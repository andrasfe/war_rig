{
  "batch_idx": 2,
  "total_batches": 5,
  "template": {
    "header": {
      "program_id": "COPAUA0C",
      "file_name": "cbl/COPAUA0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T03:51:34.038496",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This CICS program processes credit card authorization requests by reading customer master records from a VSAM file, IMS pending authorization summary segments, and profile data to evaluate transaction approval. It computes available credit based on limits and balances, decides to approve or decline the authorization, sets appropriate response codes and reasons, formats a response buffer, and sends the reply via MQPUT1 to a reply queue. Error conditions from file reads, IMS gets, or MQ puts are logged via 9500-LOG-ERROR.",
      "business_context": "Credit card transaction authorization decisioning, checking limits and statuses to approve or decline auth requests.",
      "program_type": "ONLINE_CICS",
      "citations": [
        4,
        51,
        95,
        170
      ]
    },
    "inputs": [
      {
        "name": "WS-CUSTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Customer master records identified by WS-CARD-RID-CUST-ID-X",
        "copybook": "CUSTOMER-RECORD",
        "citation": [
          6,
          7,
          10
        ]
      },
      {
        "name": "PAUT-PCB-NUM",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization summary segment (PAUTSUM0) for account PA-ACCT-ID",
        "copybook": "PENDING-AUTH-SUMMARY",
        "citation": [
          52,
          53,
          54
        ]
      },
      {
        "name": "PA-RQ-* / XREF-*",
        "io_type": "CICS_COMMAREA",
        "description": "Request data including card number, transaction ID, amount, cust/acct IDs from prior processing",
        "copybook": null,
        "citation": [
          4,
          51,
          90
        ]
      }
    ],
    "outputs": [
      {
        "name": "WS-REPLY-QNAME",
        "io_type": "CICS_QUEUE",
        "description": "Formatted authorization response string with card num, trans ID, auth code, resp code, reason, approved amt",
        "copybook": null,
        "citation": [
          152,
          170,
          187
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "MQPUT1",
        "call_type": "DYNAMIC_CALL",
        "purpose": "Send the formatted authorization response to the reply MQ queue",
        "parameters": [
          "W02-HCONN-REPLY",
          "MQM-OD-REPLY",
          "MQM-MD-REPLY",
          "MQM-PUT-MESSAGE-OPTIONS",
          "W02-BUFFLEN",
          "W02-PUT-BUFFER",
          "WS-COMPCODE",
          "WS-REASON"
        ],
        "citation": 187
      },
      {
        "program_name": "9500-LOG-ERROR",
        "call_type": "STATIC_CALL",
        "purpose": "Log application, CICS, IMS, or MQ errors with location, codes, message, and event key",
        "parameters": [
          "ERR-LOCATION",
          "ERR-* flags",
          "ERR-CODE-1",
          "ERR-CODE-2",
          "ERR-MESSAGE",
          "ERR-EVENT-KEY"
        ],
        "citation": 28
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Decline authorization if transaction amount exceeds available credit (credit limit minus balance)",
        "logic_summary": "Compute WS-AVAILABLE-AMT from PAUT summary if found, else from customer master account data; set DECLINE-AUTH and INSUFFICIENT-FUND if exceeded",
        "conditions": [
          "FOUND-PAUT-SMRY-SEG",
          "WS-TRANSACTION-AMT > WS-AVAILABLE-AMT",
          "FOUND-ACCT-IN-MSTR"
        ],
        "citation": [
          95,
          96,
          103,
          104
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Set authorization response code '00' for approve or '05' for decline, with approved amount",
        "logic_summary": "If not DECLINE-AUTH, set '00' and move transaction amt; else '05' and zero amt",
        "conditions": [
          "DECLINE-AUTH"
        ],
        "citation": [
          115,
          118,
          122
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Assign specific decline reason codes based on failure conditions like not found, insufficient funds, inactive, etc.",
        "logic_summary": "Evaluate TRUE with WHEN clauses for NFOUND-*, INSUFFICIENT-FUND, CARD-NOT-ACTIVE, etc., mapping to '3100','4100','4200', etc.",
        "conditions": [
          "AUTH-RESP-DECLINED",
          "CARD-NFOUND-XREF",
          "INSUFFICIENT-FUND"
        ],
        "citation": [
          129,
          131,
          135
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "WS-CUSTFILENAME",
          "fields_used": [
            "CUSTOMER-RECORD fields like ACCT-CREDIT-LIMIT, ACCT-CURR-BAL"
          ],
          "citation": [
            10
          ]
        },
        {
          "source": "PAUT-PCB-NUM (PAUTSUM0)",
          "fields_used": [
            "PA-CREDIT-LIMIT",
            "PA-CREDIT-BALANCE"
          ],
          "citation": [
            54
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "W02-PUT-BUFFER",
          "fields_written": [
            "PA-RL-*, WS-APPROVED-AMT-DIS"
          ],
          "citation": [
            152
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-CREDIT-LIMIT, PA-CREDIT-BALANCE or ACCT-CREDIT-LIMIT, ACCT-CURR-BAL",
          "output_field": "WS-AVAILABLE-AMT",
          "transformation_description": "Subtract balance from limit to compute available amount",
          "citation": [
            96,
            104
          ]
        },
        {
          "input_field": "PA-RQ-TRANSACTION-AMT",
          "output_field": "PA-RL-APPROVED-AMT, WS-APPROVED-AMT",
          "transformation_description": "Move transaction amount to approved if approved, else zero",
          "citation": [
            124,
            120
          ]
        },
        {
          "input_field": "PA-RL-*, WS-APPROVED-AMT",
          "output_field": "W02-PUT-BUFFER",
          "transformation_description": "String fields delimited by comma into response buffer",
          "citation": [
            152
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "CUSTOMER-RECORD",
        "purpose": "Defines structure for customer master record including account limits and balances",
        "location": "WORKING_STORAGE",
        "citation": 10
      },
      {
        "copybook_name": "PENDING-AUTH-SUMMARY",
        "purpose": "Defines IMS PAUTSUM0 segment for pending auth summary with credit limit and balance",
        "location": "WORKING_STORAGE",
        "citation": 54
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "5300-READ-CUST-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the customer record from the VSAM customer file using CICS READ with RIDFLD based on XREF-CUST-ID moved to WS-CARD-RID-CUST-ID-X. It consumes the customer ID from prior XREF processing (line 4). It produces the populated CUSTOMER-RECORD area and sets flags FOUND-CUST-IN-MSTR or NFOUND-CUST-IN-MSTR based on response. Business logic evaluates WS-RESP-CD: NORMAL sets found flag (17-18); NOTFND sets not found, logs warning 'A003' with message 'CUST NOT FOUND IN XREF' (19-28); OTHER logs critical CICS error 'C003' with resp/reas codes and 'FAILED TO READ CUST FILE' (30-41). Error handling logs via 9500-LOG-ERROR for both warning and critical cases, using ERR-LOCATION, flags, codes, message, and key. It calls 9500-LOG-ERROR twice potentially, once for NOTFND and once for OTHER.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          568,
          611
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5300-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply performs EXIT to return control to the caller paragraph. It consumes no inputs and produces no outputs. There is no business logic, conditions, or error handling. It calls no other paragraphs or programs. Its role is to cleanly exit the 5300-READ-CUST-RECORD logic.",
        "called_by": [
          "5300-READ-CUST-RECORD"
        ],
        "calls": [],
        "citation": [
          612,
          615
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-READ-AUTH-SUMMRY",
        "summary": null,
        "purpose": "This paragraph retrieves the pending authorization summary IMS segment (PAUTSUM0) using EXEC DLI GU via PAUT-PCB-NUM, qualified by PA-ACCT-ID from XREF-ACCT-ID (line 51). It consumes the account ID from request/XREF data. It populates PENDING-AUTH-SUMMARY and sets IMS-RETURN-CODE from DIBSTAT (58). Logic evaluates STATUS-OK to set FOUND-PAUT-SMRY-SEG (60-61); SEGMENT-NOT-FOUND sets NFOUND-PAUT-SMRY-SEG (62-63); OTHER logs critical IMS error 'I002' with IMS return code and 'IMS GET SUMMARY FAILED' via 9500-LOG-ERROR (64-71). Error handling is via logging for non-OK statuses. It calls 9500-LOG-ERROR for errors.",
        "called_by": [],
        "calls": [
          "9500-LOG-ERROR"
        ],
        "citation": [
          616,
          642
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5500-EXIT",
        "summary": null,
        "purpose": "This is an exit paragraph that simply performs EXIT to return control to the caller. It consumes no data and produces nothing. No logic, decisions, or error handling is present. No calls are made. Its purpose is to terminate the 5500-READ-AUTH-SUMMRY paragraph flow.",
        "called_by": [
          "5500-READ-AUTH-SUMMRY"
        ],
        "calls": [],
        "citation": [
          643,
          646
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-READ-PROFILE-DATA",
        "summary": null,
        "purpose": "This paragraph is a placeholder for reading profile data but currently contains only CONTINUE with no actual logic implemented. It consumes no inputs and produces no outputs or flags. There are no business decisions, validations, or error handling. No other paragraphs or programs are called. Its intended role appears to be retrieving profile data, but it is not functional in this code.",
        "called_by": [],
        "calls": [],
        "citation": [
          647,
          652
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "5600-EXIT",
        "summary": null,
        "purpose": "This exit paragraph performs EXIT to return control. No inputs consumed, no outputs produced. No logic or errors handled. No calls. Standard exit for 5600-READ-PROFILE-DATA.",
        "called_by": [
          "5600-READ-PROFILE-DATA"
        ],
        "calls": [],
        "citation": [
          653,
          656
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-MAKE-DECISION",
        "summary": null,
        "purpose": "This paragraph orchestrates the authorization decision by first copying request fields to response linkage like PA-RL-CARD-NUM, TRANSACTION-ID, AUTH-ID-CODE (90-92). It consumes flags from prior reads (FOUND-PAUT-SMRY-SEG, FOUND-ACCT-IN-MSTR, etc.) and fields like credit limits/balances, WS-TRANSACTION-AMT. It computes available amount preferring IMS summary, falling back to customer acct data, and declines if transaction exceeds available (95-113). Sets AUTH-RESP-DECLINED/APPROVED, resp code '05'/'00', approved amt 0/transaction amt (115-126). Assigns reason '0000' or specific codes like '3100' not found, '4100' insuff funds based on decline conditions (128-148). Formats response buffer by STRINGing fields comma-delimited into W02-PUT-BUFFER (152-160). No explicit error handling here; relies on prior flags. Calls no paragraphs/programs directly.",
        "called_by": [],
        "calls": [],
        "citation": [
          657,
          733
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "6000-EXIT",
        "summary": null,
        "purpose": "Exit paragraph performing EXIT. No inputs/outputs/logic/errors/calls. Returns control after decision logic.",
        "called_by": [
          "6000-MAKE-DECISION"
        ],
        "calls": [],
        "citation": [
          734,
          737
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-SEND-RESPONSE",
        "summary": null,
        "purpose": "This paragraph prepares and sends the authorization response via MQPUT1 to the reply queue WS-REPLY-QNAME. It consumes the formatted W02-PUT-BUFFER, WS-RESP-LENGTH, saved correl ID, and sets MQMD/MQOD fields like REPLY msg type, non-persistent, string format (170-181). Sets MQPMO options no-syncpoint (182-183). Calls 'MQPUT1' with conn, od, md, pmo, len, buffer, compcode, reason (187-195). Business logic checks WS-COMPCODE = MQCC-OK; if not, logs critical MQ error 'M004' with codes and 'FAILED TO PUT ON REPLY MQ' via 9500-LOG-ERROR (196-207). Error handling via logging only, no abend. Produces the sent MQ message or error log.",
        "called_by": [],
        "calls": [
          "MQPUT1",
          "9500-LOG-ERROR"
        ],
        "citation": [
          738,
          781
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "7100-EXIT",
        "summary": null,
        "purpose": "Standard exit paragraph with EXIT. No data flow, logic, errors, or calls. Terminates send response flow.",
        "called_by": [
          "7100-SEND-RESPONSE"
        ],
        "calls": [],
        "citation": [
          782,
          785
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "WS-RESP-CD = DFHRESP(NOTFND)",
        "action": "Set NFOUND-CUST-IN-MSTR, log warning 'A003' via 9500-LOG-ERROR",
        "citation": [
          19,
          22
        ]
      },
      {
        "condition": "WS-RESP-CD OTHER than NORMAL/NOTFND",
        "action": "Log critical CICS 'C003' via 9500-LOG-ERROR",
        "citation": [
          30,
          31
        ]
      },
      {
        "condition": "IMS DIBSTAT OTHER than OK/SEG-NOT-FOUND",
        "action": "Log critical IMS 'I002' via 9500-LOG-ERROR",
        "citation": [
          64,
          65
        ]
      },
      {
        "condition": "WS-COMPCODE NOT = MQCC-OK",
        "action": "Log critical MQ 'M004' via 9500-LOG-ERROR",
        "citation": [
          196,
          197
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "READ",
        "resource": "DATASET(WS-CUSTFILENAME)",
        "purpose": "Retrieve customer record by RIDFLD",
        "citation": 6
      }
    ],
    "open_questions": [
      {
        "question": "What are the full copybook definitions and WORKING-STORAGE/LINKAGE structures for PA-RQ-*, XREF-*, CUSTOMER-RECORD, etc.?",
        "context": "Not present in provided snippet; assumed from usage",
        "suggestion": "Analyze full source or copybooks"
      },
      {
        "question": "What is the overall program flow and calling context (e.g., transaction ID, prior paragraphs like 1000-INIT)?",
        "context": "Only late paragraphs provided; no MAIN or early logic",
        "suggestion": "Provide full source code"
      },
      {
        "question": "Details of 5600-READ-PROFILE-DATA implementation and WS-CUSTFILENAME definition",
        "context": "Paragraph is empty (CONTINUE only)",
        "suggestion": "Check if stub or full code elsewhere"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-23T20:51:34.041261"
}