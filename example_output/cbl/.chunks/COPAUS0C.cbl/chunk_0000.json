{
  "batch_idx": 0,
  "total_batches": 3,
  "template": {
    "header": {
      "program_id": "COPAUS0C",
      "file_name": "cbl/COPAUS0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:22:13.105270",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "COPAUS0C is a CICS online program that displays a paginated list of pending authorizations (PAUTDTL1 IMS segments) for a user-entered account ID on the PAULST screen using the COPAU0A BMS map. It supports user interactions via ENTER to process selections or new account ID, PF7/PF8 for backward/forward paging, PF3 to return to previous screen, and handles IMS DL/I GNP calls to retrieve and reposition authorization data. Upon valid selection 'S' or 's', it XCTLs to the authorization detail program.",
      "business_context": "Card authorization summary screen in a demo banking system for reviewing pending authorizations by account.",
      "program_type": "ONLINE_CICS",
      "citations": [
        23,
        178,
        261,
        458
      ]
    },
    "inputs": [
      {
        "name": "COPAU0AI",
        "io_type": "CICS_MAP",
        "description": "Input map fields from PAULST screen including ACCTIDI (account ID), SEL0001I-SEL0005I (selection flags), and other screen inputs",
        "copybook": "COPAU0A",
        "citation": [
          178,
          261,
          342
        ]
      },
      {
        "name": "CARDDEMO-COMMAREA",
        "io_type": "CICS_COMMAREA",
        "description": "Program communication area carrying account ID, program context, transaction details between calls",
        "copybook": "CARDDEMO",
        "citation": [
          178
        ]
      },
      {
        "name": "PAUTDTL1",
        "io_type": "IMS_SEGMENT",
        "description": "Pending authorization details segment from IMS database via PAUT-PCB-NUM PCB",
        "copybook": null,
        "citation": [
          458,
          488
        ]
      },
      {
        "name": "EIBAID",
        "io_type": "PARAMETER",
        "description": "CICS attention identifier for key handling (DFHENTER, DFHPF3, DFHPF7, DFHPF8)",
        "copybook": null,
        "citation": [
          178
        ]
      }
    ],
    "outputs": [
      {
        "name": "COPAU0AO",
        "io_type": "CICS_MAP",
        "description": "Output map fields for PAULST screen including ACCTIDO, TRNID01I-PAMT005I, PDATE01I-PTIME05I, PAPRV01I-PSTAT05I, WS-MESSAGE, ERRMSGO",
        "copybook": "COPAU0A",
        "citation": [
          178,
          522
        ]
      },
      {
        "name": "CARDDEMO-COMMAREA",
        "io_type": "CICS_COMMAREA",
        "description": "Updated commarea with CDEMO-ACCT-ID, CDEMO-CPVS-PAUKEY-LAST/PREV-PG, CDEMO-TO-PROGRAM, CDEMO-PGM-CONTEXT for XCTL or return",
        "copybook": "CARDDEMO",
        "citation": [
          178,
          261
        ]
      },
      {
        "name": "WS-CICS-TRANID",
        "io_type": "RETURN_CODE",
        "description": "Transaction ID for CICS RETURN",
        "copybook": null,
        "citation": [
          178
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "CDEMO-TO-PROGRAM",
        "call_type": "CICS_XCTL",
        "purpose": "Transfer control to authorization detail program (WS-PGM-AUTH-DTL) when user selects 'S' on an authorization",
        "parameters": [
          "CARDDEMO-COMMAREA"
        ],
        "citation": 261
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [
        "WS-CICS-TRANID"
      ],
      "linkage_section": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVS-PAU-SELECTED",
        "CDEMO-TO-PROGRAM",
        "CDEMO-PGM-REENTER"
      ]
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Account ID must be numeric and not spaces/low-values for processing",
        "logic_summary": "Validates ACCTIDI OF COPAU0AI; sets error message and WS-ERR-FLG if invalid",
        "conditions": [
          "ACCTIDI = SPACES OR LOW-VALUES",
          "ACCTIDI NOT NUMERIC"
        ],
        "citation": [
          261
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Authorization selection must be 'S' or 's' to XCTL to detail screen",
        "logic_summary": "Evaluates SEL0001I-SEL0005I to set CDEMO-CPVS-PAU-SEL-FLG and SELECTED; checks for 'S'/'s' before XCTL",
        "conditions": [
          "CDEMO-CPVS-PAU-SEL-FLG = 'S' OR 's'"
        ],
        "citation": [
          261
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Page backward (PF7) only if current page > 1",
        "logic_summary": "Decrements CDEMO-CPVS-PAGE-NUM, restores previous key, error message if at top",
        "conditions": [
          "CDEMO-CPVS-PAGE-NUM > 1"
        ],
        "citation": [
          362
        ]
      },
      {
        "rule_id": "BR004",
        "description": "Approval status 'A' if PA-AUTH-RESP-CODE = '00', else 'D'",
        "logic_summary": "Transforms IMS response code to display status in PAPRVxxI fields",
        "conditions": [
          "PA-AUTH-RESP-CODE = '00'"
        ],
        "citation": [
          522
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "PENDING-AUTH-DETAILS",
          "fields_used": [
            "PA-APPROVED-AMT",
            "PA-AUTH-ORIG-TIME",
            "PA-AUTH-ORIG-DATE",
            "PA-AUTH-RESP-CODE",
            "PA-TRANSACTION-ID",
            "PA-AUTH-TYPE",
            "PA-MATCH-STATUS",
            "PA-AUTHORIZATION-KEY"
          ],
          "citation": [
            458,
            522
          ]
        },
        {
          "source": "COPAU0AI",
          "fields_used": [
            "ACCTIDI",
            "SEL0001I",
            "SEL0002I",
            "SEL0003I",
            "SEL0004I",
            "SEL0005I"
          ],
          "citation": [
            261
          ]
        },
        {
          "source": "CARDDEMO-COMMAREA",
          "fields_used": [
            "CDEMO-ACCT-ID",
            "CDEMO-CPVS-PAUKEY-LAST",
            "CDEMO-CPVS-PAUKEY-PREV-PG",
            "CDEMO-PGM-REENTER"
          ],
          "citation": [
            178
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "COPAU0AO",
          "fields_written": [
            "ACCTIDO",
            "TRNID01I",
            "PDATE01I",
            "PTIME01I",
            "PTYPE01I",
            "PAPRV01I",
            "PSTAT01I",
            "PAMT001I",
            "SEL0001A"
          ],
          "citation": [
            522
          ]
        },
        {
          "destination": "CDEMO-CPVS-AUTH-KEYS",
          "fields_written": [
            "CDEMO-CPVS-AUTH-KEYS(1-5)",
            "CDEMO-CPVS-PAUKEY-LAST",
            "CDEMO-CPVS-PAUKEY-PREV-PG",
            "CDEMO-CPVS-PAGE-NUM"
          ],
          "citation": [
            415,
            522
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-AUTH-ORIG-TIME",
          "output_field": "WS-AUTH-TIME",
          "transformation_description": "Substrings HH:MM:SS to HHMMSS format: positions 1:2 to 1:2, 3:2 to 4:2, 5:2 to 7:2",
          "citation": [
            522
          ]
        },
        {
          "input_field": "PA-AUTH-ORIG-DATE",
          "output_field": "WS-AUTH-DATE",
          "transformation_description": "Substrings YYMMDD to MM-DD-YY via WS-CURDATE-YY/MM/DD",
          "citation": [
            522
          ]
        },
        {
          "input_field": "PA-AUTH-RESP-CODE",
          "output_field": "WS-AUTH-APRV-STAT",
          "transformation_description": "'00' -> 'A' (Approved), else 'D' (Denied)",
          "citation": [
            522
          ]
        },
        {
          "input_field": "PA-APPROVED-AMT",
          "output_field": "WS-AUTH-AMT",
          "transformation_description": "Direct move to working storage for screen display",
          "citation": [
            522
          ]
        },
        {
          "input_field": "CDEMO-CPVS-PAGE-NUM",
          "output_field": "CDEMO-CPVS-PAGE-NUM",
          "transformation_description": "COMPUTE decrement by 1 for PF7, increment by 1 at WS-IDX=2 in loop",
          "citation": [
            362,
            415
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "COPAU0A",
        "purpose": "Defines BMS map fields for PAULST screen input (COPAU0AI) and output (COPAU0AO) including account ID, auth list fields, selections",
        "location": "WORKING_STORAGE",
        "citation": 178
      },
      {
        "copybook_name": "CARDDEMO",
        "purpose": "CommaREA structure with CDEMO- fields for account ID, page keys, program navigation, context flags",
        "location": "WORKING_STORAGE",
        "citation": 178
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "COPAUS0C",
        "summary": null,
        "purpose": "Entry point paragraph of the program, likely performs initial setup or calls initialization routines before transferring to MAIN-PARA. It consumes no explicit inputs shown in AST but orchestrates calls to external programs like COCOM01Y, COPAU00 for common services. Outputs program control flow to MAIN-PARA. Implements no visible business logic or decisions in provided AST snippet. No error handling visible. Calls numerous subprograms (+9 more per outline) for initialization, date, message handling.",
        "called_by": [],
        "calls": [
          "COCOM01Y",
          "COPAU00",
          "COTTL01Y",
          "CSDAT01Y",
          "CSMSG01Y"
        ],
        "citation": [
          23,
          23
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MAIN-PARA",
        "summary": null,
        "purpose": "This is the primary orchestration paragraph controlling the overall CICS screen flow for the authorization list. It consumes EIBCALEN to detect first entry vs reentry, DFHCOMMAREA for commarea data, and map inputs via RECEIVE-PAULST-SCREEN. It produces initialized screen outputs via SEND-PAULST-SCREEN, updated commarea, and CICS RETURN. Business logic branches on first entry (EIBCALEN=0): initializes commarea, sets reenter flag, performs GATHER-DETAILS then sends screen; on reentry: receives map, EVALUATEs EIBAID for ENTER/PF3/PF7/PF8/OTHER dispatching to process paragraphs, handles ACCT-ID numeric check. Error handling for invalid AID sets WS-ERR-FLG and message. Calls GATHER-DETAILS for data load, PROCESS-*-KEY for actions, SEND-PAULST-SCREEN repeatedly, RETURN-TO-PREV-SCREEN for PF3, and EXEC CICS RETURN at end.",
        "called_by": [
          "COPAUS0C"
        ],
        "calls": [
          "SEND-PAULST-SCREEN",
          "GATHER-DETAILS",
          "RECEIVE-PAULST-SCREEN",
          "PROCESS-ENTER-KEY",
          "RETURN-TO-PREV-SCREEN",
          "PROCESS-PF7-KEY",
          "PROCESS-PF8-KEY"
        ],
        "citation": [
          178,
          260
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-ENTER-KEY",
        "summary": null,
        "purpose": "Handles ENTER key press to validate and process new account ID or authorization selection. Consumes ACCTIDI and SEL0001I-SEL0005I from map input. Produces updated WS-ACCT-ID, CDEMO-CPVS-PAU-SEL-FLG/SELECTED, error messages if invalid, and XCTL to detail program if selected. Business logic: validates ACCTIDI not spaces/low/not-numeric, sets errors; EVALUATEs non-space SELxxxxI to set selected auth key and flag; if flag='S'/'s' XCTLs with context, else invalid selection error. Error handling sets WS-ERR-FLG/Y and messages for invalid input/selection. Calls GATHER-DETAILS to refresh data post-processing.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "GATHER-DETAILS",
          "CDEMO-TO-PROGRAM"
        ],
        "citation": [
          261,
          341
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GATHER-DETAILS",
        "summary": null,
        "purpose": "Prepares data for screen display by gathering account details and authorizations if valid account. Consumes WS-ACCT-ID. Produces initialized page num/index, calls to load account/auth data. Business logic: resets ACCTIDL and page to 0; if valid ACCT-ID performs GATHER-ACCOUNT-DETAILS, INITIALIZE-AUTH-DATA, PROCESS-PAGE-FORWARD if segment found. No explicit errors handled here. Delegates to sub-paragraphs for detailed gathering and pagination.",
        "called_by": [
          "MAIN-PARA",
          "PROCESS-ENTER-KEY"
        ],
        "calls": [
          "GATHER-ACCOUNT-DETAILS",
          "INITIALIZE-AUTH-DATA",
          "PROCESS-PAGE-FORWARD"
        ],
        "citation": [
          342,
          361
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-PF7-KEY",
        "summary": null,
        "purpose": "Handles PF7 for previous page navigation. Consumes current CDEMO-CPVS-PAGE-NUM and PAUKEY-PREV-PG. Produces decremented page num, restored WS-AUTH-KEY-SAVE, refreshed auth data. Business logic: if page >1, decrement page, load prev key, GET-AUTH-SUMMARY, init auth data, PROCESS-PAGE-FORWARD; else error message 'at top'. Sets erase flags. Error handling defers to callees.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "GET-AUTH-SUMMARY",
          "INITIALIZE-AUTH-DATA",
          "PROCESS-PAGE-FORWARD"
        ],
        "citation": [
          362,
          387
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-PF8-KEY",
        "summary": null,
        "purpose": "Handles PF8 for next page navigation. Consumes CDEMO-CPVS-PAUKEY-LAST. Produces reset keys/flags, repositioned data if not at end. Business logic: if LAST key valid, load to WS-AUTH-KEY-SAVE, GET-AUTH-SUMMARY, REPOSITION-AUTHORIZATIONS; sets erase no; if NEXT-PAGE-YES init and PROCESS-PAGE-FORWARD else 'at bottom' message. Error handling in callees.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "GET-AUTH-SUMMARY",
          "REPOSITION-AUTHORIZATIONS",
          "INITIALIZE-AUTH-DATA",
          "PROCESS-PAGE-FORWARD"
        ],
        "citation": [
          388,
          414
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-PAGE-FORWARD",
        "summary": null,
        "purpose": "Paginated loop to load up to 5 authorizations into screen list. Consumes WS-IDX=1 init, auth flags (AUTHS-NOT-EOF, ERR-FLG-OFF). Produces populated CDEMO-CPVS-AUTH-KEYS(1-5), PAUKEY-LAST/PREV-PG, PAGE-NUM incremented, NEXT-PAGE-YES/NO. Business logic: PERFORM UNTIL WS-IDX>5 or EOF or ERR-ON: conditionally REPOSITION or GET-AUTHORIZATIONS, if success POPULATE-AUTH-LIST, increment IDX, save keys/page; post-loop extra GET to set NEXT-PAGE flag (line 424 termination). Errors stop loop. Calls REPOSITION/GET/POPULATE in loop.",
        "called_by": [
          "GATHER-DETAILS",
          "PROCESS-PF7-KEY",
          "PROCESS-PF8-KEY"
        ],
        "calls": [
          "REPOSITION-AUTHORIZATIONS",
          "GET-AUTHORIZATIONS",
          "POPULATE-AUTH-LIST"
        ],
        "citation": [
          415,
          457
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GET-AUTHORIZATIONS",
        "summary": null,
        "purpose": "Retrieves next PAUTDTL1 IMS segment via unqualified GNP. Consumes PAUT-PCB-NUM. Produces PENDING-AUTH-DETAILS into WS, sets AUTHS-NOT-EOF/EOF flags, error message if fail. Business logic: EXEC DLI GNP INTO PENDING-AUTH-DETAILS; EVALUATE DIBSTAT/IMS-RETURN-CODE: OK->NOT-EOF, NOT-FOUND/EOF->EOF, OTHER->ERR-FLG, STRING error msg, SEND screen. Handles IMS errors by immediate screen resend.",
        "called_by": [
          "PROCESS-PAGE-FORWARD"
        ],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          458,
          487
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "REPOSITION-AUTHORIZATIONS",
        "summary": null,
        "purpose": "Repositions IMS cursor to specific authorization key for paging. Consumes WS-AUTH-KEY-SAVE moved to PA-AUTHORIZATION-KEY. Produces PENDING-AUTH-DETAILS, AUTHS-NOT-EOF/EOF flags, error msg if fail. Business logic: EXEC DLI GNP WHERE PAUT9CTS=KEY INTO details; EVALUATE IMS-RETURN-CODE same as GET-AUTHORIZATIONS: OK/NOT-FOUND/EOF/OTHER error with STRING msg and SEND screen.",
        "called_by": [
          "PROCESS-PF8-KEY",
          "PROCESS-PAGE-FORWARD"
        ],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          488,
          521
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "POPULATE-AUTH-LIST",
        "summary": null,
        "purpose": "Transforms IMS auth segment data to screen fields for current WS-IDX position (1-5). Consumes PENDING-AUTH-DETAILS fields (AMT, TIME, DATE, RESP-CODE, etc.). Produces screen fields TRNIDxxI/PDATExxI/PTIMExxI/PTYPExxI/PAPRVxxI/PSTATxxI/PAMTxxXI/SEL000xA, CDEMO-CPVS-AUTH-KEYS(WS-IDX), WS-*-AMT/DATE/TIME/APRV-STAT. Business logic: moves/formats AMT/TIME (substring)/DATE (reformat)/sets APRV-STAT 'A'/'D' on RESP='00'; EVALUATE WS-IDX to assign to specific xxI fields and UNP protect SEL. No errors, assumes valid input.",
        "called_by": [
          "PROCESS-PAGE-FORWARD"
        ],
        "calls": [],
        "citation": [
          522,
          607
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "ACCTIDI OF COPAU0AI = SPACES OR LOW-VALUES",
        "action": "Set WS-ERR-FLG 'Y', WS-MESSAGE 'Please enter Acct Id...', ACCTIDL -1",
        "citation": [
          261
        ]
      },
      {
        "condition": "ACCTIDI NOT NUMERIC",
        "action": "Set WS-ERR-FLG 'Y', WS-MESSAGE 'Acct Id must be Numeric...', ACCTIDL -1",
        "citation": [
          261
        ]
      },
      {
        "condition": "IMS DIBSTAT OTHER (not OK/NOT-FOUND/EOF)",
        "action": "Set WS-ERR-FLG 'Y', STRING error message with IMS-RETURN-CODE, ACCTIDL -1, SEND-PAULST-SCREEN",
        "citation": [
          458,
          488
        ]
      },
      {
        "condition": "EIBAID OTHER",
        "action": "Set WS-ERR-FLG 'Y', WS-MESSAGE CCDA-MSG-INVALID-KEY, ACCTIDL -1, SEND screen",
        "citation": [
          178
        ]
      },
      {
        "condition": "CDEMO-CPVS-PAU-SEL-FLG NOT 'S'/'s'",
        "action": "Set WS-MESSAGE 'Invalid selection. Valid value is S', ACCTIDL -1",
        "citation": [
          261
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "RETURN",
        "resource": "TRANSID (WS-CICS-TRANID)",
        "purpose": "Return control to CICS with updated commarea at end of transaction",
        "citation": 178
      },
      {
        "command": "XCTL",
        "resource": "PROGRAM (CDEMO-TO-PROGRAM)",
        "purpose": "Transfer to authorization detail program without return",
        "citation": 261
      }
    ],
    "open_questions": [
      {
        "question": "Details of unshown paragraphs like INITIALIZE-AUTH-DATA, GATHER-ACCOUNT-DETAILS, SEND-PAULST-SCREEN",
        "context": "AST partial; hints indicate complexity (loops, decisions, mods) but code not provided",
        "suggestion": "Provide full AST or source for these"
      },
      {
        "question": "Exact copybook structures (e.g. fields in COPAU0A, CARDDEMO)",
        "context": "Field usage visible but layouts unknown",
        "suggestion": "Analyze copybook files"
      },
      {
        "question": "What programs COCOM01Y, COPAU00 etc. do (called from COPAUS0C)",
        "context": "Outline lists but no AST details",
        "suggestion": "Trace calls"
      },
      {
        "question": "WS-CICS-TRANID value and entry transaction ID",
        "context": "Used but not set in AST",
        "suggestion": "Check working storage init"
      },
      {
        "question": "Full list of called programs from COPAUS0C (+9 more)",
        "context": "Outline truncated",
        "suggestion": "Full static analysis"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:22:13.106387"
}