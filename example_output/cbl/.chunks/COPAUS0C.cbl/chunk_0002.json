{
  "batch_idx": 2,
  "total_batches": 3,
  "template": {
    "header": {
      "program_id": "COPAUS0C",
      "file_name": "cbl/COPAUS0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:30:40.599472",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "The SCHEDULE-PSB paragraph schedules an IMS PSB using DL/I SCHD calls. It reschedules by terminating first if already scheduled multiple times. On failure, it triggers error display via SEND-PAULST-SCREEN.",
      "business_context": "IMS DL/I application initialization or transaction handling for PSB management",
      "program_type": "ONLINE_CICS",
      "citations": [
        1001,
        1031
      ]
    },
    "inputs": [
      {
        "name": "PSB-NAME",
        "io_type": "OTHER",
        "description": "IMS Program Specification Block name passed to SCHD call",
        "copybook": null,
        "citation": [
          1001
        ]
      },
      {
        "name": "DIBSTAT",
        "io_type": "OTHER",
        "description": "DL/I status code from SCHD operation",
        "copybook": null,
        "citation": [
          1002
        ]
      },
      {
        "name": "PSB-SCHEDULED-MORE-THAN-ONCE",
        "io_type": "OTHER",
        "description": "Condition flag checked for multiple scheduling",
        "copybook": null,
        "citation": [
          1005
        ]
      },
      {
        "name": "STATUS-OK",
        "io_type": "OTHER",
        "description": "Condition indicating successful IMS return code",
        "copybook": null,
        "citation": [
          1015
        ]
      }
    ],
    "outputs": [
      {
        "name": "IMS-RETURN-CODE",
        "io_type": "OTHER",
        "description": "Updated with DIBSTAT after SCHD or TERM operations",
        "copybook": null,
        "citation": [
          1002,
          1015
        ]
      },
      {
        "name": "IMS-PSB-SCHD",
        "io_type": "OTHER",
        "description": "Flag set to TRUE on successful PSB scheduling",
        "copybook": null,
        "citation": [
          1020
        ]
      },
      {
        "name": "WS-ERR-FLG",
        "io_type": "OTHER",
        "description": "Set to 'Y' on scheduling failure",
        "copybook": null,
        "citation": [
          1022
        ]
      },
      {
        "name": "WS-MESSAGE",
        "io_type": "OTHER",
        "description": "Error message built with IMS return code on failure",
        "copybook": null,
        "citation": [
          1023
        ]
      },
      {
        "name": "ACCTIDL OF COPAU0AI",
        "io_type": "OTHER",
        "description": "Set to -1 to indicate error in commarea or linkage structure",
        "copybook": null,
        "citation": [
          1026
        ]
      }
    ],
    "called_programs": [],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": [
        "COPAU0AI"
      ]
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Terminate and reschedule PSB if already scheduled more than once",
        "logic_summary": "EXEC DLI TERM followed by EXEC DLI SCHD if PSB-SCHEDULED-MORE-THAN-ONCE",
        "conditions": [
          "PSB-SCHEDULED-MORE-THAN-ONCE"
        ],
        "citation": [
          1005,
          1010
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Handle PSB scheduling failure by setting error indicators and displaying screen",
        "logic_summary": "Set flags, build message, update ACCTIDL, perform SEND-PAULST-SCREEN if not STATUS-OK",
        "conditions": [
          "STATUS-OK false"
        ],
        "citation": [
          1015,
          1022
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "DIBSTAT",
          "fields_used": [
            "DIBSTAT"
          ],
          "citation": [
            1002
          ]
        },
        {
          "source": "PSB-SCHEDULED-MORE-THAN-ONCE",
          "fields_used": [
            "PSB-SCHEDULED-MORE-THAN-ONCE"
          ],
          "citation": [
            1005
          ]
        },
        {
          "source": "STATUS-OK",
          "fields_used": [
            "STATUS-OK"
          ],
          "citation": [
            1015
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "IMS-RETURN-CODE",
          "fields_written": [
            "IMS-RETURN-CODE"
          ],
          "citation": [
            1002,
            1015
          ]
        },
        {
          "destination": "IMS-PSB-SCHD",
          "fields_written": [
            "IMS-PSB-SCHD"
          ],
          "citation": [
            1020
          ]
        },
        {
          "destination": "WS-ERR-FLG",
          "fields_written": [
            "WS-ERR-FLG"
          ],
          "citation": [
            1022
          ]
        },
        {
          "destination": "WS-MESSAGE",
          "fields_written": [
            "WS-MESSAGE"
          ],
          "citation": [
            1023
          ]
        },
        {
          "destination": "ACCTIDL OF COPAU0AI",
          "fields_written": [
            "ACCTIDL"
          ],
          "citation": [
            1026
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "DIBSTAT",
          "output_field": "IMS-RETURN-CODE",
          "transformation_description": "Direct MOVE of DL/I status to return code variable",
          "citation": [
            1002
          ]
        },
        {
          "input_field": "' System error while scheduling PSB: Code:' AND IMS-RETURN-CODE",
          "output_field": "WS-MESSAGE",
          "transformation_description": "STRING operation concatenates literal and code into message",
          "citation": [
            1023
          ]
        },
        {
          "input_field": "-1",
          "output_field": "ACCTIDL OF COPAU0AI",
          "transformation_description": "Hard-coded MOVE to signal error in account ID field",
          "citation": [
            1026
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "COPAU0AI",
        "purpose": "Structure defining ACCTIDL field, likely used in linkage or commarea for screen or transaction data",
        "location": "LINKAGE",
        "citation": 1026
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "SCHEDULE-PSB",
        "summary": null,
        "purpose": "This paragraph's primary purpose is to schedule an IMS PSB named in PSB-NAME using EXEC DLI SCHD with NODHABEND to prevent abends on error. It consumes DIBSTAT from the DL/I environment after the initial SCHD call, moving it to IMS-RETURN-CODE for evaluation. It also reads the condition PSB-SCHEDULED-MORE-THAN-ONCE from working storage to decide on rescheduling logic. If true, it produces a TERM call to unschedule, followed by a new SCHD call, updating IMS-RETURN-CODE again. The paragraph then checks STATUS-OK (derived from IMS-RETURN-CODE) and sets IMS-PSB-SCHD to TRUE on success, producing a success flag for program flow control. On failure, it sets WS-ERR-FLG to 'Y', transforms IMS-RETURN-CODE into WS-MESSAGE via STRING, sets ACCTIDL in COPAU0AI to -1 as an error indicator, and calls SEND-PAULST-SCREEN to display the error likely to the user. Error handling is implicit via NODHABEND and the status check, with no abend but flow to screen display. No external files or databases are accessed directly; all operations are on working storage variables and DL/I control. This paragraph acts as an initialization or recovery routine for IMS PSB availability in an online transaction context.",
        "called_by": [],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          1001,
          1031
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "PSB scheduling failure (NOT STATUS-OK)",
        "action": "MOVE 'Y' TO WS-ERR-FLG; STRING error message to WS-MESSAGE; MOVE -1 TO ACCTIDL OF COPAU0AI; PERFORM SEND-PAULST-SCREEN",
        "citation": [
          1015,
          1022,
          1023,
          1026
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [],
    "open_questions": [
      {
        "question": "Definition and source of PSB-NAME, PSB-SCHEDULED-MORE-THAN-ONCE, STATUS-OK, DIBSTAT",
        "context": "Variables referenced but not defined in provided AST snippet",
        "suggestion": "Review WORKING-STORAGE SECTION or prior paragraphs for declarations"
      },
      {
        "question": "Purpose and implementation of SEND-PAULST-SCREEN paragraph",
        "context": "Called on error but AST not provided",
        "suggestion": "Analyze SEND-PAULST-SCREEN paragraph AST"
      },
      {
        "question": "Overall program flow and role of this paragraph (entry? init?)",
        "context": "Only single paragraph provided",
        "suggestion": "Provide full program AST or paragraph outline"
      },
      {
        "question": "Is COPAU0AI a CICS COMMAREA, IMS PCB, or other structure?",
        "context": "Used for ACCTIDL but copybook details unknown",
        "suggestion": "Inspect copybook definitions and program sections"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:30:40.601114"
}