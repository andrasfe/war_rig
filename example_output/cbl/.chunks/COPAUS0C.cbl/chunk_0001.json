{
  "batch_idx": 1,
  "total_batches": 3,
  "template": {
    "header": {
      "program_id": "COPAUS0C",
      "file_name": "cbl/COPAUS0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T03:53:44.225648",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "COPAUS0C is a CICS online program that displays the PAULST screen with account details, customer information, credit limits, and authorization summary for a given account ID. It receives input from the COPAU0A map, initializes auth data fields, gathers data from CARDXREF, ACCOUNT, CUSTOMER VSAM files via CICS READ, retrieves IMS PAUTSUM0 segment for auth stats, populates and sends the output map, handling read errors by displaying messages and resending the screen. Users can return to the previous screen via XCTL to COSGN00C.",
      "business_context": "Card authorization demo system; provides summary view of account holder details and recent auth history for teller/operator review.",
      "program_type": "ONLINE_CICS",
      "citations": [
        681,
        750,
        812
      ]
    },
    "inputs": [
      {
        "name": "COPAU0AI",
        "io_type": "CICS_MAP",
        "description": "Input map from PAULST screen containing account ID in ACCTIDL and auth selection fields like SEL0001A/TRNID01I",
        "copybook": null,
        "citation": [
          104,
          107
        ]
      },
      {
        "name": "WS-CARDXREFNAME-ACCT-PATH",
        "io_type": "FILE_VSAM",
        "description": "Card cross-reference file accessed via alternate index by account ID to get customer ID and card number",
        "copybook": null,
        "citation": [
          202,
          203
        ]
      },
      {
        "name": "WS-ACCTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Account file accessed by account ID to retrieve account details like credit limits",
        "copybook": null,
        "citation": [
          252,
          253
        ]
      },
      {
        "name": "WS-CUSTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Customer file accessed by customer ID to retrieve customer name, address, phone",
        "copybook": null,
        "citation": [
          302,
          303
        ]
      },
      {
        "name": "PAUTSUM0",
        "io_type": "IMS_SEGMENT",
        "description": "IMS pending authorization summary segment qualified by account ID containing counts and balances of approvals/declines",
        "copybook": null,
        "citation": [
          355,
          356
        ]
      }
    ],
    "outputs": [
      {
        "name": "COPAU0AO",
        "io_type": "CICS_MAP",
        "description": "Output map for PAULST screen populated with header info, customer details, addresses, limits, auth summary stats, and error messages",
        "copybook": null,
        "citation": [
          85,
          96
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "COSGN00C",
        "call_type": "CICS_XCTL",
        "purpose": "Return control to previous signing program with updated COMMAREA context",
        "parameters": [
          "CARDDEMO-COMMAREA"
        ],
        "citation": 67
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": [
        "CARDDEMO-COMMAREA"
      ]
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "If CARDXREF read returns NORMAL, populate CDEMO-CUST-ID and CDEMO-CARD-NUM; on NOTFND or error, set error message and resend screen with ACCTIDL=-1",
        "logic_summary": "EVALUATE WS-RESP-CD after CICS READ",
        "conditions": [
          "DFHRESP(NORMAL)",
          "DFHRESP(NOTFND)",
          "OTHER"
        ],
        "citation": [
          212,
          230,
          243
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Similar validation for ACCOUNT file read; continue on NORMAL, error message and resend on NOTFND/OTHER",
        "logic_summary": "EVALUATE WS-RESP-CD after CICS READ",
        "conditions": [
          "DFHRESP(NORMAL)",
          "DFHRESP(NOTFND)",
          "OTHER"
        ],
        "citation": [
          262,
          277,
          292
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Similar for CUSTOMER file; continue on NORMAL, error on NOTFND/OTHER",
        "logic_summary": "EVALUATE WS-RESP-CD after CICS READ",
        "conditions": [
          "DFHRESP(NORMAL)",
          "DFHRESP(NOTFND)",
          "OTHER"
        ],
        "citation": [
          312,
          327,
          342
        ]
      },
      {
        "rule_id": "BR004",
        "description": "For IMS PAUTSUM0 GU, set FOUND if STATUS-OK, NFOUND if SEGMENT-NOT-FOUND, error message/resend otherwise",
        "logic_summary": "EVALUATE DIBSTAT/IMS-RETURN-CODE",
        "conditions": [
          "STATUS-OK",
          "SEGMENT-NOT-FOUND",
          "OTHER"
        ],
        "citation": [
          360,
          375
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "COPAU0AI",
          "fields_used": [
            "ACCTIDL"
          ],
          "citation": [
            228
          ]
        },
        {
          "source": "CARD-XREF-RECORD",
          "fields_used": [
            "XREF-CUST-ID",
            "XREF-CARD-NUM"
          ],
          "citation": [
            214,
            215
          ]
        },
        {
          "source": "ACCOUNT-RECORD",
          "fields_used": [
            "ACCT-CREDIT-LIMIT",
            "ACCT-CASH-CREDIT-LIMIT"
          ],
          "citation": [
            166,
            168
          ]
        },
        {
          "source": "CUSTOMER-RECORD",
          "fields_used": [
            "CUST-ID",
            "CUST-FIRST-NAME",
            "CUST-MIDDLE-NAME",
            "CUST-LAST-NAME",
            "CUST-ADDR-LINE-1",
            "CUST-ADDR-LINE-2",
            "CUST-ADDR-LINE-3",
            "CUST-ADDR-STATE-CD",
            "CUST-ADDR-ZIP",
            "CUST-PHONE-NUM-1"
          ],
          "citation": [
            143,
            144,
            165
          ]
        },
        {
          "source": "PENDING-AUTH-SUMMARY",
          "fields_used": [
            "PA-APPROVED-AUTH-CNT",
            "PA-DECLINED-AUTH-CNT",
            "PA-CREDIT-BALANCE",
            "PA-CASH-BALANCE",
            "PA-APPROVED-AUTH-AMT",
            "PA-DECLINED-AUTH-AMT"
          ],
          "citation": [
            174,
            183
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "COPAU0AO",
          "fields_written": [
            "CNAMEO",
            "ADDR001O",
            "ADDR002O",
            "PHONE1O",
            "CREDLIMO",
            "CASHLIMO",
            "APPRCNTO",
            "DECLCNTO",
            "CREDBALO",
            "CASHBALO",
            "APPRAMTO",
            "DECLAMTO",
            "ERRMSGO"
          ],
          "citation": [
            144,
            82
          ]
        },
        {
          "destination": "CDEMO-CUST-ID",
          "fields_written": [
            "XREF-CUST-ID"
          ],
          "citation": [
            214
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "CUST-FIRST-NAME, CUST-MIDDLE-NAME(1:1), CUST-LAST-NAME",
          "output_field": "CNAMEO",
          "transformation_description": "STRING with spaces into full customer name",
          "citation": [
            144
          ]
        },
        {
          "input_field": "CUST-ADDR-LINE-1, CUST-ADDR-LINE-2",
          "output_field": "ADDR001O",
          "transformation_description": "STRING with comma delimiter, trimmed by spaces",
          "citation": [
            152
          ]
        },
        {
          "input_field": "CUST-ADDR-LINE-3, CUST-ADDR-STATE-CD, CUST-ADDR-ZIP(1:5)",
          "output_field": "ADDR002O",
          "transformation_description": "STRING with commas",
          "citation": [
            157
          ]
        },
        {
          "input_field": "FUNCTION CURRENT-DATE",
          "output_field": "CURDATEO",
          "transformation_description": "Format WS-CURDATE-MONTH-DAY-YY(3:2) into MM-DD-YY",
          "citation": [
            116,
            127
          ]
        },
        {
          "input_field": "ACCT-CREDIT-LIMIT",
          "output_field": "CREDLIMO",
          "transformation_description": "Move to WS-DISPLAY-AMT12 (likely edited numeric display) then to output",
          "citation": [
            166
          ]
        },
        {
          "input_field": "PA-APPROVED-AUTH-CNT",
          "output_field": "APPRCNTO",
          "transformation_description": "Move to WS-DISPLAY-COUNT (display format) then to output if segment found",
          "citation": [
            174
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "COPAU0AI",
        "purpose": "Defines input communication area for COPAU0A BMS map including ACCTIDL, SEL000xA/I, TRNIDxxI etc.",
        "location": "WORKING_STORAGE",
        "citation": 107
      },
      {
        "copybook_name": "COPAU0AO",
        "purpose": "Defines output communication area for COPAU0A BMS map including CUSTIDO, CNAMEO, ERRMSGO etc.",
        "location": "WORKING_STORAGE",
        "citation": 86
      },
      {
        "copybook_name": "CARD-XREF-RECORD",
        "purpose": "Layout for card cross-reference record with XREF-CUST-ID, XREF-CARD-NUM",
        "location": "WORKING_STORAGE",
        "citation": 206
      },
      {
        "copybook_name": "ACCOUNT-RECORD",
        "purpose": "Account record layout with ACCT-CREDIT-LIMIT, ACCT-CASH-CREDIT-LIMIT",
        "location": "WORKING_STORAGE",
        "citation": 256
      },
      {
        "copybook_name": "CUSTOMER-RECORD",
        "purpose": "Customer record with name, address, phone fields",
        "location": "WORKING_STORAGE",
        "citation": 306
      },
      {
        "copybook_name": "PENDING-AUTH-SUMMARY",
        "purpose": "IMS PAUTSUM0 segment layout with auth counts and amounts",
        "location": "WORKING_STORAGE",
        "citation": 356
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "INITIALIZE-AUTH-DATA",
        "summary": null,
        "purpose": "This paragraph serves as an initialization routine for the authorization history display fields on the PAULST screen, ensuring they are cleared and protected prior to screen presentation. It consumes no external inputs but uses WS-IDX as a loop counter, varying from 1 to 5. For each index, it EVALUATEs to set SEL000xA fields to DFHBMPRO (protecting from user input) and spaces out associated input fields such as TRNIDxxI, PDATExxI, PTIMExxI, PTYPExxI, PAPRVxxI, PSTATxxI, and PAMTxxI in the COPAU0AI structure. The outputs are these modified fields in COPAU0AI, ready for output map transmission. There are no business decisions beyond the fixed loop; it unconditionally initializes all five lines. No error handling or validation is implemented. No subordinate paragraphs or programs are called. This step prevents garbage data from prior transactions and sets up blank lines for potential auth history display.",
        "called_by": [],
        "calls": [],
        "citation": [
          608,
          664
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RETURN-TO-PREV-SCREEN",
        "summary": null,
        "purpose": "This paragraph handles navigation back to the previous screen or program, typically triggered by user selection like PF3 or F3. It consumes WS-CICS-TRANID, WS-PGM-AUTH-SMRY, and conditionally sets CDEMO-TO-PROGRAM to 'COSGN00C' if it is LOW-VALUES or SPACES. It produces updates to CARDDEMO-COMMAREA by moving the from-tranid, from-program, and zeroing context before XCTL. Business logic includes a simple IF check to default the target program name. No explicit error handling for the XCTL (CICS handles). It calls no paragraphs but performs CICS XCTL to CDEMO-TO-PROGRAM (COSGN00C). Control does not return, ending this program's execution. This facilitates workflow return in the card demo application.",
        "called_by": [],
        "calls": [
          "CDEMO-TO-PROGRAM"
        ],
        "citation": [
          665,
          680
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "SEND-PAULST-SCREEN",
        "summary": null,
        "purpose": "This is the screen presentation paragraph responsible for transmitting the fully populated PAULST screen to the terminal user. It first consumes the IMS-PSB-SCHD flag; if true, sets IMS-PSB-NOT-SCHD and executes CICS SYNCPOINT to commit IMS database changes before screen send. It then calls POPULATE-HEADER-INFO to fill header fields and moves WS-MESSAGE to ERRMSGO. Outputs are via CICS SEND MAP('COPAU0A') FROM(COPAU0AO) with CURSOR, conditionally including ERASE if SEND-ERASE-YES. Business logic decides on SYNCPOINT and ERASE based on flags. No explicit error handling for SEND (CICS RESP not checked). Calls POPULATE-HEADER-INFO for dynamic header data. This paragraph is frequently called on errors from data retrieval to redisplay with messages.",
        "called_by": [],
        "calls": [
          "POPULATE-HEADER-INFO"
        ],
        "citation": [
          681,
          711
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RECEIVE-PAULST-SCREEN",
        "summary": null,
        "purpose": "This paragraph receives user input from the PAULST screen into the input map structure. It consumes no prior data but executes CICS RECEIVE MAP('COPAU0A') INTO(COPAU0AI) capturing RESP/RESP2 into WS-RESP-CD/WS-REAS-CD. Outputs the populated COPAU0AI fields like ACCTIDL and selection inputs for subsequent processing. No business logic, decisions, or validations here; RESP codes captured but not evaluated in this para. No error handling performed. No calls to other paragraphs or programs. This is the entry point for user data after initial display, enabling account lookup via entered ACCTIDL.",
        "called_by": [],
        "calls": [],
        "citation": [
          712,
          725
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "POPULATE-HEADER-INFO",
        "summary": null,
        "purpose": "This utility paragraph populates static and dynamic header information on the output map for every screen send. It consumes no file data but calls FUNCTION CURRENT-DATE into WS-CURDATE-DATA and formats date/time substrings into WS-CURDATE-MM-DD-YY and WS-CURTIME-HH-MM-SS. Moves constants CCDA-TITLE01/02, WS-CICS-TRANID, WS-PGM-AUTH-SMRY to TITLE01O/TITLE02O/TRNNAMEO/PGMNAMEO, and formatted date/time to CURDATEO/CURTIMEO. Outputs these fields in COPAU0AO. No conditions or business rules; purely formatting. No error handling. No calls. Ensures consistent screen header with current timestamp and context.",
        "called_by": [],
        "calls": [],
        "citation": [
          726,
          749
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GATHER-ACCOUNT-DETAILS",
        "summary": null,
        "purpose": "This is the primary orchestration paragraph for fetching and formatting all account-related data for screen display. It consumes data from subordinate GET paragraphs: card xref for cust/card link, account for limits, customer for demographics, and auth summary for stats. Sequentially performs GETCARDXREF-BYACCT, GETACCTDATA-BYACCT, GETCUSTDATA-BYCUST, then formats customer name/addr via STRING, moves phone/limits using display editors WS-DISPLAY-AMTxx, performs GET-AUTH-SUMMARY, and conditionally populates output fields from PAUT summary (APPRCNTO etc.) if FOUND-PAUT-SMRY-SEG else zeros. Outputs populated COPAU0AO fields like CNAMEO, CREDLIMO, CREDBALO. Business logic: IF found segment then move stats else zero. Errors handled by sub-paras via resend. Calls four GET paragraphs for data retrieval.",
        "called_by": [],
        "calls": [
          "GETCARDXREF-BYACCT",
          "GETACCTDATA-BYACCT",
          "GETCUSTDATA-BYCUST",
          "GET-AUTH-SUMMARY"
        ],
        "citation": [
          750,
          811
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETCARDXREF-BYACCT",
        "summary": null,
        "purpose": "This paragraph retrieves customer/card linkage for the input account by reading VSAM CARDXREF via alternate index. Consumes WS-ACCT-ID moved to WS-CARD-RID-ACCT-ID-X for CICS READ DATASET(WS-CARDXREFNAME-ACCT-PATH). On NORMAL, moves XREF-CUST-ID/CARD-NUM to CDEMO- fields for context. On NOTFND/OTHER, builds WS-MESSAGE with details, sets ACCTIDL=-1 in input map, sets WS-ERR-FLG on system error, performs SEND-PAULST-SCREEN to redisplay error. Outputs updated CDEMO- fields or error screen. Business logic via EVALUATE WS-RESP-CD with three cases. Error handling redirects to screen resend. Calls SEND-PAULST-SCREEN twice potentially (once per error case).",
        "called_by": [],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          812,
          864
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETACCTDATA-BYACCT",
        "summary": null,
        "purpose": "Retrieves account master details by reading VSAM ACCOUNT file using account ID from prior xref. Consumes XREF-ACCT-ID moved to WS-CARD-RID-ACCT-ID-X for CICS READ DATASET(WS-ACCTFILENAME) INTO(ACCOUNT-RECORD). On NORMAL, continues silently (data available for later use). On NOTFND/OTHER, strings error message to WS-MESSAGE, sets ACCTIDL=-1, optionally WS-ERR-FLG, performs SEND-PAULST-SCREEN. Outputs ACCOUNT-RECORD fields like limits or error screen. Business logic EVALUATE WS-RESP-CD. Error handling via screen resend with message. Calls SEND-PAULST-SCREEN on errors.",
        "called_by": [],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          865,
          914
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETCUSTDATA-BYCUST",
        "summary": null,
        "purpose": "Fetches customer demographics by reading VSAM CUSTOMER file using cust ID from xref. Consumes XREF-CUST-ID to WS-CARD-RID-CUST-ID-X for CICS READ DATASET(WS-CUSTFILENAME) INTO(CUSTOMER-RECORD). On NORMAL, continues (data for formatting). On NOTFND/OTHER, builds WS-MESSAGE, sets ACCTIDL=-1, optionally WS-ERR-FLG, SEND-PAULST-SCREEN. Outputs CUSTOMER-RECORD or error screen. EVALUATE WS-RESP-CD logic. Errors resend screen. Calls SEND-PAULST-SCREEN on errors.",
        "called_by": [],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          915,
          965
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GET-AUTH-SUMMARY",
        "summary": null,
        "purpose": "Retrieves aggregated authorization summary from IMS by qualifying PAUTSUM0 segment. Consumes CDEMO-ACCT-ID to PA-ACCT-ID after PERFORM SCHEDULE-PSB, executes DLI GU USING PCB(PAUT-PCB-NUM) INTO(PENDING-AUTH-SUMMARY) WHERE(ACCNTID=PA-ACCT-ID). Evaluates DIBSTAT/IMS-RETURN-CODE: STATUS-OK sets FOUND-PAUT-SMRY-SEG, SEGMENT-NOT-FOUND sets NFOUND, OTHER builds error WS-MESSAGE, sets ACCTIDL=-1, SEND-PAULST-SCREEN. Outputs PENDING-AUTH-SUMMARY fields or error. Business logic on IMS status codes. Error handling resends screen. Calls SCHEDULE-PSB (not shown) and SEND-PAULST-SCREEN.",
        "called_by": [],
        "calls": [
          "SCHEDULE-PSB",
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          966,
          1000
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "CICS READ RESP=DFHRESP(NOTFND)",
        "action": "Build descriptive message in WS-MESSAGE, set ACCTIDL=-1 in COPAU0AI, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          217,
          229
        ]
      },
      {
        "condition": "CICS READ RESP=OTHER",
        "action": "Set WS-ERR-FLG='Y', build system error message, set ACCTIDL=-1, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          231,
          244
        ]
      },
      {
        "condition": "IMS DLI STATUS=OTHER",
        "action": "Set WS-ERR-FLG='Y', build message with IMS-RETURN-CODE, set ACCTIDL=-1, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          367,
          376
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "RECEIVE",
        "resource": "MAP('COPAU0A') MAPSET('COPAU00')",
        "purpose": "Capture user input including account ID from screen",
        "citation": 104
      },
      {
        "command": "SEND",
        "resource": "MAP('COPAU0A') MAPSET('COPAU00')",
        "purpose": "Transmit populated screen with data or error message",
        "citation": 85
      },
      {
        "command": "XCTL",
        "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
        "purpose": "Transfer control to prior program without return",
        "citation": 67
      },
      {
        "command": "SYNCPOINT",
        "resource": null,
        "purpose": "Commit IMS changes before screen send if PSB was scheduled",
        "citation": 76
      }
    ],
    "open_questions": [
      {
        "question": "Where is WS-ACCT-ID populated from COPAU0AI.ACCTIDL?",
        "context": "Used in GETCARDXREF-BYACCT line 201 but setting not in provided code",
        "suggestion": "Check code before line 608 for MOVE from input map"
      },
      {
        "question": "Definition and implementation of SCHEDULE-PSB paragraph",
        "context": "Called in GET-AUTH-SUMMARY line 350 but not provided",
        "suggestion": "Provide full source or separate analysis"
      },
      {
        "question": "Program entry point transaction ID",
        "context": "WS-CICS-TRANID used but value unknown",
        "suggestion": "Examine JCL or CICS definitions"
      },
      {
        "question": "Full copybook definitions for records/maps",
        "context": "Layouts inferred from usage but exact fields/sizes unknown",
        "suggestion": "Analyze referenced copybooks"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-23T20:53:44.227713"
}