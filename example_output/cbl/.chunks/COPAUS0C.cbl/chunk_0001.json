{
  "batch_idx": 1,
  "total_batches": 3,
  "template": {
    "header": {
      "program_id": "COPAUS0C",
      "file_name": "cbl/COPAUS0C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:26:27.070582",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "COPAUS0C is a CICS online transaction program that displays the PAULST authorization summary screen (COPAU0A map), retrieves card cross-reference, account, and customer data from VSAM files via CICS READ DATASET, fetches pending authorization summary from IMS database, and populates the screen with formatted customer details, account limits, and authorization statistics. It handles user input from the screen, initializes authorization data arrays, and supports navigation back to previous screens via XCTL. Error conditions during data retrieval trigger error messages and screen redisplay.",
      "business_context": "Serves card authorization summary display in a demo banking system, providing overview of customer account details and pending auth stats for Paul St. screen.",
      "program_type": "ONLINE_CICS",
      "citations": [
        608,
        681,
        750,
        812,
        865,
        915,
        966
      ]
    },
    "inputs": [
      {
        "name": "COPAU0AI",
        "io_type": "CICS_MAP",
        "description": "Input map fields from PAULST screen, including account ID (ACCTIDL) and selection fields (SEL0001A-SEL0005A)",
        "copybook": "COPAU00",
        "citation": [
          712
        ]
      },
      {
        "name": "WS-CARDXREFNAME-ACCT-PATH",
        "io_type": "FILE_VSAM",
        "description": "Card cross-reference file accessed by alternate index ACCT-ID to retrieve customer ID and card number",
        "copybook": null,
        "citation": [
          812
        ]
      },
      {
        "name": "WS-ACCTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Account file accessed by ACCT-ID to retrieve account details like credit limits",
        "copybook": null,
        "citation": [
          865
        ]
      },
      {
        "name": "WS-CUSTFILENAME",
        "io_type": "FILE_VSAM",
        "description": "Customer file accessed by CUST-ID to retrieve customer name, address, phone",
        "copybook": null,
        "citation": [
          915
        ]
      },
      {
        "name": "PAUTSUM0",
        "io_type": "IMS_SEGMENT",
        "description": "IMS pending authorization summary segment qualified by ACCT-ID",
        "copybook": null,
        "citation": [
          966
        ]
      },
      {
        "name": "CARDDEMO-COMMAREA",
        "io_type": "CICS_COMMAREA",
        "description": "Shared COMMAREA for passing transaction context to XCTL'd program",
        "copybook": null,
        "citation": [
          665
        ]
      }
    ],
    "outputs": [
      {
        "name": "COPAU0AO",
        "io_type": "CICS_MAP",
        "description": "Output map fields for PAULST screen including header info, customer details, account limits, auth counts/amounts, error messages",
        "copybook": "COPAU00",
        "citation": [
          681
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "COSGN00C",
        "call_type": "CICS_XCTL",
        "purpose": "Return control to previous screen/program (signature screen) with context from this program",
        "parameters": [
          "CDEMO-TO-PROGRAM",
          "CARDDEMO-COMMAREA"
        ],
        "citation": 665
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [
        "WS-CICS-TRANID"
      ],
      "linkage_section": [
        "CDEMO-CUST-ID",
        "CDEMO-CARD-NUM",
        "CDEMO-ACCT-ID"
      ]
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "If card XREF not found (DFHRESP(NOTFND)), display error message with account ID and response codes, set ACCTIDL to -1, and redisplay screen",
        "logic_summary": "EVALUATE WS-RESP-CD after CICS READ",
        "conditions": [
          "DFHRESP(NOTFND)"
        ],
        "citation": [
          812,
          830
        ]
      },
      {
        "rule_id": "BR002",
        "description": "If system error on card XREF read (other RESP), set error flag, build message, set ACCTIDL to -1, redisplay screen",
        "logic_summary": "EVALUATE WS-RESP-CD WHEN OTHER",
        "conditions": [
          "DFHRESP(OTHER)"
        ],
        "citation": [
          812,
          840
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Populate auth summary fields only if IMS segment found (STATUS-OK), else zero out counts and balances",
        "logic_summary": "EVALUATE IMS-RETURN-CODE from DLI GU call",
        "conditions": [
          "STATUS-OK",
          "SEGMENT-NOT-FOUND"
        ],
        "citation": [
          966,
          975
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "WS-CARDXREFNAME-ACCT-PATH",
          "fields_used": [
            "XREF-CUST-ID",
            "XREF-CARD-NUM"
          ],
          "citation": [
            812
          ]
        },
        {
          "source": "WS-ACCTFILENAME",
          "fields_used": [
            "ACCT-CREDIT-LIMIT",
            "ACCT-CASH-CREDIT-LIMIT"
          ],
          "citation": [
            865
          ]
        },
        {
          "source": "WS-CUSTFILENAME",
          "fields_used": [
            "CUST-ID",
            "CUST-FIRST-NAME",
            "CUST-LAST-NAME",
            "CUST-ADDR-LINE-1",
            "CUST-ADDR-LINE-2",
            "CUST-ADDR-LINE-3",
            "CUST-ADDR-STATE-CD",
            "CUST-ADDR-ZIP",
            "CUST-PHONE-NUM-1"
          ],
          "citation": [
            915
          ]
        },
        {
          "source": "PAUTSUM0",
          "fields_used": [
            "PA-APPROVED-AUTH-CNT",
            "PA-DECLINED-AUTH-CNT",
            "PA-CREDIT-BALANCE",
            "PA-CASH-BALANCE",
            "PA-APPROVED-AUTH-AMT",
            "PA-DECLINED-AUTH-AMT"
          ],
          "citation": [
            966
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "COPAU0AO",
          "fields_written": [
            "CNAMEO",
            "ADDR001O",
            "ADDR002O",
            "PHONE1O",
            "CREDLIMO",
            "CASHLIMO",
            "APPRCNTO",
            "DECLCNTO",
            "CREDBALO",
            "CASHBALO",
            "APPRAMTO",
            "DECLAMTO",
            "ERRMSGO"
          ],
          "citation": [
            750
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "CUST-FIRST-NAME, CUST-MIDDLE-NAME(1:1), CUST-LAST-NAME",
          "output_field": "CNAMEO",
          "transformation_description": "STRING customer first/middle initial/last name delimited by spaces into full name display field",
          "citation": [
            750
          ]
        },
        {
          "input_field": "CUST-ADDR-LINE-1, CUST-ADDR-LINE-2",
          "output_field": "ADDR001O",
          "transformation_description": "STRING address lines delimited by '  ' and comma into ADDR001O",
          "citation": [
            750
          ]
        },
        {
          "input_field": "ACCT-CREDIT-LIMIT",
          "output_field": "CREDLIMO",
          "transformation_description": "MOVE to WS-DISPLAY-AMT12 then to display field (formatted amount)",
          "citation": [
            750
          ]
        },
        {
          "input_field": "PA-APPROVED-AUTH-CNT",
          "output_field": "APPRCNTO",
          "transformation_description": "MOVE to WS-DISPLAY-COUNT then to display field if segment found",
          "citation": [
            750
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "COPAU00",
        "purpose": "Defines MAPSET for COPAU0A input (COPAU0AI) and output (COPAU0AO) areas including screen fields for account ID, selections, customer info, auth summary",
        "location": "WORKING_STORAGE",
        "citation": 681
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "INITIALIZE-AUTH-DATA",
        "summary": null,
        "purpose": "This paragraph initializes the authorization data selection fields in the input map COPAU0AI for up to 5 previous authorizations by looping WS-IDX from 1 to 5. It consumes WS-IDX counter and sets SEL0001A-SEL0005A to DFHBMPRO (protected) and clears associated input fields like TRNID01I, PDATE01I, PTIME01I, PTYPE01I, PAPRV01I, PSTAT01I, PAMT001I through 005 using EVALUATE WHEN. No outputs are written to files; it modifies COPAU0AI fields in working storage for later screen send. No business decisions are made beyond the fixed loop; it ensures previous auth lines are protected and cleared on screen display. No error handling is performed as operations are simple MOVE statements. No other paragraphs or programs are called.",
        "called_by": [],
        "calls": [],
        "citation": [
          608,
          664
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RETURN-TO-PREV-SCREEN",
        "summary": null,
        "purpose": "This paragraph handles navigation back to the previous screen by setting CDEMO-TO-PROGRAM to 'COSGN00C' if low-values or spaces, and populates COMMAREA fields with current transaction ID (WS-CICS-TRANID), this program name (WS-PGM-AUTH-SMRY), and zeros context. It consumes WS-CICS-TRANID, WS-PGM-AUTH-SMRY, CDEMO-TO-PROGRAM from working storage/commaREA. Outputs are updated COMMAREA fields passed via XCTL to COSGN00C. Business logic checks if CDEMO-TO-PROGRAM needs defaulting to signature screen. No explicit error handling for XCTL (CICS handles RESP implicitly). Calls EXEC CICS XCTL to transfer control to previous program.",
        "called_by": [],
        "calls": [
          "CDEMO-TO-PROGRAM"
        ],
        "citation": [
          665,
          680
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "SEND-PAULST-SCREEN",
        "summary": null,
        "purpose": "This paragraph sends the PAULST screen (COPAU0A map) to the user, first committing any IMS PSB schedule if active via SYNCPOINT, then performing POPULATE-HEADER-INFO to set titles, tran/program names, current date/time. It consumes WS-MESSAGE for ERRMSGO, SEND-ERASE-YES flag, and populated COPAU0AO fields. Outputs the entire COPAU0AO map via CICS SEND MAP with CURSOR, optionally ERASE. Business logic conditionally issues SYNCPOINT if IMS-PSB-SCHD and chooses ERASE based on flag. No explicit error handling shown for SEND (CICS RESP not checked). Calls POPULATE-HEADER-INFO for header population.",
        "called_by": [
          "GETCARDXREF-BYACCT",
          "GETACCTDATA-BYACCT",
          "GETCUSTDATA-BYCUST"
        ],
        "calls": [
          "POPULATE-HEADER-INFO"
        ],
        "citation": [
          681,
          711
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RECEIVE-PAULST-SCREEN",
        "summary": null,
        "purpose": "This paragraph receives user input from the PAULST screen into COPAU0AI map, capturing fields like account ID and selections. It consumes the screen data via CICS RECEIVE MAP. Outputs populated COPAU0AI fields in working storage for subsequent processing, and sets WS-RESP-CD/WS-REAS-CD for potential error checking. No business logic or decisions; purely I/O. No error handling in paragraph (RESP codes set but not evaluated here). No calls to other paragraphs/programs.",
        "called_by": [],
        "calls": [],
        "citation": [
          712,
          725
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "POPULATE-HEADER-INFO",
        "summary": null,
        "purpose": "This paragraph populates the screen header with titles, transaction/program names, and formatted current date/time. It consumes WS-CICS-TRANID, WS-PGM-AUTH-SMRY, and computes current date/time via FUNCTION CURRENT-DATE into WS-CURDATE-DATA/WS-CURTIME. Outputs TITLE01O/TITLE02O/TRNNAMEO/PGMNAMEO/CURDATEO/CURTIMEO in COPAU0AO by reformatting date (MM-DD-YY) and time (HH-MM-SS). No conditions or decisions; fixed formatting logic. No error handling. No calls.",
        "called_by": [
          "SEND-PAULST-SCREEN"
        ],
        "calls": [],
        "citation": [
          726,
          749
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GATHER-ACCOUNT-DETAILS",
        "summary": null,
        "purpose": "This paragraph orchestrates retrieval of all account-related data by calling subordinate GET paragraphs, then formats and populates screen fields with customer name/address/phone, account limits, and auth summary stats. It consumes data from CARD-XREF-RECORD, ACCOUNT-RECORD, CUSTOMER-RECORD, PENDING-AUTH-SUMMARY placed by prior reads. Outputs formatted fields to COPAU0AO like CNAMEO (STRING name), ADDR001O/ADDR002O (STRING address), PHONE1O, CREDLIMO/CASHLIMO (formatted limits), APPRCNTO etc. (if FOUND-PAUT-SMRY-SEG). Business logic conditionally moves auth fields or zeros them if segment not found. No explicit errors handled here. Calls GETCARDXREF-BYACCT, GETACCTDATA-BYACCT, GETCUSTDATA-BYCUST, GET-AUTH-SUMMARY.",
        "called_by": [],
        "calls": [
          "GETCARDXREF-BYACCT",
          "GETACCTDATA-BYACCT",
          "GETCUSTDATA-BYCUST",
          "GET-AUTH-SUMMARY"
        ],
        "citation": [
          750,
          811
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETCARDXREF-BYACCT",
        "summary": null,
        "purpose": "This paragraph reads the card cross-reference VSAM file by alternate ACCT-ID index to get customer/card linkage. Consumes WS-ACCT-ID into search key WS-CARD-RID-ACCT-ID-X. Outputs XREF-CUST-ID/XREF-CARD-NUM to CDEMO- fields in CARD-XREF-RECORD if normal. Business logic EVALUATE RESP: NORMAL continues; NOTFND builds 'Account not found' message, sets ACCTIDL=-1, SEND-PAULST-SCREEN; OTHER sets WS-ERR-FLG, builds system error message, SEND-PAULST-SCREEN. Error handling displays issues and redisplays screen. Calls SEND-PAULST-SCREEN on errors.",
        "called_by": [
          "GATHER-ACCOUNT-DETAILS"
        ],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          812,
          864
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETACCTDATA-BYACCT",
        "summary": null,
        "purpose": "This paragraph reads the account VSAM file by ACCT-ID (from XREF-ACCT-ID) to load account record. Consumes WS-CARD-RID-ACCT-ID-X from prior XREF. Outputs ACCOUNT-RECORD fields like limits if normal. Business logic EVALUATE RESP: NORMAL continue; NOTFND message 'Account not found in ACCT', ACCTIDL=-1, SEND screen; OTHER error flag/message, SEND screen. Error handling via screen redisplay with message. Calls SEND-PAULST-SCREEN on errors.",
        "called_by": [
          "GATHER-ACCOUNT-DETAILS"
        ],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          865,
          914
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GETCUSTDATA-BYCUST",
        "summary": null,
        "purpose": "This paragraph reads the customer VSAM file by CUST-ID (from XREF-CUST-ID) to load customer record. Consumes WS-CARD-RID-CUST-ID-X from prior XREF. Outputs CUSTOMER-RECORD fields like name/address/phone if normal. Business logic EVALUATE RESP: NORMAL continue; NOTFND 'Customer not found', ACCTIDL=-1, SEND screen; OTHER error flag/message, SEND screen. Error handling redisplays screen with message. Calls SEND-PAULST-SCREEN on errors.",
        "called_by": [
          "GATHER-ACCOUNT-DETAILS"
        ],
        "calls": [
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          915,
          965
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "GET-AUTH-SUMMARY",
        "summary": null,
        "purpose": "This paragraph retrieves IMS pending auth summary segment PAUTSUM0 qualified by ACCT-ID. Consumes CDEMO-ACCT-ID into PA-ACCT-ID, schedules PSB. Outputs PENDING-AUTH-SUMMARY fields if found. Business logic: SCHEDULE-PSB, DLI GU call, EVALUATE DIBSTAT: STATUS-OK set FOUND; SEGMENT-NOT-FOUND set NFOUND; OTHER error flag/message, ACCTIDL=-1, SEND screen. Error handling for IMS via screen message. Calls SCHEDULE-PSB, SEND-PAULST-SCREEN on error.",
        "called_by": [
          "GATHER-ACCOUNT-DETAILS"
        ],
        "calls": [
          "SCHEDULE-PSB",
          "SEND-PAULST-SCREEN"
        ],
        "citation": [
          966,
          1000
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "CICS READ RESP = DFHRESP(NOTFND)",
        "action": "Build error message with account/customer ID and codes, set ACCTIDL=-1, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          830,
          865,
          915
        ]
      },
      {
        "condition": "CICS READ RESP = OTHER",
        "action": "Set WS-ERR-FLG='Y', build system error message, set ACCTIDL=-1, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          840,
          890,
          940
        ]
      },
      {
        "condition": "IMS DIBSTAT = OTHER",
        "action": "Set WS-ERR-FLG='Y', build IMS error message with code, set ACCTIDL=-1, PERFORM SEND-PAULST-SCREEN",
        "citation": [
          985
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "SEND MAP",
        "resource": "COPAU0A",
        "purpose": "Display populated PAULST screen with cursor, optionally ERASE",
        "citation": 681
      },
      {
        "command": "RECEIVE MAP",
        "resource": "COPAU0A",
        "purpose": "Receive user input from PAULST screen into COPAU0AI",
        "citation": 712
      },
      {
        "command": "READ DATASET",
        "resource": "WS-CARDXREFNAME-ACCT-PATH",
        "purpose": "Read card XREF by ACCT-ID RIDFLD",
        "citation": 812
      },
      {
        "command": "XCTL PROGRAM",
        "resource": "CDEMO-TO-PROGRAM",
        "purpose": "Transfer control to previous program with COMMAREA",
        "citation": 665
      },
      {
        "command": "SYNCPOINT",
        "resource": null,
        "purpose": "Commit IMS PSB schedule before screen send",
        "citation": 681
      }
    ],
    "open_questions": [
      {
        "question": "What is the overall program flow and main entry point paragraph?",
        "context": "Only subordinate paragraphs provided in AST; no main PROCEDURE DIVISION or top-level flow visible",
        "suggestion": "Provide full source or main paragraph AST"
      },
      {
        "question": "Exact copybook names for data records (CARD-XREF-RECORD, ACCOUNT-RECORD, etc.)?",
        "context": "Records referenced but no COPY statements shown in provided AST",
        "suggestion": "Scan for COPY in full source"
      },
      {
        "question": "Definition and source of WS-ACCT-ID input?",
        "context": "Used as key for first read but not shown how populated (likely from map ACCTIDL)",
        "suggestion": "Check RECEIVE or prior logic"
      },
      {
        "question": "Details of SCHEDULE-PSB paragraph?",
        "context": "Called but code not provided",
        "suggestion": "Include AST for SCHEDULE-PSB"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:26:27.072356"
}