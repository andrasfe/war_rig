{
  "batch_idx": 1,
  "total_batches": 2,
  "template": {
    "header": {
      "program_id": "COPAUS1C",
      "file_name": "COPAUS1C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-24T17:36:32.135572",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This COBOL program interacts with an IMS database to retrieve and update pending authorization details. It retrieves authorization summary and detail records based on account ID and authorization key, and allows for marking authorizations as fraudulent. The program uses CICS SYNCPOINT and ROLLBACK commands to ensure data consistency during updates.",
      "business_context": "This program likely supports a fraud detection or authorization workflow within a financial institution or similar organization.",
      "program_type": "ONLINE_CICS",
      "citations": [
        9,
        35,
        95
      ]
    },
    "inputs": [
      {
        "name": "PENDING-AUTH-SUMMARY",
        "io_type": "IMS_SEGMENT",
        "description": "Contains summary information about pending authorizations, including account ID.",
        "copybook": "PAUTSUM0",
        "citation": [
          11
        ]
      },
      {
        "name": "PENDING-AUTH-DETAILS",
        "io_type": "IMS_SEGMENT",
        "description": "Contains detailed information about a specific pending authorization, including fraud report date and removal status.",
        "copybook": "PAUTDTL1",
        "citation": [
          37,
          67,
          97
        ]
      },
      {
        "name": "WS-ACCT-ID",
        "io_type": "PARAMETER",
        "description": "Account ID used to retrieve authorization summary.",
        "copybook": null,
        "citation": [
          6
        ]
      },
      {
        "name": "WS-AUTH-KEY",
        "io_type": "PARAMETER",
        "description": "Authorization key used to retrieve authorization details.",
        "copybook": null,
        "citation": [
          7
        ]
      },
      {
        "name": "WS-FRAUD-AUTH-RECORD",
        "io_type": "PARAMETER",
        "description": "Fraud authorization record used to update PENDING-AUTH-DETAILS.",
        "copybook": null,
        "citation": [
          92
        ]
      }
    ],
    "outputs": [
      {
        "name": "PENDING-AUTH-DETAILS",
        "io_type": "IMS_SEGMENT",
        "description": "Updated with fraud information.",
        "copybook": "PAUTDTL1",
        "citation": [
          97
        ]
      },
      {
        "name": "WS-MESSAGE",
        "io_type": "CICS_MAP",
        "description": "Error messages and status information displayed on the screen.",
        "copybook": null,
        "citation": [
          29,
          55,
          84,
          118,
          160
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "SEND-AUTHVIEW-SCREEN",
        "call_type": "STATIC_CALL",
        "purpose": "Displays the authorization view screen with data and error messages.",
        "parameters": [],
        "citation": 31
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "If the PSB is scheduled more than once, terminate the PSB before scheduling it again.",
        "logic_summary": "Checks if PSB-SCHEDULED-MORE-THAN-ONCE is true, and if so, performs a DLI TERM before scheduling the PSB again.",
        "conditions": [
          "IF PSB-SCHEDULED-MORE-THAN-ONCE"
        ],
        "citation": [
          141,
          142
        ]
      },
      {
        "rule_id": "BR002",
        "description": "If the IMS call is successful, set IMS-PSB-SCHD to true.",
        "logic_summary": "Checks if STATUS-OK is true after scheduling the PSB, and if so, sets IMS-PSB-SCHD to true.",
        "conditions": [
          "IF STATUS-OK"
        ],
        "citation": [
          151,
          152
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "PENDING-AUTH-SUMMARY",
          "fields_used": [
            "ACCNTID"
          ],
          "citation": [
            12
          ]
        },
        {
          "source": "PENDING-AUTH-DETAILS",
          "fields_used": [
            "PAUT9CTS"
          ],
          "citation": [
            38
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "PENDING-AUTH-DETAILS",
          "fields_written": [
            "PA-FRAUD-RPT-DATE",
            "PA-FRAUD-REMOVED"
          ],
          "citation": [
            92,
            93
          ]
        },
        {
          "destination": "WS-MESSAGE",
          "fields_written": [
            "Error messages",
            "Status messages"
          ],
          "citation": [
            29,
            55,
            84,
            118,
            160
          ]
        }
      ],
      "transforms": []
    },
    "copybooks_used": [
      {
        "copybook_name": "PAUTSUM0",
        "purpose": "Defines the structure of the PENDING-AUTH-SUMMARY IMS segment.",
        "location": "WORKING_STORAGE",
        "citation": 10
      },
      {
        "copybook_name": "PAUTDTL1",
        "purpose": "Defines the structure of the PENDING-AUTH-DETAILS IMS segment.",
        "location": "WORKING_STORAGE",
        "citation": 36
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "READ-AUTH-RECORD",
        "summary": null,
        "purpose": "This paragraph retrieves pending authorization records from the IMS database. It first calls SCHEDULE-PSB to schedule the PSB required for accessing the IMS database. It then moves the account ID (WS-ACCT-ID) and authorization key (WS-AUTH-KEY) to the corresponding fields in the PAUTSUM0 segment. A DLI GU (Get Unique) call is issued to retrieve the PENDING-AUTH-SUMMARY segment based on the account ID. If the segment is found, a DLI GNP (Get Next within Parent) call is issued to retrieve the PENDING-AUTH-DETAILS segment based on the authorization key. Error handling is performed by checking the DIBSTAT return code after each DLI call. If an error occurs, an error message is constructed and displayed using SEND-AUTHVIEW-SCREEN. The paragraph sets AUTHS-NOT-EOF or AUTHS-EOF flags based on the DIBSTAT value.",
        "called_by": [],
        "calls": [
          "SCHEDULE-PSB",
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          1,
          61
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "READ-NEXT-AUTH-RECORD",
        "summary": null,
        "purpose": "This paragraph retrieves the next pending authorization detail record from the IMS database. It issues a DLI GNP (Get Next within Parent) call to retrieve the next PENDING-AUTH-DETAILS segment. The DIBSTAT return code is checked to determine the status of the call. If the call is successful, the AUTHS-NOT-EOF flag is set to TRUE. If an error occurs, an error message is constructed and displayed using SEND-AUTHVIEW-SCREEN, and the WS-ERR-FLG is set to 'Y'. The paragraph sets AUTHS-NOT-EOF or AUTHS-EOF flags based on the DIBSTAT value. This paragraph is designed to be called repeatedly to iterate through all detail records associated with a given summary record.",
        "called_by": [],
        "calls": [
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          63,
          88
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "UPDATE-AUTH-DETAILS",
        "summary": null,
        "purpose": "This paragraph updates the pending authorization details in the IMS database. It moves the fraud authorization record (WS-FRAUD-AUTH-RECORD) to the PENDING-AUTH-DETAILS segment. A DLI REPL (Replace) call is issued to update the segment in the database. The DIBSTAT return code is checked to determine the status of the update. If the update is successful, TAKE-SYNCPOINT is performed to commit the changes to the database, and a success message is moved to WS-MESSAGE. If the update fails, ROLL-BACK is performed to undo any changes, an error message is constructed and displayed using SEND-AUTHVIEW-SCREEN, and the WS-ERR-FLG is set to 'Y'. The paragraph also displays the PA-FRAUD-RPT-DATE value to the console.",
        "called_by": [],
        "calls": [
          "TAKE-SYNCPOINT",
          "ROLL-BACK",
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          90,
          122
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "TAKE-SYNCPOINT",
        "summary": null,
        "purpose": "This paragraph issues a CICS SYNCPOINT command to commit any changes made to recoverable resources, such as the IMS database. This ensures that all updates are made permanent and consistent. It does not take any inputs or produce any outputs other than the implicit effect of committing changes. It is called after a successful update of the authorization details. No error handling is explicitly performed within this paragraph; any errors during the SYNCPOINT command would likely be handled by the CICS region itself.",
        "called_by": [
          "UPDATE-AUTH-DETAILS"
        ],
        "calls": [],
        "citation": [
          124,
          127
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "ROLL-BACK",
        "summary": null,
        "purpose": "This paragraph issues a CICS SYNCPOINT ROLLBACK command to undo any changes made to recoverable resources. This is used to ensure data consistency in case of errors during the update process. It does not take any inputs or produce any outputs other than the implicit effect of rolling back changes. It is called when an error occurs during the update of authorization details. No explicit error handling is performed within this paragraph; any errors during the ROLLBACK command would likely be handled by the CICS region itself.",
        "called_by": [
          "UPDATE-AUTH-DETAILS"
        ],
        "calls": [],
        "citation": [
          129,
          133
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "SCHEDULE-PSB",
        "summary": null,
        "purpose": "This paragraph schedules the Program Specification Block (PSB) required for accessing the IMS database. It issues a DLI SCHD command with the PSB name. If the PSB has been scheduled more than once (PSB-SCHEDULED-MORE-THAN-ONCE), it first terminates the PSB using DLI TERM and then schedules it again. This ensures that the PSB is properly initialized before accessing the database. The DIBSTAT return code is checked to determine the status of the scheduling. If the scheduling is successful, the IMS-PSB-SCHD flag is set to TRUE. If an error occurs, an error message is constructed and displayed using SEND-AUTHVIEW-SCREEN, and the WS-ERR-FLG is set to 'Y'. The PSB name is obtained from the PSB-NAME variable.",
        "called_by": [
          "READ-AUTH-RECORD"
        ],
        "calls": [
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          135,
          164
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "DIBSTAT is not STATUS-OK, SEGMENT-NOT-FOUND, or END-OF-DB during READ-AUTH-RECORD",
        "action": "Set WS-ERR-FLG to 'Y', construct an error message, and display it using SEND-AUTHVIEW-SCREEN.",
        "citation": [
          23,
          31,
          49,
          57
        ]
      },
      {
        "condition": "DIBSTAT is not STATUS-OK, SEGMENT-NOT-FOUND, or END-OF-DB during READ-NEXT-AUTH-RECORD",
        "action": "Set WS-ERR-FLG to 'Y', construct an error message, and display it using SEND-AUTHVIEW-SCREEN.",
        "citation": [
          78,
          86
        ]
      },
      {
        "condition": "DIBSTAT is not STATUS-OK during UPDATE-AUTH-DETAILS",
        "action": "Perform ROLL-BACK, set WS-ERR-FLG to 'Y', construct an error message, and display it using SEND-AUTHVIEW-SCREEN.",
        "citation": [
          110,
          120
        ]
      },
      {
        "condition": "DIBSTAT is not STATUS-OK during SCHEDULE-PSB",
        "action": "Set WS-ERR-FLG to 'Y', construct an error message, and display it using SEND-AUTHVIEW-SCREEN.",
        "citation": [
          154,
          162
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "SYNCPOINT",
        "resource": null,
        "purpose": "Commits changes to recoverable resources.",
        "citation": 125
      },
      {
        "command": "SYNCPOINT ROLLBACK",
        "resource": null,
        "purpose": "Rolls back changes to recoverable resources.",
        "citation": 131
      }
    ],
    "open_questions": [
      {
        "question": "What is the purpose and structure of the SEND-AUTHVIEW-SCREEN program?",
        "context": "The program is called frequently to display data and error messages, but its internal workings are not visible in this code.",
        "suggestion": "Examine the source code or documentation for SEND-AUTHVIEW-SCREEN."
      },
      {
        "question": "What is the structure of WS-FRAUD-AUTH-RECORD?",
        "context": "The structure of WS-FRAUD-AUTH-RECORD is not defined in the provided code snippet.",
        "suggestion": "Examine the copybook or data definition for WS-FRAUD-AUTH-RECORD."
      },
      {
        "question": "What is the definition of STATUS-OK, SEGMENT-NOT-FOUND, END-OF-DB, PSB-SCHEDULED-MORE-THAN-ONCE?",
        "context": "These are used in EVALUATE statements, but their values are not defined in the provided code.",
        "suggestion": "Examine the copybooks or data definitions for these variables."
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-24T10:36:32.140416"
}