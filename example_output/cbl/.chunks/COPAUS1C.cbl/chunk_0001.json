{
  "batch_idx": 1,
  "total_batches": 2,
  "template": {
    "header": {
      "program_id": "COPAUS1C",
      "file_name": "cbl/COPAUS1C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:26:14.022033",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "This CICS online program manages pending authorization records in an IMS database by reading authorization summaries and details for a given account ID and authorization key, allowing updates to mark or remove fraud status on those details. It schedules the required PSB, performs IMS DLI calls to retrieve and update segments PAUTSUM0 and PAUTDTL1, handles errors by displaying messages via screen sends, and commits or rolls back changes using CICS syncpoints.",
      "business_context": "Supports fraud detection and authorization management by enabling operators to review and tag pending authorizations as fraudulent or clear fraud flags in a banking or payment authorization system.",
      "program_type": "ONLINE_CICS",
      "citations": [
        431,
        493,
        520,
        557,
        565,
        574
      ]
    },
    "inputs": [
      {
        "name": "PAUT-PCB-NUM",
        "io_type": "IMS_SEGMENT",
        "description": "IMS PCB used for accessing PAUTSUM0 (authorization summary) and PAUTDTL1 (authorization details) segments",
        "copybook": null,
        "citation": [
          431,
          493,
          520,
          574
        ]
      },
      {
        "name": "WS-ACCT-ID",
        "io_type": "CICS_COMMAREA",
        "description": "Account ID used as qualification for reading PAUTSUM0 segment",
        "copybook": null,
        "citation": [
          431
        ]
      },
      {
        "name": "WS-AUTH-KEY",
        "io_type": "CICS_COMMAREA",
        "description": "Authorization key (PAUT9CTS) used as qualification for reading PAUTDTL1 segment",
        "copybook": null,
        "citation": [
          431
        ]
      }
    ],
    "outputs": [
      {
        "name": "PAUTDTL1",
        "io_type": "IMS_SEGMENT",
        "description": "Updated pending authorization details with fraud status changes from WS-FRAUD-AUTH-RECORD",
        "copybook": null,
        "citation": [
          520
        ]
      },
      {
        "name": "AUTHVIEW-SCREEN",
        "io_type": "CICS_MAP",
        "description": "Screen displays for authorization views, error messages, and status updates",
        "copybook": null,
        "citation": [
          431,
          493,
          520,
          574
        ]
      }
    ],
    "called_programs": [],
    "calling_context": {
      "called_by": [],
      "entry_points": [],
      "linkage_section": []
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "Read authorization summary for specific account ID, then retrieve matching details if summary found",
        "logic_summary": "Uses GU call on PAUTSUM0 with ACCNTID qualification, followed by conditional GNP on PAUTDTL1 with PAUT9CTS key",
        "conditions": [
          "STATUS-OK on GU",
          "AUTHS-NOT-EOF after summary read"
        ],
        "citation": [
          431
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Update authorization details only if IMS REPL succeeds, then commit; otherwise rollback",
        "logic_summary": "Moves WS-FRAUD-AUTH-RECORD to PENDING-AUTH-DETAILS and performs REPL, evaluating DIBSTAT for success",
        "conditions": [
          "STATUS-OK on REPL",
          "PA-FRAUD-REMOVED flag determines message"
        ],
        "citation": [
          520
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Schedule PSB once or retry TERM/SCHD if already scheduled more than once",
        "logic_summary": "Exec DLI SCHD PSB, check if PSB-SCHEDULED-MORE-THAN-ONCE, term and reschedule if true",
        "conditions": [
          "PSB-SCHEDULED-MORE-THAN-ONCE",
          "STATUS-OK after SCHD"
        ],
        "citation": [
          574
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "PAUTSUM0",
          "fields_used": [
            "ACCNTID"
          ],
          "citation": [
            431
          ]
        },
        {
          "source": "PAUTDTL1",
          "fields_used": [
            "PAUT9CTS"
          ],
          "citation": [
            431,
            493
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "PAUTDTL1",
          "fields_written": [
            "PENDING-AUTH-DETAILS fields from WS-FRAUD-AUTH-RECORD"
          ],
          "citation": [
            520
          ]
        },
        {
          "destination": "WS-MESSAGE",
          "fields_written": [
            "Error messages concatenated with IMS-RETURN-CODE"
          ],
          "citation": [
            431,
            493,
            520,
            574
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "WS-ACCT-ID",
          "output_field": "PA-ACCT-ID",
          "transformation_description": "Direct MOVE to qualify IMS GU call on ACCNTID",
          "citation": [
            431
          ]
        },
        {
          "input_field": "WS-AUTH-KEY",
          "output_field": "PA-AUTHORIZATION-KEY",
          "transformation_description": "Direct MOVE to qualify IMS GNP call on PAUT9CTS",
          "citation": [
            431
          ]
        },
        {
          "input_field": "WS-FRAUD-AUTH-RECORD",
          "output_field": "PENDING-AUTH-DETAILS",
          "transformation_description": "Direct MOVE before IMS REPL update",
          "citation": [
            520
          ]
        },
        {
          "input_field": "DIBSTAT",
          "output_field": "IMS-RETURN-CODE",
          "transformation_description": "Direct MOVE after each IMS DLI call for status evaluation",
          "citation": [
            431,
            493,
            520,
            574
          ]
        }
      ]
    },
    "copybooks_used": [],
    "paragraphs": [
      {
        "paragraph_name": "READ-AUTH-RECORD",
        "summary": null,
        "purpose": "This paragraph serves as the primary entry point for reading the initial authorization summary and details for a specific account. It first performs SCHEDULE-PSB to ensure the IMS PSB is active. It then moves WS-ACCT-ID to PA-ACCT-ID and WS-AUTH-KEY to PA-AUTHORIZATION-KEY for qualification criteria. An EXEC DLI GU call retrieves the PAUTSUM0 segment into PENDING-AUTH-SUMMARY where ACCNTID matches PA-ACCT-ID. The DIBSTAT is moved to IMS-RETURN-CODE and evaluated: STATUS-OK sets AUTHS-NOT-EOF true; SEGMENT-NOT-FOUND or END-OF-DB sets AUTHS-EOF true; other errors set WS-ERR-FLG 'Y', build error message in WS-MESSAGE, and perform SEND-AUTHVIEW-SCREEN. If AUTHS-NOT-EOF, a GNP call retrieves PAUTDTL1 into PENDING-AUTH-DETAILS where PAUT9CTS matches PA-AUTHORIZATION-KEY, with similar evaluation and error handling including screen send on failure. No outputs are written to files, but data is loaded into working storage for further processing. Error handling covers IMS return codes by displaying user messages without abending. It calls SCHEDULE-PSB for PSB setup and SEND-AUTHVIEW-SCREEN for errors.",
        "called_by": [],
        "calls": [
          "SCHEDULE-PSB",
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          431,
          491
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "READ-NEXT-AUTH-RECORD",
        "summary": null,
        "purpose": "This paragraph reads the next sequential authorization detail record using GNP without qualification, supporting pagination or iteration through details for an account. It performs an EXEC DLI GNP on PAUTDTL1 into PENDING-AUTH-DETAILS using the PAUT-PCB-NUM. DIBSTAT is moved to IMS-RETURN-CODE and evaluated: STATUS-OK sets AUTHS-NOT-EOF true; SEGMENT-NOT-FOUND or END-OF-DB sets AUTHS-EOF true; other statuses set WS-ERR-FLG 'Y', concatenate error message with code into WS-MESSAGE, and perform SEND-AUTHVIEW-SCREEN. It consumes the current PCB position from prior reads as implicit input. Outputs updated flags AUTHS-NOT-EOF or AUTHS-EOF and loads next PENDING-AUTH-DETAILS. No business decisions beyond status checks; errors are communicated via screen without termination. It calls SEND-AUTHVIEW-SCREEN solely for error notification.",
        "called_by": [],
        "calls": [
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          493,
          518
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "UPDATE-AUTH-DETAILS",
        "summary": null,
        "purpose": "This paragraph handles the update of fraud status on a pending authorization detail record. It moves the entire WS-FRAUD-AUTH-RECORD to PENDING-AUTH-DETAILS and displays PA-FRAUD-RPT-DATE for logging. An EXEC DLI REPL call updates the PAUTDTL1 segment from PENDING-AUTH-DETAILS using PAUT-PCB-NUM. DIBSTAT moves to IMS-RETURN-CODE and is evaluated: STATUS-OK triggers TAKE-SYNCPOINT commit, sets WS-MESSAGE to 'AUTH FRAUD REMOVED...' if PA-FRAUD-REMOVED or 'AUTH MARKED FRAUD...' otherwise. Other statuses perform ROLL-BACK, set WS-ERR-FLG 'Y', build error message with code, and SEND-AUTHVIEW-SCREEN. Inputs are WS-FRAUD-AUTH-RECORD (likely from screen) and current PCB position. Outputs are the updated IMS segment and status message. Business logic decides commit message based on fraud removal flag. Errors lead to rollback and user notification. Calls TAKE-SYNCPOINT or ROLL-BACK based on update success, and SEND-AUTHVIEW-SCREEN on error.",
        "called_by": [],
        "calls": [
          "TAKE-SYNCPOINT",
          "ROLL-BACK",
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          520,
          556
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "TAKE-SYNCPOINT",
        "summary": null,
        "purpose": "This is a utility paragraph that commits the current CICS/IMS unit of work. It performs EXEC CICS SYNCPOINT to commit all changes made in the transaction. No inputs are consumed; it relies on the current transaction state. The only output is the committed database changes. No conditions or decisions are made; it always executes the syncpoint. No error handling within the paragraph itself. No calls to other paragraphs. It is invoked only on successful IMS REPL in UPDATE-AUTH-DETAILS to persist fraud updates.",
        "called_by": [],
        "calls": [],
        "citation": [
          557,
          564
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "ROLL-BACK",
        "summary": null,
        "purpose": "This utility paragraph rolls back the current CICS/IMS unit of work on error. It performs EXEC CICS SYNCPOINT ROLLBACK to undo all changes. No inputs consumed beyond transaction state. No outputs produced except the rollback effect. No logic, conditions, or error handling; unconditional rollback. Called exclusively from UPDATE-AUTH-DETAILS on IMS REPL failure to discard invalid updates.",
        "called_by": [],
        "calls": [],
        "citation": [
          565,
          573
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "SCHEDULE-PSB",
        "summary": null,
        "purpose": "This paragraph schedules the IMS PSB required for authorization database access. It executes DLI SCHD for PSB((PSB-NAME)) with NODHABEND. Moves DIBSTAT to IMS-RETURN-CODE. If PSB-SCHEDULED-MORE-THAN-ONCE, performs DLI TERM, then reschedules SCHD. Evaluates final STATUS-OK to set IMS-PSB-SCHD true; else sets WS-ERR-FLG 'Y', builds error message in WS-MESSAGE, and performs SEND-AUTHVIEW-SCREEN. Inputs are implicit PSB-NAME. Outputs PSB scheduling status flags and error screen if failed. Business logic handles duplicate scheduling by terminating and retrying. Errors are non-abending, notifying user via screen. Called at start of READ-AUTH-RECORD to prepare IMS access.",
        "called_by": [],
        "calls": [
          "SEND-AUTHVIEW-SCREEN"
        ],
        "citation": [
          574,
          603
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "IMS DLI GU/GNP/REPL DIBSTAT not STATUS-OK, SEGMENT-NOT-FOUND, or END-OF-DB",
        "action": "Set WS-ERR-FLG 'Y', STRING error message with IMS-RETURN-CODE into WS-MESSAGE, PERFORM SEND-AUTHVIEW-SCREEN",
        "citation": [
          431,
          493,
          520,
          574
        ]
      },
      {
        "condition": "IMS REPL DIBSTAT not STATUS-OK",
        "action": "PERFORM ROLL-BACK, set WS-ERR-FLG 'Y', STRING error message, SEND-AUTHVIEW-SCREEN",
        "citation": [
          520
        ]
      },
      {
        "condition": "PSB-SCHEDULED-MORE-THAN-ONCE after SCHD",
        "action": "EXEC DLI TERM then reschedule SCHD",
        "citation": [
          574
        ]
      },
      {
        "condition": "PSB SCHD STATUS not OK",
        "action": "Set WS-ERR-FLG 'Y', STRING error message, SEND-AUTHVIEW-SCREEN",
        "citation": [
          574
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "SYNCPOINT",
        "resource": null,
        "purpose": "Commit IMS updates after successful REPL",
        "citation": 557
      },
      {
        "command": "SYNCPOINT ROLLBACK",
        "resource": null,
        "purpose": "Rollback IMS updates on REPL failure",
        "citation": 565
      },
      {
        "command": "SEND MAP",
        "resource": "AUTHVIEW",
        "purpose": "Display authorization views and error/status messages to user",
        "citation": 431
      }
    ],
    "open_questions": [
      {
        "question": "Source of input variables like WS-ACCT-ID, WS-AUTH-KEY, WS-FRAUD-AUTH-RECORD",
        "context": "Not shown in provided AST paragraphs; likely from CICS RECEIVE MAP or COMMAREA in earlier code",
        "suggestion": "Analyze full source or prior paragraphs for screen receive or linkage"
      },
      {
        "question": "Value of PSB-NAME",
        "context": "Provide full WORKING-STORAGE or earlier sections",
        "suggestion": "Check for 01-level WS-PSB-NAME or constants"
      },
      {
        "question": "Full program flow and calling context (e.g., transaction ID, main paragraph)",
        "context": "Only processing paragraphs provided; no MAIN or initialization visible",
        "suggestion": "Include AST for full program to identify entry points and orchestration"
      },
      {
        "question": "Copybook definitions for PENDING-AUTH-SUMMARY, PENDING-AUTH-DETAILS, etc.",
        "context": "Used as host variables but no COPY statements in AST",
        "suggestion": "Scan FILE/WORKING-STORAGE sections for COPYBOOK usage"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:26:14.023536"
}