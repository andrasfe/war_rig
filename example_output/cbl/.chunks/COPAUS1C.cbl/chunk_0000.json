{
  "batch_idx": 0,
  "total_batches": 2,
  "template": {
    "header": {
      "program_id": "COPAUS1C",
      "file_name": "cbl/COPAUS1C.cbl",
      "file_type": "COBOL",
      "analyzed_by": "WAR_RIG",
      "analyzed_at": "2026-02-25T15:21:57.190760",
      "iteration_count": 1,
      "final_status": null
    },
    "purpose": {
      "summary": "COPAUS1C is a CICS online transaction that displays authorization details for credit card accounts, allowing users to view, navigate, and mark authorizations as fraudulent. It handles user inputs via BMS maps, reads authorization records from an IMS database, populates screen fields with details like dates, amounts, and merchant info, and processes PF keys for actions like fraud marking and next record retrieval. The program links to a fraud processing subroutine and manages transaction flow with syncpoints and rollbacks.",
      "business_context": "Serves credit card authorization review and fraud detection workflow in a demo banking system (CDEMO), enabling operators to inspect pending authorizations and flag suspicious transactions.",
      "program_type": "ONLINE_CICS",
      "citations": [
        23,
        157,
        230,
        291
      ]
    },
    "inputs": [
      {
        "name": "CARDDEMO-COMMAREA",
        "io_type": "CICS_COMMAREA",
        "description": "Contains account ID, selected PAU key, program context flags like CDEMO-PGM-REENTER, and navigation data passed between transactions",
        "copybook": "CARDDEMO",
        "citation": [
          157,
          398
        ]
      },
      {
        "name": "COPAU1AI",
        "io_type": "CICS_MAP",
        "description": "BMS mapset COPAU01 map COPAU1A receives user input fields like CDEMO-ACCT-ID and CDEMO-CPVD-PAU-SELECTED",
        "copybook": "COPAU01",
        "citation": [
          398
        ]
      },
      {
        "name": "PA-AUTHORIZATION-KEY",
        "io_type": "IMS_SEGMENT",
        "description": "IMS database authorization segment containing fields like PA-AUTH-ORIG-DATE, PA-APPROVED-AMT, PA-FRAUD-CONFIRMED",
        "copybook": null,
        "citation": [
          208,
          230,
          268
        ]
      }
    ],
    "outputs": [
      {
        "name": "COPAU1AO",
        "io_type": "CICS_MAP",
        "description": "BMS mapset COPAU01 map COPAU1A populated with authorization details, header info, and messages for screen display",
        "copybook": "COPAU01",
        "citation": [
          373,
          291
        ]
      },
      {
        "name": "WS-FRAUD-DATA",
        "io_type": "CICS_COMMAREA",
        "description": "Data passed to fraud program including WS-FRAUD-AUTH-RECORD, WS-FRD-ACCT-ID for updating fraud status",
        "copybook": null,
        "citation": [
          230
        ]
      }
    ],
    "called_programs": [
      {
        "program_name": "WS-PGM-AUTH-FRAUD",
        "call_type": "CICS_LINK",
        "purpose": "Updates authorization record with fraud confirmation or removal status",
        "parameters": [
          "WS-FRAUD-DATA"
        ],
        "citation": 230
      },
      {
        "program_name": "CDEMO-TO-PROGRAM",
        "call_type": "CICS_XCTL",
        "purpose": "Transfers control to previous program/screen with commarea context",
        "parameters": [
          "CARDDEMO-COMMAREA"
        ],
        "citation": 360
      }
    ],
    "calling_context": {
      "called_by": [],
      "entry_points": [
        "WS-CICS-TRANID"
      ],
      "linkage_section": [
        "CARDDEMO-COMMAREA"
      ]
    },
    "business_rules": [
      {
        "rule_id": "BR001",
        "description": "On first entry (EIBCALEN=0), initialize commarea and return to previous screen; otherwise handle reentry with map receive and AID evaluation",
        "logic_summary": "IF EIBCALEN = 0 THEN initialize and XCTL else RECEIVE map and EVALUATE EIBAID for PF3(return), PF5(fraud), PF8(next), ENTER(process)",
        "conditions": [
          "EIBCALEN = 0",
          "EIBAID = DFHENTER/DFHPF3/DFHPF5/DFHPF8/OTHER"
        ],
        "citation": [
          157
        ]
      },
      {
        "rule_id": "BR002",
        "description": "Mark authorization as fraud if not already confirmed, or remove fraud flag if confirmed, via linked program",
        "logic_summary": "IF PA-FRAUD-CONFIRMED THEN set remove else set confirm; LINK to fraud program; if success UPDATE else ROLLBACK",
        "conditions": [
          "PA-FRAUD-CONFIRMED",
          "EIBRESP = DFHRESP(NORMAL)",
          "WS-FRD-UPDT-SUCCESS"
        ],
        "citation": [
          230
        ]
      },
      {
        "rule_id": "BR003",
        "description": "Validate enter key input: account ID numeric and PAU selected not spaces/low-values before reading IMS record",
        "logic_summary": "IF CDEMO-ACCT-ID NUMERIC AND CDEMO-CPVD-PAU-SELECTED NOT = SPACES/LOW-VALUES THEN read else set error flag",
        "conditions": [
          "CDEMO-ACCT-ID IS NUMERIC",
          "CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
        ],
        "citation": [
          208
        ]
      },
      {
        "rule_id": "BR004",
        "description": "Display auth response as 'A'(green) if resp-code='00' else 'D'(red); search decline table for reason description",
        "logic_summary": "IF PA-AUTH-RESP-CODE = '00' THEN 'A'/GREEN else 'D'/RED; SEARCH WS-DECLINE-REASON-TAB for PA-AUTH-RESP-REASON",
        "conditions": [
          "PA-AUTH-RESP-CODE = '00'"
        ],
        "citation": [
          291
        ]
      }
    ],
    "data_flow": {
      "reads_from": [
        {
          "source": "PA-AUTHORIZATION-KEY",
          "fields_used": [
            "PA-AUTH-ORIG-DATE",
            "PA-APPROVED-AMT",
            "PA-AUTH-RESP-CODE",
            "PA-FRAUD-CONFIRMED"
          ],
          "citation": [
            291
          ]
        },
        {
          "source": "CARDDEMO-COMMAREA",
          "fields_used": [
            "CDEMO-ACCT-ID",
            "CDEMO-CPVD-PAU-SELECTED"
          ],
          "citation": [
            208
          ]
        },
        {
          "source": "COPAU1AI",
          "fields_used": [
            "CDEMO-ACCT-ID",
            "CDEMO-CPVD-PAU-SELECTED"
          ],
          "citation": [
            398
          ]
        }
      ],
      "writes_to": [
        {
          "destination": "COPAU1AO",
          "fields_written": [
            "AUTHDTO",
            "AUTHTMO",
            "AUTHAMTO",
            "AUTHRSPO",
            "MERNAMEO"
          ],
          "citation": [
            291
          ]
        },
        {
          "destination": "WS-FRAUD-DATA",
          "fields_written": [
            "WS-FRAUD-AUTH-RECORD",
            "WS-FRD-ACCT-ID"
          ],
          "citation": [
            230
          ]
        }
      ],
      "transforms": [
        {
          "input_field": "PA-AUTH-ORIG-DATE",
          "output_field": "AUTHDTO",
          "transformation_description": "Repack YYMMDD to MM-DD-YY format via WS-CURDATE-YY/MM/DD",
          "citation": [
            291
          ]
        },
        {
          "input_field": "PA-AUTH-ORIG-TIME",
          "output_field": "AUTHTMO",
          "transformation_description": "Repack HHMMSS to HH:MM:SS via WS-AUTH-TIME",
          "citation": [
            291
          ]
        },
        {
          "input_field": "PA-AUTH-RESP-REASON",
          "output_field": "AUTHRSNO",
          "transformation_description": "SEARCH WS-DECLINE-REASON-TAB for description, format as REASON-DESC-ERROR",
          "citation": [
            291
          ]
        },
        {
          "input_field": "PA-FRAUD-CONFIRMED",
          "output_field": "AUTHFRDO",
          "transformation_description": "If confirmed/removed, set FRAUD-DATE else '-'",
          "citation": [
            291
          ]
        }
      ]
    },
    "copybooks_used": [
      {
        "copybook_name": "COPAU01",
        "purpose": "Defines BMS maps COPAU1A for input (COPAU1AI) and output (COPAU1AO) including fields like CARDNUMO, AUTHDTO",
        "location": "WORKING_STORAGE",
        "citation": 373
      },
      {
        "copybook_name": "CARDDEMO",
        "purpose": "Defines commarea structure with CDEMO- fields for account, program context, and PAU selection",
        "location": "LINKAGE",
        "citation": 157
      }
    ],
    "paragraphs": [
      {
        "paragraph_name": "COPAUS1C",
        "summary": null,
        "purpose": "This is the program entry point paragraph that likely performs initial CICS/IMS setup calls such as scheduling PSBs and loading common modules before transferring control to MAIN-PARA. It consumes no explicit inputs shown but orchestrates startup by calling utility programs like COCOM01Y for commarea init, COPAU01 for mapset load, and CSDAT01Y/CSMSG01Y for date/message services. It produces initialized working storage and linkage areas ready for transaction processing. Business logic involves sequential calls to ensure environment readiness without decision points shown. No explicit error handling in outline but relies on called programs' returns. It calls multiple initialization programs to prepare for MAIN-PARA execution.",
        "called_by": [],
        "calls": [
          "COCOM01Y",
          "COPAU01",
          "COTTL01Y",
          "CSDAT01Y",
          "CSMSG01Y"
        ],
        "citation": [
          23,
          23
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MAIN-PARA",
        "summary": null,
        "purpose": "This is the primary orchestration paragraph controlling the overall CICS transaction flow for authorization viewing. It consumes EIB fields (EIBCALEN, EIBAID), commarea (CARDDEMO-COMMAREA), and map input if reentered. It initializes flags like ERR-FLG-OFF, SEND-ERASE-YES, clears messages, and on first entry (EIBCALEN=0) initializes commarea and performs RETURN-TO-PREV-SCREEN via XCTL. On reentry, it receives the map, evaluates AID: ENTER/PF8/OTHER -> PROCESS-ENTER-KEY or PF8-KEY, PF5 -> MARK-AUTH-FRAUD, PF3 -> RETURN-TO-PREV-SCREEN, then sends screen and CICS RETURN with TRANSID and commarea. Business logic branches on entry type and AID for user actions like process, fraud mark, navigate, or exit. Error handling defers to subordinate paragraphs via flags like WS-MESSAGE. It calls RETURN-TO-PREV-SCREEN, PROCESS-ENTER-KEY, SEND-AUTHVIEW-SCREEN, RECEIVE-AUTHVIEW-SCREEN, MARK-AUTH-FRAUD, PROCESS-PF8-KEY to handle specific flows.",
        "called_by": [
          "COPAUS1C"
        ],
        "calls": [
          "RETURN-TO-PREV-SCREEN",
          "PROCESS-ENTER-KEY",
          "SEND-AUTHVIEW-SCREEN",
          "RECEIVE-AUTHVIEW-SCREEN",
          "MARK-AUTH-FRAUD",
          "PROCESS-PF8-KEY"
        ],
        "citation": [
          157,
          206
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-ENTER-KEY",
        "summary": null,
        "purpose": "This paragraph handles the ENTER key press to load a specific authorization record based on user input. It consumes CDEMO-ACCT-ID and CDEMO-CPVD-PAU-SELECTED from commarea/map, moves LOW-VALUES to map for cursor reset. It validates inputs numeric/not spaces/low-values; if valid, moves to WS-ACCT-ID/WS-AUTH-KEY, performs READ-AUTH-RECORD, and if PSB scheduled takes SYNCPOINT. If invalid, sets ERR-FLG-ON. Outputs updated map fields via subsequent POPULATE-AUTH-DETAILS and error flag/message. Business logic validates input before IMS read to prevent invalid queries. Error handling via ERR-FLG and WS-MESSAGE from read. Calls READ-AUTH-RECORD for data fetch and TAKE-SYNCPOINT for commit if needed, then POPULATE-AUTH-DETAILS to refresh screen.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "READ-AUTH-RECORD",
          "TAKE-SYNCPOINT",
          "POPULATE-AUTH-DETAILS"
        ],
        "citation": [
          208,
          228
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "MARK-AUTH-FRAUD",
        "summary": null,
        "purpose": "This paragraph processes PF5 to toggle fraud status on the current authorization. It consumes CDEMO-ACCT-ID/CPVD-PAU-SELECTED, reads current record, then if PA-FRAUD-CONFIRMED sets remove flag else sets confirm flag, prepares WS-FRAUD-DATA with record/details. Links to WS-PGM-AUTH-FRAUD; if normal and success, UPDATE-AUTH-DETAILS else sets message and ROLL-BACK. Updates selected key in commarea. Outputs updated fraud fields on screen via POPULATE-AUTH-DETAILS. Business logic implements toggle: confirm -> remove, else confirm, with recovery on link failure. Error handling checks EIBRESP and WS-FRD-UPDT-SUCCESS, rolls back on errors (resp check at ~253). Calls READ-AUTH-RECORD, LINK (implicit), UPDATE-AUTH-DETAILS, ROLL-BACK, POPULATE-AUTH-DETAILS.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "READ-AUTH-RECORD",
          "UPDATE-AUTH-DETAILS",
          "ROLL-BACK",
          "POPULATE-AUTH-DETAILS"
        ],
        "citation": [
          230,
          266
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "PROCESS-PF8-KEY",
        "summary": null,
        "purpose": "This paragraph handles PF8 to retrieve and display the next authorization record. It consumes current CDEMO-ACCT-ID/CPVD-PAU-SELECTED, reads current then next record via READ-NEXT-AUTH-RECORD. If PSB scheduled, takes SYNCPOINT. If EOF, sets no-erase and error message 'Already at last'; else updates selected key and populates details. Outputs next record details or EOF message on screen. Business logic checks AUTHS-EOF after read-next to prevent overrun. Error handling via WS-MESSAGE and flags from reads. Calls READ-AUTH-RECORD, READ-NEXT-AUTH-RECORD, TAKE-SYNCPOINT, POPULATE-AUTH-DETAILS.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "READ-AUTH-RECORD",
          "READ-NEXT-AUTH-RECORD",
          "TAKE-SYNCPOINT",
          "POPULATE-AUTH-DETAILS"
        ],
        "citation": [
          268,
          289
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "POPULATE-AUTH-DETAILS",
        "summary": null,
        "purpose": "This paragraph formats and moves IMS authorization data to BMS map output fields if no error flag. It consumes PA- fields from IMS segment (CARD-NUM, AUTH-ORIG-DATE/TIME, APPROVED-AMT, RESP-CODE, FRAUD-CONFIRMED, MERCHANT-NAME etc.). Transforms dates/times to display formats (MM-DD-YY, HH:MM:SS), sets response 'A'/GREEN or 'D'/RED, searches decline table for reason desc, formats expiry/fraud/merchant fields. Outputs to map fields like CARDNUMO, AUTHDTO, AUTHTMO, AUTHRSPO, AUTHRSNO, MERNAMEO etc. Business logic conditionally formats based on resp-code/fraud status, handles search AT END with 'ERROR'. Error handling skips if ERR-FLG-ON (at-end implied ~320). No calls, pure data transform.",
        "called_by": [
          "PROCESS-ENTER-KEY",
          "MARK-AUTH-FRAUD",
          "PROCESS-PF8-KEY"
        ],
        "calls": [],
        "citation": [
          291,
          358
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RETURN-TO-PREV-SCREEN",
        "summary": null,
        "purpose": "This paragraph exits to the previous transaction/program. It consumes WS-CICS-TRANID, WS-PGM-AUTH-SMRY/DTL, sets context flags in commarea. Prepares CDEMO-FROM-TRANID/PROGRAM, CDEMO-PGM-ENTER. Outputs updated commarea for XCTL. Business logic sets return context without conditions. No explicit errors. Calls XCTL to CDEMO-TO-PROGRAM.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "CDEMO-TO-PROGRAM"
        ],
        "citation": [
          360,
          370
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "SEND-AUTHVIEW-SCREEN",
        "summary": null,
        "purpose": "This paragraph sends the populated BMS map to the terminal. It consumes populated COPAU1AO fields, WS-MESSAGE, SEND-ERASE-YES flag. Performs POPULATE-HEADER-INFO first, moves message/length, then SEND MAP with/without ERASE based on flag. Outputs screen display with cursor. Business logic branches on erase flag for refresh vs. update. No explicit errors (NOHANDLE implied). Calls POPULATE-HEADER-INFO.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [
          "POPULATE-HEADER-INFO"
        ],
        "citation": [
          373,
          396
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
        "summary": null,
        "purpose": "This paragraph receives user input from the BMS map. It consumes terminal input into COPAU1AI via RECEIVE MAP NOHANDLE. Outputs populated input map fields for AID evaluation and data. Business logic is straightforward I/O with no conditions. Errors handled by NOHANDLE (defaults). No calls.",
        "called_by": [
          "MAIN-PARA"
        ],
        "calls": [],
        "citation": [
          398,
          406
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      },
      {
        "paragraph_name": "POPULATE-HEADER-INFO",
        "summary": null,
        "purpose": "This paragraph populates static header fields on the map. It consumes current date/time via FUNCTION CURRENT-DATE, WS-CICS-TRANID/PGM-AUTH-DTL, CCDA-TITLE01/02. Formats date MM-DD-YY, time HH:MM:SS, moves to TITLEO, TRNNAMEO, PGMNAMEO, CURDATEO, CURTIMEO. Outputs header section of COPAU1AO. Business logic pure formatting/transformation. No errors/conditions/calls.",
        "called_by": [
          "SEND-AUTHVIEW-SCREEN"
        ],
        "calls": [],
        "citation": [
          409,
          429
        ],
        "outgoing_calls": [],
        "incoming_calls": [],
        "is_dead_code": false,
        "dead_code_reason": null,
        "metadata": null
      }
    ],
    "error_handling": [
      {
        "condition": "Input validation fail (not numeric or spaces/low-values)",
        "action": "SET ERR-FLG-ON, skip populate, show via WS-MESSAGE",
        "citation": [
          208
        ]
      },
      {
        "condition": "EIBRESP NOT NORMAL after LINK WS-PGM-AUTH-FRAUD",
        "action": "PERFORM ROLL-BACK",
        "citation": [
          230
        ]
      },
      {
        "condition": "WS-FRD-UPDT-SUCCESS false after fraud LINK",
        "action": "MOVE error msg to WS-MESSAGE, PERFORM ROLL-BACK",
        "citation": [
          230
        ]
      },
      {
        "condition": "AUTHS-EOF after READ-NEXT",
        "action": "SET SEND-ERASE-NO, MOVE 'Already at last...' to WS-MESSAGE",
        "citation": [
          268
        ]
      },
      {
        "condition": "ERR-FLG-ON",
        "action": "Skip data population to map (IF ERR-FLG-OFF guard)",
        "citation": [
          291
        ]
      },
      {
        "condition": "IMS at-end (implied in reads)",
        "action": "Set flags/messages, recovery via rollbacks/syncpoints",
        "citation": [
          320
        ]
      },
      {
        "condition": "Resp check errors in MARK-AUTH-FRAUD",
        "action": "ROLL-BACK",
        "citation": [
          253
        ]
      }
    ],
    "sql_operations": [],
    "cics_operations": [
      {
        "command": "RETURN",
        "resource": "TRANSID(WS-CICS-TRANID)",
        "purpose": "End transaction passing commarea",
        "citation": 157
      },
      {
        "command": "RECEIVE MAP",
        "resource": "COPAU1A(COPAU01)",
        "purpose": "Receive user map input",
        "citation": 398
      },
      {
        "command": "SEND MAP",
        "resource": "COPAU1A(COPAU01)",
        "purpose": "Send populated map with optional ERASE/CURSOR",
        "citation": 373
      },
      {
        "command": "LINK",
        "resource": "WS-PGM-AUTH-FRAUD",
        "purpose": "Call fraud update subroutine",
        "citation": 230
      },
      {
        "command": "XCTL",
        "resource": "CDEMO-TO-PROGRAM",
        "purpose": "Transfer control to previous program",
        "citation": 360
      }
    ],
    "open_questions": [
      {
        "question": "Exact code and line numbers for READ-AUTH-RECORD, UPDATE-AUTH-DETAILS, ROLL-BACK, TAKE-SYNCPOINT, READ-NEXT-AUTH-RECORD, SCHEDULE-PSB",
        "context": "AST snippet does not include their implementations, only PERFORMs; hints provided but no lines",
        "suggestion": "Provide full AST or source for these paragraphs"
      },
      {
        "question": "IMS database/PSB names and full segment layouts (PA- fields copybook)",
        "context": "Inferred from field names like PA-AUTHORIZATION-KEY but not explicit",
        "suggestion": "Check FILE SECTION or IMS calls in full source"
      },
      {
        "question": "Copybook names/locations for WS-DECLINE-REASON-TAB, WS-FRAUD-DATA",
        "context": "Used but not declared in AST",
        "suggestion": "Static analysis of WORKING-STORAGE"
      },
      {
        "question": "Calling programs and transaction IDs",
        "context": "No inbound callers identified",
        "suggestion": "Trace CICS TDQs or prior XCTL/LINK"
      }
    ],
    "resolved_questions": [],
    "dead_code": [],
    "call_semantics": [],
    "flow_diagram": null
  },
  "saved_at": "2026-02-25T08:21:57.192640"
}