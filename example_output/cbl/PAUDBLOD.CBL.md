# PAUDBLOD

**File**: `cbl/PAUDBLOD.CBL`
**Type**: FileType.COBOL
**Analyzed**: 2026-01-26 14:23:45.621752

## Purpose

Batch IMS database load utility that reads root segment records from INFILE1 and inserts them as PAUTSUM0 segments into the PAUT database using unqualified ISRT calls. It then reads child segment records from INFILE2, which include the parent root key, uses qualified GU to position the parent, and inserts PAUTDTL1 child segments under matching parents using unqualified ISRT. Handles duplicates by displaying messages and continuing, abends on other IMS errors or file open failures.

**Business Context**: Loads pending authorization summary and detail data into IMS PAUT database from unload files generated by IMSUNLOD or similar.

## Inputs

| Name | Type | Description |
|------|------|-------------|
| INFILE1 | IOType.FILE_SEQUENTIAL | Sequential file containing root segment records (PAUTSUM0 layout) for IMS load |
| INFILE2 | IOType.FILE_SEQUENTIAL | Sequential file containing child segment records prefixed with ROOT-SEG-KEY (PAUTDTL1 layout) |
| PAUTBPCB | IOType.IMS_SEGMENT | IMS PCB for PAUT database access via DL/I calls |

## Outputs

| Name | Type | Description |
|------|------|-------------|
| PAUTSUM0 | IOType.IMS_SEGMENT | Pending authorization summary root segments inserted into IMS PAUT database |
| PAUTDTL1 | IOType.IMS_SEGMENT | Pending authorization details child segments inserted under matching PAUTSUM0 parents in IMS PAUT database |

## Business Rules

- **BR001**: Abort program with return code 16 if file open status is not spaces or '00'
- **BR002**: Insert root segment via unqualified ISRT; continue on success (spaces) or duplicate ('II'), abend otherwise
- **BR003**: Skip child records where ROOT-SEG-KEY is not numeric
- **BR004**: For child insert, perform qualified GU on parent using ROOT-SEG-KEY from child record; if success, insert child unqualified ISRT; continue on success or duplicate, abend otherwise
- **BR005**: On READ file status not '00'/spaces, set end flag if '10' (EOF), else DISPLAY error message but continue without abend

## Paragraphs/Procedures

### MAIN-PARA
This is the primary entry point paragraph that orchestrates the entire IMS database load process. It begins with an ENTRY 'DLITCBL' statement allowing alternate entry using PAUTBPCB linkage. It displays a start message, then performs 1000-INITIALIZE to open input files and set dates. It enters a loop performing 2000-READ-ROOT-SEG-FILE until END-ROOT-SEG-FILE is 'Y', processing each root record by inserting into IMS. After root processing, it loops on 3000-READ-CHILD-SEG-FILE until END-CHILD-SEG-FILE is 'Y', handling child inserts under parents. Upon completion of both loops, it performs 4000-FILE-CLOSE to shut down files. No explicit error handling here; relies on subordinate paragraphs to abend if needed. Finally, GOBACK with return code set only if abended earlier. No other paragraphs or programs called directly beyond the PERFORMs.

### 1000-INITIALIZE
This paragraph handles program initialization including date acceptance and input file opens. It consumes system date via ACCEPT CURRENT-DATE FROM DATE and CURRENT-YYDDD FROM DAY. It displays diagnostic messages including today's date. It then performs OPEN INPUT on INFILE1 and checks WS-INFIL1-STATUS; if not spaces or '00', displays error and performs 9999-ABEND. Similarly for OPEN INPUT INFILE2 with WS-INFIL2-STATUS check and abend on failure. Produces open files ready for reads and initialized date variables in WS-VARIABLES. Implements business logic to ensure files are accessible before processing, with strict error handling via abend on open failures. No subordinate calls beyond potential abend.

### 2000-READ-ROOT-SEG-FILE
This paragraph reads the next root segment record from INFILE1 in the main root processing loop. It performs READ INFILE1, consuming INFIL1-REC into the record area. If WS-INFIL1-STATUS is spaces or '00', moves INFIL1-REC to PENDING-AUTH-SUMMARY and performs 2100-INSERT-ROOT-SEG to load into IMS. If status '10', sets END-ROOT-SEG-FILE to 'Y' to exit loop. For other statuses, displays 'ERROR READING ROOT SEG INFILE' but does not abend, continuing to next iteration. Outputs updated EOF flag or processed record to IMS via subordinate. Business logic distinguishes EOF from errors but tolerates read errors without halt. Calls 2100-INSERT-ROOT-SEG only on successful reads.

### 2100-INSERT-ROOT-SEG
This paragraph inserts a root segment into IMS using unqualified SSA. It consumes PENDING-AUTH-SUMMARY (moved from input record) and calls 'CBLTDLI' with FUNC-ISRT, PAUTBPCB, segment, ROOT-UNQUAL-SSA. Displays decorative messages and checks PAUT-PCB-STATUS post-call. If spaces, displays success; if 'II', displays duplicate message. If neither, displays failure status and performs 9999-ABEND. Produces inserted PAUTSUM0 segment or abend on error. Implements logic to handle duplicates gracefully (log and continue) but fail-fast on other IMS errors like GE/GB. No further calls.

### 3000-READ-CHILD-SEG-FILE
This paragraph reads the next child segment record from INFILE2 in the main child processing loop. It performs READ INFILE2, consuming ROOT-SEG-KEY and CHILD-SEG-REC. If WS-INFIL2-STATUS spaces or '00' and ROOT-SEG-KEY IS NUMERIC, moves key to QUAL-SSA-KEY-VALUE, CHILD-SEG-REC to PENDING-AUTH-DETAILS, and performs 3100-INSERT-CHILD-SEG. If status '10', sets END-CHILD-SEG-FILE 'Y'. For other statuses, displays error but no abend. Skips non-numeric keys silently. Outputs positioned parent for child insert or EOF flag. Logic validates parent key before attempting child load to ensure parentage.

### 3100-INSERT-CHILD-SEG
This paragraph positions the parent root segment and prepares for child insert. It initializes PAUT-PCB-STATUS, then CALL 'CBLTDLI' FUNC-GU using PAUTBPCB, PENDING-AUTH-SUMMARY (not used?), ROOT-QUAL-SSA (keyed on ROOT-SEG-KEY). Displays messages, checks PAUT-PCB-STATUS: if spaces, displays success and performs 3200-INSERT-IMS-CALL. If not spaces or 'II', displays failure, KEYFB, and abends. Consumes child record's parent key to locate root. Produces positioned PCB for child ISRT or abend. Logic enforces parent-child relationship via qualified GU before insert.

### 3200-INSERT-IMS-CALL
This paragraph performs the actual child segment insert under the positioned parent. It CALL 'CBLTDLI' FUNC-ISRT with PAUTBPCB, PENDING-AUTH-DETAILS, CHILD-UNQUAL-SSA. Checks PAUT-PCB-STATUS: spaces success display, 'II' duplicate display, other displays failure/KEYFB and abends. Consumes positioned PCB from prior GU and child data. Produces inserted PAUTDTL1 segment. Handles duplicates gracefully, fails on other errors. No further calls.

### 4000-FILE-CLOSE
This paragraph closes the input files at program end. It displays closing message, CLOSE INFILE1, checks WS-INFIL1-STATUS (displays error if bad but no abend). Then CLOSE INFILE2, similar status check/display only. Consumes open files. No outputs beyond status logs. No error handling beyond display; program continues to GOBACK regardless.

### 9999-ABEND
Error termination paragraph invoked on critical failures like open errors or IMS call failures. Displays 'IMS LOAD ABENDING ...', sets RETURN-CODE to 16, GOBACK. Consumes error context from caller. No validation or further logic. Halts program with non-zero return code.

## Open Questions

- ? Exact field layouts and key fields in copybooks CIPAUSMY, CIPAUDTY, PAUTBPCB
  - Context: Copybooks not provided; cannot detail field mappings or validate key usage (e.g., ACCNTID in SSA line 116)
- ? Origin and format of INFILE1/INFILE2 (e.g., generated by IMSUNLOD?)
  - Context: Assumed unload files matching segment layouts; WS-PGMNAME 'IMSUNLOD' suggests relation
- ? Purpose of ENTRY 'DLITCBL' and if program is ever called dynamically
  - Context: Unused in main flow; possible alternate entry for DL/I compatibility
- ? Usage of counters like WS-NO-CHKP, WS-AUTH-SMRY-PROC-CNT, WS-TOT-REC-WRITTEN etc.
  - Context: Defined but never incremented or used
- ? PRM-INFO parameter structure defined but not populated or used
  - Context: In WS, fields like P-EXPIRY-DAYS, P-DEBUG-FLAG unused
