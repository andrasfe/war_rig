{
  "header": {
    "program_id": "DBUNLDGS",
    "file_name": "cbl/DBUNLDGS.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-24T03:59:38.347882",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "DBUNLDGS is an IMS DL/I batch utility program that unloads pending authorization summary (root) and details (child) segments from the PAUT IMS database using GN and GNP calls on PAUTBPCB. It inserts the unloaded root segments into a GSAM database via PASFLPCB and child segments into another GSAM via PADFLPCB using ISRT calls. The program processes all root summaries sequentially, unloading all associated child details for each root before moving to the next.",
    "business_context": "Supports data migration or backup of pending authorization data from hierarchical IMS database to GSAM files for reporting or further processing.",
    "program_type": "BATCH",
    "citations": [
      18,
      164,
      170,
      172,
      219,
      267
    ]
  },
  "inputs": [
    {
      "name": "PAUTBPCB",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database PCB for reading root (PAUTSUM0) and child (PAUTDTL1) segments from PAUT database",
      "copybook": "PAUTBPCB",
      "citation": [
        222,
        268
      ]
    }
  ],
  "outputs": [
    {
      "name": "PASFLPCB",
      "io_type": "IMS_SEGMENT",
      "description": "GSAM PCB for inserting unloaded root summary segments (PENDING-AUTH-SUMMARY)",
      "copybook": "PASFLPCB",
      "citation": [
        303
      ]
    },
    {
      "name": "PADFLPCB",
      "io_type": "IMS_SEGMENT",
      "description": "GSAM PCB for inserting unloaded child detail segments (PENDING-AUTH-DETAILS)",
      "copybook": "PADFLPCB",
      "citation": [
        322
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB",
      "PASFLPCB",
      "PADFLPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Process all root summaries and their child details sequentially until end of database",
      "logic_summary": "Loop GN on root until 'GB', for each root GNP children until 'GE'",
      "conditions": [
        "PAUT-PCB-STATUS = SPACES",
        "PAUT-PCB-STATUS = 'GB'",
        "PAUT-PCB-STATUS = 'GE'"
      ],
      "citation": [
        172,
        222,
        249,
        268,
        284
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Only process root if PA-ACCT-ID is numeric",
      "logic_summary": "Check before child loop and GSAM insert",
      "conditions": [
        "PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        241
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTBPCB",
        "fields_used": [
          "PAUT-SEG-LEVEL",
          "PAUT-SEG-NAME",
          "PA-ACCT-ID",
          "PENDING-AUTH-SUMMARY",
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          222,
          268
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PASFLPCB",
        "fields_written": [
          "PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          303
        ]
      },
      {
        "destination": "PADFLPCB",
        "fields_written": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          322
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Move PA-ACCT-ID to ROOT-SEG-KEY for OPFIL2-REC structure (unused as files commented)",
        "citation": [
          239
        ]
      },
      {
        "input_field": "PENDING-AUTH-DETAILS",
        "output_field": "CHILD-SEG-REC",
        "transformation_description": "Move details to CHILD-SEG-REC in OPFIL2-REC (unused as files commented)",
        "citation": [
          280
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS function codes like FUNC-GN, FUNC-GNP, FUNC-ISRT",
      "location": "WORKING_STORAGE",
      "citation": 136
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY root segment",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS child segment",
      "location": "WORKING_STORAGE",
      "citation": 147
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "PCB mask for PAUT IMS database access",
      "location": "LINKAGE",
      "citation": 154
    },
    {
      "copybook_name": "PASFLPCB",
      "purpose": "PCB mask for PASFL GSAM insert",
      "location": "LINKAGE",
      "citation": 155
    },
    {
      "copybook_name": "PADFLPCB",
      "purpose": "PCB mask for PADFL GSAM insert",
      "location": "LINKAGE",
      "citation": 156
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point paragraph that orchestrates the entire unload process. It accepts three IMS PCBs via LINKAGE: PAUTBPCB for source reads, PASFLPCB for parent GSAM inserts, and PADFLPCB for child GSAM inserts (lines 159-161). It first performs initialization including date acceptance and display messages (line 170). Then it enters a loop calling 2000-FIND-NEXT-AUTH-SUMMARY to read root segments until end-of-database flag is set (lines 172-173). For each root, it triggers child processing within 2000. Upon loop exit, it performs file close (though commented, line 175). No explicit error handling here beyond subordinate calls; abend delegated to 9999-ABEND if issues arise in called paragraphs. It sets entry 'DLITCBL' for potential alternate invocation (line 165). Counters like WS-NO-SUMRY-READ are incremented in subordinates but summarized implicitly here.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        164,
        179
      ],
      "outgoing_calls": [
        {
          "target": "1000-INITIALIZE",
          "call_type": "performs",
          "line": 170
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 172
        },
        {
          "target": "4000-FILE-CLOSE",
          "call_type": "performs",
          "line": 175
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph handles program startup initialization. It accepts current date and YYDDD from system (lines 185-186). Displays startup messages including program name, date, and decorative lines (lines 189-192). Commented code for parameter acceptance from SYSIN and file opens for OPFILE1/OPFILE2 with status checks is present but inactive (lines 188,195-209). No data modifications or business logic; purely setup and logging. No error handling as file opens commented; proceeds unconditionally to EXIT. Called once from MAIN-PARA to prepare for processing loop.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        182,
        212
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph performs GN call to retrieve the next root summary segment from PAUT IMS DB via PAUTBPCB (lines 222-225). Initializes PCB status beforehand (line 221). If status SPACES (success), increments read counters WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT (lines 234-235), moves data to working record (236), sets ROOT-SEG-KEY from PA-ACCT-ID (239), performs 3100 to insert into GSAM PASFL (243), then loops 3000 for children until end (245-246). Only if PA-ACCT-ID numeric (241). If 'GB' sets end-of-DB flags (249-251). Other statuses trigger display and abend (253-256). Manages WS-END-OF-ROOT-SEG flag for MAIN loop control. Error handling abends on non-success/non-GB.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3100-INSERT-PARENT-SEG-GSAM",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "citation": [
        216,
        258
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 222
        },
        {
          "target": "3100-INSERT-PARENT-SEG-GSAM",
          "call_type": "performs",
          "line": 243
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 245
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 256
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves next child detail segment under current root using GNP on PAUTBPCB (lines 267-270). If SPACES (success), sets MORE-AUTHS flag (277), increments counters (278-279), moves to CHILD-SEG-REC (280), performs 3200 insert to PADFL GSAM (282). If 'GE' (segment not found), sets WS-END-OF-CHILD-SEG='Y' and displays (284-288). Other statuses display feedback and abend (290-293). Initializes PCB status at end (295). Controls inner loop in 2000 via WS-END-OF-CHILD-SEG. No validation on data; assumes parentage from GNP. Error handling abends on failures.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "3200-INSERT-CHILD-SEG-GSAM"
      ],
      "citation": [
        263,
        297
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 267
        },
        {
          "target": "3200-INSERT-CHILD-SEG-GSAM",
          "call_type": "performs",
          "line": 282
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 293
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3100-INSERT-PARENT-SEG-GSAM",
      "summary": null,
      "purpose": "Dedicated to inserting the current root summary segment into GSAM via ISRT call on PASFLPCB (lines 302-304). Checks PASFL-PCB-STATUS post-call; if not SPACES, displays error and key feedback then abends (311-314). No data transformation; passes PENDING-AUTH-SUMMARY directly. Increments no counters here. Called from 2000 after root read success. Minimal logic focused on I/O and error check. Handles only insert failure by abend.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [],
      "citation": [
        300,
        317
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 302
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 314
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "2000-FIND-NEXT-AUTH-SUMMARY",
          "line": 243,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3200-INSERT-CHILD-SEG-GSAM",
      "summary": null,
      "purpose": "Inserts current child detail segment into GSAM via ISRT on PADFLPCB (lines 321-323). Post-call, if PADFL-PCB-STATUS not SPACES, displays error and abends (330-333). Passes PENDING-AUTH-DETAILS directly. No additional validation or transforms. Called repeatedly from 3000 for each child under a root. Strict error handling via abend on insert failure.",
      "called_by": [
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        319,
        336
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 321
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 333
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "3000-FIND-NEXT-AUTH-DTL",
          "line": 282,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "Handles program termination by displaying close message (339). Commented code for closing OPFILE1 and OPFILE2 with status checks (340-353), but inactive. No active file closes as opens commented. No error handling executed. Called once at end of MAIN-PARA after processing loop.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        338,
        355
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "Common abend routine called on IMS call failures. Displays abend message (360), sets RETURN-CODE to 16 (362), and GOBACKs (363). No recovery; immediate termination. Used across program for consistent error exit.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "3100-INSERT-PARENT-SEG-GSAM",
        "3200-INSERT-CHILD-SEG-GSAM"
      ],
      "calls": [],
      "citation": [
        357,
        366
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "PAUT-PCB-STATUS NOT = SPACES AND NOT 'GB'",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        253
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = SPACES AND NOT 'GE'",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        290
      ]
    },
    {
      "condition": "PASFL-PCB-STATUS NOT = SPACES",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        311
      ]
    },
    {
      "condition": "PADFL-PCB-STATUS NOT = SPACES",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        330
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [],
  "resolved_questions": [],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "1000-INITIALIZE",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "4000-FILE-CLOSE",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "3100-INSERT-PARENT-SEG-GSAM",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "3200-INSERT-CHILD-SEG-GSAM",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "3100-INSERT-PARENT-SEG-GSAM",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "3200-INSERT-CHILD-SEG-GSAM",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": null
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: DBUNLDGS.CBL\n    1000_EXIT[\"1000-EXIT\"]\n    1000_INITIALIZE[\"1000-INITIALIZE\"]\n    2000_EXIT[\"2000-EXIT\"]\n    2000_FIND_NEXT_AUTH_SUMMARY[\"2000-FIND-NEXT-AUTH-SUMMARY\"]\n    3000_FIND_NEXT_AUTH_DTL[\"3000-FIND-NEXT-AUTH-DTL\"]\n    3100_INSERT_PARENT_SEG_GSAM[\"3100-INSERT-PARENT-SEG-GSAM\"]\n    9999_ABEND[\"9999-ABEND\"]\n    CBLTDLI__ext([\"CBLTDLI\"])\n    3000_EXIT[\"3000-EXIT\"]\n    3200_INSERT_CHILD_SEG_GSAM[\"3200-INSERT-CHILD-SEG-GSAM\"]\n    3100_EXIT[\"3100-EXIT\"]\n    3200_EXIT[\"3200-EXIT\"]\n    4000_EXIT[\"4000-EXIT\"]\n    4000_FILE_CLOSE[\"4000-FILE-CLOSE\"]\n    9999_EXIT[\"9999-EXIT\"]\n    MAIN_PARA[\"MAIN-PARA\"]\n    2000_FIND_NEXT_AUTH_SUMMARY --> 3000_FIND_NEXT_AUTH_DTL\n    2000_FIND_NEXT_AUTH_SUMMARY --> 3100_INSERT_PARENT_SEG_GSAM\n    2000_FIND_NEXT_AUTH_SUMMARY --> 9999_ABEND\n    2000_FIND_NEXT_AUTH_SUMMARY -.->|calls| CBLTDLI__ext\n    3000_FIND_NEXT_AUTH_DTL --> 3200_INSERT_CHILD_SEG_GSAM\n    3000_FIND_NEXT_AUTH_DTL --> 9999_ABEND\n    3000_FIND_NEXT_AUTH_DTL -.->|calls| CBLTDLI__ext\n    3100_INSERT_PARENT_SEG_GSAM --> 9999_ABEND\n    3100_INSERT_PARENT_SEG_GSAM -.->|calls| CBLTDLI__ext\n    3200_INSERT_CHILD_SEG_GSAM --> 9999_ABEND\n    3200_INSERT_CHILD_SEG_GSAM -.->|calls| CBLTDLI__ext\n    MAIN_PARA --> 1000_INITIALIZE\n    MAIN_PARA --> 2000_FIND_NEXT_AUTH_SUMMARY\n    MAIN_PARA --> 4000_FILE_CLOSE"
}