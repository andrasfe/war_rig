{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "cbl/COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-26T14:21:56.414549",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUS1C is a CICS online program that provides a detailed view of pending authorization records from IMS database segments. It handles user interactions via BMS map COPAU1A, including loading details on ENTER/PF keys, toggling fraud status on PF5, navigating to next record on PF8, and returning to summary screen on PF3. Authorization details are populated from IMS PAUTSUM0 (summary) and PAUTDTL1 (details) segments, with fraud updates via linked program.",
    "business_context": "CardDemo application - Authorization module for viewing and managing pending authorization details, including fraud marking.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      157,
      375,
      382
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Common area containing account ID, selected auth key, page info, fraud data from previous screens/programs.",
      "copybook": "COCOM01Y, COPAU01",
      "citation": [
        109,
        122,
        171
      ]
    },
    {
      "name": "COPAU1A",
      "io_type": "CICS_MAP",
      "description": "Input map for receiving user selections like selected auth key and AID keys.",
      "copybook": "COPAU01",
      "citation": [
        122,
        400
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary root segment, qualified by ACCNTID.",
      "copybook": "CIPAUSMY",
      "citation": [
        140,
        439
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Details child segment, qualified by PAUT9CTS auth key.",
      "copybook": "CIPAUDTY",
      "citation": [
        145,
        465
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1AO",
      "io_type": "CICS_MAP",
      "description": "Output map populated with auth details, header, messages for screen display.",
      "copybook": "COPAU01",
      "citation": [
        382
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Updated Pending Authorization Details segment after fraud toggle.",
      "copybook": "CIPAUDTY",
      "citation": [
        525
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "To report or remove fraud status on the authorization record",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    },
    {
      "program_name": "COPAUS0C",
      "call_type": "CICS_XCTL",
      "purpose": "Return to authorization summary screen",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 368
    }
  ],
  "calling_context": {
    "called_by": [
      "COPAUS0C"
    ],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Toggle fraud status on PF5: if confirmed, remove; else report as fraud.",
      "logic_summary": "Check PA-FRAUD-CONFIRMED, set flags WS-REPORT-FRAUD or WS-REMOVE-FRAUD, call fraud program, update if success.",
      "conditions": [
        "IF PA-FRAUD-CONFIRMED",
        "ELSE SET PA-FRAUD-CONFIRMED"
      ],
      "citation": [
        236,
        240
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Display response as A (green) if resp code '00', else D (red).",
      "logic_summary": "IF PA-AUTH-RESP-CODE = '00' move 'A' and green, else 'D' and red.",
      "conditions": [
        "PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        311
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Lookup decline reason description from table by resp reason code.",
      "logic_summary": "SEARCH ALL table for matching DECL-CODE = PA-AUTH-RESP-REASON, format AUTHRSNO.",
      "conditions": [
        "WHEN DECL-CODE(WS-DECL-RSN-IDX) = PA-AUTH-RESP-REASON"
      ],
      "citation": [
        319
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Validate input for numeric ACCT-ID and non-blank selected key before read.",
      "logic_summary": "IF CDEMO-ACCT-ID NUMERIC AND CDEMO-CPVD-PAU-SELECTED NOT SPACES/LOW-VALUES.",
      "conditions": [
        "CDEMO-ACCT-ID IS NUMERIC",
        "CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        211
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID",
          "ACCNTID"
        ],
        "citation": [
          436,
          442
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PA-AUTHORIZATION-KEY",
          "PAUT9CTS",
          "PA-CARD-NUM",
          "PA-AUTH-ORIG-DATE",
          "PA-AUTH-ORIG-TIME",
          "PA-APPROVED-AMT",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-PROCESSING-CODE",
          "PA-FRAUD-CONFIRMED"
        ],
        "citation": [
          437,
          467
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHTMO",
          "AUTHAMTO",
          "AUTHRSPO",
          "AUTHRSNO",
          "AUTHFRDO"
        ],
        "citation": [
          295,
          301,
          306,
          309,
          312,
          325,
          345
        ]
      },
      {
        "destination": "PAUTDTL1",
        "fields_written": [
          "PA-FRAUD-CONFIRMED",
          "PA-FRAUD-REMOVED",
          "PA-FRAUD-RPT-DATE"
        ],
        "citation": [
          522
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Reformat YYMMDD to MM/DD/YY using WS-CURDATE-MM-DD-YY",
        "citation": [
          297
        ]
      },
      {
        "input_field": "PA-AUTH-ORIG-TIME",
        "output_field": "AUTHTMO",
        "transformation_description": "Reformat HHMMSS to HH:MM:SS",
        "citation": [
          303
        ]
      },
      {
        "input_field": "PA-AUTH-RESP-REASON",
        "output_field": "AUTHRSNO",
        "transformation_description": "Lookup table for description, format as CODE-DESCRIPTION",
        "citation": [
          325
        ]
      },
      {
        "input_field": "PA-CARD-EXPIRY-DATE",
        "output_field": "CRDEXPO",
        "transformation_description": "Reformat YYMM to YY/MM",
        "citation": [
          336
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines CARDDEMO-COMMAREA including CDEMO-CPVD-INFO for transaction data",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines BMS map COPAU1A/I/O for auth detail screen",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines PENDING-AUTH-SUMMARY IMS segment layout",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines PENDING-AUTH-DETAILS IMS segment layout",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Screen titles like CCDA-TITLE01/02",
      "location": "WORKING_STORAGE",
      "citation": 126
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Current date/time working variables WS-CURDATE-DATA",
      "location": "WORKING_STORAGE",
      "citation": 129
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Common messages like CCDA-MSG-INVALID-KEY",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS AID definitions like DFHENTER",
      "location": "WORKING_STORAGE",
      "citation": 148
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "CICS BMS color attributes like DFHGREEN",
      "location": "WORKING_STORAGE",
      "citation": 150
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point paragraph that orchestrates the entire program flow for the CICS transaction CPVD. It initializes flags and messages (lines 159-164), checks if first entry (EIBCALEN=0) to XCTL back to summary screen (165-170), or receives commarea and processes re-entry. On re-entry, it handles map receive and evaluates AID: ENTER/PF keys load details via PROCESS-ENTER-KEY (182), PF3 returns to summary (185), PF5 marks fraud (188), PF8 next record (191), other invalid keys show error (194). After processing, sends screen via SEND-AUTHVIEW-SCREEN (177,183,etc.) and CICS RETURN with commarea and same transid (202). Error flag and erase flag control screen behavior. No direct IMS access here, relies on subordinate paragraphs for data. Business logic centers on AID-driven navigation and validation. Errors from subordinates propagate via WS-MESSAGE and WS-ERR-FLG.",
      "called_by": [],
      "calls": [
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "RETURN-TO-PREV-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph handles loading the selected authorization record details on ENTER key or initial selection. It clears map input (210), validates CDEMO-ACCT-ID numeric and CDEMO-CPVD-PAU-SELECTED not blank/low-values (211-212), sets WS-ACCT-ID/WS-AUTH-KEY and performs READ-AUTH-RECORD if valid (213-216), else sets error flag (224). Unschedules PSB if needed (218-220). Always calls POPULATE-AUTH-DETAILS to refresh screen data from IMS segments (227). Inputs from commarea/map (CDEMO- fields), outputs updated map fields via populate. Business logic validates inputs before IMS read to prevent invalid queries. Errors set WS-ERR-FLG for message display. Calls READ-AUTH-RECORD for data fetch.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        208,
        229
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "Triggered by PF5, this paragraph toggles fraud status on the selected auth record. Sets WS-ACCT-ID/KEY from commarea (231-232), reads current record via READ-AUTH-RECORD (234), toggles PA-FRAUD-CONFIRMED/REMOVED and sets WS-REPORT-FRAUD or WS-REMOVE-FRAUD (236-242). Prepares WS-FRAUD-DATA with record/cust data (244-246), CICS LINK to COPAUS2C (248-252). If normal and success, UPDATE-AUTH-DETAILS (255), else message/rollback (257,260). Refreshes selected key and repopulates details (264-266). Inputs: commarea selection, IMS current record; outputs: updated IMS segment, message. Business logic implements fraud toggle with linked program validation. Errors trigger ROLL-BACK and screen send.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK"
      ],
      "citation": [
        230,
        267
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "Handles PF8 for next authorization detail record. Sets keys from commarea (270-271), reads current via READ-AUTH-RECORD (273), then GNP next PAUTDTL1 (274). Unschedules PSB (276-279). If EOF, sets no-erase and last-auth message (281-285), else updates selected key and populates (286-288). Inputs: current selection from commarea, IMS positioning; outputs: next record details or EOF message to map. Business logic navigates sequentially via IMS GNP. Errors not explicitly handled here beyond caller.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        268,
        290
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "Populates BMS output map COPAU1AO with IMS data if no error (294). Maps fields like CARDNUMO (295), reformats date/time (297-307), amount (308), response A/D with color (311-317), searches decline table for reason (319-328), other fields like codes/merchant (331-357), fraud date if flagged (344-350). Inputs: PENDING-AUTH-DETAILS from IMS read; outputs: all map O fields for display. Business logic formats data for screen, lookup reasons, conditional colors/text. No error handling, assumes valid data post-read. Called after every read/navigate.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "Prepares commarea for return to summary screen on PF3 or initial entry. Sets CDEMO-FROM-TRANID/PROGRAM/CONTEXT and CDEMO-PGM-ENTER (362-366), XCTL to COPAUS0C with commarea (367-370). Inputs: none specific; outputs: modified commarea. Business logic for navigation back. No data changes or errors.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        360,
        371
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "Sends the BMS map COPAU1A with populated data. Calls POPULATE-HEADER-INFO first (375), sets message/length (377-379), conditional ERASE on flag (380-395). Inputs: populated COPAU1AO; outputs: screen display to user. Business logic controls erase for refresh vs update. Handles cursor positioning.",
      "called_by": [
        "MAIN-PARA",
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        373,
        397
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "Receives input from BMS map COPAU1A into COPAU1AI (400-406). Nohandle, assumes success. Inputs: user screen data; outputs: map I fields for processing. Called on re-entry.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        398,
        407
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "Populates screen header with titles, tranid, program, current date/time formatted (411-429). Inputs: WS-CURDATE-DATA from FUNCTION; outputs: TITLEs, TRNNAMEO, etc. in map. Standard header setup.",
      "called_by": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        409,
        430
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "Schedules PSB if needed (433), GU PAUTSUM0 by ACCT-ID into summary (439-445), evaluates IMS status: OK/not-EOF continue, else EOF/error message/send screen (447-462). If summary found, GNP child PAUTDTL1 by key (465-488), similar eval. Inputs: WS-ACCT-ID/KEY; outputs: PENDING-AUTH-SUMMARY/DETAILS populated. Business logic: qualified get unique/parent-child read. Errors: set flag/message/screen.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        431,
        492
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "GNP next PAUTDTL1 sibling (495-498), eval status: OK/not-EOF, EOF set flag, other error message/screen (500-517). Inputs: positioned PCB; outputs: next PENDING-AUTH-DETAILS. Sequential navigation.",
      "called_by": [
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        493,
        519
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "REPL PAUTDTL1 with updated fraud data from WS-FRAUD-AUTH-RECORD (522-528), eval: OK syncpoint/set message (532-539), else rollback/error/screen (540-551). Inputs: WS-FRAUD-DATA post-link; outputs: updated IMS segment, message. Business logic: commit fraud changes.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        520,
        553
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "Exec CICS SYNCPOINT to commit changes (558). No error handling.",
      "called_by": [
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        557,
        561
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "Exec CICS SYNCPOINT ROLLBACK to undo changes (566).",
      "called_by": [
        "MARK-AUTH-FRAUD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        565,
        570
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "DLI SCHD PSBPAUTB, handle TC by TERM/re-SCHD (575-589), set flag or error/message/screen on fail (590-602). Ensures PSB scheduled.",
      "called_by": [
        "READ-AUTH-RECORD"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        574,
        604
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS-RETURN-CODE NOT STATUS-OK/GE/GB in READ-AUTH-RECORD summary",
      "action": "Set WS-ERR-FLG, build WS-MESSAGE, SEND-AUTHVIEW-SCREEN",
      "citation": [
        453
      ]
    },
    {
      "condition": "IMS-RETURN-CODE NOT STATUS-OK/GE/GB in details GNP",
      "action": "Set WS-ERR-FLG, build WS-MESSAGE, SEND-AUTHVIEW-SCREEN",
      "citation": [
        479
      ]
    },
    {
      "condition": "LINK EIBRESP NOT NORMAL or not WS-FRD-UPDT-SUCCESS",
      "action": "ROLL-BACK, set message",
      "citation": [
        257
      ]
    },
    {
      "condition": "REPL IMS-RETURN-CODE NOT OK",
      "action": "ROLL-BACK, set WS-ERR-FLG/message, SEND screen",
      "citation": [
        540
      ]
    },
    {
      "condition": "Input ACCT-ID not numeric or key blank/low",
      "action": "Set ERR-FLG-ON",
      "citation": [
        224
      ]
    },
    {
      "condition": "PSB SCHD fail",
      "action": "Set WS-ERR-FLG, message, SEND screen",
      "citation": [
        593
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A",
      "purpose": "Receive user input from screen",
      "citation": 400
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Send populated detail view screen, conditional ERASE",
      "citation": 381
    },
    {
      "command": "LINK PROGRAM",
      "resource": "COPAUS2C",
      "purpose": "Invoke fraud handling subroutine",
      "citation": 248
    },
    {
      "command": "XCTL PROGRAM",
      "resource": "COPAUS0C",
      "purpose": "Transfer control to summary screen",
      "citation": 367
    },
    {
      "command": "RETURN TRANSID",
      "resource": "CPVD",
      "purpose": "End transaction, keep commarea",
      "citation": 202
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Commit database changes",
      "citation": 558
    },
    {
      "command": "SYNCPOINT ROLLBACK",
      "resource": null,
      "purpose": "Undo database changes on error",
      "citation": 567
    }
  ],
  "open_questions": [
    {
      "question": "Exact field layouts and definitions in copybooks like CIPAUSMY, CIPAUDTY, COPAU01",
      "context": "Copybooks not provided; inferred from usage but precise offsets/types unknown",
      "suggestion": "Provide copybook source for full field analysis"
    },
    {
      "question": "How COPAUS0C calls this program",
      "context": "Inferred from context/WS-PGM-AUTH-SMRY but not explicit",
      "suggestion": "Analyze caller COPAUS0C.cbl"
    },
    {
      "question": "Full list of fields in CARDDEMO-COMMAREA",
      "context": "Partial from COCOM01Y usage; others like CDEMO-CUST-ID assumed",
      "suggestion": "Review COCOM01Y"
    }
  ]
}