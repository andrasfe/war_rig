{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "cbl/COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-24T04:03:23.439394",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUS1C is a CICS transaction program that provides a detailed view of pending authorization records from an IMS database. It retrieves and displays authorization details on a BMS screen (COPAU1A), supports navigation to next records (PF8), toggles fraud status via a linked program, and handles user inputs like ENTER and PF keys. The program manages IMS DL/I calls for GU, GNP, and REPL operations on PAUTSUM0 root and PAUTDTL1 child segments.",
    "business_context": "CardDemo authorization module for viewing and managing pending credit card authorization details, including fraud marking.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      22,
      23,
      36
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area containing account ID, selected auth key, page info, and fraud data from previous screen (COPAUS0C)",
      "copybook": "COCOM01Y",
      "citation": [
        110,
        153,
        171
      ]
    },
    {
      "name": "COPAU1AI",
      "io_type": "CICS_MAP",
      "description": "Input map fields from BMS screen for user selections like account ID and selected authorization key",
      "copybook": "COPAU01",
      "citation": [
        122,
        400
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending authorization summary root segment qualified by account ID",
      "copybook": "CIPAUSMY",
      "citation": [
        140,
        439
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending authorization details child segment qualified by authorization key",
      "copybook": "CIPAUDTY",
      "citation": [
        144,
        465
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1AO",
      "io_type": "CICS_MAP",
      "description": "Output map populated with authorization details, header info, messages, and fraud status for screen display",
      "copybook": "COPAU01",
      "citation": [
        122,
        382
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Updated authorization details segment after fraud marking",
      "copybook": "CIPAUDTY",
      "citation": [
        144,
        525
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "To report or remove fraud status on the authorization record",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    },
    {
      "program_name": "COPAUS0C",
      "call_type": "CICS_XCTL",
      "purpose": "To return to the authorization summary screen",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 368
    }
  ],
  "calling_context": {
    "called_by": [
      "COPAUS0C"
    ],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Toggle fraud status on authorization: if already confirmed, remove; else report as fraud",
      "logic_summary": "Checks PA-FRAUD-CONFIRMED flag and sets opposite, then links to fraud program",
      "conditions": [
        "IF PA-FRAUD-CONFIRMED",
        "ELSE"
      ],
      "citation": [
        236,
        237,
        240
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Display approval/decline status and reason from response code and lookup table",
      "logic_summary": "Sets 'A'/'D' based on resp code '00', searches decline reason table for description",
      "conditions": [
        "IF PA-AUTH-RESP-CODE = '00'",
        "SEARCH ALL WS-DECLINE-REASON-TAB"
      ],
      "citation": [
        311,
        319
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Validate input for numeric account ID and non-blank selected key before IMS read",
      "logic_summary": "Checks CDEMO-ACCT-ID NUMERIC and CDEMO-CPVD-PAU-SELECTED not spaces/low-values",
      "conditions": [
        "IF CDEMO-ACCT-ID IS NUMERIC AND CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        211
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID"
        ],
        "citation": [
          436
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PA-AUTHORIZATION-KEY",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-FRAUD-CONFIRMED"
        ],
        "citation": [
          437,
          311,
          324,
          344
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHRSPO",
          "AUTHRSNO"
        ],
        "citation": [
          295,
          301,
          312,
          325
        ]
      },
      {
        "destination": "PAUTDTL1",
        "fields_written": [
          "PA-FRAUD-CONFIRMED",
          "PA-FRAUD-REMOVED",
          "PA-FRAUD-RPT-DATE"
        ],
        "citation": [
          522
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Reformats YYMMDD to MM/DD/YY using working variables WS-CURDATE-YY/MM/DD",
        "citation": [
          297
        ]
      },
      {
        "input_field": "PA-AUTH-RESP-REASON",
        "output_field": "AUTHRSNO",
        "transformation_description": "Looks up description in WS-DECLINE-REASON-TABLE and appends after code with '-' separator",
        "citation": [
          324
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines CARDDEMO-COMMAREA including CDEMO-CPVD-INFO for screen navigation and auth keys",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines BMS maps COPAU1AI and COPAU1AO for authorization detail screen",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines PENDING-AUTH-SUMMARY segment layout for PAUTSUM0",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines PENDING-AUTH-DETAILS segment layout for PAUTDTL1",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS attention identifier for AID keys like DFHENTER, DFHPF3",
      "location": "WORKING_STORAGE",
      "citation": 148
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "CICS BMS control attributes like DFHGREEN, DFHRED",
      "location": "WORKING_STORAGE",
      "citation": 150
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point and orchestration paragraph that handles the overall program flow for the CICS transaction CPVD. It initializes flags and messages, checks if first entry (EIBCALEN=0) to XCTL back to summary screen, or processes commarea from caller. For reentry, it receives the map if needed, evaluates AID keys (ENTER, PF3, PF5, PF8, OTHER), and dispatches to appropriate handlers like PROCESS-ENTER-KEY for detail load, MARK-AUTH-FRAUD for fraud toggle, PROCESS-PF8-KEY for next record, or RETURN-TO-PREV-SCREEN for exit. It consumes inputs from DFHCOMMAREA (CARDDEMO-COMMAREA) and COPAU1AI map, producing outputs to COPAU1AO map via SEND and finally CICS RETURN with updated commarea. Business logic includes reentry flag management and invalid key error messaging. Error handling is delegated to subordinate paragraphs. It calls RECEIVE-AUTHVIEW-SCREEN, PROCESS-ENTER-KEY, SEND-AUTHVIEW-SCREEN, MARK-AUTH-FRAUD, PROCESS-PF8-KEY, RETURN-TO-PREV-SCREEN based on AID.",
      "called_by": [],
      "calls": [
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY",
        "RETURN-TO-PREV-SCREEN"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 169
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 175
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 177
        },
        {
          "target": "RECEIVE-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 179
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 182
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 183
        },
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 186
        },
        {
          "target": "MARK-AUTH-FRAUD",
          "call_type": "performs",
          "line": 188
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 189
        },
        {
          "target": "PROCESS-PF8-KEY",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 192
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 194
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 197
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph processes the ENTER key to load selected authorization details into the screen map. It validates numeric CDEMO-ACCT-ID and non-blank CDEMO-CPVD-PAU-SELECTED, moving them to WS-ACCT-ID/WS-AUTH-KEY if valid, then performs READ-AUTH-RECORD to fetch IMS segments; sets error flag otherwise. It consumes commarea fields and produces populated map fields via subsequent POPULATE-AUTH-DETAILS. Business logic enforces input validation before DB access. Errors from validation set ERR-FLG-ON without DB call. It unschedules PSB after read if scheduled. Calls READ-AUTH-RECORD and POPULATE-AUTH-DETAILS.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        208,
        229
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 216
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 220
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 227
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "This paragraph handles PF5 to toggle fraud status on the current authorization record. It reads the current record via READ-AUTH-RECORD using acct/auth key from commarea, toggles PA-FRAUD-CONFIRMED to REMOVED or sets CONFIRMED based on current state, prepares WS-FRAUD-DATA, and LINKs to COPAUS2C for processing. On success (WS-FRD-UPDT-SUCCESS), updates the details via UPDATE-AUTH-DETAILS and syncpoint; else rolls back and messages error. Consumes IMS details and commarea, produces updated IMS segment and refreshed map. Business logic implements fraud report/remove toggle. Error handling via ROLL-BACK on LINK or update failure. Calls READ-AUTH-RECORD, UPDATE-AUTH-DETAILS, ROLL-BACK.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK"
      ],
      "citation": [
        230,
        266
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 234
        },
        {
          "target": "UPDATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 255
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 258
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 261
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 265
        },
        {
          "target": "WS-PGM-AUTH-FRAUD",
          "call_type": "calls",
          "line": 248
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 188,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "This paragraph processes PF8 to navigate to the next authorization detail record under the same account. It reads current record, then GNP next PAUTDTL1 child segment, sets EOF flag if end reached, messages 'Already at last' if EOF else updates selected key and populates details. Consumes current IMS position and acct/auth key, produces next record details or error message. Business logic handles sequential navigation with EOF check. Errors set ERR-FLG and message. Unchedules PSB post-read. Calls READ-AUTH-RECORD, READ-NEXT-AUTH-RECORD, POPULATE-AUTH-DETAILS.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        268,
        289
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 273
        },
        {
          "target": "READ-NEXT-AUTH-RECORD",
          "call_type": "performs",
          "line": 274
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 278
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 287
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph maps IMS PENDING-AUTH-DETAILS fields to BMS output map COPAU1AO fields if no error. It formats dates/times, sets approve/decline indicators with colors, searches decline reason table for description, populates merchant/transaction fields, and handles fraud display if flagged. Consumes PA* fields from IMS and WS variables, produces all detail fields in COPAU1AO like CARDNUMO, AUTHDTO, AUTHRSNO, AUTHFRDO. Business logic includes conditional formatting (green/red, fraud date) and table lookup. No direct error handling, skips if ERR-FLG-ON. Called unconditionally after reads.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 227,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 265,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 287,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "This paragraph XCTLs back to the authorization summary program COPAUS0C. It sets commarea fields for from-program/transaction, enter context, and zero context. Consumes current commarea, produces updated commarea for caller. Business logic for PF3/exit or initial entry. No error handling shown. Called on PF3 or initial.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        360,
        370
      ],
      "outgoing_calls": [
        {
          "target": "CDEMO-TO-PROGRAM",
          "call_type": "calls",
          "line": 367
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph sends the populated BMS map COPAU1A to the terminal, erasing if flagged. It first calls POPULATE-HEADER-INFO for titles/date/time, moves message, sets length -1. Consumes populated COPAU1AO and WS-MESSAGE, produces screen display. Business logic controls ERASE option via SEND-ERASE-FLG. No error handling. Called after most processing.",
      "called_by": [
        "MAIN-PARA",
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        373,
        396
      ],
      "outgoing_calls": [
        {
          "target": "POPULATE-HEADER-INFO",
          "call_type": "performs",
          "line": 375
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 177,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 461,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-NEXT-AUTH-RECORD",
          "line": 516,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 550,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "SCHEDULE-PSB",
          "line": 601,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph receives user input from BMS map COPAU1A into COPAU1AI. Simple CICS RECEIVE NOHANDLE. Consumes screen input, produces map fields for AID evaluation. No validation or error handling here. Called on reenter.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        398,
        406
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 179,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "This paragraph populates screen header with titles, program/transaction names, current date/time from FUNCTION CURRENT-DATE. Formats date/time using WS-CURDATE/CURTIME vars from copy CSDAT01Y. Consumes system date/time, produces TITLE*/TRNNAMEO/PGMNAMEO/CURDATEO/CURTIMEO. No conditions or errors. Called before every SEND.",
      "called_by": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        409,
        429
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph schedules PSB if needed, then GU PAUTSUM0 by ACCT-ID, GNP PAUTDTL1 by AUTH-KEY, handling IMS statuses: OK continues, GE/GB sets EOF, others error message and SEND. Consumes WS-ACCT-ID/KEY, produces PENDING-AUTH-SUMMARY/DETAILS populated. Business logic for qualified hierarchical read. Errors branch to SEND with message. Calls SCHEDULE-PSB.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB"
      ],
      "citation": [
        431,
        491
      ],
      "outgoing_calls": [
        {
          "target": "SCHEDULE-PSB",
          "call_type": "performs",
          "line": 433
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 461
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 487
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 216,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 234,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 273,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph performs GNP next PAUTDTL1 under current parent, sets NOT-EOF or EOF, errors message/SEND. Consumes current PCB position, produces next PENDING-AUTH-DETAILS. Sequential navigation logic. Errors set ERR-FLG and SEND.",
      "called_by": [
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        493,
        518
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 516
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 274,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph REPL the PAUTDTL1 segment with updated fraud data from WS-FRAUD-AUTH-RECORD, syncpoints on OK with success message, else ROLL-BACK/error SEND. Consumes updated details, produces persistent IMS update. Fraud tag persistence logic. Errors rollback and message.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK"
      ],
      "citation": [
        520,
        552
      ],
      "outgoing_calls": [
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 533
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 540
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 550
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 255,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "Executes CICS SYNCPOINT to commit changes. No inputs/outputs beyond CICS state. Called post-successful updates.",
      "called_by": [
        "UPDATE-AUTH-DETAILS",
        "PROCESS-ENTER-KEY"
      ],
      "calls": [],
      "citation": [
        557,
        560
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 220,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 278,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 533,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "Executes CICS SYNCPOINT ROLLBACK to undo changes. Called on errors.",
      "called_by": [
        "MARK-AUTH-FRAUD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        565,
        569
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 258,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 540,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "Schedules IMS PSB PSBPAUTB, handles TC by TERM/SCHD retry, sets flag or error/SEND. Ensures PSB availability before DL/I calls.",
      "called_by": [
        "READ-AUTH-RECORD"
      ],
      "calls": [],
      "citation": [
        574,
        603
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 601
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS-RETURN-CODE NOT STATUS-OK in reads",
      "action": "Set WS-ERR-FLG 'Y', build WS-MESSAGE with code, PERFORM SEND-AUTHVIEW-SCREEN",
      "citation": [
        453
      ]
    },
    {
      "condition": "EIBRESP NOT NORMAL after LINK COPAUS2C",
      "action": "PERFORM ROLL-BACK",
      "citation": [
        260
      ]
    },
    {
      "condition": "WS-FRD-UPDT-FAILED after fraud LINK",
      "action": "MOVE WS-FRD-ACT-MSG to WS-MESSAGE, PERFORM ROLL-BACK",
      "citation": [
        257
      ]
    },
    {
      "condition": "EIBAID OTHER than ENTER/PF3/5/8",
      "action": "PROCESS-ENTER-KEY, set invalid key message",
      "citation": [
        194
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A",
      "purpose": "Receive user input from authorization detail screen",
      "citation": 400
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Send populated authorization detail screen with optional ERASE",
      "citation": 381
    },
    {
      "command": "LINK PROGRAM",
      "resource": "COPAUS2C",
      "purpose": "Invoke fraud processing subroutine",
      "citation": 248
    },
    {
      "command": "XCTL PROGRAM",
      "resource": "COPAUS0C",
      "purpose": "Transfer control to summary screen",
      "citation": 367
    },
    {
      "command": "RETURN TRANSID",
      "resource": "CPVD",
      "purpose": "Return to CICS with commarea and same transaction",
      "citation": 202
    },
    {
      "command": "SYNCPOINT",
      "resource": "",
      "purpose": "Commit database changes",
      "citation": 558
    }
  ],
  "open_questions": [
    {
      "question": "Exact field layouts and values in copybooks like CIPAUSMY, CIPAUDTY, COPAU01",
      "context": "Source shows COPY but not expanded contents",
      "suggestion": "Analyze referenced copybook files"
    },
    {
      "question": "Full logic in called COPAUS2C fraud program",
      "context": "LINK parameters returned but internals unknown",
      "suggestion": "Analyze COPAUS2C.cbl"
    }
  ],
  "resolved_questions": [],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RECEIVE-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "MARK-AUTH-FRAUD",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-PF8-KEY",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "READ-AUTH-RECORD",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "UPDATE-AUTH-DETAILS",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-NEXT-AUTH-RECORD",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "SEND-AUTHVIEW-SCREEN",
      "callee": "POPULATE-HEADER-INFO",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SCHEDULE-PSB",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "READ-NEXT-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    },
    {
      "caller": "SCHEDULE-PSB",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": null
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: COPAUS1C.cbl\n    MAIN_PARA[\"MAIN-PARA\"]\n    MARK_AUTH_FRAUD[\"MARK-AUTH-FRAUD\"]\n    PROCESS_ENTER_KEY[\"PROCESS-ENTER-KEY\"]\n    PROCESS_PF8_KEY[\"PROCESS-PF8-KEY\"]\n    RECEIVE_AUTHVIEW_SCREEN[\"RECEIVE-AUTHVIEW-SCREEN\"]\n    RETURN_TO_PREV_SCREEN[\"RETURN-TO-PREV-SCREEN\"]\n    SEND_AUTHVIEW_SCREEN[\"SEND-AUTHVIEW-SCREEN\"]\n    POPULATE_AUTH_DETAILS[\"POPULATE-AUTH-DETAILS\"]\n    READ_AUTH_RECORD[\"READ-AUTH-RECORD\"]\n    ROLL_BACK[\"ROLL-BACK\"]\n    UPDATE_AUTH_DETAILS[\"UPDATE-AUTH-DETAILS\"]\n    WS_PGM_AUTH_FRAUD__ext([\"WS-PGM-AUTH-FRAUD\"])\n    POPULATE_HEADER_INFO[\"POPULATE-HEADER-INFO\"]\n    TAKE_SYNCPOINT[\"TAKE-SYNCPOINT\"]\n    READ_NEXT_AUTH_RECORD[\"READ-NEXT-AUTH-RECORD\"]\n    SCHEDULE_PSB[\"SCHEDULE-PSB\"]\n    CDEMO_TO_PROGRAM__ext([\"CDEMO-TO-PROGRAM\"])\n    MAIN_PARA --> MARK_AUTH_FRAUD\n    MAIN_PARA --> PROCESS_ENTER_KEY\n    MAIN_PARA --> PROCESS_PF8_KEY\n    MAIN_PARA --> RECEIVE_AUTHVIEW_SCREEN\n    MAIN_PARA --> RETURN_TO_PREV_SCREEN\n    MAIN_PARA --> SEND_AUTHVIEW_SCREEN\n    MARK_AUTH_FRAUD --> POPULATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD --> READ_AUTH_RECORD\n    MARK_AUTH_FRAUD --> ROLL_BACK\n    MARK_AUTH_FRAUD --> UPDATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD -.->|calls| WS_PGM_AUTH_FRAUD__ext\n    PROCESS_ENTER_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_ENTER_KEY --> READ_AUTH_RECORD\n    PROCESS_ENTER_KEY --> TAKE_SYNCPOINT\n    PROCESS_PF8_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_PF8_KEY --> READ_AUTH_RECORD\n    PROCESS_PF8_KEY --> READ_NEXT_AUTH_RECORD\n    PROCESS_PF8_KEY --> TAKE_SYNCPOINT\n    READ_AUTH_RECORD --> SCHEDULE_PSB\n    READ_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    READ_NEXT_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    RETURN_TO_PREV_SCREEN -.->|calls| CDEMO_TO_PROGRAM__ext\n    SCHEDULE_PSB --> SEND_AUTHVIEW_SCREEN\n    SEND_AUTHVIEW_SCREEN --> POPULATE_HEADER_INFO\n    UPDATE_AUTH_DETAILS --> ROLL_BACK\n    UPDATE_AUTH_DETAILS --> SEND_AUTHVIEW_SCREEN\n    UPDATE_AUTH_DETAILS --> TAKE_SYNCPOINT"
}