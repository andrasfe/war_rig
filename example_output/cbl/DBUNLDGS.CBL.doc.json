{
  "header": {
    "program_id": "DBUNLDGS",
    "file_name": "cbl/DBUNLDGS.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-26T14:23:49.950346",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "Unloads root segments (PAUTSUM0 Pending Authorization Summary) from IMS database PAUT via unqualified GN calls, incrementing read counters for all roots found. Only inserts valid roots into GSAM PASFL and processes child details (PAUTDTL1) into GSAM PADFL if PA-ACCT-ID is numeric; skips insert and children otherwise but still counts the root read. Continues until end of database (GB status), abending on other IMS errors.",
    "business_context": "Facilitates unloading of pending authorization data from hierarchical IMS database PAUT to flat GSAM files PASFL/PADFL for backup, migration, or processing in an authorization system.",
    "program_type": "BATCH",
    "citations": [
      18,
      164,
      172,
      219,
      222,
      241,
      249
    ]
  },
  "inputs": [
    {
      "name": "PAUT",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database PCB PAUTBPCB providing root PAUTSUM0 summary segments via GN and child PAUTDTL1 detail segments via GNP",
      "copybook": "CIPAUSMY, CIPAUDTY, PAUTBPCB",
      "citation": [
        222,
        267
      ]
    }
  ],
  "outputs": [
    {
      "name": "PASFL",
      "io_type": "IMS_SEGMENT",
      "description": "GSAM PCB PASFLPCB receiving inserted root summary segments from PAUTSUM0",
      "copybook": "PAUTBPCB",
      "citation": [
        302
      ]
    },
    {
      "name": "PADFL",
      "io_type": "IMS_SEGMENT",
      "description": "GSAM PCB PADFLPCB receiving inserted child detail segments from PAUTDTL1",
      "copybook": "PAUTBPCB",
      "citation": [
        321
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB",
      "PASFLPCB",
      "PADFLPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Skip insertion of root summary segment into PASFL and processing of its child details if PA-ACCT-ID is not numeric; still increment read counters for the root",
      "logic_summary": "IF PA-ACCT-ID IS NUMERIC THEN PERFORM 3100-INSERT-PARENT-SEG-GSAM and loop 3000 child processing ELSE skip",
      "conditions": [
        "PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        234,
        235,
        241,
        243,
        245
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Increment summary read and process counters for every successful root GN regardless of numeric check",
      "logic_summary": "ADD 1 TO WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT on status SPACES before numeric check",
      "conditions": [
        "PAUT-PCB-STATUS = SPACES"
      ],
      "citation": [
        232,
        234,
        235
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTBPCB PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID"
        ],
        "citation": [
          236,
          239
        ]
      },
      {
        "source": "PAUTBPCB PAUTDTL1",
        "fields_used": [],
        "citation": [
          268
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PASFLPCB",
        "fields_written": [
          "PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          302
        ]
      },
      {
        "destination": "PADFLPCB",
        "fields_written": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          321
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Direct move from summary segment PA-ACCT-ID to ROOT-SEG-KEY in output buffer if numeric",
        "citation": [
          239
        ]
      },
      {
        "input_field": "PENDING-AUTH-SUMMARY",
        "output_field": "OPFIL1-REC",
        "transformation_description": "Direct move before conditional insert",
        "citation": [
          236
        ]
      },
      {
        "input_field": "PENDING-AUTH-DETAILS",
        "output_field": "CHILD-SEG-REC",
        "transformation_description": "Direct move before insert",
        "citation": [
          280
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS DL/I function codes such as FUNC-GN, FUNC-GNP, FUNC-ISRT",
      "location": "WORKING_STORAGE",
      "citation": 136
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of root segment PENDING-AUTH-SUMMARY (PAUTSUM0)",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of child segment PENDING-AUTH-DETAILS (PAUTDTL1)",
      "location": "WORKING_STORAGE",
      "citation": 147
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "Defines PCB mask for input IMS database PAUTBPCB",
      "location": "LINKAGE_SECTION",
      "citation": 154
    },
    {
      "copybook_name": "PASFLPCB",
      "purpose": "Defines PCB mask for output GSAM PASFLPCB",
      "location": "LINKAGE_SECTION",
      "citation": 155
    },
    {
      "copybook_name": "PADFLPCB",
      "purpose": "Defines PCB mask for output GSAM PADFLPCB",
      "location": "LINKAGE_SECTION",
      "citation": 156
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "MAIN-PARA serves as the primary entry and orchestration paragraph for the entire unload process, invoked via ENTRY 'DLITCBL' using linkage PCBs PAUTBPCB, PASFLPCB, PADFLPCB. It consumes no direct data inputs but relies on the passed IMS PCBs for database access. It first calls 1000-INITIALIZE to accept and display current date information for logging. It then enters a main processing loop calling 2000-FIND-NEXT-AUTH-SUMMARY repeatedly until WS-END-OF-ROOT-SEG is 'Y', processing all root summaries and conditionally their children. After the loop completes upon end-of-database, it performs 4000-FILE-CLOSE for cleanup display, though actual file closes are commented out. There is no local business logic or decisions; flow is strictly sequential orchestration. No error handling here; subordinate paragraphs handle IMS errors by abending to 9999-ABEND. It produces updated WS counters like WS-NO-SUMRY-READ accumulated from children paragraphs. It calls 1000-INITIALIZE for setup, 2000-FIND-NEXT-AUTH-SUMMARY in loop for core reading/processing, and 4000-FILE-CLOSE for termination.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        164,
        179
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This initialization paragraph sets up runtime variables and logs startup information. It consumes system date via ACCEPT CURRENT-DATE FROM DATE and CURRENT-YYDDD FROM DAY. It displays program start message, today's date, and decorative lines for operator console logging. No files are opened as those statements are commented out. No outputs are produced beyond displays. No business logic or conditions are evaluated. No error handling is performed. It calls no other paragraphs. Control returns immediately to caller after displays.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        182,
        213
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph performs the core root segment retrieval and conditional processing loop trigger for each PAUTSUM0 summary. It consumes root segments from PAUTBPCB via unqualified GN call using ROOT-UNQUAL-SSA 'PAUTSUM0 '. On success (PAUT-PCB-STATUS SPACES), it increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT counters unconditionally, moves full PENDING-AUTH-SUMMARY to OPFIL1-REC buffer, and sets ROOT-SEG-KEY from PA-ACCT-ID. It then checks IF PA-ACCT-ID IS NUMERIC; if true, performs 3100-INSERT-PARENT-SEG-GSAM to insert into PASFLPCB and initializes/resets child flags before looping PERFORM 3000-FIND-NEXT-AUTH-DTL until WS-END-OF-CHILD-SEG='Y' to process all siblings; if false, skips insert and children entirely. On GB status, sets end flags to exit main loop. On other statuses, displays error details (status, KEYFB) and abends via 9999-ABEND. Business logic enforces data validity via numeric check on account ID before unload. Error handling covers all non-success/GB IMS responses. It calls 3100-INSERT-PARENT-SEG-GSAM conditionally for output and 3000-FIND-NEXT-AUTH-DTL in loop for children.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3100-INSERT-PARENT-SEG-GSAM",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "citation": [
        216,
        259
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves and unloads child detail segments PAUTDTL1 under current root via unqualified GNP from PAUTBPCB using CHILD-UNQUAL-SSA 'PAUTDTL1 '. It consumes sequential children post-parent GN positioning. On success (SPACES), sets MORE-AUTHS flag, increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT (note: summary counters despite details), moves PENDING-AUTH-DETAILS to CHILD-SEG-REC buffer, and performs 3200-INSERT-CHILD-SEG-GSAM to output to PADFLPCB. On GE status, sets WS-END-OF-CHILD-SEG='Y' to exit child loop and displays flag. On other statuses, displays error (status, KEYFB) and abends via 9999-ABEND. No additional business logic beyond status handling. Error handling rejects non-SPACES/GE responses. Called repeatedly in loop from 2000 until child end; initializes PAUT-PCB-STATUS at end for next call. It calls 3200-INSERT-CHILD-SEG-GSAM for each valid child insert.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "3200-INSERT-CHILD-SEG-GSAM"
      ],
      "citation": [
        263,
        297
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3100-INSERT-PARENT-SEG-GSAM",
      "summary": null,
      "purpose": "This utility paragraph inserts a single root summary segment into output GSAM PASFLPCB. It consumes the current PENDING-AUTH-SUMMARY (with ROOT-SEG-KEY set) via ISRT call using FUNC-ISRT. It produces the inserted segment in PASFL if successful. No transformations or conditions; assumes data validity from caller. On non-SPACES PASFL-PCB-STATUS, displays error (status, KEYFB) and abends via 9999-ABEND. No local error recovery. Called only from 2000 if PA-ACCT-ID numeric.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [],
      "citation": [
        300,
        317
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3200-INSERT-CHILD-SEG-GSAM",
      "summary": null,
      "purpose": "This utility paragraph inserts a single child detail segment into output GSAM PADFLPCB. It consumes the current PENDING-AUTH-DETAILS (with parent key feedback assumed) via ISRT call using FUNC-ISRT. It produces the inserted segment in PADFL if successful. No transformations or conditions. On non-SPACES PADFL-PCB-STATUS, displays error (status, KEYFB) and abends via 9999-ABEND. No local error recovery. Called from 3000 for each valid child.",
      "called_by": [
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        319,
        336
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This termination paragraph handles program cleanup. It consumes no data. It displays 'CLOSING THE FILE' message; actual CLOSE statements for commented files are absent. No outputs produced. No conditions or logic. No error handling. Called once from MAIN-PARA post-processing.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        338,
        355
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This error termination paragraph abends the program on IMS or other failures. It consumes no inputs. It displays 'DBUNLDGS ABENDING ...', sets RETURN-CODE to 16, and GOBACKs. No recovery logic. Called from error paths in 2000, 3000, 3100, 3200.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "3100-INSERT-PARENT-SEG-GSAM",
        "3200-INSERT-CHILD-SEG-GSAM"
      ],
      "calls": [],
      "citation": [
        357,
        366
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "PAUT-PCB-STATUS NOT SPACES OR 'GB'",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        253
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT SPACES OR 'GE'",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        290
      ]
    },
    {
      "condition": "PASFL-PCB-STATUS NOT SPACES",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        311
      ]
    },
    {
      "condition": "PADFL-PCB-STATUS NOT SPACES",
      "action": "DISPLAY status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        330
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact field layout and other fields in PA-ACCT-ID, PENDING-AUTH-SUMMARY, PENDING-AUTH-DETAILS",
      "context": "Defined in unprovided copybooks CIPAUSMY/CIPAUDTY",
      "suggestion": "Analyze copybooks CIPAUSMY.cpy and CIPAUDTY.cpy"
    },
    {
      "question": "Purpose of counters WS-NO-DTL-READ/DELETED and WS-TOT-REC-WRITTEN (defined but never incremented)",
      "context": "Defined lines 71-73 but no ADD statements found",
      "suggestion": "Possibly legacy or for future use; confirm with runtime traces"
    }
  ]
}