{
  "header": {
    "program_id": "COPAUA0C",
    "file_name": "cbl/COPAUA0C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG_MERGED",
    "analyzed_at": "2026-01-26T15:11:36.825757",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUA0C is a CICS COBOL program in the CardDemo application that serves as the authorization decision engine for card transactions. It processes pending authorization requests received via IBM MQ, validates data against VSAM files (accounts, customers, cards, cross-references) and IMS database segments, applies approval/decline logic, updates IMS, and sends responses via MQ. The program operates as CICS transaction CP00.",
    "business_context": "Card payment authorization processing in a demo banking/card application, handling transaction approvals/declines based on account status, balances, and fraud checks.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      7,
      10,
      12,
      20,
      23,
      25,
      34,
      110,
      173,
      225,
      444,
      525,
      577
    ]
  },
  "inputs": [
    {
      "name": "PENDING-AUTH-REQUEST",
      "io_type": "OTHER",
      "description": "Incoming MQ message containing pending authorization request data",
      "copybook": "CCPAURQY",
      "citation": [
        177,
        178
      ]
    },
    {
      "name": "ACCTDAT",
      "io_type": "FILE_VSAM",
      "description": "Account master records used for balance and status validation",
      "copybook": "CVACT01Y",
      "citation": [
        35,
        206
      ]
    },
    {
      "name": "CUSTDAT",
      "io_type": "FILE_VSAM",
      "description": "Customer master records for customer validation",
      "copybook": "CVCUS01Y",
      "citation": [
        36,
        209
      ]
    },
    {
      "name": "CARDDAT",
      "io_type": "FILE_VSAM",
      "description": "Card data records, accessed via alternate index CARDAIX",
      "copybook": null,
      "citation": [
        37,
        38
      ]
    },
    {
      "name": "CCXREF",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference file linking cardnum, cust-id, acct-id",
      "copybook": "CVACT03Y",
      "citation": [
        39,
        72,
        203
      ]
    },
    {
      "name": "PAUT",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database segments for pending auth summary and details (PSB: PSBPAUTB, PCB: PAUT)",
      "copybook": "CIPAUSMY",
      "citation": [
        82,
        84,
        192
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "CICS linkage commarea for program communication",
      "copybook": null,
      "citation": [
        214,
        215
      ]
    },
    {
      "name": "REQUEST-MQ",
      "io_type": "OTHER",
      "description": "IBM MQ queue containing comma-delimited authorization request messages with card num, amt, merchant data etc.",
      "copybook": null,
      "citation": [
        31,
        173,
        187
      ]
    },
    {
      "name": "WS-CCXREF-FILE",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference VSAM file mapping card num to acct/cust IDs",
      "copybook": "CARD-XREF-RECORD",
      "citation": [
        262,
        265
      ]
    },
    {
      "name": "WS-ACCTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Account master VSAM file containing credit limits and balances",
      "copybook": "ACCOUNT-RECORD",
      "citation": [
        310,
        313
      ]
    },
    {
      "name": "WS-CUSTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Customer master VSAM file",
      "copybook": "CUSTOMER-RECORD",
      "citation": [
        358,
        361
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "IMS pending authorization summary segment for account credit usage",
      "copybook": "PENDING-AUTH-SUMMARY",
      "citation": [
        406,
        408
      ]
    }
  ],
  "outputs": [
    {
      "name": "PENDING-AUTH-RESPONSE",
      "io_type": "OTHER",
      "description": "MQ response message with authorization decision (approve/decline) and reason",
      "copybook": "CCPAURLY",
      "citation": [
        181,
        182
      ]
    },
    {
      "name": "PENDING-AUTH-SUMMARY",
      "io_type": "IMS_SEGMENT",
      "description": "Root segment updated in IMS PAUT database",
      "copybook": "CIPAUSMY",
      "citation": [
        192,
        193
      ]
    },
    {
      "name": "PENDING-AUTH-DETAILS",
      "io_type": "IMS_SEGMENT",
      "description": "Child segment inserted/updated in IMS PAUT database",
      "copybook": "CIPAUDTY",
      "citation": [
        195,
        196
      ]
    },
    {
      "name": "CCPAUERY",
      "io_type": "OTHER",
      "description": "Application error log layout for logging errors",
      "copybook": "CCPAUERY",
      "citation": [
        184,
        185
      ]
    },
    {
      "name": "REPLY-MQ",
      "io_type": "OTHER",
      "description": "IBM MQ reply queue receiving comma-delimited auth response with resp code, reason, approved amt",
      "copybook": null,
      "citation": [
        528,
        545
      ]
    },
    {
      "name": "CSSL",
      "io_type": "CICS_QUEUE",
      "description": "CICS transient data queue for error log records",
      "copybook": "ERROR-LOG-RECORD",
      "citation": [
        789
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "IMS pending auth summary segment updated/replaced with auth counts and balances",
      "copybook": "PENDING-AUTH-SUMMARY",
      "citation": [
        612,
        617
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "IMS pending auth detail segment inserted with full auth transaction data",
      "copybook": "PENDING-AUTH-DETAILS",
      "citation": [
        700
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CP00"
    ],
    "linkage_section": [
      "LK-COMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Decline authorization request based on predefined reasons including insufficient funds, inactive card, closed account, card fraud, or merchant fraud",
      "logic_summary": "Decline flags set via 88 levels on WS-DECLINE-REASON-FLG and WS-DECLINE-FLG",
      "conditions": [
        "INSUFFICIENT-FUND ('I')",
        "CARD-NOT-ACTIVE ('A')",
        "ACCOUNT-CLOSED ('C')",
        "CARD-FRAUD ('F')",
        "MERCHANT-FRAUD ('M')"
      ],
      "citation": [
        137,
        140,
        141,
        142,
        143,
        144,
        145
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Decline authorization if transaction amount exceeds available credit limit from auth summary or account master",
      "logic_summary": "Compute available amt as credit limit minus balance; if trans amt > available, set DECLINE-AUTH and INSUFFICIENT-FUND",
      "conditions": [
        "FOUND-PAUT-SMRY-SEG AND WS-TRANSACTION-AMT > WS-AVAILABLE-AMT",
        "NOT FOUND-PAUT-SMRY-SEG AND FOUND-ACCT-IN-MSTR AND WS-TRANSACTION-AMT > WS-AVAILABLE-AMT"
      ],
      "citation": [
        452,
        455,
        460,
        463
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Set specific decline reason codes based on failure conditions like not found records or insufficient funds",
      "logic_summary": "Evaluate true for DECLINE-AUTH cases mapping to reason codes like '3100' for not found, '4100' for funds",
      "conditions": [
        "CARD-NFOUND-XREF OR NFOUND-ACCT-IN-MSTR OR NFOUND-CUST-IN-MSTR",
        "INSUFFICIENT-FUND"
      ],
      "citation": [
        487,
        491,
        493
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Approve auth sets resp code '00' and approved amt to trans amt; decline '05' with 0 amt",
      "logic_summary": "If not decline, approve; else decline with reason",
      "conditions": [
        "NOT DECLINE-AUTH",
        "DECLINE-AUTH"
      ],
      "citation": [
        472,
        479
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PENDING-AUTH-REQUEST",
        "fields_used": [],
        "citation": [
          177
        ]
      },
      {
        "source": "ACCTDAT",
        "fields_used": [],
        "citation": [
          35
        ]
      },
      {
        "source": "CUSTDAT",
        "fields_used": [],
        "citation": [
          36
        ]
      },
      {
        "source": "CCXREF",
        "fields_used": [
          "WS-CARD-RID-CARDNUM",
          "WS-CARD-RID-CUST-ID",
          "WS-CARD-RID-ACCT-ID"
        ],
        "citation": [
          72,
          73,
          74,
          77
        ]
      },
      {
        "source": "REQUEST-MQ",
        "fields_used": [
          "PA-RQ-CARD-NUM",
          "PA-RQ-TRANSACTION-AMT",
          "PA-RQ-MERCHANT-ID"
        ],
        "citation": [
          141,
          187
        ]
      },
      {
        "source": "WS-CCXREF-FILE",
        "fields_used": [
          "XREF-ACCT-ID",
          "XREF-CUST-ID"
        ],
        "citation": [
          262
        ]
      },
      {
        "source": "WS-ACCTFILENAME",
        "fields_used": [
          "ACCT-CREDIT-LIMIT",
          "ACCT-CURR-BAL"
        ],
        "citation": [
          461
        ]
      },
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-CREDIT-LIMIT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          453
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PENDING-AUTH-RESPONSE",
        "fields_written": [],
        "citation": [
          181
        ]
      },
      {
        "destination": "PENDING-AUTH-SUMMARY",
        "fields_written": [],
        "citation": [
          192
        ]
      },
      {
        "destination": "REPLY-MQ",
        "fields_written": [
          "PA-RL-AUTH-RESP-CODE",
          "PA-RL-APPROVED-AMT"
        ],
        "citation": [
          509,
          545
        ]
      },
      {
        "destination": "PAUTSUM0",
        "fields_written": [
          "PA-APPROVED-AUTH-CNT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          601,
          612
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "WS-TRANSACTION-AMT-AN",
        "output_field": "WS-TRANSACTION-AMT",
        "transformation_description": "Alphanumeric transaction amount converted to numeric for calculations",
        "citation": [
          63,
          64
        ]
      },
      {
        "input_field": "WS-CARD-RID-CUST-ID",
        "output_field": "WS-CARD-RID-CUST-ID-X",
        "transformation_description": "Numeric customer ID redefined as alphanumeric",
        "citation": [
          74,
          76
        ]
      },
      {
        "input_field": "WS-CARD-RID-ACCT-ID",
        "output_field": "WS-CARD-RID-ACCT-ID-X",
        "transformation_description": "Numeric account ID redefined as alphanumeric",
        "citation": [
          77,
          79
        ]
      },
      {
        "input_field": "WS-TRANSACTION-AMT-AN",
        "output_field": "PA-RQ-TRANSACTION-AMT",
        "transformation_description": "NUMVAL conversion from alphanumeric to numeric transaction amount",
        "citation": [
          164
        ]
      },
      {
        "input_field": "PA-RL-* fields",
        "output_field": "W02-PUT-BUFFER",
        "transformation_description": "STRING comma-delimited response: card,transid,authid,respcode,reason,approvedamt",
        "citation": [
          509
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CMQODV",
      "purpose": "MQ object descriptor for request queue open",
      "location": "WORKING_STORAGE",
      "citation": 149
    },
    {
      "copybook_name": "CMQMDV",
      "purpose": "MQ message descriptor for request",
      "location": "WORKING_STORAGE",
      "citation": 152
    },
    {
      "copybook_name": "CMQV",
      "purpose": "MQ constants",
      "location": "WORKING_STORAGE",
      "citation": 161
    },
    {
      "copybook_name": "CMQTML",
      "purpose": "MQ trigger message layout",
      "location": "WORKING_STORAGE",
      "citation": 164
    },
    {
      "copybook_name": "CMQPMOV",
      "purpose": "MQ put message options",
      "location": "WORKING_STORAGE",
      "citation": 167
    },
    {
      "copybook_name": "CMQGMOV",
      "purpose": "MQ get message options",
      "location": "WORKING_STORAGE",
      "citation": 170
    },
    {
      "copybook_name": "CCPAURQY",
      "purpose": "Pending authorization request layout from MQ",
      "location": "WORKING_STORAGE",
      "citation": 178
    },
    {
      "copybook_name": "CCPAURLY",
      "purpose": "Pending authorization response layout to MQ",
      "location": "WORKING_STORAGE",
      "citation": 182
    },
    {
      "copybook_name": "CCPAUERY",
      "purpose": "Application error log layout",
      "location": "WORKING_STORAGE",
      "citation": 185
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "IMS pending authorization summary segment (root)",
      "location": "WORKING_STORAGE",
      "citation": 193
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "IMS pending authorization details segment (child)",
      "location": "WORKING_STORAGE",
      "citation": 197
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "Card cross-reference layout",
      "location": "WORKING_STORAGE",
      "citation": 203
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "Account record layout",
      "location": "WORKING_STORAGE",
      "citation": 206
    },
    {
      "copybook_name": "CVCUS01Y",
      "purpose": "Customer layout",
      "location": "WORKING_STORAGE",
      "citation": 209
    },
    {
      "copybook_name": "CARD-XREF-RECORD",
      "purpose": "Defines structure for card cross-reference VSAM record with card num, acct ID, cust ID",
      "location": "WORKING_STORAGE",
      "citation": 266
    },
    {
      "copybook_name": "ACCOUNT-RECORD",
      "purpose": "Defines account master record with credit limits and current balance",
      "location": "WORKING_STORAGE",
      "citation": 317
    },
    {
      "copybook_name": "CUSTOMER-RECORD",
      "purpose": "Defines customer master record",
      "location": "WORKING_STORAGE",
      "citation": 365
    },
    {
      "copybook_name": "PENDING-AUTH-SUMMARY",
      "purpose": "IMS segment for pending auth summary with limits, balances, auth counts",
      "location": "WORKING_STORAGE",
      "citation": 409
    },
    {
      "copybook_name": "PENDING-AUTH-DETAILS",
      "purpose": "IMS segment for individual pending auth details with full request/response data",
      "location": "WORKING_STORAGE",
      "citation": 704
    },
    {
      "copybook_name": "ERROR-LOG-RECORD",
      "purpose": "Structure for error log written to CICS TD queue",
      "location": "WORKING_STORAGE",
      "citation": 790
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point paragraph that orchestrates the entire program flow for the CICS task. It consumes no direct inputs but relies on CICS environment including EIB and trigger data. It sequentially performs initialization to setup MQ and read first message, then main process loop to handle multiple auth requests, followed by termination to cleanup resources, and finally issues CICS RETURN to end the task. No business decisions are made here; it delegates to subordinate paragraphs. Errors from subordinates are handled via flags and 9500-LOG-ERROR. It calls 1000-INITIALIZE for setup including MQ open and first read, 2000-MAIN-PROCESS for looping message processing, and 9000-TERMINATE for IMS TERM and MQ close.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-MAIN-PROCESS",
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        15
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph handles program startup by retrieving CICS trigger message data to get queue names, setting wait interval, opening the request MQ queue, and performing initial read of first request message. It consumes CICS RETRIEVE into MQTM for queue name and trigger data (lines 20-23), and MQ connection handles from prior setup. It produces WS-REQUEST-QNAME, WS-TRIGGER-DATA, and populates first W01-GET-BUFFER via 3100 read. Business logic checks EIBRESP NORMAL to move queue data (24-27). Errors in MQ open trigger 9500-LOG-ERROR with critical flag (57-70). It calls 1100-OPEN-REQUEST-QUEUE to open MQ object, and 3100-READ-REQUEST-MQ for first message.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "1100-OPEN-REQUEST-QUEUE",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        17,
        37
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1100-OPEN-REQUEST-QUEUE",
      "summary": null,
      "purpose": "Prepares and calls MQOPEN to access the request queue for input-shared reading. Consumes WS-REQUEST-QNAME for object name (44-45), computes MQOO-INPUT-SHARED options (47). Produces W01-HOBJ-REQUEST handle if successful, sets WS-REQUEST-MQ-OPEN true (58). No business logic beyond success check. On MQCC failure, sets critical MQ error, populates ERR fields, performs 9500-LOG-ERROR (60-69). Calls no other paragraphs.",
      "called_by": [
        "1000-INITIALIZE"
      ],
      "calls": [],
      "citation": [
        42,
        74
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1200-SCHEDULE-PSB",
      "summary": null,
      "purpose": "Schedules the IMS PSB for database access using DLI SCHD, handling if already scheduled by TERM then reschedule. Consumes PSB-NAME. Produces IMS-PSB-SCHD flag if successful, sets IMS-RETURN-CODE from DIBSTAT (84,93). Logic checks PSB-SCHEDULED-MORE-THAN-ONCE to TERM and reschedule (85-92), then STATUS-OK check (95). Errors set critical IMS error and log (98-103). Called in 5000 for each auth to ensure PSB active.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        79,
        107
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-MAIN-PROCESS",
      "summary": null,
      "purpose": "Main loop processes multiple auth requests until no more messages or process limit reached. Consumes messages from prior 3100-READ-REQUEST-MQ into W01-GET-BUFFER. Extracts/parses data via 2100, processes auth via 5000 including reads/decisions/updates, increments count, SYNCPOINT commits, unschedules PSB, checks limit then re-reads or exits. Business logic: loop until NO-MORE-MSG-AVAILABLE or WS-LOOP-END or count > limit (113,126). Errors delegated to callees. Calls 2100-EXTRACT, 5000-PROCESS-AUTH, 3100-READ conditionally.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "2100-EXTRACT-REQUEST-MSG",
        "5000-PROCESS-AUTH",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        110,
        135
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2100-EXTRACT-REQUEST-MSG",
      "summary": null,
      "purpose": "Parses the MQGET buffer into PA-RQ-* request fields using UNSTRING delimited by comma. Consumes W01-GET-BUFFER(1:W01-DATALEN) from 3100 (141). Produces populated PA-RQ- fields like CARD-NUM, AMT, MERCHANT-ID etc., converts alphanum amt to numeric via NUMVAL (163-166). No conditions or decisions. No error handling here. No calls.",
      "called_by": [
        "2000-MAIN-PROCESS"
      ],
      "calls": [],
      "citation": [
        138,
        170
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3100-READ-REQUEST-MQ",
      "summary": null,
      "purpose": "Calls MQGET with wait options to read next request message from opened queue. Consumes W01-HCONN-REQUEST, HOBJ (182-186). Produces W01-GET-BUFFER, W01-DATALEN, saves CORRELID and REPLYTOQ on success (198-201). Logic sets options NO-SYNCPOINT+WAIT+CONVERT+FAIL-QUIESCING (176-178), on OK save ids, on NO-MSG set flag (203-204), else critical error log (206-217). No subordinate calls.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-MAIN-PROCESS"
      ],
      "calls": [],
      "citation": [
        173,
        222
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5000-PROCESS-AUTH",
      "summary": null,
      "purpose": "Core processing for one auth request: assumes approve initially, schedules IMS PSB, reads xref/acct/cust/authsum/profile (profile empty), makes decision, sends response MQ, conditionally writes to DB. Consumes PA-RQ-* from extract. Sets flags like CARD-FOUND-XREF (232), produces decision flags APPROVE-AUTH/DECLINE-AUTH, PA-RL-* response, updates IMS if found. Logic: if xref found, read chained records (237-244), always decide/send (246-248), write if found (250). Errors to log via reads. Calls 1200-SCHEDULE-PSB, 5100/5200/5300/5500/5600-READs, 6000-MAKE-DECISION, 7100-SEND-RESPONSE, 8000-WRITE-AUTH-TO-DB.",
      "called_by": [
        "2000-MAIN-PROCESS"
      ],
      "calls": [
        "1200-SCHEDULE-PSB",
        "5100-READ-XREF-RECORD",
        "5200-READ-ACCT-RECORD",
        "5300-READ-CUST-RECORD",
        "5500-READ-AUTH-SUMMRY",
        "5600-READ-PROFILE-DATA",
        "6000-MAKE-DECISION",
        "7100-SEND-RESPONSE",
        "8000-WRITE-AUTH-TO-DB"
      ],
      "citation": [
        225,
        256
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5100-READ-XREF-RECORD",
      "summary": null,
      "purpose": "CICS READ VSAM xref file by card num, sets found flags, logs warnings for NOTFND or critical for other resp. Consumes PA-RQ-CARD-NUM moved to XREF-CARD-NUM (262). Produces CARD-XREF-RECORD, CARD-FOUND-XREF or NFOUND (276,278). Logic EVALUATE RESP: NORMAL found, NOTFND warning 'A001' log, OTHER critical 'C001' (274-300). Calls 9500-LOG-ERROR on errors.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        259,
        304
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5200-READ-ACCT-RECORD",
      "summary": null,
      "purpose": "CICS READ VSAM acct file by acct ID from xref, sets found flags, logs warnings/NOTFND or critical errors. Consumes XREF-ACCT-ID to WS-CARD-RID-ACCT-ID (310). Produces ACCOUNT-RECORD data like limits/bal, FOUND-ACCT-IN-MSTR or NFOUND (324,326). EVALUATE RESP similar to 5100: NORMAL, NOTFND 'A002' warning, OTHER 'C002' critical (322-348). Calls 9500 on errors.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        307,
        352
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5300-READ-CUST-RECORD",
      "summary": null,
      "purpose": "CICS READ VSAM cust file by cust ID from xref, sets found flags, logs warnings/NOTFND or critical. Similar to 5200. Consumes XREF-CUST-ID (358). Produces CUSTOMER-RECORD, FOUND-CUST-IN-MSTR or NFOUND (372,374). EVALUATE: NOTFND 'A003', OTHER 'C003' (370-396). Calls 9500.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        355,
        400
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5500-READ-AUTH-SUMMRY",
      "summary": null,
      "purpose": "DLI GU IMS get unique for PAUTSUM0 summary segment by acct ID. Consumes PA-ACCT-ID (406). Produces PENDING-AUTH-SUMMARY, FOUND-PAUT-SMRY-SEG or NFOUND (416,418). EVALUATE DIBSTAT: OK found, SEG-NOT-FND nfound, OTHER critical 'I002' log (414-426). Calls 9500.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        403,
        431
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5600-READ-PROFILE-DATA",
      "summary": null,
      "purpose": "Empty paragraph, just CONTINUE; no action performed for profile data read. No inputs consumed or outputs produced. No logic, errors, or calls. Likely placeholder for future profile checks.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        434,
        441
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "6000-MAKE-DECISION",
      "summary": null,
      "purpose": "Applies auth rules to set approve/decline, resp codes/reasons, builds response string buffer. Consumes PA-RQ-*, records from prior reads (credit limits/bals). Produces PA-RL-* response fields, W02-PUT-BUFFER string (516), WS-APPROVED-AMT. Logic: compute avail from summary or acct (452-470), decline if over or not found (468), set codes '00'/'05' (475,480), reason eval for declines (487-504), STRING response (509). No errors here.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        444,
        522
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "7100-SEND-RESPONSE",
      "summary": null,
      "purpose": "Prepares and calls MQPUT1 to send response to reply queue using saved correlid. Consumes WS-REPLY-QNAME, WS-SAVE-CORRELID, W02-PUT-BUFFER (528-544). Produces message on queue if MQCC-OK. Sets MQMD reply fields (531-539), options NO-SYNCPOINT (540). On failure, critical MQ error 'M004' log (554-565). No subordinate calls.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        525,
        570
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8000-WRITE-AUTH-TO-DB",
      "summary": null,
      "purpose": "Updates IMS DB with auth summary and inserts detail record if xref found. No direct inputs beyond globals. Calls 8400 to update summary counts/bals, 8500 to insert detail with timestamps etc. Logic conditional on CARD-FOUND-XREF but always calls both? Wait, called only if found (250). Errors delegated.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "8400-UPDATE-SUMMARY",
        "8500-INSERT-AUTH"
      ],
      "citation": [
        573,
        582
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8400-UPDATE-SUMMARY",
      "summary": null,
      "purpose": "Updates or inserts PAUTSUM0 summary: init if nfound, set limits from acct, inc counts/amts per approve/decline, REPL if found else ISRT. Consumes prior records/flags. Produces updated/inserted segment. Logic: if nfound init with ids (588-595), move limits (597), add to cnts/amts/bal (601-609), REPL/ISRT (611-620), check STATUS-OK else 'I003' critical (624-633). Calls 9500.",
      "called_by": [
        "8000-WRITE-AUTH-TO-DB"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        585,
        638
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8500-INSERT-AUTH",
      "summary": null,
      "purpose": "Gets current CICS time/date, computes auth timestamps, populates PAUTH detail from request/response/xref, sets match flags, ISRT PAUTDTL1 under summary SSA. Consumes PA-RQ-*, PA-RL-*, XREF-IDs (644-683). Produces inserted detail segment. Logic: ASKTIME/FORMATTIME (644-653), compute inverted dates/times (661-662), move all fields (664-688), set MATCH-PENDING or DECLINED (689), ISRT with parent SSA (700), check OK else 'I004' (707-718). Calls 9500.",
      "called_by": [
        "8000-WRITE-AUTH-TO-DB"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        641,
        723
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9000-TERMINATE",
      "summary": null,
      "purpose": "Cleanup: TERM IMS PSB if scheduled, close request MQ queue. Consumes flags IMS-PSB-SCHD, WS-REQUEST-MQ-OPEN. No outputs beyond side effects. Logic: conditional TERM (730-732), call close (734). Errors delegated to 9100.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9100-CLOSE-REQUEST-QUEUE"
      ],
      "citation": [
        727,
        738
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9100-CLOSE-REQUEST-QUEUE",
      "summary": null,
      "purpose": "Calls MQCLOSE on request queue handle if open. Consumes W01-HOBJ-REQUEST (743). Sets WS-REQUEST-MQ-CLSE on OK (751), else warning MQ 'M005' log (753-762).",
      "called_by": [
        "9000-TERMINATE"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        740,
        767
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9500-LOG-ERROR",
      "summary": null,
      "purpose": "Formats and writes error log to CICS TD queue 'CSSL' with timestamp, tranid, pgm, err details. Consumes ERR-* fields set by callers, gets current time/date (773-781). Produces ERROR-LOG-RECORD written (790). If ERR-CRITICAL, performs 9990-END-ROUTINE (795-796). No conditions beyond critical check.",
      "called_by": [
        "1100-OPEN-REQUEST-QUEUE",
        "3100-READ-REQUEST-MQ",
        "5100-READ-XREF-RECORD",
        "5200-READ-ACCT-RECORD",
        "5300-READ-CUST-RECORD",
        "5500-READ-AUTH-SUMMRY",
        "6000-MAKE-DECISION",
        "7100-SEND-RESPONSE",
        "8400-UPDATE-SUMMARY",
        "8500-INSERT-AUTH",
        "9100-CLOSE-REQUEST-QUEUE"
      ],
      "calls": [
        "9990-END-ROUTINE"
      ],
      "citation": [
        770,
        800
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-END-ROUTINE",
      "summary": null,
      "purpose": "The 9990-END-ROUTINE paragraph serves as the primary termination handler for the COPAUA0C CICS program, ensuring orderly shutdown before returning control to CICS (lines 7-16). It consumes no explicit inputs or data within its scope, relying instead on the global program state, working storage variables, and any resources opened earlier in the execution flow. Its sole output is the implicit effects of cleanup actions and the termination of the transaction via CICS RETURN, with no files or variables written directly here. There is no business logic, conditions, or decisions implemented in this paragraph; it is a straightforward sequence of termination steps without validation or branching. Error handling is not performed within this paragraph; any errors would presumably be managed prior to reaching this point or within the called 9000-TERMINATE. It calls the 9000-TERMINATE paragraph (line 10) specifically to execute finalization tasks such as closing files, freeing CICS resources, or setting return codes, though the details of 9000-TERMINATE are not present in this chunk. Following the PERFORM, it executes the CICS RETURN (lines 12-13) to terminate the transaction and return control to the CICS region. Control then falls through to the 9990-EXIT label (line 15), which issues an EXIT statement (line 16) to return to the invoking paragraph, maintaining proper COBOL flow control.",
      "called_by": [],
      "calls": [
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        16
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-EXIT",
      "summary": null,
      "purpose": "The 9990-EXIT paragraph label and statement (lines 15-16) act as a flow control exit point at the end of 9990-END-ROUTINE, with no independent logic. It consumes no data and produces no outputs, serving solely to terminate the current paragraph's execution. No business logic, conditions, error handling, or calls are present. It is reached sequentially after the CICS RETURN in 9990-END-ROUTINE, allowing the program to exit cleanly back to its caller.",
      "called_by": [],
      "calls": [],
      "citation": [
        15,
        16
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS-RETURN-CODE not STATUS-OK ('  ', 'FW')",
      "action": "88 levels defined for SEGMENT-NOT-FOUND ('GE'), DUPLICATE-SEGMENT-FOUND ('II'), WRONG-PARENTAGE ('GP'), END-OF-DB ('GB'), DATABASE-UNAVAILABLE ('BA'), PSB-SCHEDULED-MORE-THAN-ONCE ('TC'), COULD-NOT-SCHEDULE-PSB ('TE'), RETRY-CONDITION ('BA','FH','TE')",
      "citation": [
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94
      ]
    },
    {
      "condition": "MQ COMPcode or Reason not zero",
      "action": "WS-COMPCODE, WS-REASON, WS-OPTIONS defined for MQ error handling",
      "citation": [
        58,
        59,
        57
      ]
    },
    {
      "condition": "MQOPEN COMPCode != MQCC-OK",
      "action": "Set critical ERR-MQ, log 'M001' 'REQ MQ OPEN ERROR' via 9500-LOG-ERROR",
      "citation": [
        57
      ]
    },
    {
      "condition": "DLI SCHD STATUS != OK",
      "action": "Set critical ERR-IMS, log 'I001' 'IMS SCHD FAILED' via 9500",
      "citation": [
        95
      ]
    },
    {
      "condition": "MQGET COMPCode != OK and REASON != NO-MSG",
      "action": "Set critical ERR-MQ, log 'M003' 'FAILED TO READ REQUEST MQ' via 9500",
      "citation": [
        202
      ]
    },
    {
      "condition": "CICS READ RESP NOT NORMAL or NOTFND",
      "action": "Warning or critical log via 9500 for xref/acct/cust",
      "citation": [
        274
      ]
    },
    {
      "condition": "DLI GU/REPL/ISRT STATUS != OK",
      "action": "Critical ERR-IMS log 'I002/I003/I004' via 9500",
      "citation": [
        414
      ]
    },
    {
      "condition": "MQPUT1 COMPCode != OK",
      "action": "Critical ERR-MQ 'M004' log via 9500",
      "citation": [
        554
      ]
    },
    {
      "condition": "MQCLOSE COMPCode != OK",
      "action": "Warning ERR-MQ 'M005' log via 9500",
      "citation": [
        750
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETRIEVE",
      "resource": "MQTM",
      "purpose": "Retrieve trigger message data for queue names",
      "citation": 20
    },
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "End CICS task after termination",
      "citation": 13
    },
    {
      "command": "READ DATASET",
      "resource": "WS-CCXREF-FILE",
      "purpose": "Read card xref VSAM record",
      "citation": 264
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Commit after each auth process",
      "citation": 122
    },
    {
      "command": "WRITEQ TD",
      "resource": "CSSL",
      "purpose": "Write error log record",
      "citation": 789
    },
    {
      "command": "ASKTIME",
      "resource": null,
      "purpose": "Get abstime for formatting timestamps in logs and details",
      "citation": 644
    }
  ],
  "open_questions": [
    {
      "question": "No PROCEDURE DIVISION provided in chunk 1/3",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Exact field names within copybooks unknown",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Initialization of queue names WS-REQUEST-QNAME and WS-REPLY-QNAME",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "File definitions (SELECT, FD, ASSIGN)",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Program invocation trigger",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Copybook and working storage definitions",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "9990-END-ROUTINE and 5600 profile logic",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Connection handles W01/02-HCONN and full MQ setup",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Transaction ID and entry point",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "What is the overall business purpose of COPAUA0C?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What does the 9000-TERMINATE paragraph do?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What are the data divisions, files, copybooks, and main processing paragraphs?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    }
  ]
}