{
  "header": {
    "program_id": "PAUDBUNL",
    "file_name": "cbl/PAUDBUNL.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-26T15:14:37.991980",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This IMS database unload program reads root segments named PAUTSUM0 (Pending Authorization Summary) from the PAUT database using unqualified GN calls and writes them to sequential file OPFILE1 if the PA-ACCT-ID is numeric. For each valid root segment, it reads dependent child segments PAUTDTL1 (Pending Authorization Details) using GNP calls and writes them to OPFILE2, prefixed with the root's PA-ACCT-ID as a packed key. Processing continues until the end of the database is reached (status 'GB'), with counters tracking records processed and errors causing abend.",
    "business_context": "Supports unloading of pending authorization data from IMS for archiving, migration, reporting, or offline batch processing in a financial or authorization system.",
    "program_type": "BATCH",
    "citations": [
      18,
      157,
      213,
      258
    ]
  },
  "inputs": [
    {
      "name": "PAUT IMS Database - PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Root segments containing Pending Authorization Summary data",
      "copybook": "CIPAUSMY",
      "citation": [
        213
      ]
    },
    {
      "name": "PAUT IMS Database - PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Child segments containing Pending Authorization Details data, dependent on root PAUTSUM0",
      "copybook": "CIPAUDTY",
      "citation": [
        258
      ]
    }
  ],
  "outputs": [
    {
      "name": "OPFILE1",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Sequential file containing copies of root PAUTSUM0 segments (PENDING-AUTH-SUMMARY records)",
      "copybook": null,
      "citation": [
        233
      ]
    },
    {
      "name": "OPFILE2",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Sequential file containing root PA-ACCT-ID as packed key followed by child PAUTDTL1 segments (PENDING-AUTH-DETAILS records)",
      "copybook": null,
      "citation": [
        271
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Root summary records and their child details are only written to output files if the PA-ACCT-ID field is numeric",
      "logic_summary": "Implemented via IF PA-ACCT-ID IS NUMERIC before WRITE and child processing loop",
      "conditions": [
        "PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        232
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID",
          "all fields in PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          213
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "all fields in PENDING-AUTH-DETAILS"
        ],
        "citation": [
          258
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "OPFILE1",
        "fields_written": [
          "OPFIL1-REC containing PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          233
        ]
      },
      {
        "destination": "OPFILE2",
        "fields_written": [
          "ROOT-SEG-KEY",
          "CHILD-SEG-REC containing PENDING-AUTH-DETAILS"
        ],
        "citation": [
          271
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Direct move from root segment field to packed COMP-3 key field in OPFILE2 record structure",
        "citation": [
          230
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS DL/I function codes such as FUNC-GN and FUNC-GNP used in CBLTDLI calls",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY root segment (PAUTSUM0)",
      "location": "WORKING_STORAGE",
      "citation": 139
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS child segment (PAUTDTL1)",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "Defines PCB masks and feedback areas for PAUT IMS database access",
      "location": "LINKAGE",
      "citation": 150
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This paragraph serves as the primary entry and orchestration point for the entire program flow. It defines an alternate ENTRY point named 'DLITCBL' that accepts the PAUTBPCB linkage structure for IMS PCB access (line 158). It begins by performing 1000-INITIALIZE to accept system dates, display startup information, and open output files OPFILE1 and OPFILE2, consuming no data but producing opened files and console messages. Following initialization, it enters a main processing loop that repeatedly performs 2000-FIND-NEXT-AUTH-SUMMARY until WS-END-OF-ROOT-SEG is set to 'Y', reading and unloading all root and child segments (lines 163-164). No direct business logic or decisions are made here; flow control relies on flags set by subordinate paragraphs. After the loop completes, it performs 4000-FILE-CLOSE to shut down output files (line 166). Error handling is delegated to called paragraphs, which abend on failures. It calls no external programs, only internal paragraphs for structured processing. Upon completion, it executes GOBACK to return to the caller with the final return code (line 170). Overall, it ensures sequential unload of the entire database hierarchy.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        157,
        170
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph is responsible for program initialization, preparing environment and resources before main processing. It consumes system date information by ACCEPTing CURRENT-DATE from DATE and CURRENT-YYDDD from DAY (lines 176-177). It produces console DISPLAY messages showing program start, date, and banners (lines 180-183). It then opens OPFILE1 as OUTPUT, checks WS-OUTFL1-STATUS for '00' or spaces, and abends via 9999-ABEND if invalid (lines 186-192). Similarly, it opens OPFILE2 and validates WS-OUTFL2-STATUS, abending on error (lines 194-200). No business logic or conditions beyond file status checks; validation is strict to ensure output readiness. No subordinate paragraphs or programs are called. Error handling is inline with DISPLAY of status and abend call. It initializes no working variables directly but relies on prior compiler defaults. Control passes to 1000-EXIT upon success.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        173,
        204
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph handles reading the next root segment (PAUTSUM0) from the IMS database and orchestrates writing it along with its children. It consumes IMS data via CALL 'CBLTDLI' using FUNC-GN, PAUTBPCB, PENDING-AUTH-SUMMARY IO-area, and ROOT-UNQUAL-SSA (lines 213-216). On success (PAUT-PCB-STATUS spaces), it increments read counters WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT (lines 225-226), moves the segment to OPFIL1-REC (227), initializes ROOT-SEG-KEY and CHILD-SEG-REC (228-229), and moves PA-ACCT-ID to ROOT-SEG-KEY (230). It then checks if PA-ACCT-ID IS NUMERIC; if yes, writes OPFIL1-REC (233) and performs 3000-FIND-NEXT-AUTH-DTL loop until WS-END-OF-CHILD-SEG='Y' to unload children (235-237). Business logic enforces numeric PA-ACCT-ID for processing to avoid invalid data writes. On 'GB' status, sets END-OF-AUTHDB and WS-END-OF-ROOT-SEG='Y' to exit loop (239-242). Other statuses trigger DISPLAY of error/KEYFB and 9999-ABEND (243-246). It calls IMS interface and subordinate 3000 paragraph for children. PCB status is initialized before call (212).",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3000-FIND-NEXT-AUTH-DTL",
        "9999-ABEND"
      ],
      "citation": [
        207,
        249
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph reads the next child segment (PAUTDTL1) dependent on the current root using GNP call. It consumes IMS data via CALL 'CBLTDLI' with FUNC-GNP, PAUTBPCB, PENDING-AUTH-DETAILS IO-area, and CHILD-UNQUAL-SSA (lines 257-260). On success (spaces), increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT counters (268-269; note potential counter mismatch for details), moves PENDING-AUTH-DETAILS to CHILD-SEG-REC (270), and writes OPFIL2-REC (271). Business logic is minimal, assuming valid parentage from GNP. On 'GE' status, sets WS-END-OF-CHILD-SEG='Y' to exit child loop and displays flag (273-277). Other statuses display error/KEYFB and perform 9999-ABEND (279-282). No further conditions or validations like numeric checks. It initializes PAUT-PCB-STATUS post-call (284). Called repeatedly from 2000 until end of children for current root. Produces child records in OPFILE2 keyed by root PA-ACCT-ID.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        253,
        286
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This paragraph performs cleanup by closing output files after all data unload. It consumes the opened OPFILE1 and OPFILE2, displaying 'CLOSING THE FILE' (290). It closes OPFILE1 and checks WS-OUTFL1-STATUS for '00'/spaces, displaying error if invalid but no abend (293-297). Similarly closes OPFILE2 and checks WS-OUTFL2-STATUS, displaying error if bad (298-304). No inputs or business logic; purely resource release. No decisions beyond status display. No calls to other paragraphs or programs. Error handling is soft (display only, no abend). Ensures files are properly closed before program exit. Control passes to 4000-EXIT.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        289,
        306
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This paragraph handles all program abends due to errors. It consumes no specific data but is triggered by file/IMS failures. It displays 'IMSUNLOD ABENDING ...' message (311). Sets RETURN-CODE to 16 (313) and executes GOBACK (314) to terminate abnormally. No business logic, inputs, or outputs beyond message and RC. No conditions checked here. Called from initialization opens (190,199), root IMS call (246), child IMS call (282). No subordinate calls. Provides consistent abend path with RC=16 across error scenarios.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        308,
        317
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "WS-OUTFL1-STATUS NOT = '00' or spaces on OPEN",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        190
      ]
    },
    {
      "condition": "WS-OUTFL2-STATUS NOT = '00' or spaces on OPEN",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        198
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = spaces or 'GB' on GN call",
      "action": "DISPLAY status and KEYFB, then PERFORM 9999-ABEND",
      "citation": [
        244
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = spaces or 'GE' on GNP call",
      "action": "DISPLAY status and KEYFB, then PERFORM 9999-ABEND",
      "citation": [
        280
      ]
    },
    {
      "condition": "WS-OUTFL1-STATUS NOT = '00' or spaces on CLOSE",
      "action": "DISPLAY error message (no abend)",
      "citation": [
        296
      ]
    },
    {
      "condition": "WS-OUTFL2-STATUS NOT = '00' or spaces on CLOSE",
      "action": "DISPLAY error message (no abend)",
      "citation": [
        303
      ]
    },
    {
      "condition": "Any abend triggered",
      "action": "Set RETURN-CODE=16 and GOBACK",
      "citation": [
        313
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact field layouts and contents of copybooks CIPAUSMY, CIPAUDTY, PAUTBPCB, and IMSFUNCS",
      "context": "Copybooks are referenced but source not provided, preventing field-level data flow details",
      "suggestion": "Provide copybook source files for analysis"
    },
    {
      "question": "Purpose and usage of counters like WS-NO-SUMRY-READ in child processing (lines 268-269)",
      "context": "Counters named for summary are incremented in detail processing, possible copy-paste error or misnomer",
      "suggestion": "Review runtime logs or developer notes for clarification"
    },
    {
      "question": "What calls this program (e.g., JCL or parent program using ENTRY 'DLITCBL')",
      "context": "No calling context in source; ENTRY suggests dynamic linkage",
      "suggestion": "Analyze JCL or parent programs"
    }
  ]
}