{
  "header": {
    "program_id": "PAUDBUNL",
    "file_name": "cbl/PAUDBUNL.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-26T17:37:56.675601",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This IMS batch unload program reads root segments (PAUTSUM0 Pending Authorization Summary) from the IMS database using GN calls and writes them to sequential file OPFILE1. For each root segment, it then reads child segments (PAUTDTL1 Pending Authorization Details) using GNP calls and writes them to OPFILE2, prefixed with the root account ID as ROOT-SEG-KEY. It continues until the end of the database (GB status) and handles errors by abending.",
    "business_context": "Supports unloading of pending authorization data from IMS database for archiving, migration, or offline processing.",
    "program_type": "BATCH",
    "citations": [
      18,
      157,
      161,
      163,
      207,
      213,
      253,
      257
    ]
  },
  "inputs": [
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary root segment from IMS database",
      "copybook": "CIPAUSMY",
      "citation": [
        213,
        215
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Details child segment from IMS database, qualified under root",
      "copybook": "CIPAUDTY",
      "citation": [
        257,
        259
      ]
    }
  ],
  "outputs": [
    {
      "name": "OPFILE1",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Contains copied root segments (Pending Authorization Summary records)",
      "copybook": "CIPAUSMY",
      "citation": [
        227,
        233
      ]
    },
    {
      "name": "OPFILE2",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Contains root segment key (PA-ACCT-ID) followed by child segments (Pending Authorization Details records)",
      "copybook": null,
      "citation": [
        230,
        270,
        271
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Only write root record and process children if PA-ACCT-ID is numeric",
      "logic_summary": "Checks PA-ACCT-ID IS NUMERIC before WRITE OPFILE1 and PERFORM child loop",
      "conditions": [
        "PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        232
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID"
        ],
        "citation": [
          230
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          270
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "OPFILE1",
        "fields_written": [
          "OPFIL1-REC"
        ],
        "citation": [
          233
        ]
      },
      {
        "destination": "OPFILE2",
        "fields_written": [
          "ROOT-SEG-KEY",
          "CHILD-SEG-REC"
        ],
        "citation": [
          271
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PENDING-AUTH-SUMMARY",
        "output_field": "OPFIL1-REC",
        "transformation_description": "Direct MOVE of entire root segment to output record",
        "citation": [
          227
        ]
      },
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Copies root account ID to prefix field for all child records under that root",
        "citation": [
          230
        ]
      },
      {
        "input_field": "PENDING-AUTH-DETAILS",
        "output_field": "CHILD-SEG-REC",
        "transformation_description": "Direct MOVE of entire child segment to output record (after root key)",
        "citation": [
          270
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS DL/I function codes such as FUNC-GN and FUNC-GNP",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY root segment",
      "location": "WORKING_STORAGE",
      "citation": 139
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS child segment",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "Defines IMS PCB masks for database access",
      "location": "LINKAGE",
      "citation": 150
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point and orchestration paragraph that controls the overall program flow. It begins with an ENTRY statement 'DLITCBL' using the PAUTBPCB linkage for IMS access. It first performs 1000-INITIALIZE to set up dates, displays, and open output files OPFILE1 and OPFILE2. After initialization, it enters a loop performing 2000-FIND-NEXT-AUTH-SUMMARY until WS-END-OF-ROOT-SEG is 'Y', processing each root segment and its children. Once the end of the database is reached, it performs 4000-FILE-CLOSE to shut down files. No explicit error handling here beyond subordinate paragraphs; it relies on abend in errors. It then GOBACKs with the final return code. No parameters consumed directly; relies on IMS PCB passed via linkage.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        157,
        170
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph handles program initialization including date acceptance and output file opens. It consumes system date via ACCEPT CURRENT-DATE FROM DATE and CURRENT-YYDDD FROM DAY. It displays startup messages and current date for logging. It then opens OPFILE1 and checks WS-OUTFL1-STATUS; if not spaces or '00', displays error and performs 9999-ABEND. Similarly opens OPFILE2 and checks WS-OUTFL2-STATUS with same error handling. Produces no data outputs but prepares files for writing. No business decisions beyond status validation. Error handling is immediate abend on open failure. No calls to other paragraphs.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        173,
        203
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph performs the root segment read loop using IMS GN call and orchestrates child processing. It initializes PAUT-PCB-STATUS, calls CBLTDLI with FUNC-GN, PAUTBPCB, PENDING-AUTH-SUMMARY IO area, and ROOT-UNQUAL-SSA. Consumes IMS root segments (PAUTSUM0). If PAUT-PCB-STATUS is spaces (success), increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT counters, moves segment to OPFIL1-REC. Sets ROOT-SEG-KEY from PA-ACCT-ID, and if PA-ACCT-ID numeric, writes to OPFILE1 and performs 3000-FIND-NEXT-AUTH-DTL loop until WS-END-OF-CHILD-SEG='Y'. If status 'GB', sets end flags for root and database. If other status, displays error and key feedback, then abends via 9999-ABEND. Business logic includes numeric check on account ID to avoid invalid writes. Produces root records in OPFILE1 and triggers child writes.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3000-FIND-NEXT-AUTH-DTL",
        "9999-ABEND"
      ],
      "citation": [
        207,
        249
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph reads child segments under the current root using IMS GNP call. It calls CBLTDLI with FUNC-GNP, PAUTBPCB, PENDING-AUTH-DETAILS IO area, and CHILD-UNQUAL-SSA. Consumes IMS child segments (PAUTDTL1). If PAUT-PCB-STATUS spaces (success), sets MORE-AUTHS flag, increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT (note: counters named for summary but used here), moves segment to CHILD-SEG-REC, and writes OPFIL2-REC (with pre-set ROOT-SEG-KEY). If 'GE' (segment not found), sets WS-END-OF-CHILD-SEG to 'Y' and displays flag. If other status, displays error and key feedback, then abends. Initializes PAUT-PCB-STATUS at end. No additional decisions; relies on GNP for parentage. Produces child records in OPFILE2 prefixed by root key. Error handling abends on unexpected IMS status.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        253,
        286
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This paragraph closes output files at program termination. It displays 'CLOSING THE FILE', then CLOSE OPFILE1 and checks WS-OUTFL1-STATUS; if not spaces or '00', displays error but does not abend. Similarly CLOSE OPFILE2 and checks WS-OUTFL2-STATUS with display on error. Consumes no inputs beyond file handles. Produces no data but ensures clean file closure. No business logic or decisions. Error handling limited to display without abend. No calls to other paragraphs.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        289,
        306
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This is the error termination paragraph invoked on any fatal error. It displays 'IMSUNLOD ABENDING ...' (note: program is PAUDBUNL but message references IMSUNLOD). Sets RETURN-CODE to 16. Then GOBACKs to caller. Consumes no specific data; triggered by PERFORM from error sites. Produces abend with RC 16. No conditions checked here. No validation or business logic. No subordinate calls.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        308,
        317
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "WS-OUTFL1-STATUS or WS-OUTFL2-STATUS NOT = '00' or SPACES on OPEN",
      "action": "DISPLAY error and PERFORM 9999-ABEND",
      "citation": [
        187,
        194
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = SPACES and NOT 'GB' on root GN",
      "action": "DISPLAY error and key feedback, PERFORM 9999-ABEND",
      "citation": [
        243
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = SPACES and NOT 'GE' on child GNP",
      "action": "DISPLAY error and key feedback, PERFORM 9999-ABEND",
      "citation": [
        279
      ]
    },
    {
      "condition": "File status error on CLOSE (display only)",
      "action": "DISPLAY error message",
      "citation": [
        293,
        300
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact contents and field layouts of copybooks CIPAUSMY, CIPAUDTY, PAUTBPCB, IMSFUNCS",
      "context": "Copybooks define segment layouts and PCB but source not provided",
      "suggestion": "Provide copybook source files for field-level analysis"
    },
    {
      "question": "Purpose of unused variables like WS-NO-CHKP, WS-EXPIRY-DAYS, WS-DAY-DIFF, PRM-INFO",
      "context": "Defined but never referenced in code",
      "suggestion": "Check for removed logic or future use"
    },
    {
      "question": "Why WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT incremented in child paragraph 3000",
      "context": "Counters named for summary but incremented on child success (lines 268-269)",
      "suggestion": "Possible copy-paste error; verify with runtime or requirements"
    },
    {
      "question": "IMS database name and full PSB details",
      "context": "PSB name commented as IMSUNLOD; PCB is PAUTBPCB",
      "suggestion": "Review IMS DLITCBL JCL or PSB source"
    }
  ]
}