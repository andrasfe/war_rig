{
  "header": {
    "program_id": "PAUDBUNL",
    "file_name": "PAUDBUNL.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-10T17:17:39.576155",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This COBOL program, named PAUDBUNL, unloads data from an IMS database related to pending authorizations and writes it to two sequential output files. It reads pending authorization summary segments (root) and pending authorization detail segments (child) from the IMS database and writes them to OPFILE1 and OPFILE2 respectively, if the PA-ACCT-ID is numeric.",
    "business_context": "This program is likely part of a larger system for managing and processing pending authorizations, potentially for financial transactions or access control.",
    "program_type": "BATCH",
    "citations": [
      18,
      213,
      271
    ]
  },
  "inputs": [
    {
      "name": "IMS Database (PAUTSUM0, PAUTDTL1)",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary (root segment PAUTSUM0) and Detail (child segment PAUTDTL1) segments from an IMS database.",
      "copybook": "CIPAUSMY, CIPAUDTY",
      "citation": [
        213,
        237
      ]
    },
    {
      "name": "PAUTBPCB",
      "io_type": "PARAMETER",
      "description": "PCB mask for IMS calls.",
      "copybook": "PAUTBPCB",
      "citation": [
        153,
        158
      ]
    }
  ],
  "outputs": [
    {
      "name": "OPFILE1",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Contains pending authorization summary records (root segments) extracted from the IMS database.",
      "copybook": null,
      "citation": [
        233
      ]
    },
    {
      "name": "OPFILE2",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Contains pending authorization detail records (child segments) extracted from the IMS database.",
      "copybook": null,
      "citation": [
        271
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CBLTDLI",
      "call_type": "STATIC_CALL",
      "purpose": "Interface with IMS DL/I to retrieve database segments.",
      "parameters": [
        "FUNC-GN",
        "PAUTBPCB",
        "PENDING-AUTH-SUMMARY",
        "ROOT-UNQUAL-SSA"
      ],
      "citation": 213
    },
    {
      "program_name": "CBLTDLI",
      "call_type": "STATIC_CALL",
      "purpose": "Interface with IMS DL/I to retrieve database segments.",
      "parameters": [
        "FUNC-GNP",
        "PAUTBPCB",
        "PENDING-AUTH-DETAILS",
        "CHILD-UNQUAL-SSA"
      ],
      "citation": 237
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Only write the summary and detail records to the output files if the account ID (PA-ACCT-ID) is numeric.",
      "logic_summary": "The program checks if PA-ACCT-ID is numeric before writing to OPFILE1 and triggering the detail record extraction.",
      "conditions": [
        "IF PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        232,
        233,
        235
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "IMS Database (PAUTSUM0)",
        "fields_used": [
          "PA-ACCT-ID",
          "PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          213,
          230
        ]
      },
      {
        "source": "IMS Database (PAUTDTL1)",
        "fields_used": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          237,
          270
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "OPFILE1",
        "fields_written": [
          "OPFIL1-REC"
        ],
        "citation": [
          233
        ]
      },
      {
        "destination": "OPFILE2",
        "fields_written": [
          "OPFIL2-REC",
          "ROOT-SEG-KEY",
          "CHILD-SEG-REC"
        ],
        "citation": [
          271
        ]
      }
    ],
    "transforms": []
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Contains definitions for IMS function codes used in DL/I calls.",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines the layout of the PENDING-AUTH-SUMMARY segment (root segment).",
      "location": "WORKING_STORAGE",
      "citation": 103
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines the layout of the PENDING-AUTH-DETAILS segment (child segment).",
      "location": "WORKING_STORAGE",
      "citation": 107
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "Defines the PCB mask used for IMS calls.",
      "location": "LINKAGE",
      "citation": 114
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the main control paragraph of the PAUDBUNL program. It orchestrates the entire process of unloading data from the IMS database and writing it to sequential files. It first calls 1000-INITIALIZE to perform initial setup tasks such as accepting the current date and opening the output files (OPFILE1 and OPFILE2). After initialization, it enters a loop that continues as long as WS-END-OF-ROOT-SEG is not set to 'Y'. Inside the loop, it repeatedly calls 2000-FIND-NEXT-AUTH-SUMMARY to retrieve the next pending authorization summary segment from the IMS database. Once all summary segments have been processed (WS-END-OF-ROOT-SEG = 'Y'), the paragraph calls 4000-FILE-CLOSE to close the output files. Finally, the program terminates using GOBACK.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        157,
        170
      ],
      "outgoing_calls": [
        {
          "target": "1000-INITIALIZE",
          "call_type": "performs",
          "line": 161
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 163
        },
        {
          "target": "4000-FILE-CLOSE",
          "call_type": "performs",
          "line": 166
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph performs the initialization tasks required before processing the IMS database. It accepts the current date and day from the system. It then displays the program name and current date to the console for logging purposes. The paragraph proceeds to open the two output files, OPFILE1 and OPFILE2, for writing. It checks the file status after each OPEN operation. If the file status is not spaces or '00', indicating a successful open, an error message is displayed, and the program abends by calling 9999-ABEND. This paragraph ensures that the output files are available before the program attempts to write data to them.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        173,
        200
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 199
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph retrieves the next pending authorization summary segment (root segment) from the IMS database. It first initializes the PAUT-PCB-STATUS field. Then, it calls the CBLTDLI routine with the FUNC-GN (Get Next) function code to retrieve the next summary segment. The parameters passed to CBLTDLI include the PCB mask (PAUTBPCB), the PENDING-AUTH-SUMMARY segment, and the ROOT-UNQUAL-SSA. After the IMS call, it checks the PAUT-PCB-STATUS. If the status is spaces (successful retrieval), it increments counters for summary records read and processed, moves the retrieved summary data to OPFIL1-REC, and extracts the account ID (PA-ACCT-ID) to ROOT-SEG-KEY. It then checks if the PA-ACCT-ID is numeric, and if so, writes the OPFIL1-REC to OPFILE1 and calls 3000-FIND-NEXT-AUTH-DTL to retrieve the child segments. If the PAUT-PCB-STATUS is 'GB' (end of database), it sets the END-OF-AUTHDB flag to TRUE and WS-END-OF-ROOT-SEG to 'Y'. If the status is anything else, it displays an error message and abends the program.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3000-FIND-NEXT-AUTH-DTL",
        "9999-ABEND"
      ],
      "citation": [
        202,
        247
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 213
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 235
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 246
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves the next pending authorization detail segment (child segment) from the IMS database for a given summary segment. It calls CBLTDLI with FUNC-GNP (Get Next within Parent) to retrieve the next detail segment. The parameters include PAUTBPCB, PENDING-AUTH-DETAILS, and CHILD-UNQUAL-SSA. After the call, it checks PAUT-PCB-STATUS. If the status is spaces, it sets MORE-AUTHS to TRUE, increments counters, moves the detail segment to CHILD-SEG-REC, and writes it to OPFILE2. If the status is 'GE' (end of segments for the current parent), it sets WS-END-OF-CHILD-SEG to 'Y'. If the status is anything else, it displays an error message and abends. Finally, it initializes PAUT-PCB-STATUS for the next iteration.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        253,
        284
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 257
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 282
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This paragraph closes the output files, OPFILE1 and OPFILE2. It displays a message indicating that the files are being closed. It then closes each file and checks the file status. If the file status is not spaces or '00' after closing, an error message is displayed to the console. This paragraph ensures that the output files are properly closed after all data has been written, preventing data loss or corruption.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        289,
        306
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This paragraph handles abnormal termination of the program. It displays a message indicating that the program is abending. It then sets the RETURN-CODE to 16, which signals an error condition to the calling environment. Finally, it terminates the program using GOBACK.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        308,
        317
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "WS-OUTFL1-STATUS not equal to SPACES or '00' during OPEN",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        190,
        191
      ]
    },
    {
      "condition": "WS-OUTFL2-STATUS not equal to SPACES or '00' during OPEN",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        198,
        199
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS not equal to SPACES or 'GB' after GN call",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        244,
        246
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS not equal to SPACES or 'GE' after GNP call",
      "action": "DISPLAY error message and PERFORM 9999-ABEND",
      "citation": [
        280,
        282
      ]
    },
    {
      "condition": "WS-OUTFL1-STATUS not equal to SPACES or '00' during CLOSE",
      "action": "DISPLAY error message",
      "citation": [
        296
      ]
    },
    {
      "condition": "WS-OUTFL2-STATUS not equal to SPACES or '00' during CLOSE",
      "action": "DISPLAY error message",
      "citation": [
        303
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "What is the purpose of the parameters in PRM-INFO?",
      "context": "The program contains a commented-out ACCEPT statement for PRM-INFO, suggesting it might have been intended to receive parameters from SYSIN, but it's not currently used. The meaning of P-EXPIRY-DAYS, P-CHKP-FREQ, P-CHKP-DIS-FREQ, and P-DEBUG-FLAG is unclear without further context.",
      "suggestion": "Review historical documentation or contact the original developers to understand the intended use of PRM-INFO."
    }
  ],
  "resolved_questions": [],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "1000-INITIALIZE",
      "inputs": [],
      "outputs": [
        "CURRENT-DATE",
        "CURRENT-YYDDD",
        "WS-OUTFL1-STATUS",
        "WS-OUTFL2-STATUS",
        "WS-END-OF-ROOT-SEG"
      ],
      "purpose": "Initializes the program by setting current date values and opening output files OPFILE1 and OPFILE2, with error handling for file open failures."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [],
      "outputs": [
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "OPFIL1-REC",
        "ROOT-SEG-KEY",
        "WS-END-OF-ROOT-SEG",
        "CHILD-SEG-REC"
      ],
      "purpose": "Reads the next authorization summary segment from IMS using a GU call, updates counters, writes to output file, and triggers detail processing if successful."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "4000-FILE-CLOSE",
      "inputs": [
        "WS-OUTFL1-STATUS",
        "WS-OUTFL2-STATUS"
      ],
      "outputs": [],
      "purpose": "Closes the output files OPFILE1 and OPFILE2 and displays error messages if the close operation fails based on file status codes."
    },
    {
      "caller": "1000-INITIALIZE",
      "callee": "9999-ABEND",
      "inputs": [
        "WS-OUTFL1-STATUS"
      ],
      "outputs": [],
      "purpose": "Terminates the program with return code 16 if an error occurs during the opening of OPFILE1."
    },
    {
      "caller": "1000-INITIALIZE",
      "callee": "9999-ABEND",
      "inputs": [
        "WS-OUTFL2-STATUS"
      ],
      "outputs": [],
      "purpose": "Terminates the program with return code 16 if an error occurs during the opening of OPFILE2."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [
        "PA-ACCT-ID",
        "WS-END-OF-CHILD-SEG"
      ],
      "outputs": [
        "WS-END-OF-CHILD-SEG",
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "CHILD-SEG-REC"
      ],
      "purpose": "Reads and processes child segments (authorization details) for the current root segment until no more child segments are found."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [
        "PAUT-PCB-STATUS",
        "PAUT-KEYFB"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Terminates the program with a return code of 16 when an unexpected IMS status code is encountered during root segment retrieval."
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [
        "PAUT-PCB-STATUS",
        "PAUT-KEYFB"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Terminates the program with a return code of 16 when an unexpected IMS status code is encountered during child segment retrieval."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: PAUDBUNL.CBL\n    1000_EXIT[\"1000-EXIT\"]\n    1000_INITIALIZE[\"1000-INITIALIZE\"]\n    9999_ABEND[\"9999-ABEND\"]\n    2000_EXIT[\"2000-EXIT\"]\n    2000_FIND_NEXT_AUTH_SUMMARY[\"2000-FIND-NEXT-AUTH-SUMMARY\"]\n    3000_FIND_NEXT_AUTH_DTL[\"3000-FIND-NEXT-AUTH-DTL\"]\n    CBLTDLI__ext([\"CBLTDLI\"])\n    3000_EXIT[\"3000-EXIT\"]\n    4000_EXIT[\"4000-EXIT\"]\n    4000_FILE_CLOSE[\"4000-FILE-CLOSE\"]\n    9999_EXIT[\"9999-EXIT\"]\n    MAIN_PARA[\"MAIN-PARA\"]\n    1000_INITIALIZE --> 9999_ABEND\n    2000_FIND_NEXT_AUTH_SUMMARY --> 3000_FIND_NEXT_AUTH_DTL\n    2000_FIND_NEXT_AUTH_SUMMARY --> 9999_ABEND\n    2000_FIND_NEXT_AUTH_SUMMARY -.->|calls| CBLTDLI__ext\n    3000_FIND_NEXT_AUTH_DTL --> 9999_ABEND\n    3000_FIND_NEXT_AUTH_DTL -.->|calls| CBLTDLI__ext\n    MAIN_PARA --> 1000_INITIALIZE\n    MAIN_PARA --> 2000_FIND_NEXT_AUTH_SUMMARY\n    MAIN_PARA --> 4000_FILE_CLOSE"
}