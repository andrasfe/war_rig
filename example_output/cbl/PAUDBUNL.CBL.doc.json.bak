{
  "header": {
    "program_id": "PAUDBUNL",
    "file_name": "cbl/PAUDBUNL.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-27T02:42:45.463999",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "PAUDBUNL is an IMS database unload utility that retrieves all PENDING-AUTH-SUMMARY root segments (PAUTSUM0) using unqualified GN calls and writes them directly to sequential file OPFILE1. For each root segment, it then retrieves dependent PENDING-AUTH-DETAILS child segments (PAUTDTL1) using unqualified GNP calls and writes them to OPFILE2 prefixed with the root segment's PA-ACCT-ID as ROOT-SEG-KEY. The process continues until the end of the database (status 'GB') is reached, with counters tracking records read and written.",
    "business_context": "Unloads pending authorization summary and detail data from IMS PAUT database for backup, migration, or offline processing.",
    "program_type": "BATCH",
    "citations": [
      18,
      157,
      212,
      227,
      230,
      256,
      271
    ]
  },
  "inputs": [
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "PENDING-AUTH-SUMMARY root segments from IMS PAUT database",
      "copybook": "CIPAUSMY",
      "citation": [
        212,
        223
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "PENDING-AUTH-DETAILS child segments dependent on PAUTSUM0 from IMS PAUT database",
      "copybook": "CIPAUDTY",
      "citation": [
        257,
        266
      ]
    }
  ],
  "outputs": [
    {
      "name": "OPFILE1",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Unloaded PENDING-AUTH-SUMMARY root segments copied directly from IMS",
      "copybook": null,
      "citation": [
        227,
        233
      ]
    },
    {
      "name": "OPFILE2",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Unloaded PENDING-AUTH-DETAILS child segments prefixed with root PA-ACCT-ID as ROOT-SEG-KEY",
      "copybook": null,
      "citation": [
        270,
        271
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Only process root segment if PA-ACCT-ID is numeric before writing to OPFILE1 and proceeding to children",
      "logic_summary": "Checks NUMERIC clause before WRITE and PERFORM 3000",
      "conditions": [
        "IF PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        232
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Abort program on any IMS PCB status other than spaces (success) or 'GB' (end of DB) during GN call",
      "logic_summary": "Displays error and performs 9999-ABEND",
      "conditions": [
        "PAUT-PCB-STATUS NOT = SPACES AND 'GB'"
      ],
      "citation": [
        243,
        244,
        246
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Abort program on any IMS PCB status other than spaces (success) or 'GE' (segment not found) during GNP call",
      "logic_summary": "Displays error and performs 9999-ABEND",
      "conditions": [
        "PAUT-PCB-STATUS NOT = SPACES AND 'GE'"
      ],
      "citation": [
        279,
        280,
        282
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID",
          "all PENDING-AUTH-SUMMARY fields"
        ],
        "citation": [
          212,
          230
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "all PENDING-AUTH-DETAILS fields"
        ],
        "citation": [
          257
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "OPFILE1",
        "fields_written": [
          "OPFIL1-REC (full PENDING-AUTH-SUMMARY)"
        ],
        "citation": [
          227,
          233
        ]
      },
      {
        "destination": "OPFILE2",
        "fields_written": [
          "ROOT-SEG-KEY (from PA-ACCT-ID)",
          "CHILD-SEG-REC (full PENDING-AUTH-DETAILS)"
        ],
        "citation": [
          230,
          270,
          271
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Direct move from root segment account ID to prefix field in child output record",
        "citation": [
          230
        ]
      },
      {
        "input_field": "PENDING-AUTH-SUMMARY",
        "output_field": "OPFIL1-REC",
        "transformation_description": "Direct move of entire root segment to output record",
        "citation": [
          227
        ]
      },
      {
        "input_field": "PENDING-AUTH-DETAILS",
        "output_field": "CHILD-SEG-REC",
        "transformation_description": "Direct move of entire child segment to output record portion",
        "citation": [
          270
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS DL/I function codes such as FUNC-GN and FUNC-GNP",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY root segment",
      "location": "WORKING_STORAGE",
      "citation": 139
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS child segment",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "Defines IMS PCB masks for PAUT database access including PAUT-PCB-STATUS and PAUT-SEG-LEVEL",
      "location": "LINKAGE",
      "citation": 150
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point paragraph that orchestrates the entire unload process and supports an alternate entry point 'DLITCBL' for potential dynamic invocation. It consumes no direct inputs but relies on the LINKAGE SECTION PAUTBPCB for IMS database access via the calling environment. It first performs 1000-INITIALIZE to open output files, initialize dates, and display startup messages. It then enters a loop performing 2000-FIND-NEXT-AUTH-SUMMARY until WS-END-OF-ROOT-SEG is set to 'Y', which handles reading and writing all root segments and their children. After the loop completes upon reaching end of database, it performs 4000-FILE-CLOSE to shut down files gracefully. No business decisions or validations are made here; it purely controls flow and delegates processing. Error handling is delegated to subordinate paragraphs which abend on failures. It produces no direct outputs but enables all file writes through performed paragraphs. Counters like WS-NO-SUMRY-READ are indirectly updated via calls.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        157,
        170
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This initialization paragraph sets up the program environment by accepting system dates into CURRENT-DATE and CURRENT-YYDDD, displaying startup information including program name and date. It opens output files OPFILE1 and OPFILE2 in OUTPUT mode, checking WS-OUTFL1-STATUS and WS-OUTFL2-STATUS after each OPEN. If file status is not spaces or '00', it displays the error and performs 9999-ABEND to terminate. It consumes no data inputs beyond system date but initializes WS variables implicitly. It produces open files ready for writes and display output to console. No business logic or IMS calls here; purely setup and validation of output files. Error handling is local: immediate abend on open failure. No paragraphs or programs called.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        173,
        203
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph handles retrieval and processing of each PENDING-AUTH-SUMMARY root segment using an IMS GN call with unqualified SSA ROOT-UNQUAL-SSA. It initializes PAUT-PCB-STATUS before the CBLTDLI call using FUNC-GN, PAUTBPCB, PENDING-AUTH-SUMMARY IO area, and SSA. On success (status spaces), it increments counters WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT, moves the segment to OPFIL1-REC, sets ROOT-SEG-KEY from PA-ACCT-ID, and writes to OPFILE1 if PA-ACCT-ID is numeric. It then initializes child flags and performs 3000-FIND-NEXT-AUTH-DTL in a loop until WS-END-OF-CHILD-SEG='Y' to unload dependents. On 'GB' status, sets end flags for root loop exit. On other statuses, displays error details including PAUT-KEYFB and abends via 9999-ABEND. Inputs are IMS database via PCB; outputs are writes to OPFILE1 and triggers child processing. Business logic enforces numeric PA-ACCT-ID before write and child loop.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3000-FIND-NEXT-AUTH-DTL",
        "9999-ABEND"
      ],
      "citation": [
        207,
        249
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves the next dependent PENDING-AUTH-DETAILS child segment for the current root using IMS GNP call with unqualified SSA CHILD-UNQUAL-SSA. It calls CBLTDLI using FUNC-GNP, PAUTBPCB, PENDING-AUTH-DETAILS IO area, and SSA. On success (spaces), increments WS-NO-DTL-READ (though counter add commented or mismatched), moves segment to CHILD-SEG-REC, and writes OPFIL2-REC. On 'GE' (no more segments), sets WS-END-OF-CHILD-SEG to 'Y' and displays flag. On other statuses, displays PAUT-PCB-STATUS and PAUT-KEYFB, then abends via 9999-ABEND. It initializes PAUT-PCB-STATUS at end for next call. Inputs from IMS child segments under current root; outputs writes to OPFILE2. Business logic: continues until no more children per root. Error handling: abend on unexpected IMS statuses.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        253,
        286
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This termination paragraph closes output files OPFILE1 and OPFILE2, displaying 'CLOSING THE FILE' message. It checks WS-OUTFL1-STATUS and WS-OUTFL2-STATUS after each CLOSE; if not spaces or '00', displays error but does not abend (unlike open). Inputs are the opened files; outputs are closed files and potential console messages. No business logic, IMS calls, or validations beyond status check. Error handling: displays close errors but continues. No subordinate calls.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        289,
        305
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This error termination paragraph displays 'IMSUNLOD ABENDING ...' (mismatched program name comment), sets RETURN-CODE to 16, and GOBACKs. It consumes error context from caller (e.g., status codes displayed prior). Produces abend with RC=16 and console message. No inputs read, no business logic, no validations. Handles all program errors by uniform abend. Called only on failures from other paragraphs.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [],
      "citation": [
        308,
        316
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "WS-OUTFL1-STATUS or WS-OUTFL2-STATUS NOT = '00' or spaces on OPEN",
      "action": "DISPLAY error and PERFORM 9999-ABEND",
      "citation": [
        187,
        195,
        190,
        198
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = spaces and NOT 'GB' after GN",
      "action": "DISPLAY status and KEYFB, PERFORM 9999-ABEND",
      "citation": [
        243,
        244,
        245,
        246
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT = spaces and NOT 'GE' after GNP",
      "action": "DISPLAY status and KEYFB, PERFORM 9999-ABEND",
      "citation": [
        279,
        280,
        281,
        282
      ]
    },
    {
      "condition": "WS-OUTFL1-STATUS or WS-OUTFL2-STATUS NOT = '00' or spaces on CLOSE",
      "action": "DISPLAY error message",
      "citation": [
        293,
        300,
        296,
        303
      ]
    },
    {
      "condition": "PA-ACCT-ID NOT NUMERIC",
      "action": "Skip WRITE OPFILE1 and child processing for that root",
      "citation": [
        232
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact field definitions in copybooks CIPAUSMY and CIPAUDTY",
      "context": "Copybooks are referenced but contents not provided in source",
      "suggestion": "Analyze copybook source files"
    },
    {
      "question": "Purpose of counters like WS-NO-CHKP, WS-NO-DTL-DELETED (initialized but not used)",
      "context": "Defined and zeroed but no increments or displays in provided code",
      "suggestion": "Check for commented code or related programs"
    },
    {
      "question": "IMS PSB name and full PCB details",
      "context": "PSB-NAME commented out; relies on PAUTBPCB linkage",
      "suggestion": "Review calling IMS batch job or DL/I region setup"
    }
  ],
  "dead_code": []
}