{
  "header": {
    "program_id": "COPAUA0C",
    "file_name": "cbl/COPAUA0C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG_MERGED",
    "analyzed_at": "2026-01-25T18:31:40.746201",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "CICS COBOL program for card authorization decisions in CardDemo application. Processes pending authorization requests from MQ queue, performs lookups in files and IMS database, determines approve/decline status. Sends authorization response to MQ reply queue.",
    "business_context": "Card authorization module handling transaction validation, balance checks, and fraud detection in a demo payment system",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      7,
      12,
      34,
      110,
      173,
      225,
      444,
      525
    ]
  },
  "inputs": [
    {
      "name": "WS-REQUEST-QNAME",
      "io_type": "OTHER",
      "description": "MQ request queue containing pending authorization requests",
      "copybook": "CCPAURQY",
      "citation": [
        43,
        103,
        177,
        178
      ]
    },
    {
      "name": "PAUT-PCB",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database segments for pending authorization summary and details via PSB PAUTB",
      "copybook": "CIPAUSMY",
      "citation": [
        81,
        82,
        84,
        192,
        193,
        196,
        197
      ]
    },
    {
      "name": "CCXREF",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference file",
      "copybook": "CVACT03Y",
      "citation": [
        39,
        72,
        202,
        203
      ]
    },
    {
      "name": "ACCTDAT",
      "io_type": "FILE_VSAM",
      "description": "Account master file",
      "copybook": "CVACT01Y",
      "citation": [
        35,
        128,
        205,
        206
      ]
    },
    {
      "name": "CUSTDAT",
      "io_type": "FILE_VSAM",
      "description": "Customer master file",
      "copybook": "CVCUS01Y",
      "citation": [
        36,
        131,
        208,
        209
      ]
    },
    {
      "name": "CARDDAT",
      "io_type": "FILE_VSAM",
      "description": "Card data file with alternate index CARDAIX",
      "copybook": null,
      "citation": [
        37,
        38
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "CICS linkage area for transaction data",
      "copybook": null,
      "citation": [
        214,
        215
      ]
    },
    {
      "name": "MQTM",
      "io_type": "CICS_COMMAREA",
      "description": "Trigger message containing request queue name (MQTM-QNAME) and trigger data (MQTM-TRIGGERDATA)",
      "copybook": "UNKNOWN (data definitions in header chunk)",
      "citation": [
        20,
        25
      ]
    },
    {
      "name": "WS-REQUEST-QNAME (MQ Request Queue)",
      "io_type": "OTHER",
      "description": "MQ messages with comma-delimited authorization request data: date, time, card num, auth type, expiry, msg type/source, processing code, transaction amt, merchant details, etc.",
      "copybook": "UNKNOWN (data definitions in header chunk)",
      "citation": [
        31,
        173,
        187
      ]
    },
    {
      "name": "WS-CCXREF-FILE",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference records keyed by card number (XREF-CARD-NUM)",
      "copybook": "CARD-XREF-RECORD",
      "citation": [
        262,
        265
      ]
    },
    {
      "name": "WS-ACCTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Account master records keyed by account ID (WS-CARD-RID-ACCT-ID-X)",
      "copybook": "ACCOUNT-RECORD",
      "citation": [
        310,
        313
      ]
    },
    {
      "name": "WS-CUSTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Customer master records keyed by customer ID (WS-CARD-RID-CUST-ID-X)",
      "copybook": "CUSTOMER-RECORD",
      "citation": [
        358,
        361
      ]
    },
    {
      "name": "PAUT-PCB-NUM (PAUTSUM0 segment)",
      "io_type": "IMS_SEGMENT",
      "description": "Pending auth summary segment qualified by account ID (ACCNTID)",
      "copybook": "PENDING-AUTH-SUMMARY",
      "citation": [
        406,
        408
      ]
    }
  ],
  "outputs": [
    {
      "name": "WS-REPLY-QNAME",
      "io_type": "OTHER",
      "description": "MQ reply queue for authorization responses",
      "copybook": "CCPAURLY",
      "citation": [
        44,
        108,
        180,
        182
      ]
    },
    {
      "name": "PAUT-PCB",
      "io_type": "IMS_SEGMENT",
      "description": "IMS updates to pending authorization summary and details segments",
      "copybook": "CIPAUSMY",
      "citation": [
        81,
        82,
        192,
        193
      ]
    },
    {
      "name": "ERROR-LOG",
      "io_type": "OTHER",
      "description": "Application error log records",
      "copybook": "CCPAUERY",
      "citation": [
        184,
        185
      ]
    },
    {
      "name": "WS-REPLY-QNAME (MQ Reply Queue)",
      "io_type": "OTHER",
      "description": "Comma-delimited response: card num, transaction ID, auth ID code, resp code (00/05), reason, approved amt",
      "copybook": null,
      "citation": [
        528,
        545
      ]
    },
    {
      "name": "CSSL",
      "io_type": "CICS_QUEUE",
      "description": "Error log records with location, codes, message, event key, etc.",
      "copybook": "ERROR-LOG-RECORD",
      "citation": [
        789
      ]
    },
    {
      "name": "PAUT-PCB-NUM (PAUTSUM0/PAUTDTL1 segments)",
      "io_type": "IMS_SEGMENT",
      "description": "Updated/inserted pending auth summary and details",
      "copybook": "PENDING-AUTH-SUMMARY / PENDING-AUTH-DETAILS",
      "citation": [
        612,
        700
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CP00"
    ],
    "linkage_section": [
      "DFHCOMMAREA",
      "LK-COMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Decline authorization if insufficient funds",
      "logic_summary": "Flag set based on available amount vs transaction amount comparison",
      "conditions": [
        "INSUFFICIENT-FUND 'I'"
      ],
      "citation": [
        62,
        64,
        141
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Decline if card not active",
      "logic_summary": "Check card status in lookups",
      "conditions": [
        "CARD-NOT-ACTIVE 'A'"
      ],
      "citation": [
        142
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Decline if account closed",
      "logic_summary": "Account status validation from master file",
      "conditions": [
        "ACCOUNT-CLOSED 'C'"
      ],
      "citation": [
        143
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Decline if card or merchant fraud detected",
      "logic_summary": "Fraud flags checked",
      "conditions": [
        "CARD-FRAUD 'F'",
        "MERCHANT-FRAUD 'M'"
      ],
      "citation": [
        144,
        145
      ]
    },
    {
      "rule_id": "BR005",
      "description": "Decline authorization if transaction amount exceeds available credit (credit limit minus balance) from pending auth summary if found, else from account master.",
      "logic_summary": "Compute WS-AVAILABLE-AMT and compare to WS-TRANSACTION-AMT; set DECLINE-AUTH and INSUFFICIENT-FUND if exceeded.",
      "conditions": [
        "FOUND-PAUT-SMRY-SEG",
        "FOUND-ACCT-IN-MSTR"
      ],
      "citation": [
        452,
        470
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Set authorization response code '00' for approve or '05' for decline; approved amt is transaction amt or 0.",
      "logic_summary": "If not DECLINE-AUTH, approve with full amt; else decline with 0 amt.",
      "conditions": [
        "DECLINE-AUTH"
      ],
      "citation": [
        472,
        483
      ]
    },
    {
      "rule_id": "BR007",
      "description": "Assign decline reason codes based on failure conditions: 3100 for not found records, 4100 insufficient funds, 4200/4300/5100/5200 for other statuses/fraud.",
      "logic_summary": "EVALUATE decline conditions to set PA-RL-AUTH-RESP-REASON.",
      "conditions": [
        "CARD-NFOUND-XREF",
        "INSUFFICIENT-FUND",
        "CARD-NOT-ACTIVE"
      ],
      "citation": [
        487,
        504
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "WS-REQUEST-QNAME",
        "fields_used": [
          "PENDING-AUTH-REQUEST fields"
        ],
        "citation": [
          177,
          178
        ]
      },
      {
        "source": "CCXREF",
        "fields_used": [
          "WS-XREF-RID",
          "WS-CARD-RID-CARDNUM",
          "WS-CARD-RID-CUST-ID",
          "WS-CARD-RID-ACCT-ID"
        ],
        "citation": [
          72,
          73,
          74,
          77,
          78
        ]
      },
      {
        "source": "ACCTDAT",
        "fields_used": [
          "Account data"
        ],
        "citation": [
          206
        ]
      },
      {
        "source": "WS-CCXREF-FILE",
        "fields_used": [
          "XREF-ACCT-ID",
          "XREF-CUST-ID"
        ],
        "citation": [
          262
        ]
      },
      {
        "source": "PAUT-PCB-NUM (PAUTSUM0)",
        "fields_used": [
          "PA-CREDIT-LIMIT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          406
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "WS-REPLY-QNAME",
        "fields_written": [
          "PENDING-AUTH-RESPONSE fields",
          "WS-RESP-CD",
          "WS-REAS-CD"
        ],
        "citation": [
          47,
          48,
          180,
          182
        ]
      },
      {
        "destination": "PAUT-PCB",
        "fields_written": [
          "PENDING-AUTH-SUMMARY",
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          192,
          196
        ]
      },
      {
        "destination": "PAUT-PCB-NUM (PAUTSUM0)",
        "fields_written": [
          "PA-APPROVED-AUTH-CNT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          597
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "WS-TRANSACTION-AMT-AN",
        "output_field": "WS-TRANSACTION-AMT",
        "transformation_description": "Alphanumeric transaction amount converted to numeric",
        "citation": [
          63,
          64
        ]
      },
      {
        "input_field": "WS-APPROVED-AMT",
        "output_field": "WS-APPROVED-AMT-DIS",
        "transformation_description": "Approved amount formatted for display",
        "citation": [
          65,
          66
        ]
      },
      {
        "input_field": "WS-CARD-RID-CUST-ID",
        "output_field": "WS-CARD-RID-CUST-ID-X",
        "transformation_description": "Numeric customer ID redefined as alphanumeric",
        "citation": [
          74,
          76
        ]
      },
      {
        "input_field": "W01-GET-BUFFER",
        "output_field": "PA-RQ-CARD-NUM / PA-RQ-TRANSACTION-AMT-AN etc.",
        "transformation_description": "UNSTRING comma-delimited buffer into request fields; NUMVAL on amt string to numeric.",
        "citation": [
          141
        ]
      },
      {
        "input_field": "PA-RQ-TRANSACTION-AMT",
        "output_field": "WS-APPROVED-AMT / PA-RL-APPROVED-AMT",
        "transformation_description": "Copy transaction amt to approved amt if approved, else 0.",
        "citation": [
          481
        ]
      },
      {
        "input_field": "PA-RL-* fields",
        "output_field": "W02-PUT-BUFFER",
        "transformation_description": "STRING response fields delimited by comma into buffer.",
        "citation": [
          509
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CMQODV",
      "purpose": "MQ object descriptor for request and reply",
      "location": "WORKING_STORAGE",
      "citation": 149
    },
    {
      "copybook_name": "CMQMDV",
      "purpose": "MQ message descriptor for request and reply",
      "location": "WORKING_STORAGE",
      "citation": 152
    },
    {
      "copybook_name": "CMQV",
      "purpose": "MQ constants",
      "location": "WORKING_STORAGE",
      "citation": 161
    },
    {
      "copybook_name": "CMQTML",
      "purpose": "MQ trigger message layout",
      "location": "WORKING_STORAGE",
      "citation": 164
    },
    {
      "copybook_name": "CMQPMOV",
      "purpose": "MQ put message options",
      "location": "WORKING_STORAGE",
      "citation": 167
    },
    {
      "copybook_name": "CMQGMOV",
      "purpose": "MQ get message options",
      "location": "WORKING_STORAGE",
      "citation": 170
    },
    {
      "copybook_name": "CCPAURQY",
      "purpose": "Pending authorization request layout",
      "location": "WORKING_STORAGE",
      "citation": 178
    },
    {
      "copybook_name": "CCPAURLY",
      "purpose": "Pending authorization response layout",
      "location": "WORKING_STORAGE",
      "citation": 182
    },
    {
      "copybook_name": "CCPAUERY",
      "purpose": "Application error log layout",
      "location": "WORKING_STORAGE",
      "citation": 185
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "IMS pending authorization summary segment (root)",
      "location": "WORKING_STORAGE",
      "citation": 193
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "IMS pending authorization details segment (child)",
      "location": "WORKING_STORAGE",
      "citation": 197
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "Card XREF layout",
      "location": "WORKING_STORAGE",
      "citation": 203
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "Account record layout",
      "location": "WORKING_STORAGE",
      "citation": 206
    },
    {
      "copybook_name": "CVCUS01Y",
      "purpose": "Customer layout",
      "location": "WORKING_STORAGE",
      "citation": 209
    },
    {
      "copybook_name": "CARD-XREF-RECORD",
      "purpose": "Defines card cross-reference record layout including XREF-CARD-NUM, XREF-ACCT-ID, XREF-CUST-ID",
      "location": "UNKNOWN (data definitions in header chunk)",
      "citation": 266
    },
    {
      "copybook_name": "ACCOUNT-RECORD",
      "purpose": "Defines account master record layout including ACCT-CREDIT-LIMIT, ACCT-CURR-BAL",
      "location": "UNKNOWN (data definitions in header chunk)",
      "citation": 317
    },
    {
      "copybook_name": "CUSTOMER-RECORD",
      "purpose": "Defines customer master record layout",
      "location": "UNKNOWN (data definitions in header chunk)",
      "citation": 365
    },
    {
      "copybook_name": "PENDING-AUTH-SUMMARY",
      "purpose": "Defines IMS PAUTSUM0 segment layout for pending auth summary: limits, balances, counts",
      "location": "UNKNOWN (data definitions in header chunk)",
      "citation": 409
    },
    {
      "copybook_name": "ERROR-LOG-RECORD",
      "purpose": "Defines error log record for transient queue",
      "location": "UNKNOWN (data definitions in header chunk)",
      "citation": 790
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "Main control: initialize, process loop, terminate, CICS RETURN",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-MAIN-PROCESS",
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        15
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "Retrieve commarea for queue info, set wait interval, open request queue, read first MQ msg",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "1100-OPEN-REQUEST-QUEUE",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        17,
        37
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-MAIN-PROCESS",
      "summary": null,
      "purpose": "Loop: extract msg, process auth, syncpoint, read next until limit or no more msgs",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "2100-EXTRACT-REQUEST-MSG",
        "5000-PROCESS-AUTH",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        110,
        135
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5000-PROCESS-AUTH",
      "summary": null,
      "purpose": "Read xref/acct/cust/summary/profile (stub), make decision, send response, write to DB if xref found",
      "called_by": [
        "2000-MAIN-PROCESS"
      ],
      "calls": [
        "1200-SCHEDULE-PSB",
        "5100-READ-XREF-RECORD",
        "6000-MAKE-DECISION",
        "7100-SEND-RESPONSE",
        "8000-WRITE-AUTH-TO-DB"
      ],
      "citation": [
        225,
        256
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "6000-MAKE-DECISION",
      "summary": null,
      "purpose": "Apply limit check rule, set approve/decline resp code/reason, build response string",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        444,
        522
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9000-TERMINATE",
      "summary": null,
      "purpose": "TERM IMS PSB if scheduled, close request queue",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9100-CLOSE-REQUEST-QUEUE"
      ],
      "citation": [
        727,
        738
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9500-LOG-ERROR",
      "summary": null,
      "purpose": "Format timestamp, populate error record, WRITEQ to CSSL, abend if critical",
      "called_by": [
        "1100-OPEN-REQUEST-QUEUE",
        "5100-READ-XREF-RECORD"
      ],
      "calls": [
        "9990-END-ROUTINE"
      ],
      "citation": [
        770,
        800
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-END-ROUTINE",
      "summary": null,
      "purpose": "Handles program termination by performing 9000-TERMINATE and executing CICS RETURN",
      "called_by": [],
      "calls": [
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        14
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-EXIT",
      "summary": null,
      "purpose": "Provides EXIT statement at end of 9990-END-ROUTINE",
      "called_by": [],
      "calls": [],
      "citation": [
        15,
        16
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS STATUS 'GE'",
      "action": "Segment not found handling",
      "citation": [
        87
      ]
    },
    {
      "condition": "IMS STATUS 'II'",
      "action": "Duplicate segment found handling",
      "citation": [
        88
      ]
    },
    {
      "condition": "IMS STATUS 'GP'",
      "action": "Wrong parentage handling",
      "citation": [
        89
      ]
    },
    {
      "condition": "IMS STATUS 'GB'",
      "action": "End of database handling",
      "citation": [
        90
      ]
    },
    {
      "condition": "IMS STATUS 'BA'",
      "action": "Database unavailable or retry condition",
      "citation": [
        91,
        94
      ]
    },
    {
      "condition": "WS-COMPCODE NOT = MQCC-OK after MQOPEN",
      "action": "Set error flags, log 'REQ MQ OPEN ERROR' via 9500-LOG-ERROR",
      "citation": [
        57
      ]
    },
    {
      "condition": "WS-RESP-CD NOT NORMAL/NOTFND after CICS READ VSAM",
      "action": "Set flags (FOUND/NFOUND), log warning/error via 9500-LOG-ERROR",
      "citation": [
        274
      ]
    },
    {
      "condition": "DIBSTAT NOT STATUS-OK after IMS DLI",
      "action": "Set error flags, log via 9500-LOG-ERROR",
      "citation": [
        413
      ]
    },
    {
      "condition": "ERR-CRITICAL after log",
      "action": "PERFORM 9990-END-ROUTINE (likely abend)",
      "citation": [
        795
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "LINKAGE SECTION usage",
      "resource": "DFHCOMMAREA",
      "purpose": "Handles CICS transaction commarea",
      "citation": 214
    },
    {
      "command": "RETRIEVE",
      "resource": "MQTM",
      "purpose": "Retrieve trigger message from commarea for queue names",
      "citation": 20
    },
    {
      "command": "READ DATASET",
      "resource": "WS-CCXREF-FILE",
      "purpose": "Read card xref record",
      "citation": 265
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Commit after each auth process",
      "citation": 122
    },
    {
      "command": "ASKTIME / FORMATTIME",
      "resource": null,
      "purpose": "Get current timestamp for auth details and error logs",
      "citation": 644
    },
    {
      "command": "WRITEQ TD",
      "resource": "CSSL",
      "purpose": "Log errors to transient queue",
      "citation": 789
    },
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "Returns control to CICS to terminate the transaction",
      "citation": 12
    }
  ],
  "open_questions": [
    {
      "question": "Exact I/O operations (OPEN, READ, WRITE, MQ GET/PUT, IMS GU/GN/IS calls)",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Paragraphs and control flow (PERFORMs, GO TOs)",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "File definitions (SELECT, FD, file status keys)",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Called programs or subroutines",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Precise business logic implementation for rules",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Full data division and copybook layouts",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Details of 5600-READ-PROFILE-DATA",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "9990-END-ROUTINE implementation",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "MQ connection handle W01-HCONN-REQUEST initialization",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "What is the overall purpose of the COPAUA0C program?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What does the 9000-TERMINATE paragraph do?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What are the inputs, outputs, copybooks, and business rules?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    }
  ]
}