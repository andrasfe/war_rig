{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-10T17:07:16.901366",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "The COPAUS1C program is a CICS transaction that displays authorization details and allows users to mark authorizations as fraudulent. It receives input from a calling program via the COMMAREA, displays an authorization view screen (COPAU1A), and allows the user to page through authorizations or mark them as fraudulent.",
    "business_context": "This program is likely part of a fraud detection and prevention system, allowing users to review and flag potentially fraudulent authorization transactions.",
    "program_type": "ONLINE_CICS",
    "citations": [
      1,
      23,
      34
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area passed from the calling program, containing account ID, authorization key, and other context information.",
      "copybook": null,
      "citation": [
        17,
        50
      ]
    },
    {
      "name": "COPAU1AI",
      "io_type": "CICS_MAP",
      "description": "Input map structure received from the CICS terminal user, containing screen input values.",
      "copybook": null,
      "citation": [
        248
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1AO",
      "io_type": "CICS_MAP",
      "description": "Output map structure sent to the CICS terminal user, containing authorization details and screen display information.",
      "copybook": null,
      "citation": [
        229,
        237
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area passed back to the calling program, containing updated context information.",
      "copybook": null,
      "citation": [
        50
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Transfers control back to the calling program.",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 214
    },
    {
      "program_name": "WS-PGM-AUTH-FRAUD",
      "call_type": "CICS_LINK",
      "purpose": "Links to a program to handle fraud processing.",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 95
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": []
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "If the account ID is numeric and an authorization is selected, read the authorization record.",
      "logic_summary": "Checks if CDEMO-ACCT-ID is numeric and CDEMO-CPVD-PAU-SELECTED is not spaces or low-values before reading the authorization record.",
      "conditions": [
        "CDEMO-ACCT-ID IS NUMERIC",
        "CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        57,
        58,
        62
      ]
    },
    {
      "rule_id": "BR002",
      "description": "If the user presses PF5, mark the authorization as fraudulent.",
      "logic_summary": "Evaluates EIBAID for DFHPF5, then performs MARK-AUTH-FRAUD to update fraud indicators.",
      "conditions": [
        "EIBAID = DFHPF5"
      ],
      "citation": [
        33,
        34
      ]
    },
    {
      "rule_id": "BR003",
      "description": "If the user presses PF8, page to the next authorization record.",
      "logic_summary": "Evaluates EIBAID for DFHPF8, then performs PROCESS-PF8-KEY to read the next authorization record.",
      "conditions": [
        "EIBAID = DFHPF8"
      ],
      "citation": [
        36,
        37
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-ACCT-ID",
          "CDEMO-CPVD-PAU-SELECTED"
        ],
        "citation": [
          57,
          59,
          60
        ]
      },
      {
        "source": "PA-AUTHORIZATION-RECORD",
        "fields_used": [
          "PA-CARD-NUM",
          "PA-AUTH-ORIG-DATE",
          "PA-AUTH-ORIG-TIME",
          "PA-APPROVED-AMT",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-PROCESSING-CODE",
          "PA-POS-ENTRY-MODE",
          "PA-MESSAGE-SOURCE",
          "PA-MERCHANT-CATAGORY-CODE",
          "PA-CARD-EXPIRY-DATE",
          "PA-AUTH-TYPE",
          "PA-TRANSACTION-ID",
          "PA-MATCH-STATUS",
          "PA-FRAUD-CONFIRMED",
          "PA-FRAUD-REMOVED",
          "PA-AUTH-FRAUD",
          "PA-FRAUD-RPT-DATE",
          "PA-MERCHANT-NAME",
          "PA-MERCHANT-ID",
          "PA-MERCHANT-CITY",
          "PA-MERCHANT-STATE",
          "PA-MERCHANT-ZIP"
        ],
        "citation": [
          141,
          143,
          149,
          154,
          157,
          170,
          177,
          178,
          179,
          180,
          182,
          186,
          187,
          188,
          190,
          191,
          193,
          198,
          199,
          200,
          201,
          202
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHTMO",
          "AUTHAMTO",
          "AUTHRSPO",
          "AUTHRSNO",
          "AUTHCDO",
          "POSEMDO",
          "AUTHSRCO",
          "MCCCDO",
          "CRDEXPO",
          "AUTHTYPO",
          "TRNIDO",
          "AUTHMTCO",
          "AUTHFRDO",
          "MERNAMEO",
          "MERIDO",
          "MERCITYO",
          "MERSTO",
          "MERZIPO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO",
          "ERRMSGO"
        ],
        "citation": [
          141,
          147,
          152,
          155,
          158,
          167,
          171,
          177,
          178,
          179,
          180,
          182,
          186,
          187,
          188,
          191,
          198,
          199,
          200,
          201,
          202,
          257,
          258,
          259,
          260,
          266,
          272,
          222
        ]
      },
      {
        "destination": "CARDDEMO-COMMAREA",
        "fields_written": [
          "CDEMO-FROM-TRANID",
          "CDEMO-FROM-PROGRAM",
          "CDEMO-PGM-CONTEXT"
        ],
        "citation": [
          208,
          209,
          210
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Transforms the authorization original date into the output format. Extracts year, month, and day components and combines them into WS-CURDATE-MM-DD-YY.",
        "citation": [
          143,
          144,
          145,
          146,
          147
        ]
      },
      {
        "input_field": "PA-AUTH-ORIG-TIME",
        "output_field": "AUTHTMO",
        "transformation_description": "Transforms the authorization original time into the output format. Extracts hour, minute, and second components and combines them into WS-AUTH-TIME.",
        "citation": [
          149,
          150,
          151,
          152
        ]
      },
      {
        "input_field": "PA-APPROVED-AMT",
        "output_field": "AUTHAMTO",
        "transformation_description": "Moves the approved amount to the output field.",
        "citation": [
          154,
          155
        ]
      },
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURDATEO",
        "transformation_description": "Transforms the current date into the output format. Extracts month, day, and year components and combines them into WS-CURDATE-MM-DD-YY.",
        "citation": [
          255,
          262,
          263,
          264,
          266
        ]
      },
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURTIMEO",
        "transformation_description": "Transforms the current time into the output format. Extracts hours, minutes, and seconds components and combines them into WS-CURTIME-HH-MM-SS.",
        "citation": [
          255,
          268,
          269,
          270,
          272
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines the input and output map structures (COPAU1AI and COPAU1AO) for the CICS screen.",
      "location": "FILE_SECTION",
      "citation": 228
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "COPAUS1C",
      "summary": null,
      "purpose": "This is the program ID declaration. It does not contain any executable code. It simply identifies the program as COPAUS1C. This paragraph serves as a placeholder and does not perform any specific function in the program's execution. It is a required element in COBOL programs but does not contribute to the program's logic or data processing. It is not called by any other paragraphs and does not call any other paragraphs. It does not handle any errors or perform any validation.",
      "called_by": [],
      "calls": [],
      "citation": [
        1,
        1
      ],
      "outgoing_calls": [
        {
          "target": "COCOM01Y",
          "call_type": "includes",
          "line": 109
        },
        {
          "target": "COPAU01",
          "call_type": "includes",
          "line": 122
        },
        {
          "target": "COTTL01Y",
          "call_type": "includes",
          "line": 126
        },
        {
          "target": "CSDAT01Y",
          "call_type": "includes",
          "line": 129
        },
        {
          "target": "CSMSG01Y",
          "call_type": "includes",
          "line": 132
        },
        {
          "target": "CSMSG02Y",
          "call_type": "includes",
          "line": 135
        },
        {
          "target": "CIPAUSMY",
          "call_type": "includes",
          "line": 142
        },
        {
          "target": "CIPAUDTY",
          "call_type": "includes",
          "line": 146
        },
        {
          "target": "DFHAID",
          "call_type": "includes",
          "line": 148
        },
        {
          "target": "DFHBMSCA",
          "call_type": "includes",
          "line": 149
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This paragraph is the main control flow for the CICS transaction. It first initializes the error flag and message fields. It then checks if the COMMAREA length (EIBCALEN) is zero, indicating a first-time call. If so, it initializes the CARDDEMO-COMMAREA, sets the CDEMO-TO-PROGRAM field, and performs RETURN-TO-PREV-SCREEN to return to the calling program. Otherwise, it moves the DFHCOMMAREA to CARDDEMO-COMMAREA and checks if the program is re-entering. If not, it sets the CDEMO-PGM-REENTER flag and performs PROCESS-ENTER-KEY and SEND-AUTHVIEW-SCREEN. If re-entering, it performs RECEIVE-AUTHVIEW-SCREEN and then evaluates the EIBAID to determine the user's action (ENTER, PF3, PF5, PF8, or other). Based on the EIBAID, it performs different actions, such as processing the enter key, returning to the previous screen, marking authorization as fraud, or paging to the next authorization. Finally, it executes a CICS RETURN command to return control to CICS with the updated COMMAREA.",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "citation": [
        3,
        52
      ],
      "outgoing_calls": [
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 169
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 175
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 177
        },
        {
          "target": "RECEIVE-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 179
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 182
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 183
        },
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 186
        },
        {
          "target": "MARK-AUTH-FRAUD",
          "call_type": "performs",
          "line": 188
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 189
        },
        {
          "target": "PROCESS-PF8-KEY",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 192
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 194
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 197
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph processes the user's input when the ENTER key is pressed. It first initializes the COPAU1AO map. It then checks if the account ID (CDEMO-ACCT-ID) is numeric and an authorization is selected (CDEMO-CPVD-PAU-SELECTED). If both conditions are met, it moves the account ID and authorization key to working storage variables (WS-ACCT-ID and WS-AUTH-KEY) and performs READ-AUTH-RECORD to retrieve the authorization details. If IMS-PSB-SCHD is set, it performs TAKE-SYNCPOINT. If either condition is not met, it sets the error flag. Finally, it performs POPULATE-AUTH-DETAILS to populate the screen fields with the retrieved authorization details.",
      "called_by": [],
      "calls": [
        "READ-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        54,
        74
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 216
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 220
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 227
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "This paragraph handles the logic for marking an authorization as fraudulent when the user presses PF5. It moves the account ID and authorization key to working storage variables. It then performs READ-AUTH-RECORD to retrieve the authorization details. It checks if the authorization is already marked as fraud confirmed. If so, it sets flags to remove the fraud indicator; otherwise, it sets flags to confirm the fraud. It then moves pending authorization details and customer information to the WS-FRAUD-DATA area and links to the WS-PGM-AUTH-FRAUD program to update the fraud information. After the link, it checks the EIBRESP for normal completion. If normal, it checks if the fraud update was successful. If successful, it performs UPDATE-AUTH-DETAILS; otherwise, it moves an error message to WS-MESSAGE and performs ROLL-BACK. If the EIBRESP is not normal, it performs ROLL-BACK. Finally, it moves the authorization key to CDEMO-CPVD-PAU-SELECTED and performs POPULATE-AUTH-DETAILS to refresh the screen.",
      "called_by": [],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        76,
        112
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 234
        },
        {
          "target": "UPDATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 255
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 258
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 261
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 265
        },
        {
          "target": "WS-PGM-AUTH-FRAUD",
          "call_type": "calls",
          "line": 248
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 188,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "This paragraph handles the logic for paging to the next authorization record when the user presses PF8. It moves the account ID and authorization key to working storage variables. It then performs READ-AUTH-RECORD to retrieve the current authorization details and READ-NEXT-AUTH-RECORD to retrieve the next authorization details. If IMS-PSB-SCHD is set, it performs TAKE-SYNCPOINT. It checks if the end of the authorization list has been reached (AUTHS-EOF). If so, it sets a flag to prevent erasing the screen and moves a message to WS-MESSAGE. Otherwise, it moves the authorization key to CDEMO-CPVD-PAU-SELECTED and performs POPULATE-AUTH-DETAILS to display the next authorization details.",
      "called_by": [],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        114,
        135
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 273
        },
        {
          "target": "READ-NEXT-AUTH-RECORD",
          "call_type": "performs",
          "line": 274
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 278
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 287
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph populates the output map (COPAU1AO) with the authorization details retrieved from the PA-AUTHORIZATION-RECORD. It moves various fields from the PA-AUTHORIZATION-RECORD to the corresponding output fields in the map, including the card number, authorization date and time, approved amount, response code, decline reason, processing code, POS entry mode, message source, merchant category code, card expiry date, authorization type, transaction ID, match status, fraud information, and merchant details. It also handles formatting the authorization date and time. It searches the WS-DECLINE-REASON-TAB to find the description for the decline reason code. If the error flag is off, it populates the fields; otherwise, it skips the population. It also handles the fraud indicator display based on PA-FRAUD-CONFIRMED and PA-FRAUD-REMOVED flags.",
      "called_by": [],
      "calls": [],
      "citation": [
        137,
        204
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 227,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 265,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 287,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "This paragraph prepares to return control to the calling program. It moves the current transaction ID (WS-CICS-TRANID) and program ID (WS-PGM-AUTH-DTL) to the CARDDEMO-COMMAREA. It sets the program context to zeros and sets the CDEMO-PGM-ENTER flag to true. Finally, it executes a CICS XCTL command to transfer control to the program specified in CDEMO-TO-PROGRAM, passing the CARDDEMO-COMMAREA.",
      "called_by": [],
      "calls": [
        "CDEMO-TO-PROGRAM"
      ],
      "citation": [
        206,
        216
      ],
      "outgoing_calls": [
        {
          "target": "CDEMO-TO-PROGRAM",
          "call_type": "calls",
          "line": 367
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph sends the authorization view screen (COPAU1A) to the CICS terminal. It first performs POPULATE-HEADER-INFO to populate the header information on the screen. It then moves the message in WS-MESSAGE to the error message field (ERRMSGO) on the screen. It moves -1 to CARDNUML. It checks the SEND-ERASE-YES flag. If set, it executes a CICS SEND command with the ERASE option to clear the screen before sending the map. Otherwise, it executes a CICS SEND command without the ERASE option. The CURSOR option is used to position the cursor on the screen.",
      "called_by": [],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        218,
        241
      ],
      "outgoing_calls": [
        {
          "target": "POPULATE-HEADER-INFO",
          "call_type": "performs",
          "line": 375
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 177,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 461,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-NEXT-AUTH-RECORD",
          "line": 516,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 550,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "SCHEDULE-PSB",
          "line": 601,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph receives the input from the CICS terminal user. It executes a CICS RECEIVE command to receive the data from the COPAU1A map into the COPAU1AI structure. The NOHANDLE option is used to suppress CICS abend if an error occurs during the receive operation. The program will handle the error checking manually.",
      "called_by": [],
      "calls": [],
      "citation": [
        243,
        251
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 179,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "This paragraph populates the header information in the output map (COPAU1AO). It moves the current date and time to working storage variables. It moves the title fields (CCDA-TITLE01 and CCDA-TITLE02), transaction ID (WS-CICS-TRANID), and program name (WS-PGM-AUTH-DTL) to the corresponding output fields in the COPAU1AO map. It extracts the month, day, and year from the current date and moves them to working storage variables. It then moves the formatted date and time to the output fields in the COPAU1AO map.",
      "called_by": [],
      "calls": [],
      "citation": [
        253,
        273
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph retrieves authorization records from the IMS database. It first calls SCHEDULE-PSB to schedule the PSB required for IMS access. It then moves the account ID (WS-ACCT-ID) and authorization key (WS-AUTH-KEY) into the corresponding fields in the PAUTSUM0 segment. An IMS 'GU' (Get Unique) call is executed to retrieve the authorization summary based on the account ID. If the summary record is found, a 'GNP' (Get Next within Parent) call is made to retrieve the authorization details based on the authorization key. Error handling is performed by checking the DIBSTAT return code after each IMS call. If an error occurs, WS-ERR-FLG is set to 'Y', an error message is constructed, and SEND-AUTHVIEW-SCREEN is called to display the error. The paragraph sets AUTHS-EOF or AUTHS-NOT-EOF based on the DIBSTAT value. It calls SCHEDULE-PSB, SEND-AUTHVIEW-SCREEN.",
      "called_by": [],
      "calls": [
        "SCHEDULE-PSB",
        "SEND-AUTHVIEW-SCREEN",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        1,
        61
      ],
      "outgoing_calls": [
        {
          "target": "SCHEDULE-PSB",
          "call_type": "performs",
          "line": 433
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 461
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 487
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 216,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 234,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 273,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph retrieves the next authorization detail record from the IMS database. It executes an IMS 'GNP' (Get Next within Parent) call to retrieve the next PAUTDTL1 segment. The retrieved data is moved into the PENDING-AUTH-DETAILS area. Error handling is performed by checking the DIBSTAT return code after the IMS call. If an error occurs, WS-ERR-FLG is set to 'Y', an error message is constructed, and SEND-AUTHVIEW-SCREEN is called to display the error. The paragraph sets AUTHS-EOF or AUTHS-NOT-EOF based on the DIBSTAT value. It calls SEND-AUTHVIEW-SCREEN.",
      "called_by": [],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        63,
        88
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 516
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 274,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph updates the authorization details in the IMS database. It moves the fraud authorization record (WS-FRAUD-AUTH-RECORD) into the PENDING-AUTH-DETAILS area. An IMS 'REPL' (Replace) call is executed to update the PAUTDTL1 segment in the database. After the update, the DIBSTAT return code is checked. If the update is successful (STATUS-OK), TAKE-SYNCPOINT is called to commit the changes. A message indicating whether the authorization was marked or removed as fraudulent is moved to WS-MESSAGE. If an error occurs during the update, ROLL-BACK is called to undo the changes, WS-ERR-FLG is set to 'Y', an error message is constructed, and SEND-AUTHVIEW-SCREEN is called to display the error. It calls TAKE-SYNCPOINT, ROLL-BACK, SEND-AUTHVIEW-SCREEN.",
      "called_by": [],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        90,
        122
      ],
      "outgoing_calls": [
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 533
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 540
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 550
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 255,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "This paragraph issues a CICS SYNCPOINT command to commit changes to the IMS database. This ensures that all updates made are permanently saved. There are no specific inputs or outputs for this paragraph other than the implicit effect on the IMS database. No error handling is explicitly performed within this paragraph. It does not call any other paragraphs or programs. The primary purpose of this paragraph is to ensure data consistency and durability by committing the transaction.",
      "called_by": [],
      "calls": [],
      "citation": [
        124,
        127
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 220,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 278,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 533,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "This paragraph issues a CICS SYNCPOINT ROLLBACK command to undo any changes made to the IMS database since the last syncpoint. This is typically called when an error occurs during processing to ensure data integrity. There are no specific inputs or outputs for this paragraph other than the implicit effect on the IMS database. No explicit error handling is present within this paragraph. It does not call any other paragraphs or programs. The primary purpose is to revert the database to its previous consistent state in case of errors.",
      "called_by": [],
      "calls": [],
      "citation": [
        129,
        133
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 258,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 540,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "This paragraph schedules the Program Specification Block (PSB) required for accessing the IMS database. It first issues an IMS 'SCHD' command with the PSB name obtained from PSB-NAME. The NODHABEND option is specified to prevent abnormal termination. The DIBSTAT return code is checked. If the PSB has been scheduled more than once (PSB-SCHEDULED-MORE-THAN-ONCE), the PSB is terminated and then scheduled again. If the scheduling is successful (STATUS-OK), IMS-PSB-SCHD is set to TRUE. If an error occurs during scheduling, WS-ERR-FLG is set to 'Y', an error message is constructed, and SEND-AUTHVIEW-SCREEN is called to display the error. It calls SEND-AUTHVIEW-SCREEN.",
      "called_by": [],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        135,
        164
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 601
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "EIBRESP NOT = DFHRESP(NORMAL) after LINK to WS-PGM-AUTH-FRAUD",
      "action": "PERFORM ROLL-BACK",
      "citation": [
        99,
        107
      ]
    },
    {
      "condition": "WS-FRD-UPDT-SUCCESS is false after LINK to WS-PGM-AUTH-FRAUD",
      "action": "MOVE WS-FRD-ACT-MSG TO WS-MESSAGE and PERFORM ROLL-BACK",
      "citation": [
        100,
        103,
        104
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "Returns control to CICS.",
      "citation": 48
    },
    {
      "command": "XCTL",
      "resource": "CDEMO-TO-PROGRAM",
      "purpose": "Transfers control to another CICS program.",
      "citation": 214
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Sends the authorization view screen to the terminal.",
      "citation": 227
    },
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A",
      "purpose": "Receives data from the authorization view screen.",
      "citation": 246
    },
    {
      "command": "LINK",
      "resource": "WS-PGM-AUTH-FRAUD",
      "purpose": "Links to the fraud processing program.",
      "citation": 94
    }
  ],
  "open_questions": [
    {
      "question": "What is the purpose and structure of the PA-AUTHORIZATION-RECORD?",
      "context": "The code extensively uses fields from PA-AUTHORIZATION-RECORD, but its structure and source are not defined in the provided code snippet.",
      "suggestion": "Examine the copybooks or database schemas associated with this program to understand the structure and source of PA-AUTHORIZATION-RECORD."
    },
    {
      "question": "What is the purpose of the WS-FRAUD-DATA and the WS-PGM-AUTH-FRAUD program?",
      "context": "The code links to WS-PGM-AUTH-FRAUD with WS-FRAUD-DATA, but the details of this interaction are unclear.",
      "suggestion": "Examine the WS-PGM-AUTH-FRAUD program and the structure of WS-FRAUD-DATA to understand the fraud processing logic."
    },
    {
      "question": "What is the purpose of the TAKE-SYNCPOINT and ROLL-BACK paragraphs?",
      "context": "These paragraphs are called in error handling scenarios, but their exact implementation is not visible in the provided code.",
      "suggestion": "Examine the definitions of TAKE-SYNCPOINT and ROLL-BACK to understand their transaction management behavior."
    }
  ],
  "resolved_questions": [],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-CONTEXT",
        "CDEMO-PGM-ENTER"
      ],
      "purpose": "Returns control to the previous program using XCTL by setting commarea fields and transferring control."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "ERR-FLG",
        "COPAU1AO"
      ],
      "purpose": "Processes the ENTER key by validating input, setting up authorization key data, reading the authorization record, and populating details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES",
        "COPAU1AO"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the terminal, optionally erasing the screen first based on the send erase flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RECEIVE-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": "Receives data from the authorization view screen into the input map COPAU1AI without handling exceptions."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "ERR-FLG",
        "COPAU1AO"
      ],
      "purpose": "Processes the ENTER key by validating input, setting up authorization key data, reading the authorization record, and populating details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES",
        "COPAU1AO"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the user with optional erase based on flag and populates message field."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-CONTEXT",
        "CDEMO-PGM-ENTER"
      ],
      "purpose": "Transfers control back to the previous program using XCTL by setting return context in the COMMAREA."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "MARK-AUTH-FRAUD",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "CDEMO-CUST-ID",
        "PA-FRAUD-CONFIRMED",
        "PENDING-AUTH-DETAILS",
        "WS-PGM-AUTH-FRAUD"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-FRAUD-AUTH-RECORD",
        "WS-FRD-ACCT-ID",
        "WS-FRD-CUST-ID",
        "WS-FRD-ACT-MSG",
        "WS-MESSAGE",
        "CDEMO-CPVD-PAU-SELECTED",
        "WS-REMOVE-FRAUD",
        "WS-REPORT-FRAUD"
      ],
      "purpose": "Marks or unmarks an authorization as fraud by updating flags, linking to fraud processing, and refreshing the authorization details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES",
        "COPAU1AO"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the user with optional erase based on flag and populates message field."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-PF8-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "IMS-PSB-SCHD"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "SEND-ERASE-NO",
        "WS-MESSAGE",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "purpose": "Processes the PF8 key to navigate to the next authorization record and updates screen message if at end of file."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the terminal, optionally erasing the screen based on the flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-ERR-FLG"
      ],
      "purpose": "Processes the ENTER key by validating input and setting up account and authorization key for further processing."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the terminal, optionally erasing the screen based on the flag."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "IMS-RETURN-CODE",
        "WS-ERR-FLG",
        "WS-MESSAGE",
        "AUTHS-EOF"
      ],
      "purpose": "Reads the pending authorization summary and detail records from IMS using the account ID and authorization key."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS syncpoint to commit the current unit of work."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "ERR-FLG-ON",
        "ERR-FLG-OFF",
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "WS-DECLINE-REASON-TAB",
        "WS-DECL-RSN-IDX",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-AUTH-TIME",
        "WS-AUTH-AMT"
      ],
      "purpose": "Populates the authorization details screen with data from the PAUT segment and formatted working storage fields if no error flag is set."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "PENDING-AUTH-SUMMARY",
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Reads the authorization summary and detail records from IMS database using account ID and authorization key set in working storage."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "UPDATE-AUTH-DETAILS",
      "inputs": [
        "WS-FRAUD-AUTH-RECORD",
        "PA-FRAUD-RPT-DATE",
        "PA-FRAUD-REMOVED"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Updates the authorization details segment in IMS with fraud status changes and performs syncpoint or rollback based on success."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS rollback to undo database changes in case of an error during fraud update processing."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS rollback to undo database changes in case of an error during fraud update processing."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP",
        "ERR-FLG"
      ],
      "outputs": [
        "CARDNUMO",
        "WS-CURDATE-YY",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-AUTH-DATE",
        "AUTHDTO",
        "WS-AUTH-TIME",
        "AUTHTMO",
        "WS-AUTH-AMT",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Populates the authorization details screen fields using data from the current authorization record when no error is flagged."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "PENDING-AUTH-SUMMARY",
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Reads the authorization summary and detail records from IMS for the given account and authorization key."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-NEXT-AUTH-RECORD",
      "inputs": [],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Reads the next authorization detail record in sequence from the IMS database."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Commits the current unit of work by issuing a CICS syncpoint."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP",
        "ERR-FLG"
      ],
      "outputs": [
        "CARDNUMO",
        "WS-CURDATE-YY",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-AUTH-DATE",
        "AUTHDTO",
        "WS-AUTH-TIME",
        "AUTHTMO",
        "WS-AUTH-AMT",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Populates the authorization details screen fields using data from the current authorization record when no error is flagged."
    },
    {
      "caller": "SEND-AUTHVIEW-SCREEN",
      "callee": "POPULATE-HEADER-INFO",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL"
      ],
      "outputs": [],
      "purpose": "Populates the header information on the COPAU1A map with current date, time, program name, and transaction ID."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SCHEDULE-PSB",
      "inputs": [
        "PSB-NAME"
      ],
      "outputs": [
        "IMS-RETURN-CODE",
        "WS-ERR-FLG",
        "WS-IMS-PSB-SCHD-FLG"
      ],
      "purpose": "Schedules the IMS PSB for database access and handles errors if scheduling fails."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the COPAU1A screen to the user with an error message and header information when an IMS read error occurs."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the COPAU1A screen to the user with an error message and header information when an IMS read error occurs during detail record retrieval."
    },
    {
      "caller": "READ-NEXT-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the COPAU1A screen to the user with an error message and header information when an error occurs while reading the next authorization record."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Commits the current transaction unit of work to ensure data integrity after successfully updating an authorization detail in IMS."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Aborts the current transaction and rolls back all changes due to an error during the authorization update process."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends an error message to the terminal screen after a failure in fraud tagging, using the message stored in WS-MESSAGE and applying screen erase logic if SEND-ERASE-YES is set."
    },
    {
      "caller": "SCHEDULE-PSB",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Displays an error message on the terminal when PSB scheduling fails, using the message in WS-MESSAGE and respecting the SEND-ERASE-YES flag for screen rendering."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: COPAUS1C.cbl\n    MAIN_PARA[\"MAIN-PARA\"]\n    MARK_AUTH_FRAUD[\"MARK-AUTH-FRAUD\"]\n    PROCESS_ENTER_KEY[\"PROCESS-ENTER-KEY\"]\n    PROCESS_PF8_KEY[\"PROCESS-PF8-KEY\"]\n    RECEIVE_AUTHVIEW_SCREEN[\"RECEIVE-AUTHVIEW-SCREEN\"]\n    RETURN_TO_PREV_SCREEN[\"RETURN-TO-PREV-SCREEN\"]\n    SEND_AUTHVIEW_SCREEN[\"SEND-AUTHVIEW-SCREEN\"]\n    POPULATE_AUTH_DETAILS[\"POPULATE-AUTH-DETAILS\"]\n    READ_AUTH_RECORD[\"READ-AUTH-RECORD\"]\n    ROLL_BACK[\"ROLL-BACK\"]\n    UPDATE_AUTH_DETAILS[\"UPDATE-AUTH-DETAILS\"]\n    WS_PGM_AUTH_FRAUD__ext([\"WS-PGM-AUTH-FRAUD\"])\n    POPULATE_HEADER_INFO[\"POPULATE-HEADER-INFO\"]\n    TAKE_SYNCPOINT[\"TAKE-SYNCPOINT\"]\n    READ_NEXT_AUTH_RECORD[\"READ-NEXT-AUTH-RECORD\"]\n    SCHEDULE_PSB[\"SCHEDULE-PSB\"]\n    CDEMO_TO_PROGRAM__ext([\"CDEMO-TO-PROGRAM\"])\n    MAIN_PARA --> MARK_AUTH_FRAUD\n    MAIN_PARA --> PROCESS_ENTER_KEY\n    MAIN_PARA --> PROCESS_PF8_KEY\n    MAIN_PARA --> RECEIVE_AUTHVIEW_SCREEN\n    MAIN_PARA --> RETURN_TO_PREV_SCREEN\n    MAIN_PARA --> SEND_AUTHVIEW_SCREEN\n    MARK_AUTH_FRAUD --> POPULATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD --> READ_AUTH_RECORD\n    MARK_AUTH_FRAUD --> ROLL_BACK\n    MARK_AUTH_FRAUD --> UPDATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD -.->|calls| WS_PGM_AUTH_FRAUD__ext\n    PROCESS_ENTER_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_ENTER_KEY --> READ_AUTH_RECORD\n    PROCESS_ENTER_KEY --> TAKE_SYNCPOINT\n    PROCESS_PF8_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_PF8_KEY --> READ_AUTH_RECORD\n    PROCESS_PF8_KEY --> READ_NEXT_AUTH_RECORD\n    PROCESS_PF8_KEY --> TAKE_SYNCPOINT\n    READ_AUTH_RECORD --> SCHEDULE_PSB\n    READ_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    READ_NEXT_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    RETURN_TO_PREV_SCREEN -.->|calls| CDEMO_TO_PROGRAM__ext\n    SCHEDULE_PSB --> SEND_AUTHVIEW_SCREEN\n    SEND_AUTHVIEW_SCREEN --> POPULATE_HEADER_INFO\n    UPDATE_AUTH_DETAILS --> ROLL_BACK\n    UPDATE_AUTH_DETAILS --> SEND_AUTHVIEW_SCREEN\n    UPDATE_AUTH_DETAILS --> TAKE_SYNCPOINT"
}