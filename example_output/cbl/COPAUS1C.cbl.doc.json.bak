{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "cbl/COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-26T17:38:31.011392",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUS1C is a CICS online program that displays detailed views of pending authorization records from an IMS database for a specific account. It handles user interactions such as selecting an authorization for details, navigating to the next record with PF8, toggling fraud status via PF5, and returning to the summary screen with PF3. The program populates a BMS screen (COPAU1A) with authorization details, including formatted dates, amounts, decline reasons, and fraud indicators.",
    "business_context": "Part of CardDemo authorization module; provides detail view of authorization messages for account review, fraud management, and navigation in a banking/card processing system.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      157
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Common commarea containing account ID, selected PAU key, page info, fraud data from previous program; passed via DFHCOMMAREA",
      "copybook": "COCOM01Y, COPAU01",
      "citation": [
        109,
        110,
        122,
        171
      ]
    },
    {
      "name": "COPAU1AI",
      "io_type": "CICS_MAP",
      "description": "Input map data from BMS screen receive, including user-entered or selected authorization key and account ID",
      "copybook": "COPAU01",
      "citation": [
        400,
        401
      ]
    },
    {
      "name": "PAUT PCB",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database segments: PAUTSUM0 (root summary) qualified by ACCNTID, PAUTDTL1 (child details) qualified by PAUT9CTS=AUTH-KEY or GNP next",
      "copybook": "CIPAUSMY, CIPAUDTY",
      "citation": [
        439,
        465,
        495
      ]
    },
    {
      "name": "DFHAID",
      "io_type": "PARAMETER",
      "description": "CICS attention key identifier (EIBAID) for PF keys and ENTER",
      "copybook": "DFHAID",
      "citation": [
        148,
        180
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1AO",
      "io_type": "CICS_MAP",
      "description": "Output BMS map populated with auth details, header, error messages, sent to screen COPAU1A in mapset COPAU01",
      "copybook": "COPAU01",
      "citation": [
        377,
        382,
        390
      ]
    },
    {
      "name": "PENDING-AUTH-DETAILS",
      "io_type": "IMS_SEGMENT",
      "description": "Updated PAUTDTL1 segment after fraud toggle, replaced via DLI REPL",
      "copybook": "CIPAUDTY",
      "citation": [
        522,
        525
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea returned to caller or next program with current selected key, context",
      "copybook": "COCOM01Y, COPAU01",
      "citation": [
        204,
        367
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS0C",
      "call_type": "CICS_XCTL",
      "purpose": "Return control to authorization summary screen (previous program)",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 368
    },
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "Process fraud report or removal on the authorization record",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    }
  ],
  "calling_context": {
    "called_by": [
      "COPAUS0C"
    ],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Toggle fraud status on authorization: if already confirmed, remove fraud flag; else set fraud confirmed",
      "logic_summary": "Checks PA-FRAUD-CONFIRMED; sets flags and calls fraud program; updates segment if success",
      "conditions": [
        "IF PA-FRAUD-CONFIRMED",
        "ELSE"
      ],
      "citation": [
        236,
        237,
        240
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Display decline reason by looking up response reason code in table",
      "logic_summary": "SEARCH ALL table for matching DECL-CODE = PA-AUTH-RESP-REASON; format into AUTHRSNO",
      "conditions": [
        "SEARCH ALL ... WHEN DECL-CODE = PA-AUTH-RESP-REASON",
        "AT END"
      ],
      "citation": [
        319,
        324
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Validate input for numeric account ID and non-blank selected key before reading IMS",
      "logic_summary": "IF CDEMO-ACCT-ID NUMERIC AND CDEMO-CPVD-PAU-SELECTED NOT SPACES/LOW-VALUES",
      "conditions": [
        "CDEMO-ACCT-ID IS NUMERIC",
        "CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        211,
        212
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Response status display: 'A' green for '00', else 'D' red",
      "logic_summary": "IF PA-AUTH-RESP-CODE = '00' MOVE 'A' else 'D'",
      "conditions": [
        "PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        311
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "ACCNTID",
          "PA-AUTHORIZATION-KEY"
        ],
        "citation": [
          436,
          442
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PAUT9CTS",
          "PA-CARD-NUM",
          "PA-AUTH-ORIG-DATE",
          "PA-AUTH-ORIG-TIME",
          "PA-APPROVED-AMT",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-FRAUD-CONFIRMED"
        ],
        "citation": [
          468,
          292
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PAUTDTL1",
        "fields_written": [
          "PA-FRAUD-CONFIRMED",
          "PA-FRAUD-REMOVED",
          "PA-FRAUD-RPT-DATE"
        ],
        "citation": [
          522,
          525
        ]
      },
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHTMO",
          "AUTHAMTO",
          "AUTHRSPO",
          "AUTHRSNO"
        ],
        "citation": [
          295,
          377
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Reformat YYMMDD to MM/DD/YY using WS-CURDATE-MM-DD-YY",
        "citation": [
          297,
          300
        ]
      },
      {
        "input_field": "PA-AUTH-ORIG-TIME",
        "output_field": "AUTHTMO",
        "transformation_description": "Reformat HHMMSS to HH:MM:SS",
        "citation": [
          303,
          306
        ]
      },
      {
        "input_field": "PA-AUTH-RESP-REASON",
        "output_field": "AUTHRSNO",
        "transformation_description": "Lookup in WS-DECLINE-REASON-TAB, append DECL-DESC after '-'",
        "citation": [
          325,
          327
        ]
      },
      {
        "input_field": "PA-FRAUD-CONFIRMED",
        "output_field": "AUTHFRDO",
        "transformation_description": "If fraud flags set, format PA-AUTH-FRAUD + '-' + PA-FRAUD-RPT-DATE else '-'",
        "citation": [
          344,
          349
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines CARDDEMO-COMMAREA structure including CDEMO-CPVD-INFO for transaction/page/auth data",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines BMS maps COPAU1AI/O for authorization detail screen",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "IMS segment layout for PENDING-AUTH-SUMMARY (PAUTSUM0 root)",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "IMS segment layout for PENDING-AUTH-DETAILS (PAUTDTL1 child)",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Screen titles like CCDA-TITLE01/02",
      "location": "WORKING_STORAGE",
      "citation": 126
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Current date working variables WS-CURDATE-*",
      "location": "WORKING_STORAGE",
      "citation": 129
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Common messages like CCDA-MSG-INVALID-KEY",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS aid key definitions (DFHENTER, DFHPF3 etc.)",
      "location": "WORKING_STORAGE",
      "citation": 148
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point and orchestration paragraph that initializes flags, handles first-time entry vs re-enter, processes commarea, and dispatches based on EIBAID (ENTER, PF3, PF5, PF8). It consumes DFHCOMMAREA/EIBCALEN, EIBAID, and map input if re-enter; produces updated commarea and sends screen or XCTL to previous. Business logic evaluates aid keys: ENTER/PF8 read/populate/send; PF5 fraud toggle; PF3 return to summary; invalid sets error message. Error handling via WS-ERR-FLG and WS-MESSAGE display. Calls subordinate paragraphs like PROCESS-ENTER-KEY, SEND-AUTHVIEW-SCREEN, RETURN-TO-PREV-SCREEN; ultimately CICS RETURN with TRANSID CPVD. Ensures screen erase on initial send.",
      "called_by": [],
      "calls": [
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY",
        "RETURN-TO-PREV-SCREEN"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "Handles ENTER key processing by validating numeric ACCT-ID and non-blank PAU-SELECTED, then reading specific IMS auth record via key. Consumes CDEMO-ACCT-ID, CDEMO-CPVD-PAU-SELECTED from commarea/map; produces WS-ACCT-ID/KEY for IMS read, sets ERR-FLG if invalid. Logic checks NUMERIC and NOT SPACES/LOW-VALUES before GU read; unschedules PSB post-read. No direct writes but populates details for screen. Calls READ-AUTH-RECORD then POPULATE-AUTH-DETAILS; error sets ERR-FLG-ON without screen send here.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        208,
        229
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "Processes PF5 to toggle fraud status: reads current auth record, toggles PA-FRAUD-CONFIRMED/REMOVED flags, calls fraud program via LINK, updates IMS if success else rollback. Consumes CDEMO-ACCT-ID/PAU-SELECTED, IMS details; produces WS-FRAUD-DATA for LINK, updated PENDING-AUTH-DETAILS. Business logic: if confirmed then remove else report; LINK COPAUS2C; if EIBRESP NORMAL and success then REPL else ROLLBACK/ERRMSG. Error handling: ROLL-BACK on LINK fail or fraud fail, sets WS-MESSAGE. Calls READ-AUTH-RECORD, UPDATE-AUTH-DETAILS, POPULATE-AUTH-DETAILS.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "POPULATE-AUTH-DETAILS",
        "ROLL-BACK"
      ],
      "citation": [
        230,
        266
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "Handles PF8 for next authorization: reads current summary/details, GNP next details segment, handles EOF with message. Consumes WS-ACCT-ID/KEY from commarea; produces next PA-AUTH-KEY in commarea/selected. Logic: read current then GNP next PAUTDTL1; if EOF set ERASE-NO and message else update selected and populate. Error handling via IMS status in read-next. Calls READ-AUTH-RECORD, READ-NEXT-AUTH-RECORD, POPULATE-AUTH-DETAILS; unschedules PSB.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        268,
        290
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "Formats and moves IMS auth details to output map fields if no error; transforms dates/times, amounts, reasons, fraud info. Consumes PENDING-AUTH-DETAILS fields (PA-CARD-NUM etc.); produces COPAU1AO fields (CARDNUMO, AUTHDTO etc.). Business logic: conditional response color/status, SEARCH decline table, fraud date format if flagged. No errors handled here (pre-checked ERR-FLG-OFF). No calls.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "Prepares commarea for return to summary screen via XCTL: sets FROM-TRANID/PGM, context zeros, enter flag. Consumes WS-PGM-AUTH-SMRY; produces updated CARDDEMO-COMMAREA. No conditions or errors; direct XCTL. Called on initial or PF3.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        360,
        371
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "Sends the populated BMS map to screen: calls header populate, moves message, conditional ERASE, always CURSOR. Consumes COPAU1AO populated fields, WS-MESSAGE; produces screen display. Logic: if SEND-ERASE-YES then ERASE else no. No error handling. Calls POPULATE-HEADER-INFO.",
      "called_by": [
        "MAIN-PARA",
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        373,
        396
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "Receives map input from screen into COPAU1AI; NOHANDLE so ignores errors. Consumes screen data; produces COPAU1AI for processing. Called on re-enter.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        398,
        406
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "Populates screen header with titles, tranid, pgmname, current date/time formatted. Consumes WS-CICS-TRANID etc., FUNCTION CURRENT-DATE; produces TITLE01O etc. in COPAU1AO. No conditions.",
      "called_by": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        409,
        429
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "Schedules PSB if needed, GU root PAUTSUM0 by ACCNTID, then GNP child PAUTDTL1 by KEY; handles IMS statuses with EOF/error messages/screen send. Consumes WS-ACCT-ID/KEY; produces PENDING-AUTH-SUMMARY/DETAILS, sets AUTHS-EOF/ERR-FLG. Logic: EVALUATE IMS-RETURN-CODE for OK/GE/GB/OTHER; error STRING message and SEND. Calls SCHEDULE-PSB, SEND-AUTHVIEW-SCREEN.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        431,
        491
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "GNP next PAUTDTL1 under current parent; sets EOF or error/message/screen. Consumes current PCB position; produces next PENDING-AUTH-DETAILS. EVALUATE IMS statuses similar to read.",
      "called_by": [
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        493,
        518
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "REPL current PAUTDTL1 with fraud-updated record; SYNCPOINT if OK else ROLLBACK/error message/screen. Consumes WS-FRAUD-AUTH-RECORD; produces updated IMS segment, sets WS-MESSAGE success/fail. EVALUATE IMS status.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        520,
        552
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "Exec CICS SYNCPOINT to commit changes.",
      "called_by": [
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        557,
        560
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "Exec CICS SYNCPOINT ROLLBACK to undo changes.",
      "called_by": [
        "MARK-AUTH-FRAUD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        565,
        569
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "DLI SCHD PSBPAUTB, TERM/resched if TC, set schd flag or error/message/screen.",
      "called_by": [
        "READ-AUTH-RECORD"
      ],
      "calls": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        574,
        603
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS-RETURN-CODE NOT STATUS-OK (e.g. GE, GB, other)",
      "action": "Set WS-ERR-FLG 'Y', STRING error message to WS-MESSAGE, PERFORM SEND-AUTHVIEW-SCREEN",
      "citation": [
        453,
        462
      ]
    },
    {
      "condition": "Input validation fail (non-numeric ACCT-ID or blank SELECTED)",
      "action": "Set ERR-FLG-ON",
      "citation": [
        224
      ]
    },
    {
      "condition": "CICS LINK EIBRESP NOT NORMAL or fraud update FAILED",
      "action": "ROLL-BACK, set error message",
      "citation": [
        257,
        260
      ]
    },
    {
      "condition": "PF key OTHER than ENTER/PF3/PF5/PF8",
      "action": "Process as ENTER, set invalid key message",
      "citation": [
        196
      ]
    },
    {
      "condition": "PSB schedule fail (not OK)",
      "action": "Set ERR-FLG, error message, SEND screen",
      "citation": [
        593
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "SEND MAP",
      "resource": "COPAU1A (COPAU01)",
      "purpose": "Display auth detail screen with data, cursor, optional ERASE",
      "citation": 382
    },
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A (COPAU01)",
      "purpose": "Receive user input from screen into map",
      "citation": 400
    },
    {
      "command": "RETURN",
      "resource": "TRANSID(CPVD)",
      "purpose": "Return to CICS with updated commarea",
      "citation": 202
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(COPAUS0C)",
      "purpose": "Transfer control to summary program",
      "citation": 368
    },
    {
      "command": "LINK",
      "resource": "PROGRAM(COPAUS2C)",
      "purpose": "Call fraud handler subroutine",
      "citation": 248
    },
    {
      "command": "SYNCPOINT",
      "resource": "",
      "purpose": "Commit database changes",
      "citation": 558
    },
    {
      "command": "SYNCPOINT ROLLBACK",
      "resource": "",
      "purpose": "Rollback database changes on error",
      "citation": 567
    }
  ],
  "open_questions": [
    {
      "question": "Exact field layouts in copybooks (e.g. full PA- fields in CIPAUSMY/CIPAUDTY)",
      "context": "Copybooks not provided; inferred from usage like PA-ACCT-ID, PA-FRAUD-CONFIRMED",
      "suggestion": "Provide copybook source for precise field analysis"
    },
    {
      "question": "Programs calling this one",
      "context": "Inferred COPAUS0C from context/WS-PGM-AUTH-SMRY, but not explicitly stated",
      "suggestion": "Check JCL/JCL or caller code"
    },
    {
      "question": "Full fraud logic in COPAUS2C",
      "context": "Only input/output flags visible (WS-FRD-UPDT-SUCCESS, WS-FRD-ACT-MSG)",
      "suggestion": "Analyze COPAUS2C.cbl"
    }
  ]
}