{
  "header": {
    "program_id": "COPAUA0C",
    "file_name": "cbl/COPAUA0C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG_MERGED",
    "analyzed_at": "2026-01-26T17:37:23.676480",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "COPAUA0C is a CICS COBOL program in the CardDemo application serving as the Authorization Module for card authorization decisions. It integrates IMS database access via PSBPAUTB, VSAM files for account/customer/card data, and IBM MQ for request/reply queuing between pending authorization requests and responses. The program is invoked via CICS transaction ID CP00.",
    "business_context": "Card payment authorization processing in a demonstration banking/payment system, handling validation against master records and IMS segments for approve/decline decisions.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      4,
      5,
      7,
      10,
      12,
      20,
      34,
      82,
      110,
      173,
      225,
      444,
      525,
      573,
      727
    ]
  },
  "inputs": [
    {
      "name": "WS-REQUEST-QNAME",
      "io_type": "OTHER",
      "description": "MQ queue containing pending authorization requests (PENDING-AUTH-REQUEST layout)",
      "copybook": "CCPAURQY",
      "citation": [
        43,
        177,
        178
      ]
    },
    {
      "name": "WS-CCXREF-FILE (CCXREF)",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference file for mapping card to customer/account IDs",
      "copybook": "CVACT03Y",
      "citation": [
        39,
        72,
        202,
        203
      ]
    },
    {
      "name": "WS-ACCTFILENAME (ACCTDAT)",
      "io_type": "FILE_VSAM",
      "description": "Account master file records",
      "copybook": "CVACT01Y",
      "citation": [
        35,
        128,
        205,
        206
      ]
    },
    {
      "name": "WS-CUSTFILENAME (CUSTDAT)",
      "io_type": "FILE_VSAM",
      "description": "Customer master file records",
      "copybook": "CVCUS01Y",
      "citation": [
        36,
        131,
        208,
        209
      ]
    },
    {
      "name": "WS-CARDFILENAME (CARDDAT)",
      "io_type": "FILE_VSAM",
      "description": "Card data file",
      "copybook": null,
      "citation": [
        37
      ]
    },
    {
      "name": "PAUT-PCB (PSBPAUTB)",
      "io_type": "IMS_SEGMENT",
      "description": "IMS database segments for pending authorization summary and details",
      "copybook": "CIPAUSMY, CIPAUDTY",
      "citation": [
        81,
        82,
        84,
        191,
        195
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "CICS linkage area for program communication (4096 bytes)",
      "copybook": null,
      "citation": [
        214,
        215
      ]
    },
    {
      "name": "REQUEST-MQ-QUEUE",
      "io_type": "OTHER",
      "description": "IBM MQ queue containing comma-delimited authorization request messages with fields like date, time, card num, amount, merchant details",
      "copybook": null,
      "citation": [
        31,
        33,
        176,
        187
      ]
    },
    {
      "name": "MQTM",
      "io_type": "CICS_COMMAREA",
      "description": "Trigger message retrieved from CICS to get request queue name and trigger data",
      "copybook": null,
      "citation": [
        20
      ]
    },
    {
      "name": "WS-CCXREF-FILE",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference VSAM file, read by card number to get account and customer IDs",
      "copybook": "CARD-XREF-RECORD",
      "citation": [
        262,
        264
      ]
    },
    {
      "name": "WS-ACCTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Account master VSAM file, read by account ID from XREF",
      "copybook": "ACCOUNT-RECORD",
      "citation": [
        310,
        312
      ]
    },
    {
      "name": "WS-CUSTFILENAME",
      "io_type": "FILE_VSAM",
      "description": "Customer master VSAM file, read by customer ID from XREF",
      "copybook": "CUSTOMER-RECORD",
      "citation": [
        358,
        360
      ]
    },
    {
      "name": "PAUT-PCB-NUM",
      "io_type": "IMS_SEGMENT",
      "description": "IMS PAUT database PCB for GU/ISRT/REPL on PAUTSUM0 (pending auth summary) and PAUTDTL1 (details)",
      "copybook": "PENDING-AUTH-SUMMARY",
      "citation": [
        406,
        700
      ]
    }
  ],
  "outputs": [
    {
      "name": "WS-REPLY-QNAME",
      "io_type": "OTHER",
      "description": "MQ reply queue for authorization responses (approved/declined with reasons)",
      "copybook": "CCPAURLY",
      "citation": [
        44,
        180,
        182
      ]
    },
    {
      "name": "Unnamed error log",
      "io_type": "OTHER",
      "description": "Application error log layout",
      "copybook": "CCPAUERY",
      "citation": [
        184,
        185
      ]
    },
    {
      "name": "REPLY-MQ-QUEUE",
      "io_type": "OTHER",
      "description": "IBM MQ reply queue, receives comma-delimited response with card num, trans ID, resp code, reason, approved amt",
      "copybook": null,
      "citation": [
        528,
        545
      ]
    },
    {
      "name": "CSSL",
      "io_type": "CICS_QUEUE",
      "description": "CICS transient data queue for error logging, writes ERROR-LOG-RECORD on errors",
      "copybook": "ERROR-LOG-RECORD",
      "citation": [
        789
      ]
    },
    {
      "name": "PAUT-PCB-NUM",
      "io_type": "IMS_SEGMENT",
      "description": "IMS updates/inserts to PAUTSUM0 summary segment and PAUTDTL1 detail segment",
      "copybook": "PENDING-AUTH-DETAILS",
      "citation": [
        612,
        617,
        700
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CP00"
    ],
    "linkage_section": [
      "LK-COMMAREA",
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Authorization decline reasons defined: insufficient funds, card not active, account closed, card fraud, merchant fraud",
      "logic_summary": "Switch variables WS-DECLINE-FLG and WS-DECLINE-REASON-FLG control approval ('A') or decline ('D') with specific reason codes",
      "conditions": [
        "INSUFFICIENT-FUND ('I')",
        "CARD-NOT-ACTIVE ('A')",
        "ACCOUNT-CLOSED ('C')",
        "CARD-FRAUD ('F')",
        "MERCHANT-FRAUD ('M')"
      ],
      "citation": [
        137,
        140,
        141,
        142,
        143,
        144,
        145
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Process limit of 500 requests",
      "logic_summary": "WS-REQSTS-PROCESS-LIMIT caps message processing loop",
      "conditions": [
        "WS-MSG-PROCESSED reaches 500"
      ],
      "citation": [
        40,
        42
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Decline authorization if transaction amount exceeds available credit: for existing pending auth summary, avail = credit limit - credit balance; else use account master credit limit - curr bal",
      "logic_summary": "Compute WS-AVAILABLE-AMT and compare to WS-TRANSACTION-AMT, set DECLINE-AUTH and INSUFFICIENT-FUND if exceeded",
      "conditions": [
        "FOUND-PAUT-SMRY-SEG",
        "FOUND-ACCT-IN-MSTR",
        "WS-TRANSACTION-AMT > WS-AVAILABLE-AMT"
      ],
      "citation": [
        452,
        460,
        463
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Set auth response code '00' approved or '05' declined, with approved amt = trans amt or 0; reason code based on decline cause like 3100 not found, 4100 insuff funds, etc.",
      "logic_summary": "IF DECLINE-AUTH set resp code '05' else '00'; EVALUATE decline flags for reason",
      "conditions": [
        "DECLINE-AUTH",
        "CARD-NFOUND-XREF",
        "INSUFFICIENT-FUND"
      ],
      "citation": [
        472,
        487
      ]
    },
    {
      "rule_id": "BR005",
      "description": "Process only up to WS-REQSTS-PROCESS-LIMIT messages per invocation",
      "logic_summary": "Loop PERFORM UNTIL NO-MORE-MSG-AVAILABLE OR WS-LOOP-END, check WS-MSG-PROCESSED > limit",
      "conditions": [
        "WS-MSG-PROCESSED > WS-REQSTS-PROCESS-LIMIT"
      ],
      "citation": [
        113,
        126
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "WS-CCXREF-FILE",
        "fields_used": [
          "WS-CARD-RID-CARDNUM",
          "WS-CARD-RID-CUST-ID",
          "WS-CARD-RID-ACCT-ID"
        ],
        "citation": [
          72,
          73,
          74,
          77
        ]
      },
      {
        "source": "PENDING-AUTH-REQUEST",
        "fields_used": [
          "Transaction amount (implied)"
        ],
        "citation": [
          177
        ]
      },
      {
        "source": "REQUEST-MQ-QUEUE",
        "fields_used": [
          "PA-RQ-AUTH-DATE",
          "PA-RQ-CARD-NUM",
          "PA-RQ-TRANSACTION-AMT"
        ],
        "citation": [
          141,
          187
        ]
      },
      {
        "source": "PAUT-PCB-NUM PAUTSUM0",
        "fields_used": [
          "PA-CREDIT-LIMIT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          406
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PENDING-AUTH-RESPONSE",
        "fields_written": [
          "WS-RESP-CD",
          "WS-REAS-CD",
          "Approved amount"
        ],
        "citation": [
          47,
          48,
          65
        ]
      },
      {
        "destination": "REPLY-MQ-QUEUE",
        "fields_written": [
          "PA-RL-AUTH-RESP-CODE",
          "PA-RL-APPROVED-AMT"
        ],
        "citation": [
          509
        ]
      },
      {
        "destination": "PAUT-PCB-NUM PAUTSUM0",
        "fields_written": [
          "PA-APPROVED-AUTH-CNT",
          "PA-CREDIT-BALANCE"
        ],
        "citation": [
          601
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "WS-TRANSACTION-AMT-AN",
        "output_field": "WS-TRANSACTION-AMT",
        "transformation_description": "Alphanumeric transaction amount to numeric for calculations",
        "citation": [
          63,
          64
        ]
      },
      {
        "input_field": "WS-AVAILABLE-AMT",
        "output_field": "WS-APPROVED-AMT",
        "transformation_description": "Available amount compared/transformed to approved amount based on auth logic",
        "citation": [
          62,
          65
        ]
      },
      {
        "input_field": "WS-TRANSACTION-AMT-AN",
        "output_field": "PA-RQ-TRANSACTION-AMT",
        "transformation_description": "NUMVAL conversion from alphanumeric to numeric transaction amount",
        "citation": [
          163
        ]
      },
      {
        "input_field": "PA-RQ-TRANSACTION-AMT",
        "output_field": "WS-APPROVED-AMT",
        "transformation_description": "Set to full trans amt if approved, 0 if declined",
        "citation": [
          481
        ]
      },
      {
        "input_field": "WS-CUR-TIME-N6",
        "output_field": "PA-AUTH-TIME-9C",
        "transformation_description": "Compute inverted time 999999999 - (time*1000 + ms) for IMS key",
        "citation": [
          659
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CMQODV",
      "purpose": "MQ object descriptor structures for request and reply",
      "location": "WORKING_STORAGE",
      "citation": 149
    },
    {
      "copybook_name": "CMQMDV",
      "purpose": "MQ message descriptor structures for request and reply",
      "location": "WORKING_STORAGE",
      "citation": 152
    },
    {
      "copybook_name": "CMQV",
      "purpose": "MQ constants",
      "location": "WORKING_STORAGE",
      "citation": 161
    },
    {
      "copybook_name": "CCPAURQY",
      "purpose": "Pending authorization request layout from MQ",
      "location": "WORKING_STORAGE",
      "citation": 178
    },
    {
      "copybook_name": "CCPAURLY",
      "purpose": "Pending authorization response layout to MQ",
      "location": "WORKING_STORAGE",
      "citation": 182
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "IMS pending auth summary segment (root)",
      "location": "WORKING_STORAGE",
      "citation": 193
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "Card XREF dataset layout",
      "location": "WORKING_STORAGE",
      "citation": 203
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "Account record dataset layout",
      "location": "WORKING_STORAGE",
      "citation": 206
    },
    {
      "copybook_name": "CVCUS01Y",
      "purpose": "Customer dataset layout",
      "location": "WORKING_STORAGE",
      "citation": 209
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "MAIN-PARA serves as the primary entry point and orchestration paragraph controlling the entire program flow in this CICS task. It consumes no direct inputs but relies on EIB and CICS environment for trigger data. It sequentially performs initialization (open MQ, read first msg), main processing loop (extract, process auth, send response, commit), and termination (close IMS PSB and MQ). No business decisions are made here; it delegates to subordinates. Errors are handled implicitly via flags set in callees leading to log and potential abend. It calls 1000-INITIALIZE for setup including queue open and first read, 2000-MAIN-PROCESS for looped message handling with SYNCPOINT per msg, and 9000-TERMINATE for cleanup before CICS RETURN. After all performs, it executes CICS RETURN to end the task.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-MAIN-PROCESS",
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        15
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "1000-INITIALIZE handles program startup by retrieving MQ trigger message from CICS, setting queue name and wait interval, opening the request MQ queue, and reading the first request message. It consumes CICS EIBRESP and MQTM trigger data via RETRIEVE NOHANDLE. It produces WS-REQUEST-QNAME, WS-TRIGGER-DATA, WS-REQUEST-MQ-OPEN flag, and first W01-GET-BUFFER message. No business logic decisions; focuses on setup. Errors from MQOPEN set critical error flags and log via 9500-LOG-ERROR, but continues. Calls 1100-OPEN-REQUEST-QUEUE to perform the MQOPEN call and set flags, and 3100-READ-REQUEST-MQ for initial message get.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "1100-OPEN-REQUEST-QUEUE",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        17,
        36
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1100-OPEN-REQUEST-QUEUE",
      "summary": null,
      "purpose": "1100-OPEN-REQUEST-QUEUE opens the IBM MQ request queue using MQOPEN with input-shared options. It consumes WS-REQUEST-QNAME from trigger data to populate MQOD. It produces W01-HOBJ-REQUEST handle and sets WS-REQUEST-MQ-OPEN flag if successful. No conditions or business logic beyond success check. On MQCC-OK, sets open flag; else sets critical ERR-MQ flags, populates error codes/messages, and performs 9500-LOG-ERROR. No subordinate calls.",
      "called_by": [
        "1000-INITIALIZE"
      ],
      "calls": [],
      "citation": [
        42,
        73
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "1200-SCHEDULE-PSB",
      "summary": null,
      "purpose": "1200-SCHEDULE-PSB schedules the IMS PSB for database access using DLI SCHD, handling if already scheduled by TERM then reschedule. It consumes PSB-NAME and DIBSTAT. It produces IMS-PSB-SCHD flag and IMS-RETURN-CODE. Checks STATUS-OK to set flag; else critical ERR-IMS and log. Ensures single scheduling via PSB-SCHEDULED-MORE-THAN-ONCE check. No subordinate calls.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        79,
        106
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2000-MAIN-PROCESS",
      "summary": null,
      "purpose": "2000-MAIN-PROCESS implements the main loop to process multiple auth requests until no more messages or process limit reached. It consumes messages from prior 3100-READ, WS-REQSTS-PROCESS-LIMIT, WS-MSG-PROCESSED counter. It produces incremented counter, commits per message via SYNCPOINT, unschedules PSB, and sets loop end flag. Business logic: loop condition NO-MORE-MSG-AVAILABLE OR WS-LOOP-END, limit check after each process. Errors handled in subordinates leading to log/abend. Calls 2100-EXTRACT-REQUEST-MSG to parse buffer, 5000-PROCESS-AUTH for full auth handling including reads/decision/response/db write, and re-calls 3100-READ-REQUEST-MQ if under limit.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "2100-EXTRACT-REQUEST-MSG",
        "5000-PROCESS-AUTH",
        "3100-READ-REQUEST-MQ"
      ],
      "citation": [
        110,
        134
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "2100-EXTRACT-REQUEST-MSG",
      "summary": null,
      "purpose": "2100-EXTRACT-REQUEST-MSG parses the MQGET buffer into PA-RQ-* request fields using UNSTRING delimited by comma. It consumes W01-GET-BUFFER(1:W01-DATALEN) from MQGET. It produces populated PA-RQ-AUTH-DATE thru PA-RQ-TRANSACTION-ID fields and WS-TRANSACTION-AMT via NUMVAL on amount. No conditions or errors handled directly. No business logic beyond parsing. No calls.",
      "called_by": [
        "2000-MAIN-PROCESS"
      ],
      "calls": [],
      "citation": [
        138,
        169
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "3100-READ-REQUEST-MQ",
      "summary": null,
      "purpose": "3100-READ-REQUEST-MQ performs non-destructive MQGET with wait interval, convert, no-syncpoint options to fetch next request message. It consumes W01-HCONN-REQUEST/HOBJ, WS-WAIT-INTERVAL. It produces W01-GET-BUFFER/DATALEN, WS-SAVE-CORRELID, WS-REPLY-QNAME if OK; sets NO-MORE-MSG-AVAILABLE on MQRC-NO-MSG-AVAILABLE. On other errors, critical ERR-CICS (misclassified?), log with card num if available. No business decisions. No calls.",
      "called_by": [
        "1000-INITIALIZE",
        "2000-MAIN-PROCESS"
      ],
      "calls": [],
      "citation": [
        173,
        221
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5000-PROCESS-AUTH",
      "summary": null,
      "purpose": "5000-PROCESS-AUTH orchestrates single authorization request: assumes approve init, schedules IMS PSB, reads XREF/ACCT/CUST if found, reads IMS summary/profile (profile empty), makes decision, sends response, writes to DB if XREF found. Consumes parsed PA-RQ-*, VSAM/IMS records. Produces decision flags, response buffer, IMS updates. Business logic delegates decline conditions to reads/6000. Errors via subordinates. Calls 1200-SCHEDULE-PSB, 5100-READ-XREF-RECORD conditional chain, 5500/5600, 6000-MAKE-DECISION, 7100-SEND-RESPONSE, conditional 8000-WRITE-AUTH-TO-DB.",
      "called_by": [
        "2000-MAIN-PROCESS"
      ],
      "calls": [
        "1200-SCHEDULE-PSB",
        "5100-READ-XREF-RECORD",
        "5200-READ-ACCT-RECORD",
        "5300-READ-CUST-RECORD",
        "5500-READ-AUTH-SUMMRY",
        "5600-READ-PROFILE-DATA",
        "6000-MAKE-DECISION",
        "7100-SEND-RESPONSE",
        "8000-WRITE-AUTH-TO-DB"
      ],
      "citation": [
        225,
        255
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5100-READ-XREF-RECORD",
      "summary": null,
      "purpose": "5100-READ-XREF-RECORD reads VSAM CCXREF by card num, sets CARD-FOUND-XREF or NFOUND flags, propagates NFOUND-ACCT-IN-MSTR. Consumes PA-RQ-CARD-NUM. Produces CARD-XREF-RECORD, flags. EVALUATE RESP: NORMAL set found, NOTFND warning log 'A001' and set nfound, OTHER critical CICS log 'C001'. Calls 9500-LOG-ERROR on errors.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        259,
        303
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5200-READ-ACCT-RECORD",
      "summary": null,
      "purpose": "5200-READ-ACCT-RECORD conditionally called if XREF found, reads VSAM account by XREF-ACCT-ID, sets FOUND-ACCT-IN-MSTR or NFOUND. Consumes WS-CARD-RID-ACCT-ID from XREF. Produces ACCOUNT-RECORD, flags. EVALUATE RESP: NORMAL found, NOTFND warning 'A002', OTHER critical 'C002' log. Calls 9500-LOG-ERROR.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        307,
        351
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5300-READ-CUST-RECORD",
      "summary": null,
      "purpose": "5300-READ-CUST-RECORD conditionally called if XREF found, reads VSAM customer by XREF-CUST-ID, sets FOUND-CUST-IN-MSTR or NFOUND. Consumes WS-CARD-RID-CUST-ID from XREF. Produces CUSTOMER-RECORD, flags. EVALUATE RESP: NORMAL found, NOTFND warning 'A003', OTHER critical 'C003' log. Calls 9500-LOG-ERROR.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        355,
        399
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5500-READ-AUTH-SUMMRY",
      "summary": null,
      "purpose": "5500-READ-AUTH-SUMMRY performs IMS DLI GU on PAUTSUM0 segment by ACCT-ID for pending auth summary. Consumes PA-ACCT-ID from XREF. Produces PENDING-AUTH-SUMMARY, FOUND-PAUT-SMRY-SEG or NFOUND flags. EVALUATE DIBSTAT: OK found, SEG-NOT-FND nfound, OTHER critical IMS 'I002' log. Calls 9500-LOG-ERROR.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        403,
        430
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "5600-READ-PROFILE-DATA",
      "summary": null,
      "purpose": "5600-READ-PROFILE-DATA is a placeholder paragraph that performs CONTINUE, implementing no logic or reads. Consumes nothing. Produces nothing. No conditions, errors, or calls. Likely stub for future profile reads.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        434,
        440
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "6000-MAKE-DECISION",
      "summary": null,
      "purpose": "6000-MAKE-DECISION applies core auth rules: compute available credit from summary or acct, decline if trans amt exceeds, set resp code/reason based on flags, format response buffer via STRING. Consumes PA-RQ-*, summary/acct data, found flags. Produces PA-RL-* response fields, W02-PUT-BUFFER, WS-APPROVED-AMT. Business logic: nested IF for avail amt calc/decline, set '00'/'05' code, EVALUATE decline reasons for 3100/4100 etc. No errors direct. No calls.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [],
      "citation": [
        444,
        521
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "7100-SEND-RESPONSE",
      "summary": null,
      "purpose": "7100-SEND-RESPONSE sends response to reply queue using MQPUT1 (implicit open), setting reply MD from saved correlid etc. Consumes WS-REPLY-QNAME, WS-SAVE-CORRELID, W02-PUT-BUFFER from decision. Produces message on queue if OK. Checks COMPCODE=OK else critical MQ 'M004' log. No business logic. No calls.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        525,
        569
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8000-WRITE-AUTH-TO-DB",
      "summary": null,
      "purpose": "8000-WRITE-AUTH-TO-DB conditionally called if XREF found, updates/inserts IMS summary and inserts auth detail. Consumes decision, acct/cust/summary data. Produces updated/inserted IMS segments. Delegates to 8400/8500. Errors via subordinates. Calls 8400-UPDATE-SUMMARY and 8500-INSERT-AUTH.",
      "called_by": [
        "5000-PROCESS-AUTH"
      ],
      "calls": [
        "8400-UPDATE-SUMMARY",
        "8500-INSERT-AUTH"
      ],
      "citation": [
        573,
        581
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8400-UPDATE-SUMMARY",
      "summary": null,
      "purpose": "8400-UPDATE-SUMMARY prepares and REPL/ISRT PAUTSUM0 summary: init if nfound, set limits from acct, inc cnts/amts based on approve/decline, update bal if approved. Consumes found flags, acct data, approved amt. Produces updated PENDING-AUTH-SUMMARY. IF found REPL else ISRT, check STATUS-OK else critical IMS 'I003' log. Calls 9500-LOG-ERROR.",
      "called_by": [
        "8000-WRITE-AUTH-TO-DB"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        585,
        637
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "8500-INSERT-AUTH",
      "summary": null,
      "purpose": "8500-INSERT-AUTH computes inverted date/time keys via ASKTIME/FORMATTIME, populates PAUTH detail from request/response/XREF, sets match flag, ISRT PAUTDTL1 child under summary. Consumes PA-RQ-*, PA-RL-*, XREF-ACCT-ID. Produces PENDING-AUTH-DETAILS inserted. Check STATUS-OK else critical IMS 'I004' log. Calls 9500-LOG-ERROR.",
      "called_by": [
        "8000-WRITE-AUTH-TO-DB"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        641,
        722
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9000-TERMINATE",
      "summary": null,
      "purpose": "9000-TERMINATE performs cleanup: unschedule IMS PSB if scheduled, close request MQ queue. Consumes IMS-PSB-SCHD flag, WS-REQUEST-MQ-OPEN. Sets WS-REQUEST-MQ-CLSE on close OK. Errors on close as warning MQ 'M005' log, no abend. Calls 9100-CLOSE-REQUEST-QUEUE.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9100-CLOSE-REQUEST-QUEUE"
      ],
      "citation": [
        727,
        737
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9100-CLOSE-REQUEST-QUEUE",
      "summary": null,
      "purpose": "9100-CLOSE-REQUEST-QUEUE calls MQCLOSE on request queue handle if open. Consumes W01-HOBJ-REQUEST. Sets WS-REQUEST-MQ-CLSE if OK else warning ERR-MQ 'M005' log. Calls 9500-LOG-ERROR on error.",
      "called_by": [
        "9000-TERMINATE"
      ],
      "calls": [
        "9500-LOG-ERROR"
      ],
      "citation": [
        740,
        766
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9500-LOG-ERROR",
      "summary": null,
      "purpose": "9500-LOG-ERROR formats and writes ERROR-LOG-RECORD to CICS TD queue 'CSSL' with timestamp, tranid, program, error details. Consumes populated ERR-* fields from callers, WS-CICS-TRANID etc. Produces log entry. If ERR-CRITICAL, performs 9990-END-ROUTINE (not in chunk). Uses ASKTIME/FORMATTIME NOHANDLE.",
      "called_by": [
        "1100-OPEN-REQUEST-QUEUE",
        "3100-READ-REQUEST-MQ",
        "5100-READ-XREF-RECORD"
      ],
      "calls": [
        "9990-END-ROUTINE"
      ],
      "citation": [
        770,
        799
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-END-ROUTINE",
      "summary": null,
      "purpose": "This paragraph serves as the primary end routine for terminating the COPAUA0C CICS program execution. Its role is to orchestrate the final cleanup and return control to CICS. It consumes no explicit inputs or data from files/variables visible in this chunk, relying instead on the program state established by prior paragraphs. It produces no direct outputs, but indirectly triggers any outputs from the called 9000-TERMINATE paragraph, such as potential file closes or log writes. The business logic is minimal, consisting solely of sequential execution without conditional decisions. No validation or error handling is performed within this paragraph itself. It calls the 9000-TERMINATE paragraph via PERFORM at line 10 to handle termination tasks like resource cleanup, which are not defined in this chunk. Following the PERFORM, it unconditionally executes the CICS RETURN at lines 12-13 to end the transaction and return to CICS. After the period at line 14, control naturally flows to the subsequent 9990-EXIT. This structure ensures a clean exit from the program.",
      "called_by": [],
      "calls": [
        "9000-TERMINATE"
      ],
      "citation": [
        7,
        14
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    },
    {
      "paragraph_name": "9990-EXIT",
      "summary": null,
      "purpose": "This paragraph consists solely of an EXIT label and statement, serving as a standard exit point following the CICS RETURN in 9990-END-ROUTINE. Its primary role is to provide a conventional termination marker in the program flow, though execution would typically not reach here due to the prior CICS RETURN. It consumes no inputs or data from any sources. It produces no outputs or modifications to variables/files. No business logic, conditions, or decisions are implemented. No error handling or validation occurs. It makes no calls to other paragraphs or programs. The EXIT statement at line 16 simply transfers control back to the calling paragraph, if any, but in context, it acts as a fallback or structural endpoint.",
      "called_by": [],
      "calls": [],
      "citation": [
        15,
        16
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS-RETURN-CODE not STATUS-OK",
      "action": "88 levels defined for SEGMENT-NOT-FOUND ('GE'), DUPLICATE-SEGMENT-FOUND ('II'), WRONG-PARENTAGE ('GP'), END-OF-DB ('GB'), DATABASE-UNAVAILABLE ('BA'), etc.; RETRY-CONDITION for 'BA','FH','TE'",
      "citation": [
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94
      ]
    },
    {
      "condition": "MQ or file processing errors implied",
      "action": "Switches like WS-MSG-LOOP-FLG, WS-REQUEST-MQ-FLG control loops and closes",
      "citation": [
        110,
        114,
        119,
        122
      ]
    },
    {
      "condition": "WS-COMPCODE NOT = MQCC-OK after MQOPEN",
      "action": "Set ERR-MQ critical, log 'M001' 'REQ MQ OPEN ERROR', continue",
      "citation": [
        57
      ]
    },
    {
      "condition": "DIBSTAT NOT STATUS-OK after SCHD",
      "action": "Set ERR-IMS critical, log 'I001' 'IMS SCHD FAILED'",
      "citation": [
        95
      ]
    },
    {
      "condition": "WS-REASON = MQRC-NO-MSG-AVAILABLE after MQGET",
      "action": "Set NO-MORE-MSG-AVAILABLE, exit loop",
      "citation": [
        203
      ]
    },
    {
      "condition": "WS-RESP-CD = DFHRESP(NOTFND) on VSAM READ",
      "action": "Set nfound flags, warning ERR-APP log 'A00x'",
      "citation": [
        278
      ]
    },
    {
      "condition": "ERR-CRITICAL after log",
      "action": "Perform 9990-END-ROUTINE (likely abend)",
      "citation": [
        795
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "Implied CICS handling",
      "resource": "DFHCOMMAREA",
      "purpose": "Linkage for CICS transaction CP00 communication",
      "citation": 214
    },
    {
      "command": "RETRIEVE",
      "resource": "MQTM",
      "purpose": "Retrieve trigger message for queue name",
      "citation": 20
    },
    {
      "command": "READ DATASET",
      "resource": "WS-CCXREF-FILE",
      "purpose": "Read card XREF VSAM record",
      "citation": 264
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Commit per message processing",
      "citation": 122
    },
    {
      "command": "WRITEQ TD",
      "resource": "CSSL",
      "purpose": "Log error record",
      "citation": 789
    },
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "End the CICS transaction and return control to CICS",
      "citation": 12
    }
  ],
  "open_questions": [
    {
      "question": "Actual I/O operations (OPEN, READ, WRITE, GET, PUT for MQ/IMS/VSAM)",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Exact queue names populated in WS-REQUEST-QNAME and WS-REPLY-QNAME",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "File organization (confirmed VSAM/KSDS?) and access methods",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Program flow, paragraphs, and called programs",
      "context": "From chunk SOURCE-chunk-1-header (lines 1-217)",
      "suggestion": ""
    },
    {
      "question": "Data division and working storage/copybook definitions",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Details of 9990-END-ROUTINE and any other missing paragraphs",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Reply MQ connection W02-HCONN-REPLY origin",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "WS-REQSTS-PROCESS-LIMIT value/source",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "Full list of decline flags like CARD-NOT-ACTIVE, ACCOUNT-CLOSED",
      "context": "From chunk SOURCE-chunk-2 (lines 220-1015)",
      "suggestion": ""
    },
    {
      "question": "What is the overall purpose and business function of the COPAUA0C program?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What does the 9000-TERMINATE paragraph do?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What inputs, outputs, copybooks, and data divisions are used?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    },
    {
      "question": "What is the calling context, entry points, or linkage for this CICS program?",
      "context": "From chunk SOURCE-chunk-3 (lines 1016-1027)",
      "suggestion": ""
    }
  ]
}