# XAUTHFRD

**File:** ddl/XAUTHFRD.ddl
**Type:** OTHER
**Status:** In Progress
**Iterations:** 1
**Analyzed:** 2026-02-24 03:59:02.308269

## Purpose

This DDL script creates a unique index named CARDDEMO.XAUTHFRD on the CARDDEMO.AUTHFRDS table. The index is defined on columns CARD_NUM in ascending order and AUTH_TS in descending order. The COPY YES option is specified to allow the index to be copied during table reorganization.
**Program Type:** UTILITY
**Citations:** Lines 1, 2, 3, 4

## Outputs

### CARDDEMO.XAUTHFRD
- **Type:** OTHER
- **Description:** Unique index on CARDDEMO.AUTHFRDS table keyed by CARD_NUM ASC and AUTH_TS DESC
- **Lines:** 1, 2, 3, 4

## Key Paragraphs

### XAUTHFRD
**Purpose:** [Citadel] Paragraph identified by static analysis
- Lines: 1-1

## SQL Operations

| Operation | Table | Purpose | Line |
|-----------|-------|---------|------|
| CREATE UNIQUE INDEX | CARDDEMO.AUTHFRDS | Enforces uniqueness on the composite key (CARD_NUM ASC, AUTH_TS DESC) and optimizes access for queries filtering or sorting by these columns | 1 |

## Resolved Questions

- **Q:** What is the specific business purpose of the AUTHFRDS table and this index?
  **A:** **AUTHFRDS Table Purpose:**  
The `CARDDEMO.AUTHFRDS` table is a DB2 table specifically for **fraud tracking and reporting** on card authorization messages/transactions. It stores detailed authorization records (e.g., `CARD_NUM`, `AUTH_TS`, `AUTH_TYPE`, `TRANSACTION_AMT`, merchant details, response codes) along with fraud-specific fields like `AUTH_FRAUD` (flag indicating fraud status), `FRAUD_RPT_DATE` (date fraud was reported), `ACCT_ID`, and `CUST_ID`.  

This is confirmed by:  
- **README.md** (lines 271, 113): Explicitly describes it as "DB2 table for fraud tracking".  
- **COPAUS2C.cbl** (lines 2-5, 142-198, 223-244): CICS COBOL program "Mark Authorization Message Fraud". Performs upsert logicâ€”**INSERT** full auth record with fraud flag into `AUTHFRDS` (populating from input fraud auth record via `CIPAUDTY` copybook); on duplicate key error (SQLCODE -803), **UPDATE** sets `AUTH_FRAUD` and `FRAUD_RPT_DATE`. Input includes action ('F' report fraud, 'R' remove), account/customer IDs.  
- Table DDL (`ddl/AUTHFRDS.ddl`): Primary key `(CARD_NUM, AUTH_TS)` enforces uniqueness per card/timestamp.  

**XAUTHFRD Index Purpose:**  
Unique index `CARDDEMO.XAUTHFRD` on `(CARD_NUM ASC, AUTH_TS DESC)` with `COPY YES` (allows index rebuild during table reorganization). Supports:  
- **Efficient lookups** by card number for the *most recent* authorization (DESC timestamp).  
- **Upsert enforcement** (unique constraint catches duplicates for UPDATE).  
- **Fraud queries**: Quick retrieval of latest fraud-flagged auths per card for reporting/analysis.  

Sources: `ddl/XAUTHFRD.ddl`, `ddl/AUTHFRDS.ddl`, `cbl/COPAUS2C.cbl` (full file read), `README.md`, `dcl/AUTHFRDS.dcl`. No other code references found, confirming isolated fraud subsystem role.

---
*Generated by War Rig WAR_RIG*