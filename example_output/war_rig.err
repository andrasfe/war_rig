2026-02-10 10:20:08,758 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:414

2026-02-10 10:20:08,760 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-10T10:20:08.759726",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 309, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 296, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-10 10:20:08,765 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:474

2026-02-10 10:20:08,766 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-10T10:20:08.766236",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cpy/PASFLPCB.CPY"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 309, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 296, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 450, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 421, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: cpy/PASFLPCB.CPY\nFile Type: COPYBOOK\nIteration: 1\n\n## Source Code\n```\n    1 |       ******************************************************************\n    2 |       * Copyright Amazon.com, Inc. or its affiliates.\n    3 |       * All Rights Reserved.\n    4 |       *\n    5 |       * Licensed under the Apache License, Version 2.0 (the \"License\").\n    6 |       * You may not use this file except in compliance with the License.\n    7 |       * You may obtain a copy of the License at\n    8 |       *\n    9 |       *    http://www.apache.org/licenses/LICENSE-2.0\n   10 |       *\n   11 |       * Unless required by applicable law or agreed to in writing,\n   12 |       * software distributed under the License is distributed on an\n   13 |       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n   14 |       * either express or implied. See the License for the specific\n   15 |       * language governing permissions and limitations under the License\n   16 |       ********..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

