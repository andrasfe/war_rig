{
  "header": {
    "program_id": "COUSR01C",
    "file_name": "COUSR01C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T15:56:43.820666",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "CICS online program that presents a screen (COUSR1A) for adding new users to USRSEC file by capturing first name, last name, user ID, password, and type via map input, validates required fields are non-empty, writes VSAM record using user ID as key, handles duplicate keys and other errors with messages, supports PF3/PF4 keys for navigation/clear.",
    "business_context": "CardDemo application user security administration: adds regular/admin users to USRSEC dataset.",
    "program_type": "ONLINE_CICS",
    "citations": [
      3,
      5,
      71,
      115,
      184,
      238
    ]
  },
  "inputs": [
    {
      "name": "COUSR1AI",
      "io_type": "CICS_MAP",
      "description": "Input map fields from screen: FNAMEI, LNAMEI, USERIDI, PASSWDI, USRTYPEI for new user details",
      "copybook": "COUSR01",
      "citation": [
        203
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Program linkage commarea populated from previous program, used to pass CARDDEMO-COMMAREA context",
      "copybook": "COCOM01Y",
      "citation": [
        82
      ]
    },
    {
      "name": "EIBAID",
      "io_type": "CICS_COMMAREA",
      "description": "CICS AID key from user input (ENTER, PF3, PF4, OTHER)",
      "copybook": "DFHAID",
      "citation": [
        90
      ]
    }
  ],
  "outputs": [
    {
      "name": "COUSR1AO",
      "io_type": "CICS_MAP",
      "description": "Output map with populated header (titles, tranid, pgmname, date/time), error messages, and cursor positioning",
      "copybook": "COUSR01",
      "citation": [
        190
      ]
    },
    {
      "name": "USRSEC",
      "io_type": "FILE_VSAM",
      "description": "New user security record written with fields SEC-USR-ID (key), SEC-USR-FNAME, SEC-USR-LNAME, SEC-USR-PWD, SEC-USR-TYPE",
      "copybook": "CSUSR01Y",
      "citation": [
        240
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea passed back on RETURN or XCTL",
      "copybook": "COCOM01Y",
      "citation": [
        107,
        177
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Transfer control to previous or next screen program (e.g., COSGN00C, COADM01C)",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 176
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CU01"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "First name must not be empty or low-values",
      "logic_summary": "EVALUATE checks FNAMEI OF COUSR1AI, sets error flag/message if invalid, repositions cursor",
      "conditions": [
        "FNAMEI OF COUSR1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        118,
        123
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Last name must not be empty or low-values",
      "logic_summary": "EVALUATE checks LNAMEI OF COUSR1AI, sets error flag/message if invalid, repositions cursor",
      "conditions": [
        "LNAMEI OF COUSR1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        124,
        129
      ]
    },
    {
      "rule_id": "BR003",
      "description": "User ID must not be empty or low-values",
      "logic_summary": "EVALUATE checks USERIDI OF COUSR1AI, sets error flag/message if invalid, repositions cursor",
      "conditions": [
        "USERIDI OF COUSR1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        130,
        135
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Password must not be empty or low-values",
      "logic_summary": "EVALUATE checks PASSWDI OF COUSR1AI, sets error flag/message if invalid, repositions cursor",
      "conditions": [
        "PASSWDI OF COUSR1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        136,
        141
      ]
    },
    {
      "rule_id": "BR005",
      "description": "User type must not be empty or low-values",
      "logic_summary": "EVALUATE checks USRTYPEI OF COUSR1AI, sets error flag/message if invalid, repositions cursor",
      "conditions": [
        "USRTYPEI OF COUSR1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        142,
        147
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Reject invalid AID keys",
      "logic_summary": "EVALUATE EIBAID WHEN OTHER sets error flag and invalid key message",
      "conditions": [
        "EIBAID NOT DFHENTER, DFHPF3, DFHPF4"
      ],
      "citation": [
        99,
        102
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "COUSR1AI",
        "fields_used": [
          "FNAMEI",
          "LNAMEI",
          "USERIDI",
          "PASSWDI",
          "USRTYPEI"
        ],
        "citation": [
          203
        ]
      },
      {
        "source": "DFHCOMMAREA",
        "fields_used": [
          "CDEMO-PGM-REENTER",
          "CDEMO-TO-PROGRAM"
        ],
        "citation": [
          82
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "USRSEC",
        "fields_written": [
          "SEC-USR-ID",
          "SEC-USR-FNAME",
          "SEC-USR-LNAME",
          "SEC-USR-PWD",
          "SEC-USR-TYPE"
        ],
        "citation": [
          240
        ]
      },
      {
        "destination": "COUSR1AO",
        "fields_written": [
          "ERRMSGO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO",
          "ERRMSGC"
        ],
        "citation": [
          190
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "FNAMEI OF COUSR1AI",
        "output_field": "SEC-USR-FNAME",
        "transformation_description": "Direct MOVE if all validations pass",
        "citation": [
          155
        ]
      },
      {
        "input_field": "LNAMEI OF COUSR1AI",
        "output_field": "SEC-USR-LNAME",
        "transformation_description": "Direct MOVE if all validations pass",
        "citation": [
          156
        ]
      },
      {
        "input_field": "USERIDI OF COUSR1AI",
        "output_field": "SEC-USR-ID",
        "transformation_description": "Direct MOVE if all validations pass",
        "citation": [
          154
        ]
      },
      {
        "input_field": "PASSWDI OF COUSR1AI",
        "output_field": "SEC-USR-PWD",
        "transformation_description": "Direct MOVE if all validations pass",
        "citation": [
          157
        ]
      },
      {
        "input_field": "USRTYPEI OF COUSR1AI",
        "output_field": "SEC-USR-TYPE",
        "transformation_description": "Direct MOVE if all validations pass",
        "citation": [
          158
        ]
      },
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURDATEO OF COUSR1AO",
        "transformation_description": "Format MM-DD-YY from WS-CURDATE-DATA",
        "citation": [
          216,
          228
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines CARDDEMO-COMMAREA including CDEMO-TO-PROGRAM, CDEMO-FROM-TRANID, CDEMO-FROM-PROGRAM, CDEMO-PGM-REENTER",
      "location": "WORKING_STORAGE",
      "citation": 46
    },
    {
      "copybook_name": "COUSR01",
      "purpose": "Defines BMS map input COUSR1AI and output COUSR1AO fields like FNAMEI, USERIDI, ERRMSGO",
      "location": "WORKING_STORAGE",
      "citation": 48
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Defines title constants like CCDA-TITLE01, CCDA-TITLE02",
      "location": "WORKING_STORAGE",
      "citation": 50
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Defines date handling WS-CURDATE-DATA, WS-CURDATE-MM etc.",
      "location": "WORKING_STORAGE",
      "citation": 51
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Defines message constants like CCDA-MSG-INVALID-KEY",
      "location": "WORKING_STORAGE",
      "citation": 52
    },
    {
      "copybook_name": "CSUSR01Y",
      "purpose": "Defines SEC-USER-DATA record structure with SEC-USR-ID (key), SEC-USR-FNAME etc.",
      "location": "WORKING_STORAGE",
      "citation": 53
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "Defines EIBAID and constants like DFHENTER, DFHPF3",
      "location": "WORKING_STORAGE",
      "citation": 55
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "Defines BMS attributes like DFHGREEN, ERASE, CURSOR",
      "location": "WORKING_STORAGE",
      "citation": 56
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Main control logic: initialize, handle first entry vs reentry, receive map, process AID",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "SEND-USRADD-SCREEN",
        "RECEIVE-USRADD-SCREEN",
        "PROCESS-ENTER-KEY",
        "CLEAR-CURRENT-SCREEN"
      ],
      "citation": [
        71,
        110
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Validate all input fields non-empty, move to SEC-USER-DATA if valid, perform write",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-USRADD-SCREEN",
        "WRITE-USER-SEC-FILE"
      ],
      "citation": [
        115,
        160
      ]
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "purpose": "Prepare commarea for XCTL to previous/next program",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        165,
        178
      ]
    },
    {
      "paragraph_name": "SEND-USRADD-SCREEN",
      "purpose": "Populate header, send map with message and ERASE/CURSOR",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY",
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        184,
        196
      ]
    },
    {
      "paragraph_name": "RECEIVE-USRADD-SCREEN",
      "purpose": "Receive map into input area with RESP codes",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        201,
        209
      ]
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "purpose": "Set titles, tranid, pgmname, format current date/time",
      "called_by": [
        "SEND-USRADD-SCREEN"
      ],
      "calls": [],
      "citation": [
        214,
        234
      ]
    },
    {
      "paragraph_name": "WRITE-USER-SEC-FILE",
      "purpose": "CICS WRITE VSAM record with RIDFLD, handle RESP outcomes",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-USRADD-SCREEN"
      ],
      "citation": [
        238,
        274
      ]
    },
    {
      "paragraph_name": "CLEAR-CURRENT-SCREEN",
      "purpose": "Clear by initializing fields and resending screen",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-USRADD-SCREEN"
      ],
      "citation": [
        279,
        283
      ]
    },
    {
      "paragraph_name": "INITIALIZE-ALL-FIELDS",
      "purpose": "Reset input fields to SPACES/LOW-VALUES and clear message",
      "called_by": [
        "CLEAR-CURRENT-SCREEN",
        "WRITE-USER-SEC-FILE"
      ],
      "calls": [],
      "citation": [
        287,
        295
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "Input fields empty/low-values",
      "action": "Set WS-ERR-FLG 'Y', load specific message to WS-MESSAGE, reposition cursor (-1 length), send screen",
      "citation": [
        118
      ]
    },
    {
      "condition": "Invalid EIBAID",
      "action": "Set WS-ERR-FLG 'Y', message CCDA-MSG-INVALID-KEY, send screen",
      "citation": [
        99
      ]
    },
    {
      "condition": "CICS WRITE RESP = DUPKEY or DUPREC",
      "action": "Set WS-ERR-FLG 'Y', message 'User ID already exist...', reposition USERIDL, send screen",
      "citation": [
        260
      ]
    },
    {
      "condition": "CICS WRITE RESP OTHER/NORMAL",
      "action": "NORMAL: success message, green attr, reinitialize; OTHER: error message, reposition FNAMEL, send screen",
      "citation": [
        250
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID)",
      "purpose": "Return to CICS with same transaction and updated COMMAREA",
      "citation": 107
    },
    {
      "command": "SEND",
      "resource": "MAP('COUSR1A') MAPSET('COUSR01')",
      "purpose": "Send output map with ERASE and CURSOR",
      "citation": 190
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('COUSR1A') MAPSET('COUSR01')",
      "purpose": "Receive input map with RESP/RESP2",
      "citation": 203
    },
    {
      "command": "WRITE",
      "resource": "DATASET(WS-USRSEC-FILE)",
      "purpose": "Write VSAM record using RIDFLD(SEC-USR-ID) with RESP/RESP2",
      "citation": 240
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
      "purpose": "Transfer control to another program with COMMAREA",
      "citation": 176
    }
  ],
  "open_questions": [
    {
      "question": "Exact structure and lengths of copybook fields (e.g., SEC-USR-ID length)",
      "context": "Copybook sources not provided; inferred from usage but not verifiable",
      "suggestion": "Provide copybook sources for precise field definitions"
    },
    {
      "question": "Called_by programs",
      "context": "No JCL or PROC; inferred from XCTL usage but not explicit",
      "suggestion": "Analyze calling programs like COSGN00C"
    }
  ]
}