{
  "header": {
    "program_id": "COTRN01C",
    "file_name": "COTRN01C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T16:56:48.066173",
    "iteration_count": 2,
    "final_status": null
  },
  "purpose": {
    "summary": "COTRN01C is a CICS online transaction (CT01) specifically designed to view details of a single credit card transaction record from the VSAM TRANSACT file using screen map COTRN1A. Users enter a transaction ID (or use pre-selected from commarea), the program reads the record via CICS READ UPDATE, populates screen fields with details like card number, amount, type, merchant info, and timestamps, or shows errors for invalid/not found IDs. Unlike transaction list programs, it focuses exclusively on inquiry/display of one record with navigation to menus/lists via PF keys.",
    "business_context": "Part of CardDemo application for credit card transaction inquiry, allowing detailed view of individual transactions keyed by ID.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      5,
      23,
      37,
      106,
      172,
      177,
      213,
      230,
      269
    ]
  },
  "inputs": [
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Receives commarea from calling program containing context like CDEMO-CT01-TRN-SELECTED transaction ID",
      "copybook": "COCOM01Y",
      "citation": [
        78,
        98,
        103
      ]
    },
    {
      "name": "COTRN1AI",
      "io_type": "CICS_MAP",
      "description": "Screen input map capturing user-entered transaction ID in TRNIDINI",
      "copybook": "COTRN01",
      "citation": [
        232
      ]
    },
    {
      "name": "TRANSACT",
      "io_type": "FILE_VSAM",
      "description": "VSAM file of transaction records, accessed by key TRAN-ID",
      "copybook": "CVTRA05Y",
      "citation": [
        39,
        269
      ]
    }
  ],
  "outputs": [
    {
      "name": "COTRN1AO",
      "io_type": "CICS_MAP",
      "description": "Screen output map with header (titles, date/time), error messages, and transaction details for display",
      "copybook": "COTRN01",
      "citation": [
        219
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea returned to CICS with transaction context for potential reentry",
      "copybook": "COCOM01Y",
      "citation": [
        136,
        138
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COSGN00C",
      "call_type": "CICS_XCTL",
      "purpose": "Called on first entry (EIBCALEN=0) or when no prior program specified in RETURN-TO-PREV-SCREEN (defaults to sign-on)",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 96
    },
    {
      "program_name": "COMEN00C",
      "call_type": "CICS_XCTL",
      "purpose": "Called on PF3 when CDEMO-FROM-PROGRAM is spaces/low-values (no prior program, defaults to main menu)",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 117
    },
    {
      "program_name": "COTRN00C",
      "call_type": "CICS_XCTL",
      "purpose": "Called on PF5 to return to transaction list screen",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 126
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CT01"
    ],
    "linkage_section": [
      "DFHCOMMAREA",
      "LK-COMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "If transaction ID is empty or low-values on enter, display error and reprompt",
      "logic_summary": "EVALUATE checks TRNIDINI, sets error flag and message if invalid",
      "conditions": [
        "TRNIDINI OF COTRN1AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        147,
        152
      ]
    },
    {
      "rule_id": "BR002",
      "description": "If transaction not found in TRANSACT, set error flag and message, reprompt with cursor on ID field",
      "logic_summary": "After READ, check DFHRESP(NOTFND), move error message and -1 to TRNIDINL",
      "conditions": [
        "WS-RESP-CD = DFHRESP(NOTFND)"
      ],
      "citation": [
        280,
        284
      ]
    },
    {
      "rule_id": "BR003",
      "description": "On invalid AID key, set error and invalid key message",
      "logic_summary": "EVALUATE EIBAID WHEN OTHER",
      "conditions": [
        "EIBAID NOT IN (DFHENTER, DFHPF3, DFHPF4, DFHPF5)"
      ],
      "citation": [
        112,
        129
      ]
    },
    {
      "rule_id": "BR004",
      "description": "PF3 returns to prior program or default (COMEN01C if no prior, else CDEMO-FROM-PROGRAM), PF5 to COTRN00C transaction list",
      "logic_summary": "EVALUATE EIBAID sets CDEMO-TO-PROGRAM based on conditions",
      "conditions": [
        "EIBAID = DFHPF3",
        "EIBAID = DFHPF5"
      ],
      "citation": [
        112,
        116,
        126
      ]
    },
    {
      "rule_id": "BR005",
      "description": "PF4 clears all screen fields and resets for new transaction ID entry",
      "logic_summary": "Performs CLEAR-CURRENT-SCREEN which initializes fields to spaces/low-values and redisplays screen",
      "conditions": [
        "EIBAID = DFHPF4"
      ],
      "citation": [
        124
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "TRANSACT",
        "fields_used": [
          "TRAN-ID",
          "TRAN-AMT",
          "TRAN-CARD-NUM",
          "TRAN-TYPE-CD",
          "TRAN-CAT-CD",
          "TRAN-SOURCE",
          "TRAN-DESC",
          "TRAN-ORIG-TS",
          "TRAN-PROC-TS",
          "TRAN-MERCHANT-ID",
          "TRAN-MERCHANT-NAME",
          "TRAN-MERCHANT-CITY",
          "TRAN-MERCHANT-ZIP"
        ],
        "citation": [
          172,
          269,
          277
        ]
      },
      {
        "source": "COTRN1AI",
        "fields_used": [
          "TRNIDINI"
        ],
        "citation": [
          106,
          147,
          172
        ]
      },
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-CT01-TRN-SELECTED"
        ],
        "citation": [
          98,
          103
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COTRN1AO",
        "fields_written": [
          "ERRMSGO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO"
        ],
        "citation": [
          217,
          247
        ]
      },
      {
        "destination": "COTRN1AI",
        "fields_written": [
          "TRNIDI",
          "CARDNUMI",
          "TTYPCDI",
          "TCATCDI",
          "TRNSRCI",
          "TRNAMTI",
          "TDESCI",
          "TORIGDTI",
          "TPROCDTI",
          "MIDI",
          "MNAMEI",
          "MCITYI",
          "MZIPI"
        ],
        "citation": [
          178
        ]
      },
      {
        "destination": "CDEMO-TO-PROGRAM",
        "fields_written": [
          "COSGN00C",
          "COMEN01C",
          "COTRN00C"
        ],
        "citation": [
          96,
          117,
          126
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "TRAN-AMT",
        "output_field": "WS-TRAN-AMT",
        "transformation_description": "Direct move from TRAN-RECORD to WS for numeric formatting before screen move",
        "citation": [
          177
        ]
      },
      {
        "input_field": "TRAN-ID",
        "output_field": "TRNIDI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          178
        ]
      },
      {
        "input_field": "TRAN-CARD-NUM",
        "output_field": "CARDNUMI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          179
        ]
      },
      {
        "input_field": "TRAN-TYPE-CD",
        "output_field": "TTYPCDI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          180
        ]
      },
      {
        "input_field": "TRAN-CAT-CD",
        "output_field": "TCATCDI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          181
        ]
      },
      {
        "input_field": "TRAN-SOURCE",
        "output_field": "TRNSRCI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          182
        ]
      },
      {
        "input_field": "WS-TRAN-AMT",
        "output_field": "TRNAMTI OF COTRN1AI",
        "transformation_description": "Move from WS (formatted from TRAN-AMT) to screen amount field",
        "citation": [
          183
        ]
      },
      {
        "input_field": "TRAN-DESC",
        "output_field": "TDESCI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          184
        ]
      },
      {
        "input_field": "TRAN-ORIG-TS",
        "output_field": "TORIGDTI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          185
        ]
      },
      {
        "input_field": "TRAN-PROC-TS",
        "output_field": "TPROCDTI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          186
        ]
      },
      {
        "input_field": "TRAN-MERCHANT-ID",
        "output_field": "MIDI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          187
        ]
      },
      {
        "input_field": "TRAN-MERCHANT-NAME",
        "output_field": "MNAMEI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          188
        ]
      },
      {
        "input_field": "TRAN-MERCHANT-CITY",
        "output_field": "MCITYI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          189
        ]
      },
      {
        "input_field": "TRAN-MERCHANT-ZIP",
        "output_field": "MZIPI OF COTRN1AI",
        "transformation_description": "Direct move from file record to screen display field",
        "citation": [
          190
        ]
      },
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURDATEO OF COTRN1AO",
        "transformation_description": "Parse current date into MM-DD-YY format for screen header",
        "citation": [
          245,
          256
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Common CardDemo commarea including CDEMO-CT01-INFO for transaction selection and navigation context",
      "location": "WORKING_STORAGE",
      "citation": 52
    },
    {
      "copybook_name": "COTRN01",
      "purpose": "BMS map definitions for COTRN1AI (input) and COTRN1AO (output) transaction view screen",
      "location": "WORKING_STORAGE",
      "citation": 63
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Transaction title/list related data structures",
      "location": "WORKING_STORAGE",
      "citation": 65
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Date/time formatting structures like WS-CURDATE-DATA",
      "location": "WORKING_STORAGE",
      "citation": 66
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Constants for messages (CCDA-MSG-INVALID-KEY) and titles (CCDA-TITLE01/02)",
      "location": "WORKING_STORAGE",
      "citation": 67
    },
    {
      "copybook_name": "CVTRA05Y",
      "purpose": "Layout of TRAN-RECORD for VSAM TRANSACT file transactions",
      "location": "WORKING_STORAGE",
      "citation": 69
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS attention identifier constants (DFHENTER, DFHPF3 etc.)",
      "location": "WORKING_STORAGE",
      "citation": 71
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "BMS symbolic constants for mapset/map handling",
      "location": "WORKING_STORAGE",
      "citation": 72
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Main control: initializes, handles first/reentry logic, receives map, evaluates AID keys for actions",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-TRNVIEW-SCREEN",
        "RECEIVE-TRNVIEW-SCREEN",
        "CLEAR-CURRENT-SCREEN"
      ],
      "citation": [
        86,
        138
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Validates/processes transaction ID input, clears other fields, reads file, populates display or errors",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-TRNVIEW-SCREEN",
        "READ-TRANSACT-FILE"
      ],
      "citation": [
        144,
        192
      ]
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "purpose": "Prepares and XCTLs to target program (sets from context or defaults)",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        197,
        207
      ]
    },
    {
      "paragraph_name": "SEND-TRNVIEW-SCREEN",
      "purpose": "Populates header/messages, sends map with ERASE CURSOR",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY",
        "CLEAR-CURRENT-SCREEN",
        "READ-TRANSACT-FILE"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        213,
        225
      ]
    },
    {
      "paragraph_name": "RECEIVE-TRNVIEW-SCREEN",
      "purpose": "Receives user map data into COTRN1AI capturing resp codes",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        230,
        237
      ]
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "purpose": "Formats current date/time, moves static titles/program names to output map",
      "called_by": [
        "SEND-TRNVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        243,
        262
      ]
    },
    {
      "paragraph_name": "READ-TRANSACT-FILE",
      "purpose": "CICS READ UPDATE TRANSACT by TRAN-ID, evaluates RESP for normal/error handling",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-TRNVIEW-SCREEN"
      ],
      "citation": [
        267,
        296
      ]
    },
    {
      "paragraph_name": "CLEAR-CURRENT-SCREEN",
      "purpose": "Clears/resets screen by initializing fields and resending",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-TRNVIEW-SCREEN"
      ],
      "citation": [
        301,
        304
      ]
    },
    {
      "paragraph_name": "INITIALIZE-ALL-FIELDS",
      "purpose": "Sets screen fields to spaces/low-values and clears message",
      "called_by": [
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [],
      "citation": [
        309,
        326
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "TRNIDINI empty or low-values",
      "action": "Set WS-ERR-FLG 'Y', custom error message, TRNIDINL -1, send screen",
      "citation": [
        147
      ]
    },
    {
      "condition": "READ RESP = DFHRESP(NOTFND)",
      "action": "Set WS-ERR-FLG 'Y', 'Transaction ID NOT found' message, TRNIDINL -1, send screen",
      "citation": [
        284
      ]
    },
    {
      "condition": "READ RESP OTHER than NORMAL/NOTFND",
      "action": "DISPLAY RESP/REAS, set error flag, 'Unable to lookup' message, TRNIDINL -1, send screen",
      "citation": [
        290
      ]
    },
    {
      "condition": "Invalid EIBAID",
      "action": "Set WS-ERR-FLG 'Y', CCDA-MSG-INVALID-KEY message, send screen",
      "citation": [
        129
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID)",
      "purpose": "Returns to CICS with CT01 transid and updated commarea",
      "citation": 136
    },
    {
      "command": "SEND",
      "resource": "MAP('COTRN1A') MAPSET('COTRN01')",
      "purpose": "Displays transaction view screen from COTRN1AO with erase and cursor",
      "citation": 219
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('COTRN1A') MAPSET('COTRN01')",
      "purpose": "Captures user input into COTRN1AI with RESP codes",
      "citation": 232
    },
    {
      "command": "READ",
      "resource": "DATASET(TRANSACT)",
      "purpose": "Reads VSAM transaction record by RIDFLD(TRAN-ID) into TRAN-RECORD for UPDATE",
      "citation": 269
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
      "purpose": "Transfers control to prior/target program (COSGN00C/COMEN01C/COTRN00C) with commarea",
      "citation": 205
    }
  ],
  "open_questions": [
    {
      "question": "Exact field layouts in copybooks (e.g., CVTRA05Y TRAN-RECORD fields, COTRN01 map fields)",
      "context": "COPY referenced but source not provided; field names inferred from moves",
      "suggestion": "Obtain and analyze copybook sources"
    },
    {
      "question": "Programs/transids calling COTRN01C (CT01)",
      "context": "Inferred from context (e.g., COTRN00C list), but no explicit callers",
      "suggestion": "Review CICS region definitions or caller code"
    },
    {
      "question": "Implications of READ UPDATE without REWRITE",
      "context": "File opened UPDATE but only read; may lock record or abend?",
      "suggestion": "Check CICS VSAM file control options or runtime behavior"
    }
  ]
}