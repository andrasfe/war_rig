{
  "header": {
    "program_id": "COBIL00C",
    "file_name": "COBIL00C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T16:44:35.645947",
    "iteration_count": 2,
    "final_status": null
  },
  "purpose": {
    "summary": "COBIL00C is a CICS online program that displays a bill payment screen (COBIL0A), receives user input for account ID and Y/N confirmation, reads account details from ACCTDAT and CXACAIX files, generates sequential transaction ID, writes bill payment record to TRANSACT if confirmed (paying full balance), updates account balance to zero, and handles aid keys ENTER/PF3/PF4.",
    "business_context": "Provides online bill payment functionality in CardDemo application, simulating POS terminal full balance payments with transaction logging.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      5,
      24,
      38,
      99
    ]
  },
  "inputs": [
    {
      "name": "COBIL0AI",
      "io_type": "CICS_MAP",
      "description": "Bill pay screen input: ACTIDINI (account ID), CONFIRMI (Y/N confirm), CURBALI (balance display)",
      "copybook": "COBIL00",
      "citation": [
        308,
        312
      ]
    },
    {
      "name": "ACCTDAT",
      "io_type": "FILE_VSAM",
      "description": "Account record with ACCT-ID key, ACCT-CURR-BAL balance, XREF-ACCT-ID",
      "copybook": "CVACT01Y",
      "citation": [
        345,
        347
      ]
    },
    {
      "name": "CXACAIX",
      "io_type": "FILE_VSAM",
      "description": "Card cross-reference record keyed by XREF-ACCT-ID, provides XREF-CARD-NUM",
      "copybook": "CSDAT01Y",
      "citation": [
        410,
        412
      ]
    },
    {
      "name": "TRANSACT",
      "io_type": "FILE_VSAM",
      "description": "Transaction records for highest TRAN-ID generation via backward browse",
      "copybook": "CVTRA05Y",
      "citation": [
        443,
        474
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Shared context: CDEMO-CB00-TRN-SELECTED (pre-selected acct ID), CDEMO-PGM-REENTER flag",
      "copybook": "COCOM01Y",
      "citation": [
        111,
        116
      ]
    },
    {
      "name": "EIBAID",
      "io_type": "CICS_COMMAREA",
      "description": "Aid key: DFHENTER (process), DFHPF3 (exit), DFHPF4 (clear)",
      "copybook": "DFHAID",
      "citation": [
        125
      ]
    }
  ],
  "outputs": [
    {
      "name": "COBIL0AO",
      "io_type": "CICS_MAP",
      "description": "Bill pay screen output: ERRMSGO (messages), header titles/dates/times, cursor position",
      "copybook": "COBIL00",
      "citation": [
        295,
        299
      ]
    },
    {
      "name": "TRANSACT",
      "io_type": "FILE_VSAM",
      "description": "New bill payment transaction: sequential TRAN-ID, type '02', full ACCT-CURR-BAL as TRAN-AMT, timestamps",
      "copybook": "CVTRA05Y",
      "citation": [
        512
      ]
    },
    {
      "name": "ACCTDAT",
      "io_type": "FILE_VSAM",
      "description": "Updated account: ACCT-CURR-BAL set to zero post-payment",
      "copybook": "CVACT01Y",
      "citation": [
        379
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated for return/XCTL: CDEMO-TO-PROGRAM, CDEMO-FROM-TRANID/PGMNAME",
      "copybook": "COCOM01Y",
      "citation": [
        146,
        282
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Exit to prior program (COSGN00C/COMEN01C) on PF3/initial entry",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 282
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CB00"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Account ID must not be empty/low-values",
      "logic_summary": "Error if ACTIDINI = SPACES/LOW-VALUES",
      "conditions": [
        "ACTIDINI OF COBIL0AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        159,
        160
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Confirmation accepts Y/y (pay), N/n/spaces/low (no pay), others invalid",
      "logic_summary": "EVALUATE CONFIRMI sets CONF-PAY-YES or clears/errors",
      "conditions": [
        "CONFIRMI OF COBIL0AI = 'Y' OR 'y'",
        "CONFIRMI OF COBIL0AI = 'N' OR 'n' OR SPACES OR LOW-VALUES"
      ],
      "citation": [
        173,
        176,
        180,
        186
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Balance >0 required for payment",
      "logic_summary": "Error if ACCT-CURR-BAL <= ZEROS",
      "conditions": [
        "ACCT-CURR-BAL <= ZEROS"
      ],
      "citation": [
        198,
        200
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Sequential TRAN-ID via backward browse from HIGH-VALUES",
      "logic_summary": "STARTBR high, READPREV gets max, +1",
      "conditions": [
        "CONF-PAY-YES"
      ],
      "citation": [
        212,
        217
      ]
    },
    {
      "rule_id": "BR005",
      "description": "PF3 exits to caller or default (COMEN01C/COSGN00C)",
      "logic_summary": "Set CDEMO-TO-PROGRAM from CDEMO-FROM-PROGRAM or defaults, XCTL",
      "conditions": [
        "EIBAID = DFHPF3"
      ],
      "citation": [
        129,
        135
      ]
    },
    {
      "rule_id": "BR006",
      "description": "PF4 clears screen fields and redisplays",
      "logic_summary": "PERFORM CLEAR-CURRENT-SCREEN on DFHPF4",
      "conditions": [
        "EIBAID = DFHPF4"
      ],
      "citation": [
        137
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "ACCTDAT",
        "fields_used": [
          "ACCT-CURR-BAL",
          "XREF-ACCT-ID"
        ],
        "citation": [
          170,
          193
        ]
      },
      {
        "source": "CXACAIX",
        "fields_used": [
          "XREF-CARD-NUM"
        ],
        "citation": [
          225
        ]
      },
      {
        "source": "TRANSACT",
        "fields_used": [
          "TRAN-ID"
        ],
        "citation": [
          216
        ]
      },
      {
        "source": "COBIL0AI",
        "fields_used": [
          "ACTIDINI",
          "CONFIRMI"
        ],
        "citation": [
          169,
          173
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "TRANSACT",
        "fields_written": [
          "TRAN-ID",
          "TRAN-TYPE-CD",
          "TRAN-AMT",
          "TRAN-CARD-NUM",
          "TRAN-ORIG-TS",
          "TRAN-PROC-TS"
        ],
        "citation": [
          219,
          220,
          224,
          225,
          231
        ]
      },
      {
        "destination": "ACCTDAT",
        "fields_written": [
          "ACCT-CURR-BAL"
        ],
        "citation": [
          234
        ]
      },
      {
        "destination": "COBIL0AO",
        "fields_written": [
          "ERRMSGO",
          "CURDATEO",
          "CURTIMEO"
        ],
        "citation": [
          293,
          332,
          338
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "TRAN-ID",
        "output_field": "WS-TRAN-ID-NUM",
        "transformation_description": "Highest TRAN-ID from READPREV +1 for new ID",
        "citation": [
          216,
          217
        ]
      },
      {
        "input_field": "ACCT-CURR-BAL",
        "output_field": "TRAN-AMT",
        "transformation_description": "Full balance copied as payment amount",
        "citation": [
          224
        ]
      },
      {
        "input_field": "ACCT-CURR-BAL",
        "output_field": "CURBALI OF COBIL0AI",
        "transformation_description": "Balance to screen via WS-CURR-BAL",
        "citation": [
          193,
          194
        ]
      },
      {
        "input_field": "WS-ABS-TIME",
        "output_field": "WS-TIMESTAMP",
        "transformation_description": "ASKTIME/FORMATTIME to YYYY-MM-DD-HH:MM:SS.000000",
        "citation": [
          251,
          264
        ]
      },
      {
        "input_field": "ACCT-CURR-BAL",
        "output_field": "ACCT-CURR-BAL",
        "transformation_description": "ACCT-CURR-BAL -= TRAN-AMT (to zero)",
        "citation": [
          234
        ]
      },
      {
        "input_field": "WS-TIMESTAMP",
        "output_field": "TRAN-ORIG-TS",
        "transformation_description": "Formatted timestamp copied to transaction timestamps",
        "citation": [
          231
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "CARDDEMO-COMMAREA and CDEMO-CB00-INFO for context/transaction selection",
      "location": "WORKING_STORAGE",
      "citation": 63
    },
    {
      "copybook_name": "COBIL00",
      "purpose": "BMS maps COBIL0AI/COBIL0AO for bill pay screen I/O",
      "location": "WORKING_STORAGE",
      "citation": 74
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Titles/constants like CCDA-TITLE01/TITLE02 for screen headers",
      "location": "WORKING_STORAGE",
      "citation": 76
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "CARD-XREF-RECORD for CXACAIX file",
      "location": "WORKING_STORAGE",
      "citation": 77
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Messages like CCDA-MSG-INVALID-KEY for error display",
      "location": "WORKING_STORAGE",
      "citation": 78
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "ACCOUNT-RECORD for ACCTDAT file",
      "location": "WORKING_STORAGE",
      "citation": 80
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "Additional account-related structures (usage unclear from source)",
      "location": "WORKING_STORAGE",
      "citation": 81
    },
    {
      "copybook_name": "CVTRA05Y",
      "purpose": "TRAN-RECORD for TRANSACT file",
      "location": "WORKING_STORAGE",
      "citation": 82
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "EIBAID for aid key processing",
      "location": "WORKING_STORAGE",
      "citation": 84
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "BMS constants DFHENTER/DFHPF3/DFHPF4/DFHGREEN",
      "location": "WORKING_STORAGE",
      "citation": 85
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Main: init flags, handle entry/reentry, aid keys, map send/receive",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-BILLPAY-SCREEN",
        "RECEIVE-BILLPAY-SCREEN",
        "CLEAR-CURRENT-SCREEN"
      ],
      "citation": [
        99,
        148
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Validate/process payment: read files, gen txn, write/update if confirmed",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN",
        "CLEAR-CURRENT-SCREEN",
        "READ-ACCTDAT-FILE",
        "READ-CXACAIX-FILE",
        "STARTBR-TRANSACT-FILE",
        "READPREV-TRANSACT-FILE",
        "ENDBR-TRANSACT-FILE",
        "GET-CURRENT-TIMESTAMP",
        "WRITE-TRANSACT-FILE",
        "UPDATE-ACCTDAT-FILE"
      ],
      "citation": [
        154,
        243
      ]
    },
    {
      "paragraph_name": "GET-CURRENT-TIMESTAMP",
      "purpose": "Format current timestamp into WS-TIMESTAMP",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [],
      "citation": [
        249,
        267
      ]
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "purpose": "XCTL to prior program",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        273,
        283
      ]
    },
    {
      "paragraph_name": "SEND-BILLPAY-SCREEN",
      "purpose": "Populate/send map with header/message",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY",
        "READ-ACCTDAT-FILE",
        "UPDATE-ACCTDAT-FILE",
        "READ-CXACAIX-FILE",
        "STARTBR-TRANSACT-FILE",
        "READPREV-TRANSACT-FILE",
        "WRITE-TRANSACT-FILE",
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        289,
        300
      ]
    },
    {
      "paragraph_name": "RECEIVE-BILLPAY-SCREEN",
      "purpose": "Receive map into COBIL0AI",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        306,
        313
      ]
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "purpose": "Set screen header date/time/titles/tranid",
      "called_by": [
        "SEND-BILLPAY-SCREEN"
      ],
      "calls": [],
      "citation": [
        319,
        338
      ]
    },
    {
      "paragraph_name": "READ-ACCTDAT-FILE",
      "purpose": "READ UPDATE ACCTDAT by ACCT-ID",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        343,
        371
      ]
    },
    {
      "paragraph_name": "UPDATE-ACCTDAT-FILE",
      "purpose": "REWRITE ACCTDAT",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        377,
        402
      ]
    },
    {
      "paragraph_name": "READ-CXACAIX-FILE",
      "purpose": "READ CXACAIX by XREF-ACCT-ID",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        408,
        435
      ]
    },
    {
      "paragraph_name": "STARTBR-TRANSACT-FILE",
      "purpose": "STARTBR backward TRANSACT high key",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        441,
        466
      ]
    },
    {
      "paragraph_name": "READPREV-TRANSACT-FILE",
      "purpose": "READPREV TRANSACT for max ID",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        472,
        495
      ]
    },
    {
      "paragraph_name": "ENDBR-TRANSACT-FILE",
      "purpose": "ENDBR TRANSACT",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [],
      "citation": [
        501,
        504
      ]
    },
    {
      "paragraph_name": "WRITE-TRANSACT-FILE",
      "purpose": "WRITE new TRANSACT, success msg or error",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        510,
        546
      ]
    },
    {
      "paragraph_name": "CLEAR-CURRENT-SCREEN",
      "purpose": "Clear fields and resend screen",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-BILLPAY-SCREEN"
      ],
      "citation": [
        552,
        555
      ]
    },
    {
      "paragraph_name": "INITIALIZE-ALL-FIELDS",
      "purpose": "Reset screen inputs and message",
      "called_by": [
        "WRITE-TRANSACT-FILE",
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [],
      "citation": [
        560,
        565
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "READ ACCTDAT NOTFND/OTHER",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        356,
        363,
        368
      ]
    },
    {
      "condition": "REWRITE ACCTDAT NOTFND/OTHER",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        387,
        391,
        396
      ]
    },
    {
      "condition": "READ CXACAIX NOTFND/OTHER",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        420,
        424,
        429
      ]
    },
    {
      "condition": "STARTBR TRANSACT NOTFND/OTHER",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        451,
        455,
        460
      ]
    },
    {
      "condition": "READPREV TRANSACT OTHER (ENDFILE sets ZEROS TRAN-ID)",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        484,
        491
      ]
    },
    {
      "condition": "WRITE TRANSACT DUPKEY/DUPREC/OTHER",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND screen",
      "citation": [
        522,
        534,
        540
      ]
    },
    {
      "condition": "ACTIDINI empty/low",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND",
      "citation": [
        159
      ]
    },
    {
      "condition": "Balance <=0",
      "action": "ERR-FLG 'Y', msg, cursor ACTIDINL, SEND",
      "citation": [
        198
      ]
    },
    {
      "condition": "Invalid CONFIRMI",
      "action": "ERR-FLG 'Y', msg, cursor CONFIRML, SEND",
      "citation": [
        186
      ]
    },
    {
      "condition": "Invalid EIBAID",
      "action": "ERR-FLG 'Y', invalid key msg, SEND",
      "citation": [
        139
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID)",
      "purpose": "Return to CICS with CB00 and commarea",
      "citation": 146
    },
    {
      "command": "ASKTIME",
      "resource": "ABSTIME(WS-ABS-TIME)",
      "purpose": "Get current absolute time",
      "citation": 251
    },
    {
      "command": "FORMATTIME",
      "resource": "ABSTIME(WS-ABS-TIME)",
      "purpose": "Format abstime to date/time strings",
      "citation": 255
    },
    {
      "command": "SEND",
      "resource": "MAP('COBIL0A') MAPSET('COBIL00')",
      "purpose": "Send bill pay screen ERASE CURSOR",
      "citation": 295
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('COBIL0A') MAPSET('COBIL00')",
      "purpose": "Receive screen into COBIL0AI",
      "citation": 308
    },
    {
      "command": "READ",
      "resource": "DATASET(WS-ACCTDAT-FILE)",
      "purpose": "Read ACCTDAT UPDATE by ACCT-ID",
      "citation": 345
    },
    {
      "command": "REWRITE",
      "resource": "DATASET(WS-ACCTDAT-FILE)",
      "purpose": "Update ACCTDAT record",
      "citation": 379
    },
    {
      "command": "READ",
      "resource": "DATASET(WS-CXACAIX-FILE)",
      "purpose": "Read CXACAIX by XREF-ACCT-ID",
      "citation": 410
    },
    {
      "command": "STARTBR",
      "resource": "DATASET(WS-TRANSACT-FILE)",
      "purpose": "Backward browse TRANSACT from high TRAN-ID",
      "citation": 443
    },
    {
      "command": "READPREV",
      "resource": "DATASET(WS-TRANSACT-FILE)",
      "purpose": "Read previous TRANSACT record",
      "citation": 474
    },
    {
      "command": "ENDBR",
      "resource": "DATASET(WS-TRANSACT-FILE)",
      "purpose": "End backward browse",
      "citation": 503
    },
    {
      "command": "WRITE",
      "resource": "DATASET(WS-TRANSACT-FILE)",
      "purpose": "Write new transaction record",
      "citation": 512
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
      "purpose": "Transfer to previous program",
      "citation": 282
    }
  ],
  "open_questions": [
    {
      "question": "Precise layouts/fields in copybooks (e.g., CVACT01Y ACCOUNT-RECORD details, CVACT03Y usage)",
      "context": "Inferred from usage but full structures unknown without copybook source",
      "suggestion": "Analyze referenced copybooks"
    },
    {
      "question": "Programs calling COBIL00C via XCTL",
      "context": "Inferred from commarea CDEMO-FROM-PROGRAM but not explicit",
      "suggestion": "Review transaction flow/callers like COSGN00C"
    }
  ]
}