{
  "header": {
    "program_id": "CBSTM03B",
    "file_name": "CBSTM03B.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T17:52:14.786502",
    "iteration_count": 2,
    "final_status": null
  },
  "purpose": {
    "summary": "This batch COBOL subroutine provides file access services limited to OPEN INPUT ('O'), sequential READ ('R') for TRNX-FILE/XREF-FILE, keyed READ ('K') for CUST-FILE/ACCT-FILE, and CLOSE ('C') based on linkage parameters for file DD name and operation. It loads read record data into linkage LK-M03B-FLDT and returns file status in LK-M03B-RC. Unrecognized DD names or operations (including defined but unused WRITE 'W'/REWRITE 'Z') result in no action and return.",
    "business_context": "Part of CardDemo application for transaction report file processing",
    "program_type": "SUBROUTINE",
    "citations": [
      2,
      5,
      6,
      7,
      8,
      26,
      103,
      104,
      105,
      106,
      107,
      108,
      114,
      116,
      118
    ]
  },
  "inputs": [
    {
      "name": "LK-M03B-AREA",
      "io_type": "PARAMETER",
      "description": "Linkage structure providing file DD name (LK-M03B-DD), operation code (LK-M03B-OPER with 88s O/C/R/K/W/Z), optional key and length (LK-M03B-KEY/LK-M03B-KEY-LN for keyed reads)",
      "copybook": null,
      "citation": [
        99,
        101,
        114,
        118,
        135,
        140,
        164,
        183,
        188,
        213
      ]
    },
    {
      "name": "TRNX-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed file (ORGANIZATION INDEXED, ACCESS SEQUENTIAL, RECORD KEY FD-TRNXS-ID composed of FD-TRNX-CARD PIC X(16) + FD-TRNX-ID PIC X(16)) with account data FD-ACCT-DATA PIC X(318)",
      "copybook": null,
      "citation": [
        141
      ]
    },
    {
      "name": "XREF-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed file (ORGANIZATION INDEXED, ACCESS SEQUENTIAL, RECORD KEY FD-XREF-CARD-NUM PIC X(16)) with data FD-XREF-DATA PIC X(34)",
      "copybook": null,
      "citation": [
        165
      ]
    },
    {
      "name": "CUST-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed file (ORGANIZATION INDEXED, ACCESS RANDOM, RECORD KEY FD-CUST-ID PIC X(09)) with customer data FD-CUST-DATA PIC X(491)",
      "copybook": null,
      "citation": [
        190
      ]
    },
    {
      "name": "ACCT-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed file (ORGANIZATION INDEXED, ACCESS RANDOM, RECORD KEY FD-ACCT-ID PIC 9(11)) with account data FD-ACCT-DATA PIC X(289)",
      "copybook": null,
      "citation": [
        215
      ]
    }
  ],
  "outputs": [
    {
      "name": "LK-M03B-FLDT",
      "io_type": "PARAMETER",
      "description": "Receives entire record data from file on successful READ or READ-K operations",
      "copybook": null,
      "citation": [
        141,
        165,
        190,
        215
      ]
    },
    {
      "name": "LK-M03B-RC",
      "io_type": "PARAMETER",
      "description": "File status code (2 bytes) set after each file operation or on fall-through",
      "copybook": null,
      "citation": [
        152,
        176,
        201,
        226
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": [
      "LK-M03B-AREA",
      "LK-M03B-DD",
      "LK-M03B-OPER",
      "LK-M03B-RC",
      "LK-M03B-KEY",
      "LK-M03B-KEY-LN",
      "LK-M03B-FLDT"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Select file processing routine based on file DD name in LK-M03B-DD",
      "logic_summary": "EVALUATE LK-M03B-DD to PERFORM specific PROC THRU EXIT",
      "conditions": [
        "LK-M03B-DD = 'TRNXFILE'",
        "LK-M03B-DD = 'XREFFILE'",
        "LK-M03B-DD = 'CUSTFILE'",
        "LK-M03B-DD = 'ACCTFILE'"
      ],
      "citation": [
        118,
        120,
        122,
        124,
        126
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Execute OPEN INPUT if operation is 'O' (M03B-OPEN)",
      "logic_summary": "IF M03B-OPEN OPEN INPUT file-name; GOTO exit",
      "conditions": [
        "M03B-OPEN (LK-M03B-OPER = 'O')"
      ],
      "citation": [
        135,
        159,
        183,
        208
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Execute sequential READ if operation is 'R' (M03B-READ) for TRNX-FILE or XREF-FILE",
      "logic_summary": "IF M03B-READ READ file INTO LK-M03B-FLDT; GOTO exit",
      "conditions": [
        "M03B-READ (LK-M03B-OPER = 'R')"
      ],
      "citation": [
        140,
        164
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Execute keyed READ if operation is 'K' (M03B-READ-K) for CUST-FILE or ACCT-FILE",
      "logic_summary": "IF M03B-READ-K MOVE key substring to file key; READ file INTO LK-M03B-FLDT; GOTO exit",
      "conditions": [
        "M03B-READ-K (LK-M03B-OPER = 'K')"
      ],
      "citation": [
        188,
        213
      ]
    },
    {
      "rule_id": "BR005",
      "description": "Execute CLOSE if operation is 'C' (M03B-CLOSE)",
      "logic_summary": "IF M03B-CLOSE CLOSE file; GOTO exit",
      "conditions": [
        "M03B-CLOSE (LK-M03B-OPER = 'C')"
      ],
      "citation": [
        146,
        170,
        195,
        220
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Unrecognized DD name or unhandled operation (not O/R/K/C, e.g. defined W/Z) results in no action",
      "logic_summary": "WHEN OTHER GO TO GOBACK for DD; unhandled OPER falls through IFs to EXIT with status move (no operation performed)",
      "conditions": [
        "LK-M03B-DD not one of four files",
        "LK-M03B-OPER not O/R/K/C"
      ],
      "citation": [
        127,
        128,
        151,
        153,
        175,
        177,
        200,
        202,
        225,
        227
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "LK-M03B-AREA",
        "fields_used": [
          "LK-M03B-DD",
          "LK-M03B-OPER",
          "LK-M03B-KEY",
          "LK-M03B-KEY-LN"
        ],
        "citation": [
          118,
          135,
          140,
          164,
          183,
          188,
          213
        ]
      },
      {
        "source": "TRNX-FILE",
        "fields_used": [
          "FD-TRNXFILE-REC"
        ],
        "citation": [
          141
        ]
      },
      {
        "source": "XREF-FILE",
        "fields_used": [
          "FD-XREFFILE-REC"
        ],
        "citation": [
          165
        ]
      },
      {
        "source": "CUST-FILE",
        "fields_used": [
          "FD-CUSTFILE-REC"
        ],
        "citation": [
          190
        ]
      },
      {
        "source": "ACCT-FILE",
        "fields_used": [
          "FD-ACCTFILE-REC"
        ],
        "citation": [
          215
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "LK-M03B-FLDT",
        "fields_written": [
          "LK-M03B-FLDT"
        ],
        "citation": [
          141,
          165,
          190,
          215
        ]
      },
      {
        "destination": "LK-M03B-RC",
        "fields_written": [
          "LK-M03B-RC"
        ],
        "citation": [
          152,
          176,
          201,
          226
        ]
      },
      {
        "destination": "FD-CUST-ID",
        "fields_written": [
          "FD-CUST-ID"
        ],
        "citation": [
          189
        ]
      },
      {
        "destination": "FD-ACCT-ID",
        "fields_written": [
          "FD-ACCT-ID"
        ],
        "citation": [
          214
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "LK-M03B-KEY (1:LK-M03B-KEY-LN)",
        "output_field": "FD-CUST-ID",
        "transformation_description": "Substring move from linkage key to file record key for random access read",
        "citation": [
          189
        ]
      },
      {
        "input_field": "LK-M03B-KEY (1:LK-M03B-KEY-LN)",
        "output_field": "FD-ACCT-ID",
        "transformation_description": "Substring move from linkage key to file record key for random access read",
        "citation": [
          214
        ]
      },
      {
        "input_field": "FD-TRNXFILE-REC",
        "output_field": "LK-M03B-FLDT",
        "transformation_description": "Direct transfer of entire record via READ INTO",
        "citation": [
          141
        ]
      },
      {
        "input_field": "FD-XREFFILE-REC",
        "output_field": "LK-M03B-FLDT",
        "transformation_description": "Direct transfer of entire record via READ INTO",
        "citation": [
          165
        ]
      },
      {
        "input_field": "FD-CUSTFILE-REC",
        "output_field": "LK-M03B-FLDT",
        "transformation_description": "Direct transfer of entire record via READ INTO after key move",
        "citation": [
          190
        ]
      },
      {
        "input_field": "FD-ACCTFILE-REC",
        "output_field": "LK-M03B-FLDT",
        "transformation_description": "Direct transfer of entire record via READ INTO after key move",
        "citation": [
          215
        ]
      },
      {
        "input_field": "TRNXFILE-STATUS",
        "output_field": "LK-M03B-RC",
        "transformation_description": "Direct move of file status code",
        "citation": [
          152
        ]
      },
      {
        "input_field": "XREFFILE-STATUS",
        "output_field": "LK-M03B-RC",
        "transformation_description": "Direct move of file status code",
        "citation": [
          176
        ]
      },
      {
        "input_field": "CUSTFILE-STATUS",
        "output_field": "LK-M03B-RC",
        "transformation_description": "Direct move of file status code",
        "citation": [
          201
        ]
      },
      {
        "input_field": "ACCTFILE-STATUS",
        "output_field": "LK-M03B-RC",
        "transformation_description": "Direct move of file status code",
        "citation": [
          226
        ]
      }
    ]
  },
  "copybooks_used": [],
  "paragraphs": [
    {
      "paragraph_name": "0000-START",
      "purpose": "Entry point: EVALUATE linkage DD name to invoke file-specific processing thru exit or GOBACK",
      "called_by": [],
      "calls": [
        "1000-TRNXFILE-PROC THRU 1999-EXIT",
        "2000-XREFFILE-PROC THRU 2999-EXIT",
        "3000-CUSTFILE-PROC THRU 3999-EXIT",
        "4000-ACCTFILE-PROC THRU 4999-EXIT"
      ],
      "citation": [
        116,
        129
      ]
    },
    {
      "paragraph_name": "1000-TRNXFILE-PROC",
      "purpose": "Handles conditional OPEN/READ/CLOSE or fall-through for TRNX-FILE",
      "called_by": [
        "0000-START"
      ],
      "calls": [
        "1900-EXIT"
      ],
      "citation": [
        133,
        150
      ]
    },
    {
      "paragraph_name": "1900-EXIT",
      "purpose": "Moves TRNXFILE-STATUS to LK-M03B-RC",
      "called_by": [
        "1000-TRNXFILE-PROC"
      ],
      "calls": [
        "1999-EXIT"
      ],
      "citation": [
        151,
        153
      ]
    },
    {
      "paragraph_name": "2000-XREFFILE-PROC",
      "purpose": "Handles conditional OPEN/READ/CLOSE or fall-through for XREF-FILE",
      "called_by": [
        "0000-START"
      ],
      "calls": [
        "2900-EXIT"
      ],
      "citation": [
        157,
        174
      ]
    },
    {
      "paragraph_name": "2900-EXIT",
      "purpose": "Moves XREFFILE-STATUS to LK-M03B-RC",
      "called_by": [
        "2000-XREFFILE-PROC"
      ],
      "calls": [
        "2999-EXIT"
      ],
      "citation": [
        175,
        177
      ]
    },
    {
      "paragraph_name": "3000-CUSTFILE-PROC",
      "purpose": "Handles conditional OPEN/READ-K/CLOSE or fall-through for CUST-FILE",
      "called_by": [
        "0000-START"
      ],
      "calls": [
        "3900-EXIT"
      ],
      "citation": [
        181,
        199
      ]
    },
    {
      "paragraph_name": "3900-EXIT",
      "purpose": "Moves CUSTFILE-STATUS to LK-M03B-RC",
      "called_by": [
        "3000-CUSTFILE-PROC"
      ],
      "calls": [
        "3999-EXIT"
      ],
      "citation": [
        200,
        202
      ]
    },
    {
      "paragraph_name": "4000-ACCTFILE-PROC",
      "purpose": "Handles conditional OPEN/READ-K/CLOSE or fall-through for ACCT-FILE",
      "called_by": [
        "0000-START"
      ],
      "calls": [
        "4900-EXIT"
      ],
      "citation": [
        206,
        224
      ]
    },
    {
      "paragraph_name": "4900-EXIT",
      "purpose": "Moves ACCTFILE-STATUS to LK-M03B-RC",
      "called_by": [
        "4000-ACCTFILE-PROC"
      ],
      "calls": [
        "4999-EXIT"
      ],
      "citation": [
        225,
        227
      ]
    },
    {
      "paragraph_name": "9999-GOBACK",
      "purpose": "Program termination for unrecognized DD",
      "called_by": [
        "0000-START"
      ],
      "calls": [],
      "citation": [
        130,
        132
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "Any file status after OPEN INPUT, READ, READ-K, CLOSE or no operation (fall-through)",
      "action": "Status unconditionally propagated to LK-M03B-RC without checks, abends, or logic; caller must interpret (typical VSAM: '00' success, '10' no current record/EOF, '23' record not found, '97' record locked)",
      "citation": [
        152,
        176,
        201,
        226
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "No copybooks used",
      "context": "Preprocessor analysis reports empty copybooks list; no COPY statements in source",
      "suggestion": "Confirmed; no further action needed"
    },
    {
      "question": "What program(s) call this subroutine and how (static/dynamic CALL)?",
      "context": "Not determinable from this source; comment mentions 'called by the statement create program'",
      "suggestion": "Analyze JCL/PROC or main program source"
    },
    {
      "question": "Why are M03B-WRITE ('W') and M03B-REWRITE ('Z') 88 conditions defined but not implemented?",
      "context": "88 levels defined in LINKAGE but no corresponding IF logic; program performs only O/R/K/C",
      "suggestion": "Check calling program or requirements spec"
    }
  ]
}