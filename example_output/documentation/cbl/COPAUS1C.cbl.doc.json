{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "cbl/COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-30T19:50:53.258245",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This program provides a detailed view of a specific pending authorization message within the CardDemo application. It allows users to view transaction details, navigate to the next authorization record, and toggle the fraud status of a transaction.",
    "business_context": "CardDemo Authorization Module - enables administrators or investigators to review flagged or pending credit card authorizations for potential fraud.",
    "program_type": "ONLINE_CICS",
    "citations": [
      3,
      5,
      188,
      191
    ]
  },
  "inputs": [
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Contains session data including account ID and the selected authorization key from the summary screen.",
      "copybook": "COCOM01Y",
      "citation": [
        152,
        171
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary root segment, accessed by Account ID.",
      "copybook": "CIPAUSMY",
      "citation": [
        440,
        442
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Details child segment, containing specific transaction data.",
      "copybook": "CIPAUDTY",
      "citation": [
        466,
        496
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1A",
      "io_type": "CICS_MAP",
      "description": "The Detail View screen displaying authorization details like card number, amount, merchant info, and fraud status.",
      "copybook": "COPAU01",
      "citation": [
        382,
        390
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Updated detail segment when fraud status is toggled.",
      "copybook": "CIPAUDTY",
      "citation": [
        525
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "Handles fraud reporting logic and validation.",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    },
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "STATIC_CALL",
      "purpose": "XCTL to the previous screen (usually COPAUS0C).",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 368
    }
  ],
  "calling_context": {
    "called_by": [
      "COPAUS0C"
    ],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Fraud Status Toggle",
      "logic_summary": "If the record is already marked as fraud, it is toggled to removed; otherwise, it is marked as confirmed fraud.",
      "conditions": [
        "IF PA-FRAUD-CONFIRMED",
        "SET PA-FRAUD-REMOVED TO TRUE",
        "SET PA-FRAUD-CONFIRMED TO TRUE"
      ],
      "citation": [
        236,
        242
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Authorization Response Mapping",
      "logic_summary": "Maps response codes to 'A' (Approved/Green) or 'D' (Declined/Red) for display.",
      "conditions": [
        "IF PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        311,
        317
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PA-CARD-NUM",
          "PA-APPROVED-AMT",
          "PA-MERCHANT-NAME"
        ],
        "citation": [
          295,
          308,
          352
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHAMTO"
        ],
        "citation": [
          295,
          301,
          309
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Reformatting YYMMDD to MM/DD/YY for display.",
        "citation": [
          297,
          301
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Common Commarea for CardDemo",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "BMS Mapset for Authorization screens",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "IMS Segment Layout for Auth Summary",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "IMS Segment Layout for Auth Details",
      "location": "WORKING_STORAGE",
      "citation": 146
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary orchestration paragraph for the CICS program. It initializes program flags and checks the EIBCALEN to determine if the program was started fresh or re-entered. If the COMMAREA is empty, it redirects to the summary screen. If valid data exists, it evaluates the user's input (EIBAID) to determine whether to process the Enter key (view details), PF3 (return), PF5 (mark fraud), or PF8 (next record). It ensures the CICS session is maintained by returning with the transaction ID and COMMAREA.",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 169
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 175
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 177
        },
        {
          "target": "RECEIVE-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 179
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 182
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 183
        },
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 186
        },
        {
          "target": "MARK-AUTH-FRAUD",
          "call_type": "performs",
          "line": 188
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 189
        },
        {
          "target": "PROCESS-PF8-KEY",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 192
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 194
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 197
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph handles the logic when the Enter key is pressed or when the program is first entered with a selection. It clears the output map and validates that the Account ID and Authorization Key are present in the COMMAREA. If valid, it calls READ-AUTH-RECORD to fetch data from the IMS database. It manages the IMS PSB state by checking if it was scheduled and then taking a syncpoint to release resources. Finally, it calls POPULATE-AUTH-DETAILS to prepare the data for the screen.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        208,
        228
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 216
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 220
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 227
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "This paragraph implements the business logic for toggling the fraud status of a transaction. It retrieves the current record from the database and checks the existing fraud flag. It then flips the flag (Confirmed to Removed or vice versa) and prepares the WS-FRAUD-DATA structure. It performs a CICS LINK to COPAUS2C to process the fraud update logic. If the link is successful and the update succeeds, it calls UPDATE-AUTH-DETAILS to commit the change to the IMS database; otherwise, it performs a rollback.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        230,
        266
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 234
        },
        {
          "target": "UPDATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 255
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 258
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 261
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 265
        },
        {
          "target": "WS-PGM-AUTH-FRAUD",
          "call_type": "calls",
          "line": 248
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 188,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "This paragraph facilitates sequential navigation through authorization records for a specific account. It first reads the current record to establish position in the IMS database and then calls READ-NEXT-AUTH-RECORD to fetch the subsequent child segment. If the end of the database is reached, it sets a message for the user. If a record is found, it updates the selection key in the COMMAREA and calls POPULATE-AUTH-DETAILS to refresh the screen with the new record's data.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        268,
        289
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 273
        },
        {
          "target": "READ-NEXT-AUTH-RECORD",
          "call_type": "performs",
          "line": 274
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 278
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 287
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph maps the raw data from the IMS PENDING-AUTH-DETAILS segment into the BMS map fields for display. It performs several data transformations, including formatting dates (YYMMDD to MM/DD/YY) and times (HHMMSS to HH:MM:SS). It also includes logic to set screen attributes, such as coloring the response code green for approvals and red for declines. It uses a SEARCH ALL statement against a hardcoded reason table to translate numeric decline codes into human-readable descriptions.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 227,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 265,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 287,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph performs the physical I/O to the IMS database to retrieve a specific authorization. It first ensures the PSB is scheduled. It then issues a 'GU' (Get Unique) call to the root segment (PAUTSUM0) using the Account ID. If the root is found, it issues a 'GNP' (Get Next within Parent) call to find the specific child segment (PAUTDTL1) matching the Authorization Key. It handles various IMS status codes, setting EOF flags or error messages as appropriate.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        431,
        491
      ],
      "outgoing_calls": [
        {
          "target": "SCHEDULE-PSB",
          "call_type": "performs",
          "line": 433
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 461
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 487
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 216,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 234,
          "call_type": "performs"
        },
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 273,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph updates an existing authorization record in the IMS database. It moves the updated fraud information into the segment layout and issues an IMS 'REPL' (Replace) command for the PAUTDTL1 segment. If the update is successful, it calls TAKE-SYNCPOINT to commit the transaction and sets a success message. If the update fails for any reason, it triggers a ROLL-BACK to ensure data integrity and reports the system error to the user.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        520,
        552
      ],
      "outgoing_calls": [
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 533
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 540
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 550
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 255,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "IMS Status Code NOT OK",
      "action": "Set error flag, format error message with status code, and display on screen.",
      "citation": [
        452,
        478,
        507
      ]
    },
    {
      "condition": "CICS Link Failure or Fraud Update Failure",
      "action": "Perform SYNCPOINT ROLLBACK to undo database changes.",
      "citation": [
        258,
        261,
        540
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "LINK",
      "resource": "COPAUS2C",
      "purpose": "Call fraud processing sub-module",
      "citation": 248
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Display the authorization detail screen",
      "citation": 381
    },
    {
      "command": "SYNCPOINT",
      "resource": "N/A",
      "purpose": "Commit database changes",
      "citation": 558
    },
    {
      "command": "SYNCPOINT ROLLBACK",
      "resource": "N/A",
      "purpose": "Undo database changes on error",
      "citation": 567
    }
  ],
  "open_questions": [],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-CONTEXT",
        "CDEMO-PGM-ENTER"
      ],
      "purpose": "Transfers control back to the previous program using CICS XCTL after setting up the necessary communication area fields."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "WS-IMS-PSB-SCHD-FLG"
      ],
      "outputs": [
        "COPAU1AO",
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-IMS-PSB-SCHD-FLG",
        "WS-ERR-FLG"
      ],
      "purpose": "Validates input account and authorization data to retrieve and populate authorization record details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG",
        "COPAU1AO"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user via CICS SEND, including any error messages and header information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RECEIVE-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [
        "COPAU1AI"
      ],
      "purpose": "Receives user input from the authorization view screen into the map input structure."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "WS-IMS-PSB-SCHD-FLG"
      ],
      "outputs": [
        "COPAU1AO",
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-IMS-PSB-SCHD-FLG",
        "WS-ERR-FLG"
      ],
      "purpose": "Validates input account and authorization data to retrieve and populate authorization record details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user with current messages and header information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-CONTEXT",
        "CDEMO-PGM-ENTER"
      ],
      "purpose": "Transfers control back to the previous program using CICS XCTL while passing the communication area."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "MARK-AUTH-FRAUD",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "CDEMO-CUST-ID",
        "WS-PGM-AUTH-FRAUD"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-REMOVE-FRAUD",
        "WS-REPORT-FRAUD",
        "WS-FRAUD-AUTH-RECORD",
        "WS-FRD-ACCT-ID",
        "WS-FRD-CUST-ID",
        "WS-MESSAGE",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "purpose": "Toggles the fraud status of an authorization record and updates the database via an external fraud program link."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Refreshes the authorization view screen to show updated data or error messages after user interaction."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-PF8-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "WS-IMS-PSB-SCHD-FLG"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-IMS-PSB-SCHD-FLG",
        "WS-SEND-ERASE-FLG",
        "WS-MESSAGE",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "purpose": "Navigates to the next authorization record in the database when the PF8 key is pressed."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Sends the authorization view screen to the CICS terminal, optionally erasing the previous screen content."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "COPAU1AO",
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-IMS-PSB-SCHD-FLG",
        "WS-ERR-FLG"
      ],
      "purpose": "Validates input data and coordinates the retrieval of authorization records and population of screen details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Sends the authorization view screen to the CICS terminal, optionally erasing the previous screen content."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PA-ACCT-ID",
        "PA-AUTHORIZATION-KEY",
        "PENDING-AUTH-SUMMARY",
        "IMS-RETURN-CODE",
        "WS-AUTHS-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE",
        "PENDING-AUTH-DETAILS"
      ],
      "purpose": "Retrieves authorization summary and detail segments from the IMS database using the account ID and authorization key."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Issues a CICS SYNCPOINT command to commit database changes and release resources."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "WS-ERR-FLG",
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "WS-DECLINE-REASON-TAB",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP"
      ],
      "outputs": [
        "CARDNUMO",
        "WS-CURDATE-YY",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-AUTH-DATE",
        "AUTHDTO",
        "WS-AUTH-TIME",
        "AUTHTMO",
        "WS-AUTH-AMT",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Maps authorization record fields and status codes to screen output variables for display."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PA-ACCT-ID",
        "PA-AUTHORIZATION-KEY",
        "PENDING-AUTH-SUMMARY",
        "IMS-RETURN-CODE",
        "WS-AUTHS-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE",
        "PENDING-AUTH-DETAILS"
      ],
      "purpose": "Retrieves authorization summary and detail segments from the IMS database using the account ID and authorization key."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "UPDATE-AUTH-DETAILS",
      "inputs": [
        "WS-FRAUD-AUTH-RECORD",
        "PAUT-PCB-NUM",
        "PA-FRAUD-REMOVED"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "WS-MESSAGE",
        "WS-ERR-FLG"
      ],
      "purpose": "Updates the authorization detail segment in the database with fraud status changes and handles the transaction syncpoint."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Executes a CICS SYNCPOINT ROLLBACK to undo database changes in the event of an error."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Executes a CICS SYNCPOINT ROLLBACK to undo database changes in the event of an error."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "WS-ERR-FLG",
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "WS-DECLINE-REASON-TAB",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP"
      ],
      "outputs": [
        "CARDNUMO",
        "WS-CURDATE-YY",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-AUTH-DATE",
        "AUTHDTO",
        "WS-AUTH-TIME",
        "AUTHTMO",
        "WS-AUTH-AMT",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Formats and moves authorization record data into screen output fields for display."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PA-ACCT-ID",
        "PA-AUTHORIZATION-KEY",
        "PENDING-AUTH-SUMMARY",
        "IMS-RETURN-CODE",
        "WS-AUTHS-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE",
        "PENDING-AUTH-DETAILS"
      ],
      "purpose": "Retrieves the authorization summary and detail records from the database based on account and authorization keys."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-NEXT-AUTH-RECORD",
      "inputs": [
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "WS-AUTHS-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Retrieves the next sequential authorization detail record from the database."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Commits database changes and releases resources by issuing a CICS SYNCPOINT."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "WS-ERR-FLG",
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "WS-DECLINE-REASON-TAB",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP"
      ],
      "outputs": [
        "CARDNUMO",
        "WS-CURDATE-YY",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-AUTH-DATE",
        "AUTHDTO",
        "WS-AUTH-TIME",
        "AUTHTMO",
        "WS-AUTH-AMT",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Formats and moves authorization record data into screen output fields for display."
    },
    {
      "caller": "SEND-AUTHVIEW-SCREEN",
      "callee": "POPULATE-HEADER-INFO",
      "inputs": [
        "CCDA-TITLE01",
        "CCDA-TITLE02",
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "WS-CURDATE-DATA",
        "WS-CURDATE-MONTH",
        "WS-CURDATE-DAY",
        "WS-CURDATE-YEAR",
        "WS-CURTIME-HOURS",
        "WS-CURTIME-MINUTE",
        "WS-CURTIME-SECOND"
      ],
      "outputs": [
        "WS-CURDATE-DATA",
        "TITLE01O",
        "TITLE02O",
        "TRNNAMEO",
        "PGMNAMEO",
        "WS-CURDATE-MM",
        "WS-CURDATE-DD",
        "WS-CURDATE-YY",
        "CURDATEO",
        "WS-CURTIME-HH",
        "WS-CURTIME-MM",
        "WS-CURTIME-SS",
        "CURTIMEO"
      ],
      "purpose": "Populates the screen header fields with system date, time, and program identifiers."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SCHEDULE-PSB",
      "inputs": [
        "PSB-NAME",
        "DIBSTAT"
      ],
      "outputs": [
        "IMS-RETURN-CODE",
        "WS-IMS-PSB-SCHD-FLG",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Schedules the IMS PSB for database access and handles potential scheduling errors."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user, typically to report a system error during record retrieval."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user, typically to report a system error during record retrieval."
    },
    {
      "caller": "READ-NEXT-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user when an error occurs while reading the next sequential authorization record."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Commits the database changes by issuing a CICS SYNCPOINT."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Reverts database changes by issuing a CICS SYNCPOINT ROLLBACK in the event of an error."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to the user, typically showing error messages after a failed update."
    },
    {
      "caller": "SCHEDULE-PSB",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "WS-SEND-ERASE-FLG"
      ],
      "outputs": [
        "ERRMSGO",
        "CARDNUML"
      ],
      "purpose": "Displays the authorization view screen to report a system error when the IMS PSB cannot be scheduled."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: COPAUS1C.cbl\n    MAIN_PARA[\"MAIN-PARA\"]\n    MARK_AUTH_FRAUD[\"MARK-AUTH-FRAUD\"]\n    PROCESS_ENTER_KEY[\"PROCESS-ENTER-KEY\"]\n    PROCESS_PF8_KEY[\"PROCESS-PF8-KEY\"]\n    RECEIVE_AUTHVIEW_SCREEN[\"RECEIVE-AUTHVIEW-SCREEN\"]\n    RETURN_TO_PREV_SCREEN[\"RETURN-TO-PREV-SCREEN\"]\n    SEND_AUTHVIEW_SCREEN[\"SEND-AUTHVIEW-SCREEN\"]\n    POPULATE_AUTH_DETAILS[\"POPULATE-AUTH-DETAILS\"]\n    READ_AUTH_RECORD[\"READ-AUTH-RECORD\"]\n    ROLL_BACK[\"ROLL-BACK\"]\n    UPDATE_AUTH_DETAILS[\"UPDATE-AUTH-DETAILS\"]\n    WS_PGM_AUTH_FRAUD__ext([\"WS-PGM-AUTH-FRAUD\"])\n    POPULATE_HEADER_INFO[\"POPULATE-HEADER-INFO\"]\n    TAKE_SYNCPOINT[\"TAKE-SYNCPOINT\"]\n    READ_NEXT_AUTH_RECORD[\"READ-NEXT-AUTH-RECORD\"]\n    SCHEDULE_PSB[\"SCHEDULE-PSB\"]\n    CDEMO_TO_PROGRAM__ext([\"CDEMO-TO-PROGRAM\"])\n    MAIN_PARA --> MARK_AUTH_FRAUD\n    MAIN_PARA --> PROCESS_ENTER_KEY\n    MAIN_PARA --> PROCESS_PF8_KEY\n    MAIN_PARA --> RECEIVE_AUTHVIEW_SCREEN\n    MAIN_PARA --> RETURN_TO_PREV_SCREEN\n    MAIN_PARA --> SEND_AUTHVIEW_SCREEN\n    MARK_AUTH_FRAUD --> POPULATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD --> READ_AUTH_RECORD\n    MARK_AUTH_FRAUD --> ROLL_BACK\n    MARK_AUTH_FRAUD --> UPDATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD -.->|calls| WS_PGM_AUTH_FRAUD__ext\n    PROCESS_ENTER_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_ENTER_KEY --> READ_AUTH_RECORD\n    PROCESS_ENTER_KEY --> TAKE_SYNCPOINT\n    PROCESS_PF8_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_PF8_KEY --> READ_AUTH_RECORD\n    PROCESS_PF8_KEY --> READ_NEXT_AUTH_RECORD\n    PROCESS_PF8_KEY --> TAKE_SYNCPOINT\n    READ_AUTH_RECORD --> SCHEDULE_PSB\n    READ_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    READ_NEXT_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    RETURN_TO_PREV_SCREEN -.->|calls| CDEMO_TO_PROGRAM__ext\n    SCHEDULE_PSB --> SEND_AUTHVIEW_SCREEN\n    SEND_AUTHVIEW_SCREEN --> POPULATE_HEADER_INFO\n    UPDATE_AUTH_DETAILS --> ROLL_BACK\n    UPDATE_AUTH_DETAILS --> SEND_AUTHVIEW_SCREEN\n    UPDATE_AUTH_DETAILS --> TAKE_SYNCPOINT"
}