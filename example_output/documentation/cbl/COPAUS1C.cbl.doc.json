{
  "header": {
    "program_id": "COPAUS1C",
    "file_name": "COPAUS1C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-03T21:21:07.310002",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This CICS COBOL program, COPAUS1C, displays detailed information about a selected authorization record. It retrieves authorization details from an IMS database, allows marking authorizations as fraudulent, and links to another program to update fraud status. It is part of the CardDemo application's authorization module.",
    "business_context": "This program is used to view and manage authorization details within the CardDemo application, likely for customer service or fraud investigation purposes.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      4,
      5,
      23
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Communication area passed between CICS programs, containing account ID, selected authorization key, and other context data.",
      "copybook": "COCOM01Y",
      "citation": [
        171,
        204
      ]
    },
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary segment from IMS database, containing summary information about the authorization.",
      "copybook": "CIPAUSMY",
      "citation": [
        441
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Details segment from IMS database, containing detailed information about the authorization.",
      "copybook": "CIPAUDTY",
      "citation": [
        467
      ]
    },
    {
      "name": "COPAU1AI",
      "io_type": "CICS_MAP",
      "description": "Input map for the COPAU1A screen, used to receive data entered by the user.",
      "copybook": "COPAU01",
      "citation": [
        403
      ]
    }
  ],
  "outputs": [
    {
      "name": "COPAU1AO",
      "io_type": "CICS_MAP",
      "description": "Output map for the COPAU1A screen, used to display authorization details and messages to the user.",
      "copybook": "COPAU01",
      "citation": [
        384,
        392
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COPAUS0C",
      "call_type": "STATIC_CALL",
      "purpose": "Returns to the authorization summary screen.",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 168
    },
    {
      "program_name": "COPAUS2C",
      "call_type": "CICS_LINK",
      "purpose": "Updates the fraud status of an authorization record.",
      "parameters": [
        "WS-FRAUD-DATA"
      ],
      "citation": 249
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CPVD"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "If the account ID is numeric and an authorization is selected, read the authorization record from the IMS database.",
      "logic_summary": "Checks if CDEMO-ACCT-ID is numeric and CDEMO-CPVD-PAU-SELECTED is not spaces or low-values. If both conditions are true, it reads the authorization record.",
      "conditions": [
        "CDEMO-ACCT-ID IS NUMERIC",
        "CDEMO-CPVD-PAU-SELECTED NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        211,
        212
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Determine the fraud status of an authorization and set the appropriate flag.",
      "logic_summary": "Checks if the authorization is already marked as fraud. If so, it removes the fraud flag; otherwise, it sets the fraud flag.",
      "conditions": [
        "PA-FRAUD-CONFIRMED"
      ],
      "citation": [
        236,
        237,
        240
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-ACCT-ID",
          "CDEMO-CPVD-PAU-SELECTED",
          "CDEMO-CUST-ID"
        ],
        "citation": [
          213,
          214,
          246
        ]
      },
      {
        "source": "PENDING-AUTH-SUMMARY",
        "fields_used": [
          "PA-ACCT-ID",
          "PA-AUTHORIZATION-KEY"
        ],
        "citation": [
          436,
          437
        ]
      },
      {
        "source": "PENDING-AUTH-DETAILS",
        "fields_used": [
          "PA-CARD-NUM",
          "PA-AUTH-ORIG-DATE",
          "PA-AUTH-ORIG-TIME",
          "PA-APPROVED-AMT",
          "PA-AUTH-RESP-CODE",
          "PA-AUTH-RESP-REASON",
          "PA-PROCESSING-CODE",
          "PA-POS-ENTRY-MODE",
          "PA-MESSAGE-SOURCE",
          "PA-MERCHANT-CATAGORY-CODE",
          "PA-CARD-EXPIRY-DATE",
          "PA-AUTH-TYPE",
          "PA-TRANSACTION-ID",
          "PA-MATCH-STATUS",
          "PA-AUTH-FRAUD",
          "PA-FRAUD-RPT-DATE",
          "PA-MERCHANT-NAME",
          "PA-MERCHANT-ID",
          "PA-MERCHANT-CITY",
          "PA-MERCHANT-STATE",
          "PA-MERCHANT-ZIP"
        ],
        "citation": [
          295,
          297,
          303,
          308,
          311,
          324,
          331,
          332,
          333,
          334,
          336,
          340,
          341,
          342,
          345,
          347,
          352,
          353,
          354,
          355,
          356
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COPAU1AO",
        "fields_written": [
          "CARDNUMO",
          "AUTHDTO",
          "AUTHTMO",
          "AUTHAMTO",
          "AUTHRSPO",
          "AUTHRSPC",
          "AUTHRSNO",
          "AUTHCDO",
          "POSEMDO",
          "AUTHSRCO",
          "MCCCDO",
          "CRDEXPO",
          "AUTHTYPO",
          "TRNIDO",
          "AUTHMTCO",
          "AUTHFRDO",
          "MERNAMEO",
          "MERIDO",
          "MERCITYO",
          "MERSTO",
          "MERZIPO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO",
          "ERRMSGO"
        ],
        "citation": [
          295,
          301,
          306,
          309,
          312,
          314,
          321,
          331,
          332,
          333,
          334,
          336,
          340,
          341,
          342,
          345,
          352,
          353,
          354,
          355,
          356,
          413,
          414,
          415,
          416,
          422,
          428,
          377
        ]
      },
      {
        "destination": "PENDING-AUTH-DETAILS",
        "fields_written": [
          "PA-AUTH-FRAUD",
          "PA-FRAUD-RPT-DATE"
        ],
        "citation": [
          522
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-ORIG-DATE",
        "output_field": "AUTHDTO",
        "transformation_description": "Formats the authorization date from YYMMDD to MM/DD/YY.",
        "citation": [
          297,
          298,
          299,
          300,
          301
        ]
      },
      {
        "input_field": "PA-AUTH-ORIG-TIME",
        "output_field": "AUTHTMO",
        "transformation_description": "Formats the authorization time from HHMMSS to HH:MM:SS.",
        "citation": [
          303,
          304,
          305,
          306
        ]
      },
      {
        "input_field": "PA-APPROVED-AMT",
        "output_field": "AUTHAMTO",
        "transformation_description": "Formats the approved amount to a displayable format.",
        "citation": [
          308,
          309
        ]
      },
      {
        "input_field": "PA-CARD-EXPIRY-DATE",
        "output_field": "CRDEXPO",
        "transformation_description": "Formats the card expiry date from YYMM to MM/YY.",
        "citation": [
          336,
          337,
          338
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Defines the CARDDEMO-COMMAREA used for communication between CardDemo programs.",
      "location": "LINKAGE",
      "citation": 109
    },
    {
      "copybook_name": "COPAU01",
      "purpose": "Defines the BMS map structures (COPAU1A) for the authorization detail view screen.",
      "location": "WORKING_STORAGE",
      "citation": 122
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Defines screen titles.",
      "location": "WORKING_STORAGE",
      "citation": 126
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Defines current date variables.",
      "location": "WORKING_STORAGE",
      "citation": 129
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Defines common messages.",
      "location": "WORKING_STORAGE",
      "citation": 132
    },
    {
      "copybook_name": "CSMSG02Y",
      "purpose": "Defines abend variables.",
      "location": "WORKING_STORAGE",
      "citation": 135
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines the PENDING-AUTH-SUMMARY segment layout for IMS.",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines the PENDING-AUTH-DETAILS segment layout for IMS.",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "Defines the CICS AID (Attention Identifier) constants.",
      "location": "WORKING_STORAGE",
      "citation": 148
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "Defines the CICS BMS Communication Area constants.",
      "location": "WORKING_STORAGE",
      "citation": 149
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the main paragraph that controls the overall program flow. It first initializes flags and variables, then checks if the program is being called for the first time (EIBCALEN = 0). If it's the first time, it initializes the CARDDEMO-COMMAREA and calls RETURN-TO-PREV-SCREEN to return to the authorization summary screen. If it's a re-entry, it moves the DFHCOMMAREA to CARDDEMO-COMMAREA and processes the user's input based on the EIBAID. Depending on the AID, it performs different actions such as processing the ENTER key, returning to the previous screen (PF3), marking authorization as fraud (PF5), or processing PF8 to read the next authorization record. If an invalid key is pressed, it displays an error message. Finally, it returns to CICS with the updated COMMAREA.",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-AUTHVIEW-SCREEN",
        "RECEIVE-AUTHVIEW-SCREEN",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "citation": [
        157,
        206
      ],
      "outgoing_calls": [
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 169
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 175
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 177
        },
        {
          "target": "RECEIVE-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 179
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 182
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 183
        },
        {
          "target": "RETURN-TO-PREV-SCREEN",
          "call_type": "performs",
          "line": 186
        },
        {
          "target": "MARK-AUTH-FRAUD",
          "call_type": "performs",
          "line": 188
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 189
        },
        {
          "target": "PROCESS-PF8-KEY",
          "call_type": "performs",
          "line": 191
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 192
        },
        {
          "target": "PROCESS-ENTER-KEY",
          "call_type": "performs",
          "line": 194
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 197
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "summary": null,
      "purpose": "This paragraph handles the processing when the user presses the ENTER key. It initializes the COPAU1AO map and checks if the account ID is numeric and an authorization is selected. If both conditions are met, it moves the account ID and authorization key to working storage variables and calls READ-AUTH-RECORD to retrieve the authorization details from the IMS database. If the PSB is scheduled, it takes a syncpoint. If the account ID is not numeric or no authorization is selected, it sets the error flag. Finally, it calls POPULATE-AUTH-DETAILS to populate the screen fields with the retrieved data.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        208,
        228
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 216
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 220
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 227
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "MARK-AUTH-FRAUD",
      "summary": null,
      "purpose": "This paragraph handles the process of marking or unmarking an authorization record as fraudulent. It moves the account ID and authorization key to working storage. It then calls READ-AUTH-RECORD to retrieve the authorization details. If the authorization is already marked as fraud, it removes the fraud flag (PA-FRAUD-REMOVED); otherwise, it sets the fraud flag (PA-FRAUD-CONFIRMED). It then moves the PENDING-AUTH-DETAILS to WS-FRAUD-AUTH-RECORD, the account ID to WS-FRD-ACCT-ID, and the customer ID to WS-FRD-CUST-ID. It then links to the COPAUS2C program to update the fraud status. If the link is successful and the update is successful, it calls UPDATE-AUTH-DETAILS. Otherwise, it displays an error message and performs a rollback. Finally, it populates the authorization details on the screen.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "ROLL-BACK",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        230,
        266
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 234
        },
        {
          "target": "UPDATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 255
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 258
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 261
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 265
        },
        {
          "target": "WS-PGM-AUTH-FRAUD",
          "call_type": "calls",
          "line": 248
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 188,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "PROCESS-PF8-KEY",
      "summary": null,
      "purpose": "This paragraph handles the processing when the user presses the PF8 key to view the next authorization record. It moves the account ID and authorization key to working storage variables and calls READ-AUTH-RECORD to retrieve the current authorization details. It then calls READ-NEXT-AUTH-RECORD to retrieve the next authorization record. If the PSB is scheduled, it takes a syncpoint. If there are no more authorization records (AUTHS-EOF), it sets a flag to prevent erasing the screen and displays a message indicating that the user is already at the last authorization. Otherwise, it moves the authorization key of the next record to CDEMO-CPVD-PAU-SELECTED and calls POPULATE-AUTH-DETAILS to display the details of the next authorization record.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "TAKE-SYNCPOINT",
        "POPULATE-AUTH-DETAILS"
      ],
      "citation": [
        268,
        289
      ],
      "outgoing_calls": [
        {
          "target": "READ-AUTH-RECORD",
          "call_type": "performs",
          "line": 273
        },
        {
          "target": "READ-NEXT-AUTH-RECORD",
          "call_type": "performs",
          "line": 274
        },
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 278
        },
        {
          "target": "POPULATE-AUTH-DETAILS",
          "call_type": "performs",
          "line": 287
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph populates the authorization details on the screen (COPAU1AO) with data from the PENDING-AUTH-DETAILS segment. It moves various fields from the PENDING-AUTH-DETAILS segment to the corresponding output fields in the COPAU1AO map, formatting the date, time, and amount as needed. It determines the authorization response status (approved or declined) and sets the corresponding indicator and color. It searches the WS-DECLINE-REASON-TAB table to find the description of the decline reason code and displays it on the screen. It also handles the display of fraud information, displaying the fraud report date if the authorization is marked as fraudulent.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        291,
        358
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 227,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 265,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 287,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "summary": null,
      "purpose": "This paragraph prepares the COMMAREA for returning to the previous screen (authorization summary). It moves the CICS transaction ID and the current program ID to the CARDDEMO-COMMAREA. It sets the program context to zero and sets the program enter flag to true. Finally, it performs a CICS XCTL to the program specified in CDEMO-TO-PROGRAM, passing the CARDDEMO-COMMAREA.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        360,
        371
      ],
      "outgoing_calls": [
        {
          "target": "CDEMO-TO-PROGRAM",
          "call_type": "calls",
          "line": 367
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SEND-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph sends the authorization detail view screen (COPAU1A) to the terminal. It first calls POPULATE-HEADER-INFO to populate the header information on the screen. It then moves any error messages to the ERRMSGO field in the COPAU1AO map. If the SEND-ERASE-YES flag is set, it sends the map with the ERASE option, clearing the screen before displaying the data. Otherwise, it sends the map without the ERASE option, overlaying the new data on the existing screen content. In both cases, the CURSOR option is used to position the cursor on the screen.",
      "called_by": [
        "MAIN-PARA",
        "READ-AUTH-RECORD",
        "READ-NEXT-AUTH-RECORD",
        "UPDATE-AUTH-DETAILS",
        "SCHEDULE-PSB"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        373,
        396
      ],
      "outgoing_calls": [
        {
          "target": "POPULATE-HEADER-INFO",
          "call_type": "performs",
          "line": 375
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 177,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-AUTH-RECORD",
          "line": 461,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "READ-NEXT-AUTH-RECORD",
          "line": 516,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 550,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "SCHEDULE-PSB",
          "line": 601,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "RECEIVE-AUTHVIEW-SCREEN",
      "summary": null,
      "purpose": "This paragraph receives data from the COPAU1A screen. It executes a CICS RECEIVE command to receive the data entered by the user into the COPAU1AI map. The NOHANDLE option is specified to prevent CICS from handling any errors that occur during the receive operation; the program will handle any errors itself.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        398,
        406
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MAIN-PARA",
          "line": 179,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "summary": null,
      "purpose": "This paragraph populates the header information on the screen. It moves the current date and time to working storage variables. It then moves the title strings, transaction ID, and program ID to the corresponding output fields in the COPAU1AO map. It formats the current date and time and moves them to the CURDATEO and CURTIMEO fields in the COPAU1AO map.",
      "called_by": [
        "SEND-AUTHVIEW-SCREEN"
      ],
      "calls": [],
      "citation": [
        409,
        429
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph reads the authorization record from the IMS database. It first calls SCHEDULE-PSB to schedule the PSB. It then moves the account ID and authorization key from working storage to the PA-ACCT-ID and PA-AUTHORIZATION-KEY fields. It then executes a DLI GU (Get Unique) command to retrieve the PENDING-AUTH-SUMMARY segment from the IMS database, using the account ID as the search key. If the segment is found, it executes a DLI GNP (Get Next within Parent) command to retrieve the PENDING-AUTH-DETAILS segment, using the authorization key as the search key. If any errors occur during the read operation, it sets the error flag and displays an error message.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "MARK-AUTH-FRAUD",
        "PROCESS-PF8-KEY"
      ],
      "calls": [
        "SCHEDULE-PSB"
      ],
      "citation": [
        431,
        491
      ],
      "outgoing_calls": [
        {
          "target": "SCHEDULE-PSB",
          "call_type": "performs",
          "line": 433
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 461
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 487
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 216,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 234,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 273,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "READ-NEXT-AUTH-RECORD",
      "summary": null,
      "purpose": "This paragraph reads the next authorization detail record from the IMS database. It executes a DLI GNP (Get Next within Parent) command to retrieve the next PENDING-AUTH-DETAILS segment. It checks the IMS return code (DIBSTAT) to determine if the read was successful. If the read is successful, it sets the AUTHS-NOT-EOF flag to true. If the end of the database is reached, it sets the AUTHS-EOF flag to true. If any other error occurs, it sets the error flag and displays an error message.",
      "called_by": [
        "PROCESS-PF8-KEY"
      ],
      "calls": [],
      "citation": [
        493,
        518
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 516
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 274,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "UPDATE-AUTH-DETAILS",
      "summary": null,
      "purpose": "This paragraph updates the authorization details in the IMS database. It moves the WS-FRAUD-AUTH-RECORD to the PENDING-AUTH-DETAILS segment. It then executes a DLI REPL (Replace) command to update the PENDING-AUTH-DETAILS segment in the IMS database. It checks the IMS return code (DIBSTAT) to determine if the update was successful. If the update is successful, it performs a syncpoint and displays a message indicating whether the authorization was marked or removed as fraud. If the update fails, it performs a rollback and displays an error message.",
      "called_by": [
        "MARK-AUTH-FRAUD"
      ],
      "calls": [
        "TAKE-SYNCPOINT",
        "ROLL-BACK",
        "SEND-AUTHVIEW-SCREEN"
      ],
      "citation": [
        520,
        552
      ],
      "outgoing_calls": [
        {
          "target": "TAKE-SYNCPOINT",
          "call_type": "performs",
          "line": 533
        },
        {
          "target": "ROLL-BACK",
          "call_type": "performs",
          "line": 540
        },
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 550
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 255,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "TAKE-SYNCPOINT",
      "summary": null,
      "purpose": "This paragraph takes a syncpoint, which commits the changes made to the database. It executes a CICS SYNCPOINT command to commit the changes.",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "PROCESS-PF8-KEY",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        557,
        560
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-ENTER-KEY",
          "line": 220,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "PROCESS-PF8-KEY",
          "line": 278,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 533,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "ROLL-BACK",
      "summary": null,
      "purpose": "This paragraph rolls back the database changes. It executes a CICS SYNCPOINT ROLLBACK command to undo any changes made to the database since the last syncpoint.",
      "called_by": [
        "MARK-AUTH-FRAUD",
        "UPDATE-AUTH-DETAILS"
      ],
      "calls": [],
      "citation": [
        565,
        569
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "MARK-AUTH-FRAUD",
          "line": 258,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/COPAUS1C.cbl",
          "function": "UPDATE-AUTH-DETAILS",
          "line": 540,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "SCHEDULE-PSB",
      "summary": null,
      "purpose": "This paragraph schedules the PSB (Program Specification Block) for IMS database access. It executes a DLI SCHD (Schedule) command to schedule the PSB specified in PSB-NAME. If the PSB is already scheduled, it terminates the current PSB and schedules it again. It checks the IMS return code (DIBSTAT) to determine if the scheduling was successful. If the scheduling is successful, it sets the IMS-PSB-SCHD flag to true. If the scheduling fails, it sets the error flag and displays an error message.",
      "called_by": [
        "READ-AUTH-RECORD"
      ],
      "calls": [],
      "citation": [
        574,
        603
      ],
      "outgoing_calls": [
        {
          "target": "SEND-AUTHVIEW-SCREEN",
          "call_type": "performs",
          "line": 601
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "EIBCALEN = 0",
      "action": "Return to the previous screen (authorization summary).",
      "citation": [
        165,
        169
      ]
    },
    {
      "condition": "Account ID is not numeric or no authorization is selected",
      "action": "Set the error flag.",
      "citation": [
        223,
        224
      ]
    },
    {
      "condition": "EIBRESP not equal to DFHRESP(NORMAL) after LINK to COPAUS2C",
      "action": "Perform ROLL-BACK.",
      "citation": [
        253,
        261
      ]
    },
    {
      "condition": "WS-FRD-UPDT-SUCCESS is false after LINK to COPAUS2C",
      "action": "Move WS-FRD-ACT-MSG to WS-MESSAGE and perform ROLL-BACK.",
      "citation": [
        254,
        257,
        258
      ]
    },
    {
      "condition": "IMS-RETURN-CODE is not STATUS-OK in READ-AUTH-RECORD",
      "action": "Set ERR-FLG-ON to TRUE and display an error message.",
      "citation": [
        452,
        453,
        455
      ]
    },
    {
      "condition": "IMS-RETURN-CODE is not STATUS-OK in READ-NEXT-AUTH-RECORD",
      "action": "Set ERR-FLG-ON to TRUE and display an error message.",
      "citation": [
        507,
        508,
        510
      ]
    },
    {
      "condition": "IMS-RETURN-CODE is not STATUS-OK in UPDATE-AUTH-DETAILS",
      "action": "Perform ROLL-BACK, set ERR-FLG-ON to TRUE and display an error message.",
      "citation": [
        539,
        540,
        542,
        544
      ]
    },
    {
      "condition": "IMS-RETURN-CODE is not STATUS-OK in SCHEDULE-PSB",
      "action": "Set ERR-FLG-ON to TRUE and display an error message.",
      "citation": [
        590,
        593,
        595
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": null,
      "purpose": "Returns control to CICS.",
      "citation": 202
    },
    {
      "command": "XCTL",
      "resource": "CDEMO-TO-PROGRAM",
      "purpose": "Transfers control to another CICS program.",
      "citation": 368
    },
    {
      "command": "SEND MAP",
      "resource": "COPAU1A",
      "purpose": "Sends the authorization view screen to the terminal.",
      "citation": 382
    },
    {
      "command": "RECEIVE MAP",
      "resource": "COPAU1A",
      "purpose": "Receives data from the authorization view screen.",
      "citation": 401
    },
    {
      "command": "SYNCPOINT",
      "resource": null,
      "purpose": "Takes a syncpoint to commit database changes.",
      "citation": 558
    },
    {
      "command": "SYNCPOINT ROLLBACK",
      "resource": null,
      "purpose": "Rolls back database changes.",
      "citation": 567
    },
    {
      "command": "LINK",
      "resource": "COPAUS2C",
      "purpose": "Links to the fraud processing program.",
      "citation": 248
    }
  ],
  "open_questions": [
    {
      "question": "What is the exact format and content of the COPAU1A BMS map?",
      "context": "The copybook COPAU01 is included, but the actual BMS definition is not available.",
      "suggestion": "Review the BMS source code for COPAU1A to understand the screen layout and field attributes."
    },
    {
      "question": "What is the purpose of the CDEMO-PGM-CONTEXT field in the CARDDEMO-COMMAREA?",
      "context": "It is moved ZEROS to this field in RETURN-TO-PREV-SCREEN, but its purpose is not clear from this program.",
      "suggestion": "Review other programs that use the CARDDEMO-COMMAREA to understand how this field is used."
    }
  ],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-CONTEXT",
        "CDEMO-PGM-ENTER"
      ],
      "purpose": "Returns control to the previous screen by XCTL'ing to the program specified in CDEMO-TO-PROGRAM with updated context and return information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "ERR-FLG",
        "COPAU1AO"
      ],
      "purpose": "Processes the ENTER key by validating input account and authorization key, reading the authorization record, and populating details if input is valid."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES",
        "COPAU1AO"
      ],
      "outputs": [],
      "purpose": "Sends the COPAU1A map to the terminal, optionally erasing the screen, based on the message and erase flag settings."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RECEIVE-AUTHVIEW-SCREEN",
      "inputs": [],
      "outputs": [],
      "purpose": "Receives the COPAU1A map input from the terminal into the COPAU1AI structure without handling exceptions."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "ERR-FLG",
        "COPAU1AO"
      ],
      "purpose": "Processes the ENTER key by validating input account and authorization key, reading the authorization record, and populating details if input is valid."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen with optional erase based on the flag, displaying the current message and populating header information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "RETURN-TO-PREV-SCREEN",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL",
        "CDEMO-TO-PROGRAM"
      ],
      "outputs": [
        "CDEMO-FROM-TRANID",
        "CDEMO-FROM-PROGRAM",
        "CDEMO-PGM-ENTER",
        "CDEMO-PGM-CONTEXT"
      ],
      "purpose": "Sets return context and XCTLs to the previous program specified in the communication area."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "MARK-AUTH-FRAUD",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED",
        "CDEMO-CUST-ID"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "WS-FRAUD-AUTH-RECORD",
        "WS-FRD-ACCT-ID",
        "WS-FRD-CUST-ID",
        "WS-MESSAGE",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "WS-REMOVE-FRAUD",
        "WS-REPORT-FRAUD",
        "WS-FRD-UPDT-SUCCESS",
        "WS-FRD-ACT-MSG"
      ],
      "purpose": "Marks the selected authorization as fraud or removes fraud flag by updating the record and linking to the fraud processing program."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen with optional erase based on the flag, displaying the current message and populating header information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-PF8-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "SEND-ERASE-NO",
        "WS-MESSAGE",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "purpose": "Processes the PF8 key to navigate to the next authorization record for the account and updates screen data accordingly."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the user, optionally erasing the screen based on the SEND-ERASE-YES flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "PROCESS-ENTER-KEY",
      "inputs": [
        "CDEMO-ACCT-ID",
        "CDEMO-CPVD-PAU-SELECTED"
      ],
      "outputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY",
        "ERR-FLG-ON"
      ],
      "purpose": "Processes the ENTER key by validating input data, setting up authorization keys, and reading the corresponding authorization record."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends the authorization view screen to the user, optionally erasing the screen based on the SEND-ERASE-YES flag."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "AUTHS-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE",
        "AUTHS-NOT-EOF"
      ],
      "purpose": "Reads the pending authorization summary and detail records from IMS using account ID and authorization key as input."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS syncpoint to commit the current unit of work if the IMS PSB was scheduled."
    },
    {
      "caller": "PROCESS-ENTER-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "ERR-FLG-ON",
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-AUTH-TIME",
        "WS-AUTH-AMT",
        "CARDNUMO",
        "AUTHDTO",
        "AUTHTMO",
        "AUTHAMTO",
        "AUTHRSPO",
        "AUTHRSPC",
        "AUTHRSNO",
        "AUTHCDO",
        "POSEMDO",
        "AUTHSRCO",
        "MCCCDO",
        "CRDEXPO",
        "AUTHTYPO",
        "TRNIDO",
        "AUTHMTCO",
        "AUTHFRDO",
        "MERNAMEO",
        "MERIDO",
        "MERCITYO",
        "MERSTO",
        "MERZIPO"
      ],
      "purpose": "Populates the authorization details screen output fields using data from the PAUTDTL1 segment if no error flag is set."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "PA-ACCT-ID",
        "PA-AUTHORIZATION-KEY",
        "PENDING-AUTH-SUMMARY",
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF"
      ],
      "purpose": "Reads the pending authorization summary and detail records from IMS using the account ID and authorization key."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "UPDATE-AUTH-DETAILS",
      "inputs": [
        "WS-FRAUD-AUTH-RECORD",
        "PA-FRAUD-RPT-DATE",
        "PA-FRAUD-REMOVED"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "WS-MESSAGE"
      ],
      "purpose": "Updates the authorization details segment in IMS with fraud status changes and issues a syncpoint or rollback based on success."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS rollback to undo database changes due to an error in fraud update processing."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Performs a CICS rollback to undo database changes due to an error in fraud update processing."
    },
    {
      "caller": "MARK-AUTH-FRAUD",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP",
        "ERR-FLG"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-AUTH-AMT",
        "WS-AUTH-TIME"
      ],
      "purpose": "Populates the authorization details screen fields using data from the PAUT segment and working storage, conditionally formatting output based on response code and fraud status."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-AUTH-RECORD",
      "inputs": [
        "WS-ACCT-ID",
        "WS-AUTH-KEY"
      ],
      "outputs": [
        "PA-ACCT-ID",
        "PA-AUTHORIZATION-KEY",
        "PENDING-AUTH-SUMMARY",
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Reads the authorization summary and detail records from IMS using the account ID and authorization key, setting EOF and error flags accordingly."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "READ-NEXT-AUTH-RECORD",
      "inputs": [],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "IMS-RETURN-CODE",
        "AUTHS-EOF",
        "AUTHS-NOT-EOF",
        "WS-ERR-FLG",
        "WS-MESSAGE"
      ],
      "purpose": "Reads the next authorization detail record from IMS in sequence, updating EOF and error status based on the result."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Issues a CICS SYNCPOINT to commit the current unit of work if an IMS PSB was scheduled."
    },
    {
      "caller": "PROCESS-PF8-KEY",
      "callee": "POPULATE-AUTH-DETAILS",
      "inputs": [
        "PA-CARD-NUM",
        "PA-AUTH-ORIG-DATE",
        "PA-AUTH-ORIG-TIME",
        "PA-APPROVED-AMT",
        "PA-AUTH-RESP-CODE",
        "PA-AUTH-RESP-REASON",
        "PA-PROCESSING-CODE",
        "PA-POS-ENTRY-MODE",
        "PA-MESSAGE-SOURCE",
        "PA-MERCHANT-CATAGORY-CODE",
        "PA-CARD-EXPIRY-DATE",
        "PA-AUTH-TYPE",
        "PA-TRANSACTION-ID",
        "PA-MATCH-STATUS",
        "PA-FRAUD-CONFIRMED",
        "PA-FRAUD-REMOVED",
        "PA-AUTH-FRAUD",
        "PA-FRAUD-RPT-DATE",
        "PA-MERCHANT-NAME",
        "PA-MERCHANT-ID",
        "PA-MERCHANT-CITY",
        "PA-MERCHANT-STATE",
        "PA-MERCHANT-ZIP",
        "ERR-FLG"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-AUTH-AMT",
        "WS-AUTH-TIME"
      ],
      "purpose": "Populates the authorization details screen fields using data from the PAUT segment and working storage, conditionally formatting output based on response code and fraud status."
    },
    {
      "caller": "SEND-AUTHVIEW-SCREEN",
      "callee": "POPULATE-HEADER-INFO",
      "inputs": [
        "WS-CICS-TRANID",
        "WS-PGM-AUTH-DTL"
      ],
      "outputs": [],
      "purpose": "Populates the screen header with current date, time, transaction name, and program name for the authorization view."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SCHEDULE-PSB",
      "inputs": [
        "PSB-NAME"
      ],
      "outputs": [
        "IMS-RETURN-CODE",
        "WS-ERR-FLG",
        "WS-IMS-PSB-SCHD-FLG"
      ],
      "purpose": "Schedules the IMS PSB for database access and handles errors if scheduling fails."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Displays the authorization screen with error message and header information when a database read fails."
    },
    {
      "caller": "READ-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Displays the authorization screen with error message and header information when a database read fails."
    },
    {
      "caller": "READ-NEXT-AUTH-RECORD",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Displays the authorization screen with error message and header information when reading the next authorization record fails."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "TAKE-SYNCPOINT",
      "inputs": [],
      "outputs": [],
      "purpose": "Commits the current transaction unit of work to ensure data integrity after successfully updating the fraud authorization details."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "ROLL-BACK",
      "inputs": [],
      "outputs": [],
      "purpose": "Aborts the current transaction and rolls back all changes due to an error during the fraud tagging update operation."
    },
    {
      "caller": "UPDATE-AUTH-DETAILS",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Sends an error message to the terminal screen after a failure in fraud tagging, using the message stored in WS-MESSAGE and applying screen erase logic based on SEND-ERASE-YES."
    },
    {
      "caller": "SCHEDULE-PSB",
      "callee": "SEND-AUTHVIEW-SCREEN",
      "inputs": [
        "WS-MESSAGE",
        "SEND-ERASE-YES"
      ],
      "outputs": [],
      "purpose": "Displays an error message on the terminal when PSB scheduling fails, using the message in WS-MESSAGE and respecting the SEND-ERASE-YES flag for screen rendering."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: COPAUS1C.cbl\n    MAIN_PARA[\"MAIN-PARA\"]\n    MARK_AUTH_FRAUD[\"MARK-AUTH-FRAUD\"]\n    PROCESS_ENTER_KEY[\"PROCESS-ENTER-KEY\"]\n    PROCESS_PF8_KEY[\"PROCESS-PF8-KEY\"]\n    RECEIVE_AUTHVIEW_SCREEN[\"RECEIVE-AUTHVIEW-SCREEN\"]\n    RETURN_TO_PREV_SCREEN[\"RETURN-TO-PREV-SCREEN\"]\n    SEND_AUTHVIEW_SCREEN[\"SEND-AUTHVIEW-SCREEN\"]\n    POPULATE_AUTH_DETAILS[\"POPULATE-AUTH-DETAILS\"]\n    READ_AUTH_RECORD[\"READ-AUTH-RECORD\"]\n    ROLL_BACK[\"ROLL-BACK\"]\n    UPDATE_AUTH_DETAILS[\"UPDATE-AUTH-DETAILS\"]\n    WS_PGM_AUTH_FRAUD__ext([\"WS-PGM-AUTH-FRAUD\"])\n    POPULATE_HEADER_INFO[\"POPULATE-HEADER-INFO\"]\n    TAKE_SYNCPOINT[\"TAKE-SYNCPOINT\"]\n    READ_NEXT_AUTH_RECORD[\"READ-NEXT-AUTH-RECORD\"]\n    SCHEDULE_PSB[\"SCHEDULE-PSB\"]\n    CDEMO_TO_PROGRAM__ext([\"CDEMO-TO-PROGRAM\"])\n    MAIN_PARA --> MARK_AUTH_FRAUD\n    MAIN_PARA --> PROCESS_ENTER_KEY\n    MAIN_PARA --> PROCESS_PF8_KEY\n    MAIN_PARA --> RECEIVE_AUTHVIEW_SCREEN\n    MAIN_PARA --> RETURN_TO_PREV_SCREEN\n    MAIN_PARA --> SEND_AUTHVIEW_SCREEN\n    MARK_AUTH_FRAUD --> POPULATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD --> READ_AUTH_RECORD\n    MARK_AUTH_FRAUD --> ROLL_BACK\n    MARK_AUTH_FRAUD --> UPDATE_AUTH_DETAILS\n    MARK_AUTH_FRAUD -.->|calls| WS_PGM_AUTH_FRAUD__ext\n    PROCESS_ENTER_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_ENTER_KEY --> READ_AUTH_RECORD\n    PROCESS_ENTER_KEY --> TAKE_SYNCPOINT\n    PROCESS_PF8_KEY --> POPULATE_AUTH_DETAILS\n    PROCESS_PF8_KEY --> READ_AUTH_RECORD\n    PROCESS_PF8_KEY --> READ_NEXT_AUTH_RECORD\n    PROCESS_PF8_KEY --> TAKE_SYNCPOINT\n    READ_AUTH_RECORD --> SCHEDULE_PSB\n    READ_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    READ_NEXT_AUTH_RECORD --> SEND_AUTHVIEW_SCREEN\n    RETURN_TO_PREV_SCREEN -.->|calls| CDEMO_TO_PROGRAM__ext\n    SCHEDULE_PSB --> SEND_AUTHVIEW_SCREEN\n    SEND_AUTHVIEW_SCREEN --> POPULATE_HEADER_INFO\n    UPDATE_AUTH_DETAILS --> ROLL_BACK\n    UPDATE_AUTH_DETAILS --> SEND_AUTHVIEW_SCREEN\n    UPDATE_AUTH_DETAILS --> TAKE_SYNCPOINT"
}