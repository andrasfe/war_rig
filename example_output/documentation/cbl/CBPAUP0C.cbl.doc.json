{
  "header": {
    "program_id": "CBPAUP0C",
    "file_name": "cbl/CBPAUP0C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-30T19:46:38.329060",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "Batch IMS program that traverses the authorization database, reads pending authorization summary segments (PAUTSUM0), and for each, reads child detail segments (PAUTDTL1). It checks each detail for expiry based on days since authorization date exceeding a parameter-driven threshold, deletes expired details via DLI DLET, adjusts in-memory summary counters accordingly, and deletes the parent summary if both approved and declined auth counts reach zero after processing all details. Periodically takes IMS checkpoints and displays processing statistics at end.",
    "business_context": "CardDemo Authorization Module: Cleanup of expired pending authorization messages to maintain database hygiene by removing stale transaction details and empty summaries.",
    "program_type": "BATCH",
    "citations": [
      3,
      4,
      5,
      136,
      140,
      142,
      144,
      156,
      169
    ]
  },
  "inputs": [
    {
      "name": "PRM-INFO",
      "io_type": "PARAMETER",
      "description": "Command line parameters from SYSIN containing expiry days (P-EXPIRY-DAYS), checkpoint frequency (P-CHKP-FREQ), display frequency (P-CHKP-DIS-FREQ), and debug flag (P-DEBUG-FLAG)",
      "copybook": null,
      "citation": [
        189
      ]
    },
    {
      "name": "PENDING-AUTH-SUMMARY",
      "io_type": "IMS_SEGMENT",
      "description": "Root segment PAUTSUM0 containing summary data like PA-ACCT-ID, PA-APPROVED-AUTH-CNT, PA-DECLINED-AUTH-CNT, etc., read via GN calls",
      "copybook": "CIPAUSMY",
      "citation": [
        223,
        256
      ]
    },
    {
      "name": "PENDING-AUTH-DETAILS",
      "io_type": "IMS_SEGMENT",
      "description": "Child segment PAUTDTL1 under current summary, containing details like PA-AUTH-DATE-9C, PA-AUTH-RESP-CODE, PA-TRANSACTION-AMT, read via GNP calls",
      "copybook": "CIPAUDTY",
      "citation": [
        255
      ]
    }
  ],
  "outputs": [
    {
      "name": "PENDING-AUTH-DETAILS",
      "io_type": "IMS_SEGMENT",
      "description": "Deletion of expired PAUTDTL1 segments via DLI DLET (no inserts/updates)",
      "copybook": "CIPAUDTY",
      "citation": [
        310
      ]
    },
    {
      "name": "PENDING-AUTH-SUMMARY",
      "io_type": "IMS_SEGMENT",
      "description": "Deletion of PAUTSUM0 segments with zero counts after detail processing via DLI DLET (no inserts/updates to counters; adjustments are in-memory only for delete decision)",
      "copybook": "CIPAUSMY",
      "citation": [
        335
      ]
    },
    {
      "name": "CHECKPOINT",
      "io_type": "OTHER",
      "description": "IMS checkpoints taken periodically via DLI CHKP to ensure transaction integrity",
      "copybook": null,
      "citation": [
        355
      ]
    },
    {
      "name": "PROCESSING STATISTICS",
      "io_type": "REPORT",
      "description": "Console DISPLAY of counts: summaries read/deleted, details read/deleted",
      "copybook": null,
      "citation": [
        173,
        174,
        175,
        176
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": [
      "IO-PCB-MASK",
      "PGM-PCB-MASK"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Delete detail segment if days elapsed since authorization date (CURRENT-YYDDD - (99999 - PA-AUTH-DATE-9C)) >= P-EXPIRY-DAYS (default 5)",
      "logic_summary": "Compute WS-DAY-DIFF and set QUALIFIED-FOR-DELETE if >= WS-EXPIRY-DAYS; adjust in-memory summary counters based on PA-AUTH-RESP-CODE ('00' approved else declined)",
      "conditions": [
        "WS-DAY-DIFF >= WS-EXPIRY-DAYS",
        "PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        280,
        282,
        284,
        287,
        291
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Delete summary segment after all details processed if PA-APPROVED-AUTH-CNT <= 0 (note: code has duplicate condition, likely intended PA-DECLINED-AUTH-CNT <=0 also)",
      "logic_summary": "Check after detail loop; code as-is: PA-APPROVED-AUTH-CNT <=0 AND PA-APPROVED-AUTH-CNT <=0",
      "conditions": [
        "PA-APPROVED-AUTH-CNT <= 0"
      ],
      "citation": [
        156
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Take IMS checkpoint every P-CHKP-FREQ (default 5) summaries processed; display status every P-CHKP-DIS-FREQ (default 10) checkpoints",
      "logic_summary": "Increment WS-AUTH-SMRY-PROC-CNT; call 9000 if > P-CHKP-FREQ; reset counter",
      "conditions": [
        "WS-AUTH-SMRY-PROC-CNT > P-CHKP-FREQ",
        "WS-NO-CHKP >= P-CHKP-DIS-FREQ"
      ],
      "citation": [
        160,
        361
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PENDING-AUTH-SUMMARY",
        "fields_used": [
          "PA-ACCT-ID",
          "PA-APPROVED-AUTH-CNT",
          "PA-APPROVED-AUTH-AMT",
          "PA-DECLINED-AUTH-CNT",
          "PA-DECLINED-AUTH-AMT"
        ],
        "citation": [
          233,
          156,
          287
        ]
      },
      {
        "source": "PENDING-AUTH-DETAILS",
        "fields_used": [
          "PA-AUTH-DATE-9C",
          "PA-AUTH-RESP-CODE",
          "PA-APPROVED-AMT",
          "PA-TRANSACTION-AMT"
        ],
        "citation": [
          280,
          287,
          289,
          292
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PENDING-AUTH-DETAILS",
        "fields_written": [
          "(entire segment deleted)"
        ],
        "citation": [
          310
        ]
      },
      {
        "destination": "PENDING-AUTH-SUMMARY",
        "fields_written": [
          "(entire segment deleted)"
        ],
        "citation": [
          335
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-AUTH-DATE-9C",
        "output_field": "WS-AUTH-DATE",
        "transformation_description": "WS-AUTH-DATE = 99999 - PA-AUTH-DATE-9C to convert packed date to YYDDD format",
        "citation": [
          280
        ]
      },
      {
        "input_field": "CURRENT-YYDDD, WS-AUTH-DATE",
        "output_field": "WS-DAY-DIFF",
        "transformation_description": "WS-DAY-DIFF = CURRENT-YYDDD - WS-AUTH-DATE to compute days since authorization",
        "citation": [
          282
        ]
      },
      {
        "input_field": "PA-APPROVED-AUTH-CNT, PA-APPROVED-AUTH-AMT",
        "output_field": "PA-APPROVED-AUTH-CNT, PA-APPROVED-AUTH-AMT",
        "transformation_description": "In-memory subtraction if approved and expired: SUBTRACT 1 FROM CNT, AMT FROM PA-APPROVED-AUTH-AMT (not persisted)",
        "citation": [
          288,
          289
        ]
      },
      {
        "input_field": "PA-DECLINED-AUTH-CNT, PA-DECLINED-AUTH-AMT",
        "output_field": "PA-DECLINED-AUTH-CNT, PA-DECLINED-AUTH-AMT",
        "transformation_description": "In-memory subtraction if declined and expired: SUBTRACT 1 FROM CNT, PA-TRANSACTION-AMT FROM AMT (not persisted)",
        "citation": [
          291,
          292
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY (PAUTSUM0 root segment) including PA-ACCT-ID, counters for approved/declined auths",
      "location": "WORKING_STORAGE",
      "citation": 117
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS (PAUTDTL1 child segment) including PA-AUTH-DATE-9C, PA-AUTH-RESP-CODE, amounts",
      "location": "WORKING_STORAGE",
      "citation": 121
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary orchestration paragraph that controls the entire program flow as the entry point after PROCEDURE DIVISION. It begins by performing 1000-INITIALIZE to accept parameters, set defaults, and prepare variables from date and SYSIN. It then enters the main processing loop by first performing 2000-FIND-NEXT-AUTH-SUMMARY to GU the first summary segment. The loop continues until ERR-FLG-ON or END-OF-AUTHDB, nested with a detail loop via 3000-FIND-NEXT-AUTH-DTL until NO-MORE-AUTHS, where each detail is checked for expiry in 4000-CHECK-IF-EXPIRED and deleted via 5000-DELETE-AUTH-DTL if qualified. After all details for a summary, it checks if summary counters <=0 (approved cnt) and deletes via 6000-DELETE-AUTH-SUMMARY if so. Periodically checks WS-AUTH-SMRY-PROC-CNT against P-CHKP-FREQ to perform 9000-TAKE-CHECKPOINT and resets counter. After loop exit, takes final checkpoint, displays aggregate statistics (reads/deletes for summary/details), and GOBACKs. No explicit error handling here beyond loop conditions relying on subordinate abends. It consumes IMS PCB masks from LINKAGE, parameters, and date; produces deletions and checkpoints; implements business logic for expiry cleanup traversal.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "4000-CHECK-IF-EXPIRED",
        "5000-DELETE-AUTH-DTL",
        "6000-DELETE-AUTH-SUMMARY",
        "9000-TAKE-CHECKPOINT"
      ],
      "citation": [
        136,
        180
      ],
      "outgoing_calls": [
        {
          "target": "1000-INITIALIZE",
          "call_type": "performs",
          "line": 138
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 140
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 144
        },
        {
          "target": "4000-CHECK-IF-EXPIRED",
          "call_type": "performs",
          "line": 147
        },
        {
          "target": "5000-DELETE-AUTH-DTL",
          "call_type": "performs",
          "line": 150
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 153
        },
        {
          "target": "6000-DELETE-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 157
        },
        {
          "target": "9000-TAKE-CHECKPOINT",
          "call_type": "performs",
          "line": 161
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 165
        },
        {
          "target": "9000-TAKE-CHECKPOINT",
          "call_type": "performs",
          "line": 169
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This initialization paragraph sets up program variables and parameters at startup. It accepts CURRENT-DATE from DATE and CURRENT-YYDDD from DAY for expiry calculations, then reads PRM-INFO from SYSIN containing expiry days, chkpt freq, dis freq, debug flag. Displays startup messages with parms and date. Validates and sets defaults: WS-EXPIRY-DAYS to P-EXPIRY-DAYS if numeric else 5; P-CHKP-FREQ to 5 if invalid; P-CHKP-DIS-FREQ to 10; P-DEBUG-FLAG to 'N' if not 'Y'. Consumes system date and SYSIN parameters; produces initialized WS-VARIABLES, PRM-INFO, and console displays. No business decisions beyond validation; no error handling (invalid parms use defaults); no calls made. Flow passes to 1000-EXIT.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        183,
        211
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-EXIT",
      "summary": null,
      "purpose": "Standard exit paragraph that simply performs EXIT to return control to caller (MAIN-PARA). No inputs consumed, no outputs produced, no logic, no error handling, no calls. Serves as procedural delimiter after 1000-INITIALIZE logic.",
      "called_by": [],
      "calls": [],
      "citation": [
        212,
        213
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph retrieves the next root summary segment (PAUTSUM0) via DLI GN call into PENDING-AUTH-SUMMARY. If DEBUG-ON, displays read count. Evaluates DIBSTAT: '  ' sets NOT-END-OF-AUTHDB, increments WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT, moves PA-ACCT-ID to WS-CURR-APP-ID; 'GB' sets END-OF-AUTHDB; other statuses display error and perform 9999-ABEND. Consumes current PCB position and prior summary data; produces next PENDING-AUTH-SUMMARY in memory, updated counters WS-NO-SUMRY-READ/WS-AUTH-SMRY-PROC-CNT, or abend. Implements decision logic on IMS status for continuation/abend; error handling via EVALUATE leading to abend on failure. Called repeatedly in MAIN-PARA loop to traverse summaries.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        216,
        243
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 240
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-EXIT",
      "summary": null,
      "purpose": "Standard exit paragraph that performs EXIT to return to MAIN-PARA loop. No data manipulation, decisions, or error handling.",
      "called_by": [],
      "calls": [],
      "citation": [
        244,
        244
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "Retrieves next child detail segment (PAUTDTL1) under current summary via DLI GNP into PENDING-AUTH-DETAILS. If DEBUG-ON, displays read count. Evaluates DIBSTAT: '  '/'GE'/'GB' set MORE-AUTHS or NO-MORE-AUTHS and increment WS-NO-DTL-READ if found; other statuses display errors (with PA-ACCT-ID) and abend via 9999-ABEND. Consumes current position under summary; produces next detail in memory or end flag. Logic decides loop continuation; error handling abends on unexpected status. Called in nested loop in MAIN-PARA.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        248,
        273
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 270
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-EXIT",
      "summary": null,
      "purpose": "Standard exit paragraph performing EXIT.",
      "called_by": [],
      "calls": [],
      "citation": [
        274,
        274
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-CHECK-IF-EXPIRED",
      "summary": null,
      "purpose": "Determines if current detail is expired by computing WS-AUTH-DATE = 99999 - PA-AUTH-DATE-9C, then WS-DAY-DIFF = CURRENT-YYDDD - WS-AUTH-DATE. If WS-DAY-DIFF >= WS-EXPIRY-DAYS, sets QUALIFIED-FOR-DELETE and adjusts in-memory summary counters: if PA-AUTH-RESP-CODE='00' subtract 1/amt from approved cnt/amt else from declined. Else sets NOT-QUALIFIED-FOR-DELETE. Consumes detail fields and current date/expiry param; produces flags and modified in-memory summary counters (not persisted). Implements core expiry business rule with conditional counter adjustments; no error handling or calls. Used to qualify deletions.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        277,
        299
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 147,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-EXIT",
      "summary": null,
      "purpose": "Standard exit performing EXIT.",
      "called_by": [],
      "calls": [],
      "citation": [
        300,
        300
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "5000-DELETE-AUTH-DTL",
      "summary": null,
      "purpose": "Performs DLI DLET to delete current expired PAUTDTL1 segment from PENDING-AUTH-DETAILS if qualified. If DEBUG-ON, displays app ID. Checks DIBSTAT=SPACES to increment WS-NO-DTL-DELETED else displays error/APP-ID and abends via 9999-ABEND. Consumes qualified detail in memory; produces database deletion and updated delete counter or abend. Error handling via status check leading to abend; no other logic.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        303,
        324
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 320
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 150,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "5000-EXIT",
      "summary": null,
      "purpose": "Standard exit performing EXIT.",
      "called_by": [],
      "calls": [],
      "citation": [
        325,
        325
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "6000-DELETE-AUTH-SUMMARY",
      "summary": null,
      "purpose": "Performs DLI DLET to delete current PAUTSUM0 summary segment from PENDING-AUTH-SUMMARY if counters indicate empty. If DEBUG-ON, displays app ID. Checks DIBSTAT=SPACES to increment WS-NO-SUMRY-DELETED else displays error/APP-ID and abends. Consumes qualified summary; produces DB deletion and counter or abend. Error handling via status/abend.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        328,
        348
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 345
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 157,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "6000-EXIT",
      "summary": null,
      "purpose": "Standard exit performing EXIT.",
      "called_by": [],
      "calls": [],
      "citation": [
        349,
        349
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9000-TAKE-CHECKPOINT",
      "summary": null,
      "purpose": "Issues DLI CHKP with WK-CHKPT-ID for IMS transaction checkpoint. If DIBSTAT=SPACES, increments WS-NO-CHKP and if >= P-CHKP-DIS-FREQ resets counter and displays success with counts/APP-ID; else displays failure details and abends. Consumes current checkpoint ID/counter; produces committed position and optional display or abend. Implements periodic recovery point logic with error abend.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        352,
        372
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 369
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 161,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9000-EXIT",
      "summary": null,
      "purpose": "Standard exit performing EXIT.",
      "called_by": [],
      "calls": [],
      "citation": [
        374,
        374
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "Error termination paragraph called on any IMS failure or invalid status. Displays abend message, sets RETURN-CODE=16, and GOBACKs. Consumes no specific data; produces non-zero return code to halt batch job. No conditions or validation; serves as centralized fatal error handler.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "5000-DELETE-AUTH-DTL",
        "6000-DELETE-AUTH-SUMMARY",
        "9000-TAKE-CHECKPOINT"
      ],
      "calls": [],
      "citation": [
        377,
        385
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-EXIT",
      "summary": null,
      "purpose": "Standard exit paragraph following 9999-ABEND that performs EXIT (though rarely reached as GOBACK precedes). No logic or data flow.",
      "called_by": [],
      "calls": [],
      "citation": [
        386,
        386
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "DIBSTAT NOT '  ' OR 'GB' in summary GN",
      "action": "DISPLAY error and PERFORM 9999-ABEND",
      "citation": [
        237
      ]
    },
    {
      "condition": "DIBSTAT NOT '  '/'GE'/'GB' in detail GNP",
      "action": "DISPLAY error details and PERFORM 9999-ABEND",
      "citation": [
        267
      ]
    },
    {
      "condition": "DIBSTAT NOT SPACES after DLET detail/summary",
      "action": "DISPLAY failure and PERFORM 9999-ABEND",
      "citation": [
        318,
        343
      ]
    },
    {
      "condition": "DIBSTAT NOT SPACES after CHKP",
      "action": "DISPLAY failure and PERFORM 9999-ABEND",
      "citation": [
        366
      ]
    },
    {
      "condition": "Main loop until ERR-FLG-ON (set externally via abend)",
      "action": "Exit loop and proceed to final stats/checkpoint",
      "citation": [
        142
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Line 156 condition: IF PA-APPROVED-AUTH-CNT <= 0 AND PA-APPROVED-AUTH-CNT <= 0 \u2013 duplicate field; intended PA-DECLINED-AUTH-CNT?",
      "context": "Code as provided uses same field twice, likely copy-paste error preventing declined-only summaries from deletion",
      "suggestion": "Review copybook CIPAUSMY or runtime behavior; static analysis flags potential bug"
    },
    {
      "question": "No persistence of in-memory counter adjustments to non-deleted summaries",
      "context": "4000 adjusts PA-*-CNT/AMT but no DLI CHG/ISRT before next GN; counters only used for delete decision",
      "suggestion": "Confirm if intentional (counters recalculated elsewhere) or missing update logic"
    }
  ],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "1000-INITIALIZE",
      "inputs": [],
      "outputs": [
        "CURRENT-DATE",
        "CURRENT-YYDDD",
        "PRM-INFO",
        "WS-EXPIRY-DAYS",
        "P-CHKP-FREQ",
        "P-CHKP-DIS-FREQ",
        "P-DEBUG-FLAG"
      ],
      "purpose": "Initializes current date, YYDDD date, parameter information from SYSIN, and sets or defaults expiry days, checkpoint frequencies, and debug flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [
        "P-DEBUG-FLAG",
        "PAUT-PCB-NUM",
        "WS-NO-SUMRY-READ"
      ],
      "outputs": [
        "PENDING-AUTH-SUMMARY",
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "WS-CURR-APP-ID",
        "WS-END-OF-AUTHDB-FLAG"
      ],
      "purpose": "Performs IMS GN to retrieve the next pending authorization summary segment and updates read counters, current app ID, and end-of-database flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [
        "P-DEBUG-FLAG",
        "PAUT-PCB-NUM",
        "WS-NO-DTL-READ",
        "PA-ACCT-ID"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "WS-NO-DTL-READ",
        "WS-MORE-AUTHS-FLAG"
      ],
      "purpose": "Performs IMS GNP to retrieve the next child pending authorization detail segment and updates detail read counter and more-auths flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "4000-CHECK-IF-EXPIRED",
      "inputs": [
        "PA-AUTH-DATE-9C",
        "CURRENT-YYDDD",
        "WS-EXPIRY-DAYS",
        "PA-AUTH-RESP-CODE",
        "PA-APPROVED-AMT",
        "PA-TRANSACTION-AMT"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-DAY-DIFF",
        "WS-QUALIFY-DELETE-FLAG",
        "PA-APPROVED-AUTH-CNT",
        "PA-APPROVED-AUTH-AMT",
        "PA-DECLINED-AUTH-CNT",
        "PA-DECLINED-AUTH-AMT"
      ],
      "purpose": "Computes age of authorization detail and sets delete qualification flag while adjusting summary counters if expired."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "5000-DELETE-AUTH-DTL",
      "inputs": [
        "P-DEBUG-FLAG",
        "PA-ACCT-ID",
        "PENDING-AUTH-DETAILS"
      ],
      "outputs": [
        "WS-NO-DTL-DELETED"
      ],
      "purpose": "Performs IMS DLET to delete the current positioned pending authorization detail segment and increments deleted details counter."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PENDING-AUTH-DETAILS",
        "WS-NO-DTL-READ",
        "WS-MORE-AUTHS-FLAG"
      ],
      "purpose": "Retrieves the next pending authorization detail segment child of the current summary using IMS GNP and updates detail read count and more aut hs flag."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "6000-DELETE-AUTH-SUMMARY",
      "inputs": [
        "PAUT-PCB-NUM",
        "PENDING-AUTH-SUMMARY"
      ],
      "outputs": [
        "WS-NO-SUMRY-DELETED"
      ],
      "purpose": "Deletes the current pending authorization summary root segment from IMS database using DLET and increments summary deleted count."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "9000-TAKE-CHECKPOINT",
      "inputs": [
        "WK-CHKPT-ID"
      ],
      "outputs": [
        "WS-NO-CHKP"
      ],
      "purpose": "Takes an IMS checkpoint using the current checkpoint ID and updates the checkpoint counter."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [
        "PAUT-PCB-NUM"
      ],
      "outputs": [
        "PENDING-AUTH-SUMMARY",
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "WS-CURR-APP-ID",
        "WS-END-OF-AUTHDB-FLAG"
      ],
      "purpose": "Retrieves the next pending authorization summary root segment using IMS GN, updates counts and current app ID, and sets end-of-database flag if applicable."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "9000-TAKE-CHECKPOINT",
      "inputs": [
        "WK-CHKPT-ID"
      ],
      "outputs": [
        "WS-NO-CHKP"
      ],
      "purpose": "Takes an IMS checkpoint using the current checkpoint ID and updates the checkpoint counter."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": "Terminates the program abnormally when the IMS GN call for authorization summary fails."
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": "Terminates the program abnormally when the IMS GNP call for authorization detail fails."
    },
    {
      "caller": "5000-DELETE-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": "Terminates the program abnormally when the IMS DLET call for authorization detail fails."
    },
    {
      "caller": "6000-DELETE-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": "Terminates the program abnormally when the IMS DLET call for authorization summary fails."
    },
    {
      "caller": "9000-TAKE-CHECKPOINT",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [],
      "purpose": "Terminates the program abnormally when the IMS CHKP call fails."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: CBPAUP0C.cbl\n    1000_EXIT[\"1000-EXIT\"]\n    1000_INITIALIZE[\"1000-INITIALIZE\"]\n    2000_EXIT[\"2000-EXIT\"]\n    2000_FIND_NEXT_AUTH_SUMMARY[\"2000-FIND-NEXT-AUTH-SUMMARY\"]\n    9999_ABEND[\"9999-ABEND\"]\n    3000_EXIT[\"3000-EXIT\"]\n    3000_FIND_NEXT_AUTH_DTL[\"3000-FIND-NEXT-AUTH-DTL\"]\n    4000_CHECK_IF_EXPIRED[\"4000-CHECK-IF-EXPIRED\"]\n    4000_EXIT[\"4000-EXIT\"]\n    5000_DELETE_AUTH_DTL[\"5000-DELETE-AUTH-DTL\"]\n    5000_EXIT[\"5000-EXIT\"]\n    6000_DELETE_AUTH_SUMMARY[\"6000-DELETE-AUTH-SUMMARY\"]\n    6000_EXIT[\"6000-EXIT\"]\n    9000_EXIT[\"9000-EXIT\"]\n    9000_TAKE_CHECKPOINT[\"9000-TAKE-CHECKPOINT\"]\n    9999_EXIT[\"9999-EXIT\"]\n    MAIN_PARA[\"MAIN-PARA\"]\n    2000_FIND_NEXT_AUTH_SUMMARY --> 9999_ABEND\n    3000_FIND_NEXT_AUTH_DTL --> 9999_ABEND\n    5000_DELETE_AUTH_DTL --> 9999_ABEND\n    6000_DELETE_AUTH_SUMMARY --> 9999_ABEND\n    9000_TAKE_CHECKPOINT --> 9999_ABEND\n    MAIN_PARA --> 1000_INITIALIZE\n    MAIN_PARA --> 2000_FIND_NEXT_AUTH_SUMMARY\n    MAIN_PARA --> 3000_FIND_NEXT_AUTH_DTL\n    MAIN_PARA --> 4000_CHECK_IF_EXPIRED\n    MAIN_PARA --> 5000_DELETE_AUTH_DTL\n    MAIN_PARA --> 6000_DELETE_AUTH_SUMMARY\n    MAIN_PARA --> 9000_TAKE_CHECKPOINT"
}