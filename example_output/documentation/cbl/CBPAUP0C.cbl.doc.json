{
  "header": {
    "program_id": "CBPAUP0C",
    "file_name": "CBPAUP0C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-02-03T21:06:57.273145",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "This COBOL batch IMS program, CBPAUP0C, deletes expired pending authorization messages from the IMS database. It reads pending authorization summary and detail segments, checks if the authorization has expired based on a configurable expiry period, and deletes the expired detail segments. It also deletes the summary segment if all its detail segments have been deleted, and takes checkpoints periodically.",
    "business_context": "This program is part of the CardDemo application and is used to purge expired authorization data, likely to maintain data storage and improve performance.",
    "program_type": "BATCH",
    "citations": [
      2,
      5,
      140
    ]
  },
  "inputs": [
    {
      "name": "PAUTSUM0",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Summary segment from IMS database, containing summary information about pending authorizations.",
      "copybook": "CIPAUSMY",
      "citation": [
        224
      ]
    },
    {
      "name": "PAUTDTL1",
      "io_type": "IMS_SEGMENT",
      "description": "Pending Authorization Detail segment from IMS database, containing detailed information about individual pending authorizations.",
      "copybook": "CIPAUDTY",
      "citation": [
        256
      ]
    },
    {
      "name": "SYSIN",
      "io_type": "PARAMETER",
      "description": "System input parameters including expiry days, checkpoint frequency, checkpoint display frequency, and debug flag.",
      "copybook": null,
      "citation": [
        189
      ]
    }
  ],
  "outputs": [],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": [
      "IO-PCB-MASK",
      "PGM-PCB-MASK"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Determine if an authorization detail is expired based on the difference between the current date and the authorization date, compared to the expiry days parameter.",
      "logic_summary": "Calculates the difference between the current Julian date (CURRENT-YYDDD) and the authorization date (PA-AUTH-DATE-9C). If the difference is greater than or equal to the expiry days (WS-EXPIRY-DAYS), the authorization is considered expired.",
      "conditions": [
        "WS-DAY-DIFF >= WS-EXPIRY-DAYS"
      ],
      "citation": [
        280,
        281,
        284
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Adjust summary counts and amounts based on whether the authorization was approved or declined before deleting the detail record.",
      "logic_summary": "If the authorization response code (PA-AUTH-RESP-CODE) is '00' (approved), the approved authorization count (PA-APPROVED-AUTH-CNT) and amount (PA-APPROVED-AUTH-AMT) are decremented. Otherwise (declined), the declined authorization count (PA-DECLINED-AUTH-CNT) and amount (PA-DECLINED-AUTH-AMT) are decremented.",
      "conditions": [
        "PA-AUTH-RESP-CODE = '00'"
      ],
      "citation": [
        287,
        288,
        289,
        291,
        292
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Delete the authorization summary if both approved and declined authorization counts are zero.",
      "logic_summary": "Checks if PA-APPROVED-AUTH-CNT and PA-DECLINED-AUTH-CNT are both less than or equal to 0. If true, then the summary record is deleted.",
      "conditions": [
        "PA-APPROVED-AUTH-CNT <= 0 AND PA-APPROVED-AUTH-CNT <= 0"
      ],
      "citation": [
        156,
        157
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTSUM0",
        "fields_used": [
          "PA-ACCT-ID",
          "PA-APPROVED-AUTH-CNT",
          "PA-DECLINED-AUTH-CNT",
          "PA-APPROVED-AUTH-AMT",
          "PA-DECLINED-AUTH-AMT"
        ],
        "citation": [
          224,
          156
        ]
      },
      {
        "source": "PAUTDTL1",
        "fields_used": [
          "PA-AUTH-DATE-9C",
          "PA-AUTH-RESP-CODE",
          "PA-TRANSACTION-AMT"
        ],
        "citation": [
          256,
          280,
          287,
          292
        ]
      },
      {
        "source": "SYSIN",
        "fields_used": [
          "P-EXPIRY-DAYS",
          "P-CHKP-FREQ",
          "P-CHKP-DIS-FREQ",
          "P-DEBUG-FLAG"
        ],
        "citation": [
          189,
          196,
          201,
          204,
          207
        ]
      }
    ],
    "writes_to": [],
    "transforms": [
      {
        "input_field": "PA-AUTH-DATE-9C",
        "output_field": "WS-AUTH-DATE",
        "transformation_description": "Calculates the authorization date by subtracting PA-AUTH-DATE-9C from 99999.",
        "citation": [
          280
        ]
      },
      {
        "input_field": "CURRENT-YYDDD, WS-AUTH-DATE",
        "output_field": "WS-DAY-DIFF",
        "transformation_description": "Calculates the difference between the current Julian date and the calculated authorization date.",
        "citation": [
          282
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines the layout of the PENDING-AUTH-SUMMARY segment.",
      "location": "WORKING_STORAGE",
      "citation": 117
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines the layout of the PENDING-AUTH-DETAILS segment.",
      "location": "WORKING_STORAGE",
      "citation": 121
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the main control paragraph for the CBPAUP0C program. It orchestrates the deletion of expired pending authorization messages. It begins by calling 1000-INITIALIZE to set up the program environment, including accepting parameters from SYSIN and initializing variables. Then, it enters a loop that continues until either an error flag is set or the end of the authorization database is reached. Inside this loop, it retrieves the next authorization summary using 2000-FIND-NEXT-AUTH-SUMMARY. For each summary, it retrieves authorization details using 3000-FIND-NEXT-AUTH-DTL in an inner loop. The 4000-CHECK-IF-EXPIRED paragraph determines if each detail record is expired. If a detail record is expired, 5000-DELETE-AUTH-DTL is called to delete it, and the summary counts are adjusted. After processing all details for a summary, 6000-DELETE-AUTH-SUMMARY is called to delete the summary if all details have been removed. Checkpoints are taken periodically using 9000-TAKE-CHECKPOINT based on the P-CHKP-FREQ parameter to prevent excessive rollback in case of failure. Finally, the program displays summary statistics and terminates.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "citation": [
        136,
        167
      ],
      "outgoing_calls": [
        {
          "target": "1000-INITIALIZE",
          "call_type": "performs",
          "line": 138
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 140
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 144
        },
        {
          "target": "4000-CHECK-IF-EXPIRED",
          "call_type": "performs",
          "line": 147
        },
        {
          "target": "5000-DELETE-AUTH-DTL",
          "call_type": "performs",
          "line": 150
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 153
        },
        {
          "target": "6000-DELETE-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 157
        },
        {
          "target": "9000-TAKE-CHECKPOINT",
          "call_type": "performs",
          "line": 161
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 165
        },
        {
          "target": "9000-TAKE-CHECKPOINT",
          "call_type": "performs",
          "line": 169
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This paragraph initializes the program environment. It accepts the current date and Julian date from the system using ACCEPT statements. It then accepts parameters from SYSIN into the PRM-INFO group item, displaying these parameters for debugging purposes. It validates the P-EXPIRY-DAYS parameter, defaulting to 5 if the input is non-numeric. Similarly, it validates P-CHKP-FREQ and P-CHKP-DIS-FREQ, defaulting to 5 and 10 respectively if the input is invalid. Finally, it ensures that the P-DEBUG-FLAG is either 'Y' or 'N', defaulting to 'N' if it is not 'Y'. This paragraph ensures that the program has valid configuration settings before proceeding with the main processing logic. No error handling is explicitly performed in this paragraph, but invalid input values are handled by assigning default values.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        183,
        210
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "MAIN-PARA",
          "line": 161,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph retrieves the next pending authorization summary segment from the IMS database. It uses the EXEC DLI GN command with the PAUTSUM0 segment name to fetch the next summary record into the PENDING-AUTH-SUMMARY area. Before the GET NEXT call, if the DEBUG-ON flag is set, it displays the current number of summary records read. After the call, it evaluates the DIBSTAT return code. If DIBSTAT is '  ', it sets the NOT-END-OF-AUTHDB flag to TRUE, increments the summary read count (WS-NO-SUMRY-READ), increments the summary process count (WS-AUTH-SMRY-PROC-CNT), and moves the account ID (PA-ACCT-ID) to WS-CURR-APP-ID. If DIBSTAT is 'GB', it sets the END-OF-AUTHDB flag to TRUE, indicating the end of the database. If DIBSTAT is any other value, it displays an error message with the DIBSTAT code and the number of summary records read before abending, then calls 9999-ABEND to terminate the program. This paragraph handles IMS database access and error conditions related to reading summary segments.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        216,
        242
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 240
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "MAIN-PARA",
          "line": 163,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves the next pending authorization detail segment from the IMS database. It uses the EXEC DLI GNP command with the PAUTDTL1 segment name to fetch the next detail record into the PENDING-AUTH-DETAILS area. Before the GET NEXT WITHIN PARENT call, if the DEBUG-ON flag is set, it displays the current number of detail records read. After the call, it evaluates the DIBSTAT return code. If DIBSTAT is '  ', it sets the MORE-AUTHS flag to TRUE and increments the detail read count (WS-NO-DTL-READ). If DIBSTAT is 'GE' or 'GB', it sets the NO-MORE-AUTHS flag to TRUE, indicating either the end of the parent or the end of the database. If DIBSTAT is any other value, it displays an error message with the DIBSTAT code, the summary account ID (PA-ACCT-ID), and the number of detail records read before abending, then calls 9999-ABEND to terminate the program. This paragraph handles IMS database access and error conditions related to reading detail segments.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        248,
        272
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 270
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "2000-FIND-NEXT-AUTH-SUMMARY",
          "line": 235,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 144,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-CHECK-IF-EXPIRED",
      "summary": null,
      "purpose": "This paragraph determines if a pending authorization detail record has expired. It calculates the authorization date (WS-AUTH-DATE) by subtracting the PA-AUTH-DATE-9C field from 99999. It then calculates the difference (WS-DAY-DIFF) between the current Julian date (CURRENT-YYDDD) and the calculated authorization date. If this difference is greater than or equal to the expiry days (WS-EXPIRY-DAYS), the QUALIFIED-FOR-DELETE flag is set to TRUE. Before setting the flag, it checks the PA-AUTH-RESP-CODE. If it is '00' (approved), it decrements the approved authorization count (PA-APPROVED-AUTH-CNT) and amount (PA-APPROVED-AUTH-AMT) in the summary record. Otherwise (declined), it decrements the declined authorization count (PA-DECLINED-AUTH-CNT) and amount (PA-DECLINED-AUTH-AMT) in the summary record. If the authorization is not expired, the NOT-QUALIFIED-FOR-DELETE flag is set to TRUE. This paragraph implements the core business rule for determining authorization expiry and updates the summary record accordingly.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        277,
        298
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 147,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "5000-DELETE-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph deletes a pending authorization detail segment from the IMS database. It uses the EXEC DLI DLET command with the PAUTDTL1 segment name to delete the current detail record. Before the delete call, if the DEBUG-ON flag is set, it displays the account ID (PA-ACCT-ID) of the record being deleted. After the call, it checks the DIBSTAT return code. If DIBSTAT is SPACES, it increments the detail deleted count (WS-NO-DTL-DELETED). Otherwise, it displays an error message with the DIBSTAT code and the account ID, then calls 9999-ABEND to terminate the program. This paragraph handles the physical deletion of detail segments from the IMS database and associated error handling.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        303,
        323
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 320
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 150,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "6000-DELETE-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph deletes a pending authorization summary segment from the IMS database. It uses the EXEC DLI DLET command with the PAUTSUM0 segment name to delete the current summary record. Before the delete call, if the DEBUG-ON flag is set, it displays the account ID (PA-ACCT-ID) of the record being deleted. After the call, it checks the DIBSTAT return code. If DIBSTAT is SPACES, it increments the summary deleted count (WS-NO-SUMRY-DELETED). Otherwise, it displays an error message with the DIBSTAT code and the account ID, then calls 9999-ABEND to terminate the program. This paragraph handles the physical deletion of summary segments from the IMS database and associated error handling.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        328,
        347
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 345
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 157,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9000-TAKE-CHECKPOINT",
      "summary": null,
      "purpose": "This paragraph takes an IMS checkpoint. It uses the EXEC DLI CHKP command with a unique checkpoint ID (WK-CHKPT-ID). After the checkpoint call, it checks the DIBSTAT return code. If DIBSTAT is SPACES, it increments the checkpoint count (WS-NO-CHKP). If the checkpoint count reaches the checkpoint display frequency (P-CHKP-DIS-FREQ), it resets the checkpoint count to zero and displays a success message with the current authorization count (WS-NO-SUMRY-READ) and application ID (WS-CURR-APP-ID). If DIBSTAT is not SPACES, it displays an error message with the DIBSTAT code, the record count, and the application ID, then calls 9999-ABEND to terminate the program. This paragraph ensures that the program can be restarted from a known point in case of failure, minimizing data loss and reprocessing time.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        352,
        372
      ],
      "outgoing_calls": [
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 369
        }
      ],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "MAIN-PARA",
          "line": 161,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This paragraph handles program termination due to an error condition. It displays a message indicating that the program is abending. It sets the RETURN-CODE to 16, indicating an abnormal termination. Finally, it executes a GOBACK statement to return control to the calling environment. This paragraph provides a consistent and controlled way to terminate the program when an unrecoverable error occurs.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "5000-DELETE-AUTH-DTL",
        "6000-DELETE-AUTH-SUMMARY",
        "9000-TAKE-CHECKPOINT"
      ],
      "calls": [],
      "citation": [
        377,
        384
      ],
      "outgoing_calls": [],
      "incoming_calls": [
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "1000-INITIALIZE",
          "line": 191,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "2000-FIND-NEXT-AUTH-SUMMARY",
          "line": 246,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBUNL.CBL",
          "function": "3000-FIND-NEXT-AUTH-DTL",
          "line": 282,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBLOD.CBL",
          "function": "2100-INSERT-ROOT-SEG",
          "line": 261,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBLOD.CBL",
          "function": "3100-INSERT-CHILD-SEG",
          "line": 313,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/PAUDBLOD.CBL",
          "function": "3200-INSERT-IMS-CALL",
          "line": 335,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "3100-INSERT-PARENT-SEG-GSAM",
          "line": 314,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "3200-INSERT-CHILD-SEG-GSAM",
          "line": 333,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "5000-DELETE-AUTH-DTL",
          "line": 320,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "6000-DELETE-AUTH-SUMMARY",
          "line": 345,
          "call_type": "performs"
        },
        {
          "file": "/home/andras/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/CBPAUP0C.cbl",
          "function": "9000-TAKE-CHECKPOINT",
          "line": 369,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "DIBSTAT not equal to SPACES in 5000-DELETE-AUTH-DTL",
      "action": "DISPLAY error message and ABEND",
      "citation": [
        315,
        318,
        320
      ]
    },
    {
      "condition": "DIBSTAT not equal to SPACES in 6000-DELETE-AUTH-SUMMARY",
      "action": "DISPLAY error message and ABEND",
      "citation": [
        340,
        343,
        345
      ]
    },
    {
      "condition": "DIBSTAT not equal to SPACES in 9000-TAKE-CHECKPOINT",
      "action": "DISPLAY error message and ABEND",
      "citation": [
        358,
        366,
        369
      ]
    },
    {
      "condition": "DIBSTAT not equal to ' ' or 'GB' in 2000-FIND-NEXT-AUTH-SUMMARY",
      "action": "DISPLAY error message and ABEND",
      "citation": [
        228,
        236,
        237,
        240
      ]
    },
    {
      "condition": "DIBSTAT not equal to ' ' or 'GE' or 'GB' in 3000-FIND-NEXT-AUTH-DTL",
      "action": "DISPLAY error message and ABEND",
      "citation": [
        259,
        266,
        267,
        270
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "What is the structure of the IMS database being accessed?",
      "context": "The program uses IMS DL/I calls, but the PSB and DBD are not available to determine the exact database structure and relationships.",
      "suggestion": "Examine the PSB (PSBPAUTB) and DBD definitions to understand the database structure."
    }
  ],
  "dead_code": [
    {
      "name": "9999-EXIT",
      "artifact_type": "paragraph",
      "line": 385,
      "reason": "Paragraph '9999-EXIT' is never PERFORMed or referenced by any other paragraph or program"
    }
  ],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "1000-INITIALIZE",
      "inputs": [
        "P-EXPIRY-DAYS",
        "P-CHKP-FREQ",
        "P-CHKP-DIS-FREQ",
        "P-DEBUG-FLAG"
      ],
      "outputs": [
        "WS-EXPIRY-DAYS",
        "P-CHKP-FREQ",
        "P-CHKP-DIS-FREQ",
        "P-DEBUG-FLAG",
        "CURRENT-DATE",
        "CURRENT-YYDDD"
      ],
      "purpose": "Initializes program variables including current date, expiry days, checkpoint frequency, and debug flag based on input parameters."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [
        "PAUT-PCB-NUM",
        "DEBUG-ON"
      ],
      "outputs": [
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "WS-CURR-APP-ID",
        "END-OF-AUTHDB",
        "NOT-END-OF-AUTHDB"
      ],
      "purpose": "Reads the next pending authorization summary record from the IMS database and updates counters and flags accordingly."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [
        "PAUT-PCB-NUM",
        "DEBUG-ON"
      ],
      "outputs": [
        "WS-NO-DTL-READ",
        "MORE-AUTHS",
        "NO-MORE-AUTHS"
      ],
      "purpose": "Retrieves the next authorization detail record from the IMS database and sets flags to indicate if more details exist."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "4000-CHECK-IF-EXPIRED",
      "inputs": [
        "PA-AUTH-DATE-9C",
        "CURRENT-YYDDD",
        "WS-EXPIRY-DAYS",
        "PA-AUTH-RESP-CODE",
        "PA-APPROVED-AUTH-CNT",
        "PA-APPROVED-AUTH-AMT",
        "PA-DECLINED-AUTH-CNT",
        "PA-TRANSACTION-AMT"
      ],
      "outputs": [
        "WS-AUTH-DATE",
        "WS-DAY-DIFF",
        "QUALIFIED-FOR-DELETE",
        "NOT-QUALIFIED-FOR-DELETE",
        "PA-APPROVED-AUTH-CNT",
        "PA-APPROVED-AUTH-AMT",
        "PA-DECLINED-AUTH-CNT",
        "PA-DECLINED-AUTH-AMT"
      ],
      "purpose": "Determines if an authorization detail is expired based on the current date and configured expiry days, and adjusts summary counts accordingly."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "5000-DELETE-AUTH-DTL",
      "inputs": [
        "PAUT-PCB-NUM",
        "PENDING-AUTH-DETAILS",
        "DEBUG-ON",
        "PA-ACCT-ID"
      ],
      "outputs": [
        "WS-NO-DTL-DELETED"
      ],
      "purpose": "Deletes the current authorization detail segment from the IMS database and increments the deletion counter if successful."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [
        "DEBUG-ON",
        "PENDING-AUTH-DETAILS"
      ],
      "outputs": [
        "WS-NO-DTL-READ",
        "WS-MORE-AUTHS-FLAG"
      ],
      "purpose": "Reads the next pending authorization detail record from the IMS database and updates read count and flag indicating if more details exist."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "6000-DELETE-AUTH-SUMMARY",
      "inputs": [
        "DEBUG-ON",
        "PENDING-AUTH-SUMMARY",
        "PA-ACCT-ID"
      ],
      "outputs": [
        "WS-NO-SUMRY-DELETED"
      ],
      "purpose": "Deletes the current pending authorization summary record from the IMS database and increments the deletion counter upon success."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "9000-TAKE-CHECKPOINT",
      "inputs": [
        "WK-CHKPT-ID",
        "WS-NO-SUMRY-READ",
        "WS-CURR-APP-ID",
        "WS-NO-CHKP",
        "P-CHKP-DIS-FREQ"
      ],
      "outputs": [
        "WS-NO-CHKP"
      ],
      "purpose": "Takes an IMS checkpoint and displays progress information if the checkpoint frequency threshold is reached."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [
        "DEBUG-ON",
        "PENDING-AUTH-SUMMARY"
      ],
      "outputs": [
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "WS-CURR-APP-ID",
        "WS-END-OF-AUTHDB-FLAG"
      ],
      "purpose": "Retrieves the next pending authorization summary record from the IMS database and updates counters and flags accordingly."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "9000-TAKE-CHECKPOINT",
      "inputs": [
        "WK-CHKPT-ID",
        "WS-NO-SUMRY-READ",
        "WS-CURR-APP-ID",
        "WS-NO-CHKP",
        "P-CHKP-DIS-FREQ"
      ],
      "outputs": [
        "WS-NO-CHKP"
      ],
      "purpose": "Takes an IMS checkpoint and displays progress information if the checkpoint frequency threshold is reached."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [
        "DIBSTAT",
        "WS-NO-SUMRY-READ"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program with return code 16 when an unexpected IMS status code is encountered during authorization summary read."
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [
        "DIBSTAT",
        "PA-ACCT-ID",
        "WS-NO-DTL-READ"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program with return code 16 when an unexpected IMS status code is encountered during authorization detail read."
    },
    {
      "caller": "5000-DELETE-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [
        "DIBSTAT",
        "PA-ACCT-ID"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program with return code 16 when an authorization detail delete operation fails in IMS."
    },
    {
      "caller": "6000-DELETE-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [
        "DIBSTAT",
        "PA-ACCT-ID"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program with return code 16 when an authorization summary delete operation fails in IMS."
    },
    {
      "caller": "9000-TAKE-CHECKPOINT",
      "callee": "9999-ABEND",
      "inputs": [
        "DIBSTAT",
        "WS-NO-SUMRY-READ",
        "WS-CURR-APP-ID"
      ],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program with return code 16 when an IMS checkpoint operation fails."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: CBPAUP0C.cbl\n    1000_EXIT[\"1000-EXIT\"]\n    1000_INITIALIZE[\"1000-INITIALIZE\"]\n    2000_EXIT[\"2000-EXIT\"]\n    2000_FIND_NEXT_AUTH_SUMMARY[\"2000-FIND-NEXT-AUTH-SUMMARY\"]\n    9999_ABEND[\"9999-ABEND\"]\n    3000_EXIT[\"3000-EXIT\"]\n    3000_FIND_NEXT_AUTH_DTL[\"3000-FIND-NEXT-AUTH-DTL\"]\n    4000_CHECK_IF_EXPIRED[\"4000-CHECK-IF-EXPIRED\"]\n    4000_EXIT[\"4000-EXIT\"]\n    5000_DELETE_AUTH_DTL[\"5000-DELETE-AUTH-DTL\"]\n    5000_EXIT[\"5000-EXIT\"]\n    6000_DELETE_AUTH_SUMMARY[\"6000-DELETE-AUTH-SUMMARY\"]\n    6000_EXIT[\"6000-EXIT\"]\n    9000_EXIT[\"9000-EXIT\"]\n    9000_TAKE_CHECKPOINT[\"9000-TAKE-CHECKPOINT\"]\n    9999_EXIT[\"9999-EXIT\"]\n    MAIN_PARA[\"MAIN-PARA\"]\n    2000_FIND_NEXT_AUTH_SUMMARY --> 9999_ABEND\n    3000_FIND_NEXT_AUTH_DTL --> 9999_ABEND\n    5000_DELETE_AUTH_DTL --> 9999_ABEND\n    6000_DELETE_AUTH_SUMMARY --> 9999_ABEND\n    9000_TAKE_CHECKPOINT --> 9999_ABEND\n    MAIN_PARA --> 1000_INITIALIZE\n    MAIN_PARA --> 2000_FIND_NEXT_AUTH_SUMMARY\n    MAIN_PARA --> 3000_FIND_NEXT_AUTH_DTL\n    MAIN_PARA --> 4000_CHECK_IF_EXPIRED\n    MAIN_PARA --> 5000_DELETE_AUTH_DTL\n    MAIN_PARA --> 6000_DELETE_AUTH_SUMMARY\n    MAIN_PARA --> 9000_TAKE_CHECKPOINT"
}