{
  "header": {
    "program_id": "DBUNLDGS",
    "file_name": "cbl/DBUNLDGS.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-30T19:47:20.866610",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "DBUNLDGS is an IMS batch utility that browses and unloads root Pending Authorization Summary segments (PAUTSUM0) and their child Pending Authorization Detail segments (PAUTDTL1) from the PAUT IMS database using unqualified SSAs via the PAUTBPCB. For each root segment retrieved via GN call, it inserts a copy into a GSAM database using PASFLPCB and then retrieves all children via GNP calls, inserting each into another GSAM via PADFLPCB. It continues until end of database (GB status), increments counters, and abends on errors.",
    "business_context": "Supports unloading of pending authorization data from IMS for potential archiving, migration, or reporting in a financial authorization system.",
    "program_type": "BATCH",
    "citations": [
      18,
      164,
      170,
      172,
      222,
      268,
      303,
      321
    ]
  },
  "inputs": [
    {
      "name": "PAUT IMS Database",
      "io_type": "IMS_SEGMENT",
      "description": "Root PAUTSUM0 summary segments and child PAUTDTL1 detail segments accessed via PAUTBPCB browse PCB",
      "copybook": "CIPAUSMY, CIPAUDTY",
      "citation": [
        222,
        268
      ]
    }
  ],
  "outputs": [
    {
      "name": "PASFL GSAM",
      "io_type": "IMS_SEGMENT",
      "description": "Copies of unloaded PAUTSUM0 root summary segments inserted via PASFLPCB",
      "copybook": "CIPAUSMY",
      "citation": [
        303
      ]
    },
    {
      "name": "PADFL GSAM",
      "io_type": "IMS_SEGMENT",
      "description": "Copies of unloaded PAUTDTL1 child detail segments inserted via PADFLPCB",
      "copybook": "CIPAUDTY",
      "citation": [
        321
      ]
    }
  ],
  "called_programs": [],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "DLITCBL"
    ],
    "linkage_section": [
      "PAUTBPCB",
      "PASFLPCB",
      "PADFLPCB"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Process only valid root segments with numeric PA-ACCT-ID before handling children",
      "logic_summary": "Check PA-ACCT-ID numeric after GN, skip if not",
      "conditions": [
        "PA-ACCT-ID IS NUMERIC"
      ],
      "citation": [
        241
      ]
    },
    {
      "rule_id": "BR002",
      "description": "End root processing on GB status from PAUTBPCB",
      "logic_summary": "Set end flags and exit loop",
      "conditions": [
        "PAUT-PCB-STATUS = 'GB'"
      ],
      "citation": [
        249
      ]
    },
    {
      "rule_id": "BR003",
      "description": "End child processing on GE status from PAUTBPCB",
      "logic_summary": "Set child end flag after no more children",
      "conditions": [
        "PAUT-PCB-STATUS = 'GE'"
      ],
      "citation": [
        284
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "PAUTBPCB (PAUTSUM0 root)",
        "fields_used": [
          "PA-ACCT-ID"
        ],
        "citation": [
          239
        ]
      },
      {
        "source": "PAUTBPCB (PAUTDTL1 child)",
        "fields_used": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          280
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "PASFLPCB GSAM",
        "fields_written": [
          "PENDING-AUTH-SUMMARY"
        ],
        "citation": [
          304
        ]
      },
      {
        "destination": "PADFLPCB GSAM",
        "fields_written": [
          "PENDING-AUTH-DETAILS"
        ],
        "citation": [
          322
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "PA-ACCT-ID",
        "output_field": "ROOT-SEG-KEY",
        "transformation_description": "Move account ID from summary segment to GSAM root key field",
        "citation": [
          239
        ]
      },
      {
        "input_field": "PENDING-AUTH-DETAILS",
        "output_field": "CHILD-SEG-REC",
        "transformation_description": "Direct move of detail segment to GSAM child record",
        "citation": [
          280
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "IMSFUNCS",
      "purpose": "Defines IMS DL/I function codes like FUNC-GN, FUNC-GNP, FUNC-ISRT",
      "location": "WORKING_STORAGE",
      "citation": 136
    },
    {
      "copybook_name": "CIPAUSMY",
      "purpose": "Defines layout of PENDING-AUTH-SUMMARY root segment including PA-ACCT-ID",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "CIPAUDTY",
      "purpose": "Defines layout of PENDING-AUTH-DETAILS child segment",
      "location": "WORKING_STORAGE",
      "citation": 147
    },
    {
      "copybook_name": "PAUTBPCB",
      "purpose": "PCB mask for browsing PAUT IMS database (PAUTSUM0/PAUTDTL1)",
      "location": "LINKAGE",
      "citation": 154
    },
    {
      "copybook_name": "PASFLPCB",
      "purpose": "PCB mask for inserting into summary GSAM database",
      "location": "LINKAGE",
      "citation": 155
    },
    {
      "copybook_name": "PADFLPCB",
      "purpose": "PCB mask for inserting into details GSAM database",
      "location": "LINKAGE",
      "citation": 156
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "summary": null,
      "purpose": "This is the primary entry point and orchestration paragraph for the entire program flow, labeled MAIN-PARA with an ENTRY 'DLITCBL' for potential dynamic invocation. It receives IMS PCBs (PAUTBPCB, PASFLPCB, PADFLPCB) via linkage section as inputs for database access. It first performs 1000-INITIALIZE to set up dates and display startup information. Then it enters a loop performing 2000-FIND-NEXT-AUTH-SUMMARY until WS-END-OF-ROOT-SEG is 'Y', handling each root segment and its children. After the loop, it performs 4000-FILE-CLOSE to log closure, though file operations are commented out. No direct business logic decisions here beyond loop control based on end flag from 2000. No explicit error handling; relies on abends from subordinates. It calls 1000-INITIALIZE for init, 2000-FIND-NEXT-AUTH-SUMMARY repeatedly for core unloading, and 4000-FILE-CLOSE for termination. Upon completion, it executes GOBACK to end the program.",
      "called_by": [],
      "calls": [
        "1000-INITIALIZE",
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "4000-FILE-CLOSE"
      ],
      "citation": [
        164,
        179
      ],
      "outgoing_calls": [
        {
          "target": "1000-INITIALIZE",
          "call_type": "performs",
          "line": 170
        },
        {
          "target": "2000-FIND-NEXT-AUTH-SUMMARY",
          "call_type": "performs",
          "line": 172
        },
        {
          "target": "4000-FILE-CLOSE",
          "call_type": "performs",
          "line": 175
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "1000-INITIALIZE",
      "summary": null,
      "purpose": "This initialization paragraph sets up runtime variables and logs program start. It consumes system date via ACCEPT from DATE and DAY into CURRENT-DATE and CURRENT-YYDDD. It displays program start message, date, and decorative lines for audit trail. Commented code for parameter acceptance from SYSIN and sequential file opens with status checks is present but inactive. No outputs produced beyond displays and variable initialization. No business logic conditions or validations performed. No error handling implemented here. No calls to other paragraphs or programs. Control passes to 1000-EXIT upon completion.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        182,
        212
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "2000-FIND-NEXT-AUTH-SUMMARY",
      "summary": null,
      "purpose": "This paragraph handles retrieval and processing of each root Pending Auth Summary segment, serving as the outer loop driver for unloading. It consumes the PAUTBPCB for IMS GN call with ROOT-UNQUAL-SSA to get next unqualified root segment into PENDING-AUTH-SUMMARY. If status is spaces (success), it increments read counters WS-NO-SUMRY-READ and WS-AUTH-SMRY-PROC-CNT, moves data to OPFIL1-REC (commented write), sets ROOT-SEG-KEY from PA-ACCT-ID if numeric, performs 3100-INSERT-PARENT-SEG-GSAM to write to GSAM, resets child end flag, and loops 3000-FIND-NEXT-AUTH-DTL until no more children. On 'GB' status, sets end of root flag to exit main loop. On other errors, displays status/feedback and abends via 9999-ABEND. Business logic includes numeric check on PA-ACCT-ID to qualify processing and status-based decisions for continue/end/abend. Error handling covers non-success statuses with abend.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "3100-INSERT-PARENT-SEG-GSAM",
        "3000-FIND-NEXT-AUTH-DTL",
        "9999-ABEND"
      ],
      "citation": [
        216,
        258
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 222
        },
        {
          "target": "3100-INSERT-PARENT-SEG-GSAM",
          "call_type": "performs",
          "line": 243
        },
        {
          "target": "3000-FIND-NEXT-AUTH-DTL",
          "call_type": "performs",
          "line": 245
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 256
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3000-FIND-NEXT-AUTH-DTL",
      "summary": null,
      "purpose": "This paragraph retrieves and processes child Pending Auth Detail segments under the current root, invoked in loop from 2000. It consumes PAUTBPCB for IMS GNP call with CHILD-UNQUAL-SSA to get next parent-qualified child into PENDING-AUTH-DETAILS. On spaces status (success), sets MORE-AUTHS flag (unused), increments counters (note: uses sumry counters erroneously?), moves to CHILD-SEG-REC, and performs 3200-INSERT-CHILD-SEG-GSAM. On 'GE' status, sets WS-END-OF-CHILD-SEG to 'Y' to exit child loop and displays flag. On other statuses, displays error/feedback and abends. Logic decisions based on PCB status for process/end/abend. Error handling abends on failures. Initializes status after call. No direct outputs beyond inserts via call.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "3200-INSERT-CHILD-SEG-GSAM",
        "9999-ABEND"
      ],
      "citation": [
        263,
        297
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 267
        },
        {
          "target": "3200-INSERT-CHILD-SEG-GSAM",
          "call_type": "performs",
          "line": 282
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 293
        }
      ],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3100-INSERT-PARENT-SEG-GSAM",
      "summary": null,
      "purpose": "This utility paragraph inserts the current root summary segment into the target GSAM database. It consumes PENDING-AUTH-SUMMARY and PASFLPCB for IMS ISRT call. On non-spaces status, displays error/KEYFB and abends via 9999-ABEND. No other inputs, outputs, or logic; purely I/O with error check. Business logic is strict success requirement for continuation. Error handling immediate abend on failure.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        300,
        316
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 302
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 314
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "2000-FIND-NEXT-AUTH-SUMMARY",
          "line": 243,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "3200-INSERT-CHILD-SEG-GSAM",
      "summary": null,
      "purpose": "This utility paragraph inserts the current child detail segment into the target GSAM database. It consumes PENDING-AUTH-DETAILS and PADFLPCB for IMS ISRT call. On non-spaces status, displays error/KEYFB and abends via 9999-ABEND. No other inputs, outputs, or logic; purely I/O with error check. Business logic enforces successful insert for each child. Error handling immediate abend on failure.",
      "called_by": [
        "3000-FIND-NEXT-AUTH-DTL"
      ],
      "calls": [
        "9999-ABEND"
      ],
      "citation": [
        319,
        335
      ],
      "outgoing_calls": [
        {
          "target": "CBLTDLI",
          "call_type": "calls",
          "line": 321
        },
        {
          "target": "9999-ABEND",
          "call_type": "performs",
          "line": 333
        }
      ],
      "incoming_calls": [
        {
          "file": "/Users/andraslferenczi/war_rig/aws-mainframe-modernization-carddemo/app/app-authorization-ims-db2-mq/cbl/DBUNLDGS.CBL",
          "function": "3000-FIND-NEXT-AUTH-DTL",
          "line": 282,
          "call_type": "performs"
        }
      ],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "4000-FILE-CLOSE",
      "summary": null,
      "purpose": "This termination paragraph logs file closure, though actual CLOSE statements for OPFILE1/2 are commented out. It consumes no data, displays 'CLOSING THE FILE'. Commented status checks and error displays. No business logic or conditions. No error handling active. No calls. Prepares for program end.",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        338,
        354
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-ABEND",
      "summary": null,
      "purpose": "This error termination paragraph handles all program abends. It consumes no specific inputs, displays 'DBUNLDGS ABENDING ...' message. Sets RETURN-CODE to 16 and executes GOBACK to terminate abnormally. No validations or conditions. Called from multiple error points throughout the program. No further calls.",
      "called_by": [
        "2000-FIND-NEXT-AUTH-SUMMARY",
        "3000-FIND-NEXT-AUTH-DTL",
        "3100-INSERT-PARENT-SEG-GSAM",
        "3200-INSERT-CHILD-SEG-GSAM"
      ],
      "calls": [],
      "citation": [
        357,
        364
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    },
    {
      "paragraph_name": "9999-EXIT",
      "summary": null,
      "purpose": "This is a minimal exit label within the abend routine, containing only an EXIT statement. It consumes no data and produces no outputs. No logic, conditions, error handling, or calls. Serves as a potential THRU exit point though not used. Provides structured exit from 9999-ABEND if needed.",
      "called_by": [],
      "calls": [],
      "citation": [
        365,
        366
      ],
      "outgoing_calls": [],
      "incoming_calls": [],
      "is_dead_code": false,
      "dead_code_reason": null,
      "metadata": null
    }
  ],
  "error_handling": [
    {
      "condition": "PAUT-PCB-STATUS NOT SPACES AND NOT 'GB' after GN",
      "action": "Display status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        253
      ]
    },
    {
      "condition": "PAUT-PCB-STATUS NOT SPACES AND NOT 'GE' after GNP",
      "action": "Display status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        290
      ]
    },
    {
      "condition": "PASFL-PCB-STATUS NOT SPACES after ISRT",
      "action": "Display status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        311
      ]
    },
    {
      "condition": "PADFL-PCB-STATUS NOT SPACES after ISRT",
      "action": "Display status/KEYFB and PERFORM 9999-ABEND",
      "citation": [
        330
      ]
    },
    {
      "condition": "Any abend condition",
      "action": "Set RETURN-CODE 16 and GOBACK",
      "citation": [
        362
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact field layouts and keys in CIPAUSMY and CIPAUDTY copybooks",
      "context": "Copybooks referenced but contents not in source; limits field-level data flow details",
      "suggestion": "Analyze referenced copybook files"
    },
    {
      "question": "Purpose and current status of heavily commented sequential file code (OPFILE1/2)",
      "context": "Lines 26-47, 195-209, 340-353 suggest original file unload replaced by GSAM inserts",
      "suggestion": "Check version history or related LISTING files"
    }
  ],
  "dead_code": [],
  "call_semantics": [
    {
      "caller": "MAIN-PARA",
      "callee": "1000-INITIALIZE",
      "inputs": [],
      "outputs": [
        "CURRENT-DATE",
        "CURRENT-YYDDD"
      ],
      "purpose": "Initializes current date and Julian date variables and displays program startup information."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "2000-FIND-NEXT-AUTH-SUMMARY",
      "inputs": [],
      "outputs": [
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "OPFIL1-REC",
        "ROOT-SEG-KEY",
        "CHILD-SEG-REC",
        "WS-END-OF-CHILD-SEG",
        "WS-END-OF-ROOT-SEG"
      ],
      "purpose": "Retrieves the next root authorization summary segment from IMS and processes its parent insertion and child details."
    },
    {
      "caller": "MAIN-PARA",
      "callee": "4000-FILE-CLOSE",
      "inputs": [],
      "outputs": [],
      "purpose": "Displays a message indicating that files are being closed."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "3100-INSERT-PARENT-SEG-GSAM",
      "inputs": [],
      "outputs": [],
      "purpose": "Inserts the pending authorization summary record into the GSAM parent database via IMS call."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "3000-FIND-NEXT-AUTH-DTL",
      "inputs": [],
      "outputs": [
        "WS-NO-SUMRY-READ",
        "WS-AUTH-SMRY-PROC-CNT",
        "CHILD-SEG-REC",
        "WS-END-OF-CHILD-SEG"
      ],
      "purpose": "Retrieves the next child authorization detail segment from IMS using parent-child navigation and inserts it into GSAM."
    },
    {
      "caller": "2000-FIND-NEXT-AUTH-SUMMARY",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program due to failure in the IMS GN call for the authorization summary root segment."
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "3200-INSERT-CHILD-SEG-GSAM",
      "inputs": [
        "PENDING-AUTH-DETAILS"
      ],
      "outputs": [],
      "purpose": "Performs IMS insert of the authorization details as a child segment into the GSAM database."
    },
    {
      "caller": "3000-FIND-NEXT-AUTH-DTL",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program due to failure in the IMS GNP call for the authorization detail child segment."
    },
    {
      "caller": "3100-INSERT-PARENT-SEG-GSAM",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program due to failure in the IMS ISRT call for the parent segment in GSAM."
    },
    {
      "caller": "3200-INSERT-CHILD-SEG-GSAM",
      "callee": "9999-ABEND",
      "inputs": [],
      "outputs": [
        "RETURN-CODE"
      ],
      "purpose": "Abends the program due to failure in the IMS ISRT call for the child segment in GSAM."
    }
  ],
  "flow_diagram": "flowchart TD\n    %% Title: DBUNLDGS.CBL\n    1000_EXIT[\"1000-EXIT\"]\n    1000_INITIALIZE[\"1000-INITIALIZE\"]\n    2000_EXIT[\"2000-EXIT\"]\n    2000_FIND_NEXT_AUTH_SUMMARY[\"2000-FIND-NEXT-AUTH-SUMMARY\"]\n    3000_FIND_NEXT_AUTH_DTL[\"3000-FIND-NEXT-AUTH-DTL\"]\n    3100_INSERT_PARENT_SEG_GSAM[\"3100-INSERT-PARENT-SEG-GSAM\"]\n    9999_ABEND[\"9999-ABEND\"]\n    CBLTDLI__ext([\"CBLTDLI\"])\n    3000_EXIT[\"3000-EXIT\"]\n    3200_INSERT_CHILD_SEG_GSAM[\"3200-INSERT-CHILD-SEG-GSAM\"]\n    3100_EXIT[\"3100-EXIT\"]\n    3200_EXIT[\"3200-EXIT\"]\n    4000_EXIT[\"4000-EXIT\"]\n    4000_FILE_CLOSE[\"4000-FILE-CLOSE\"]\n    9999_EXIT[\"9999-EXIT\"]\n    MAIN_PARA[\"MAIN-PARA\"]\n    2000_FIND_NEXT_AUTH_SUMMARY --> 3000_FIND_NEXT_AUTH_DTL\n    2000_FIND_NEXT_AUTH_SUMMARY --> 3100_INSERT_PARENT_SEG_GSAM\n    2000_FIND_NEXT_AUTH_SUMMARY --> 9999_ABEND\n    2000_FIND_NEXT_AUTH_SUMMARY -.->|calls| CBLTDLI__ext\n    3000_FIND_NEXT_AUTH_DTL --> 3200_INSERT_CHILD_SEG_GSAM\n    3000_FIND_NEXT_AUTH_DTL --> 9999_ABEND\n    3000_FIND_NEXT_AUTH_DTL -.->|calls| CBLTDLI__ext\n    3100_INSERT_PARENT_SEG_GSAM --> 9999_ABEND\n    3100_INSERT_PARENT_SEG_GSAM -.->|calls| CBLTDLI__ext\n    3200_INSERT_CHILD_SEG_GSAM --> 9999_ABEND\n    3200_INSERT_CHILD_SEG_GSAM -.->|calls| CBLTDLI__ext\n    MAIN_PARA --> 1000_INITIALIZE\n    MAIN_PARA --> 2000_FIND_NEXT_AUTH_SUMMARY\n    MAIN_PARA --> 4000_FILE_CLOSE"
}