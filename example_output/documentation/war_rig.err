2026-02-03 14:02:08,264 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:02:08,268 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:02:08.266359",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:02:08,273 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:02:08,274 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:02:08.274076",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cbl/PAUDBUNL.CBL"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: cbl/PAUDBUNL.CBL\nFile Type: COBOL\nIteration: 1\n\n## Paragraph Outline (from static analysis)\n\nThe following paragraphs were identified by static analysis.\nYou MUST document ALL listed paragraphs. Do not skip any.\n\n- **9999-ABEND** (lines 308-315)\n- **9999-EXIT** (lines 316-317)\n\n## Source Code\n```\n    1 |        9999-ABEND.                                                      03630026\n    2 |       *----------------------------------------------------------------*03640026\n    3 |       *                                                                 03650026\n    4 |            DISPLAY 'IMSUNLOD ABENDING ...'                              03660030\n    5 |                                                                         03670026\n    6 |            MOVE 16 TO RETURN-CODE                                       03680026\n    7 |            GOBACK.                                                      03690026\n    8 | \n    9 |        9999-EXIT.                             ..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:05:03,654 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:05:03,655 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:05:03.655296",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:05:03,660 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:05:03,662 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:05:03.661953",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cbl/COPAUS0C.cbl"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: cbl/COPAUS0C.cbl\nFile Type: COBOL\nIteration: 1\n\n## Paragraph Outline (from static analysis)\n\nThe following paragraphs were identified by static analysis.\nYou MUST document ALL listed paragraphs. Do not skip any.\n\n- **INITIALIZE-AUTH-DATA** (lines 608-664)\n- **RETURN-TO-PREV-SCREEN** (lines 665-680) \u2192 calls: CDEMO-TO-PROGRAM\n- **SEND-PAULST-SCREEN** (lines 681-711) \u2192 calls: POPULATE-HEADER-INFO\n- **RECEIVE-PAULST-SCREEN** (lines 712-725)\n- **POPULATE-HEADER-INFO** (lines 726-749)\n- **GATHER-ACCOUNT-DETAILS** (lines 750-811) \u2192 calls: GETCARDXREF-BYACCT, GETACCTDATA-BYACCT, GETCUSTDATA-BYCUST, GET-AUTH-SUMMARY\n- **GETCARDXREF-BYACCT** (lines 812-864) \u2192 calls: SEND-PAULST-SCREEN, SEND-PAULST-SCREEN, WS-CARDXREFNAME-ACCT-PATH\n- **GETACCTDATA-BYACCT** (lines 865-914) \u2192 calls: SEND-PAULST-SCREEN, SEND-PAULST-SCREEN, WS-ACCTFILENAME\n- **GETCUSTDATA-BYCUST** (lines 915-965) \u2192 calls: SEND-PAULST-SCREEN, SEND-PAULST-SCREEN, WS-CUSTFILENAME\n- **GET-AUTH-SUMMARY** (lines 966-1000) \u2192..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:05:03,976 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:05:03,978 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:05:03.977691",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:05:03,984 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:05:03,986 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:05:03.986117",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "ims/PSBPAUTB.psb"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: ims/PSBPAUTB.psb\nFile Type: OTHER\nIteration: 1\n\n## Source Code\n```\n    1 | ***********************************************************************\n    2 | * Copyright Amazon.com, Inc. or its affiliates.\n    3 | * All Rights Reserved.\n    4 | *\n    5 | * Licensed under the Apache License, Version 2.0 (the \"License\").\n    6 | * You may not use this file except in compliance with the License.\n    7 | * You may obtain a copy of the License at\n    8 | *\n    9 | *    http://www.apache.org/licenses/LICENSE-2.0\n   10 | *\n   11 | * Unless required by applicable law or agreed to in writing,\n   12 | * software distributed under the License is distributed on an\n   13 | * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n   14 | * either express or implied. See the License for the specific\n   15 | * language governing permissions and limitations under the License\n   16 | ***********************************************************************\n   17 | PAUTBPCB PCB   TYPE=DB..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:06:01,936 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:06:01,937 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:06:01.937527",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:06:01,943 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:06:01,944 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:06:01.944098",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cbl/PAUDBLOD.CBL"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: cbl/PAUDBLOD.CBL\nFile Type: COBOL\nIteration: 1\n\n## Source Code\n```\n    1 |       ******************************************************************\n    2 |       * Copyright Amazon.com, Inc. or its affiliates.\n    3 |       * All Rights Reserved.\n    4 |       *\n    5 |       * Licensed under the Apache License, Version 2.0 (the \"License\").\n    6 |       * You may not use this file except in compliance with the License.\n    7 |       * You may obtain a copy of the License at\n    8 |       *\n    9 |       *    http://www.apache.org/licenses/LICENSE-2.0\n   10 |       *\n   11 |       * Unless required by applicable law or agreed to in writing,\n   12 |       * software distributed under the License is distributed on an\n   13 |       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n   14 |       * either express or implied. See the License for the specific\n   15 |       * language governing permissions and limitations under the License\n   16 |       ***********..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:07:21,950 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:07:21,952 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:07:21.952103",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:07:21,957 | ERROR | war_rig.agents.base | Challenger: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:07:21,958 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:07:21.958049",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cpy/CIPAUDTY.cpy"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Challenger",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Challenger, a validation specialist for mainframe documentation.\n\nYour role is to review documentation produced by the Scribe and identify issues, gaps, and errors by cross-checking against the source code.\n\n## Core Principles\n\n1. **Be thorough but fair**: Look for real issues, not nitpicks. Focus on accuracy and completeness.\n\n2. **Provide evidence**: Every challenge must include line number citations from the source code.\n\n3. **Ask meaningful questions**: Questions should help improve the documentation, not just create work.\n\n4. **Assess per-section**: Evaluate each section independently as SOLID, SHAKY, or WRONG.\n\n## Question Types\n\nUse these question types appropriately:\n\n- **CLARIFICATION**: \"What do you mean by X?\" - for vague or unclear statements\n- **VERIFICATION**: \"Line 234 says Y, but you documented Z\" - for potential errors\n- **COMPLETENESS**: \"What about the error handling at line 456?\" - for missing information\n- **CHALLENGE**: \"Are you sure this is an input, ..."
      },
      {
        "role": "user",
        "content": "## Validating: cpy/CIPAUDTY.cpy\nFile Type: COPYBOOK\nIteration: 1\nMax Questions: 5\n\n## Scribe's Documentation\n```json\n{\n  \"header\": {\n    \"program_id\": \"CIPAUDTY\",\n    \"file_name\": \"CIPAUDTY.cpy\",\n    \"file_type\": \"COPYBOOK\",\n    \"analyzed_by\": \"WAR_RIG\",\n    \"analyzed_at\": \"2026-02-03T21:07:20.078881\",\n    \"iteration_count\": 1,\n    \"final_status\": null\n  },\n  \"purpose\": {\n    \"summary\": \"This copybook defines the data structure for the IMS segment related to pending authorization details. It includes fields for authorization keys, card details, transaction information, merchant details, match status, and fraud indicators. The copybook is used to store and process information about pending authorizations within an IMS database.\",\n    \"business_context\": null,\n    \"program_type\": \"OTHER\",\n    \"citations\": [\n      2,\n      19,\n      50\n    ]\n  },\n  \"inputs\": [],\n  \"outputs\": [],\n  \"called_programs\": [],\n  \"calling_context\": {\n    \"called_by\": [],\n    \"entry_points\": [],\n    \"linkage_secti..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:09:03,278 | ERROR | war_rig.providers.openrouter | OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/providers/openrouter.py:397

2026-02-03 14:09:03,279 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:09:03.279413",
  "error_type": "APIError",
  "error_message": "JSON error injected into SSE stream",
  "context": {
    "provider": "openrouter",
    "model": "google/gemini-2.0-flash-001",
    "error_type": "api_error",
    "status_code": null
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n",
  "request": {
    "model": "google/gemini-2.0-flash-001",
    "message_count": 2
  },
  "response": {
    "body": {
      "message": "JSON error injected into SSE stream",
      "code": 502,
      "metadata": {
        "raw": "{\n  \"error\": {\n    \"code\": 429,\n    \"message\": \"Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.\",\n    \"status\": \"RESOURCE_EXHAUSTED\"\n  }\n}\n",
        "provider_name": "Google"
      }
    },
    "response": "None",
    "message": "JSON error injected into SSE stream"
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

2026-02-03 14:09:03,284 | ERROR | war_rig.agents.base | Scribe: Error during invocation: OpenRouter API error: JSON error injected into SSE stream
/home/andras/war_rig/war_rig/agents/base.py:442

2026-02-03 14:09:03,285 | ERROR | war_rig.errors | 
================================================================================
STRUCTURED ERROR:
{
  "timestamp": "2026-02-03T14:09:03.285037",
  "error_type": "OpenRouterProviderError",
  "error_message": "OpenRouter API error: JSON error injected into SSE stream",
  "context": {
    "iteration": 1,
    "file_name": "cbl/COPAUS1C.cbl"
  },
  "traceback": "Traceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 292, in complete\n    async for chunk in iter_with_timeout(stream, chunk_timeout):\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 279, in iter_with_timeout\n    chunk = await asyncio.wait_for(\n            ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/.local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/lib/python3.11/asyncio/tasks.py\", line 489, in wait_for\n    return fut.result()\n           ^^^^^^^^^^^^\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 148, in __aiter__\n    async for item in self._iterator:\n  File \"/home/andras/war_rig/.venv/lib/python3.11/site-packages/openai/_streaming.py\", line 195, in __stream__\n    raise APIError(\nopenai.APIError: JSON error injected into SSE stream\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/andras/war_rig/war_rig/agents/base.py\", line 418, in ainvoke\n    response = await self._provider.complete(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/andras/war_rig/war_rig/providers/openrouter.py\", line 404, in complete\n    raise OpenRouterProviderError(\nwar_rig.providers.openrouter.OpenRouterProviderError: OpenRouter API error: JSON error injected into SSE stream\n",
  "request": {
    "agent": "Scribe",
    "model": "google/gemini-2.0-flash-001",
    "messages": [
      {
        "role": "system",
        "content": "You are the Scribe, a documentation specialist for mainframe code analysis.\n\nYour role is to analyze COBOL, PL/I, JCL, and other mainframe source files and produce comprehensive documentation following a structured template.\n\n## Special File Types\n\n### LISTING Files (.lst, .list)\nLISTING files are NOT executable programs. They contain **prose documentation** such as:\n- Compiler output and diagnostics\n- Change history and modification notes\n- System documentation and comments\n- Version control notes\n- Developer notes and explanations\n\nWhen analyzing a LISTING file:\n1. The summary should describe what the file CONTAINS (change history, compiler output, notes), not what code it \"executes\"\n2. Do NOT try to document called_programs, data_flow, sql_operations, cics_operations - these are not applicable\n3. Focus on purpose (what documentation is in the file), and any inputs/outputs mentioned as references\n4. Treat the content as prose to be understood and summarized, not as code to be reverse..."
      },
      {
        "role": "user",
        "content": "## Source File: cbl/COPAUS1C.cbl\nFile Type: COBOL\nIteration: 1\n\n## Source Code\n```\n    1 |       ******************************************************************\n    2 |       * Program     : COPAUS1C.CBL\n    3 |       * Application : CardDemo - Authorization Module\n    4 |       * Type        : CICS COBOL IMS BMS Program\n    5 |       * Function    : Detail View of Authorization Message\n    6 |       ******************************************************************\n    7 |       * Copyright Amazon.com, Inc. or its affiliates.\n    8 |       * All Rights Reserved.\n    9 |       *\n   10 |       * Licensed under the Apache License, Version 2.0 (the \"License\").\n   11 |       * You may not use this file except in compliance with the License.\n   12 |       * You may obtain a copy of the License at\n   13 |       *\n   14 |       *    http://www.apache.org/licenses/LICENSE-2.0\n   15 |       *\n   16 |       * Unless required by applicable law or agreed to in writing,\n   17 |       * software ..."
      }
    ]
  }
}
================================================================================
/home/andras/war_rig/war_rig/utils/error_logging.py:164

