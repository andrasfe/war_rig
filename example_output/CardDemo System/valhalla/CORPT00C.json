{
  "header": {
    "program_id": "CORPT00C",
    "file_name": "CORPT00C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T16:53:20.674489",
    "iteration_count": 2,
    "final_status": "VALHALLA"
  },
  "purpose": {
    "summary": "CICS online program that displays a screen for selecting transaction report types (Monthly, Yearly, Custom) and submits a batch job (TRNRPT00) via extra partition TDQ 'JOBS' containing JCL with date parameters. Validates user inputs including date fields using CSUTLDTC subroutine and numeric conversions. Handles screen navigation, error messages, and returns control to prior programs via XCTL.",
    "business_context": "CardDemo application for printing transaction reports from online interface by submitting batch jobs to internal reader.",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      3,
      5,
      6,
      24,
      517,
      549
    ]
  },
  "inputs": [
    {
      "name": "CORPT0AI",
      "io_type": "CICS_MAP",
      "description": "Input map fields for report selection (MONTHLYI, YEARLYI, CUSTOMI), custom start/end dates (SDTMMI/SDTDDI/SDTYYYYI, EDTMMI/EDTDDI/EDTYYYYI), confirmation (CONFIRMI)",
      "copybook": "CORPT00",
      "citation": [
        598,
        599,
        601
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Linkage commarea from calling program containing CARDDEMO-COMMAREA with prior context (CDEMO-PGM-REENTER, CDEMO-TO-PROGRAM)",
      "copybook": null,
      "citation": [
        155,
        156,
        176
      ]
    },
    {
      "name": "EIBAID",
      "io_type": "CICS_COMMAREA",
      "description": "Aid key from terminal (DFHENTER, DFHPF3) via DFHAID copybook",
      "copybook": "DFHAID",
      "citation": [
        184,
        148
      ]
    }
  ],
  "outputs": [
    {
      "name": "CORPT0AO",
      "io_type": "CICS_MAP",
      "description": "Output map for screen display including header info, error messages (ERRMSGO), titles",
      "copybook": "CORPT00",
      "citation": [
        563,
        571
      ]
    },
    {
      "name": "JOBS",
      "io_type": "CICS_QUEUE",
      "description": "Extra partition TDQ receiving JCL lines from JOB-DATA for batch job submission to internal reader",
      "copybook": null,
      "citation": [
        517,
        518
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea returned to CICS or XCTL target",
      "copybook": null,
      "citation": [
        199,
        587
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CSUTLDTC",
      "call_type": "STATIC_CALL",
      "purpose": "Validate start date format conversion to YYYY-MM-DD",
      "parameters": [
        "CSUTLDTC-DATE (WS-START-DATE)",
        "CSUTLDTC-DATE-FORMAT",
        "CSUTLDTC-RESULT"
      ],
      "citation": 392
    },
    {
      "program_name": "CSUTLDTC",
      "call_type": "STATIC_CALL",
      "purpose": "Validate end date format conversion to YYYY-MM-DD",
      "parameters": [
        "CSUTLDTC-DATE (WS-END-DATE)",
        "CSUTLDTC-DATE-FORMAT",
        "CSUTLDTC-RESULT"
      ],
      "citation": 412
    },
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Transfer control to previous screen (e.g., COSGN00C or COMEN01C)",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 549
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CR00"
    ],
    "linkage_section": [
      "DFHCOMMAREA",
      "LK-COMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "For Monthly report, set start date to first day of current month and end date to last day of current month",
      "logic_summary": "Uses CURRENT-DATE, adjusts month/day for end date with DATE-OF-INTEGER",
      "conditions": [
        "MONTHLYI OF CORPT0AI NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        213,
        214,
        217,
        232
      ]
    },
    {
      "rule_id": "BR002",
      "description": "For Yearly report, set dates to full current year (01/01 to 12/31)",
      "logic_summary": "Uses CURRENT-DATE year for both start/end",
      "conditions": [
        "YEARLYI OF CORPT0AI NOT = SPACES AND LOW-VALUES"
      ],
      "citation": [
        239,
        243,
        250
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Custom dates must be numeric, month 01-12, day 01-31, valid via CSUTLDTC; start/end not empty",
      "logic_summary": "NUMVAL-C conversion, range checks, CSUTLDTC call for validity",
      "conditions": [
        "SDTMMI/SDTDDI/SDTYYYYI/EDTMMI/EDTDDI/EDTYYYYI = SPACES OR LOW-VALUES",
        "IS NOT NUMERIC OR SDTMMI/EDTMMI > '12'",
        "IS NOT NUMERIC OR SDTDDI/EDTDDI > '31'",
        "SDTYYYYI/EDTYYYYI IS NOT NUMERIC",
        "CSUTLDTC-RESULT-SEV-CD NOT = '0000' AND MSG-NUM NOT = '2513'"
      ],
      "citation": [
        257,
        305,
        330,
        338,
        347,
        355,
        364,
        373,
        392,
        412
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Confirmation must be 'Y'/'y' to submit job, 'N'/'n' to cancel, else invalid",
      "logic_summary": "EVALUATE CONFIRMI, prompt if empty",
      "conditions": [
        "CONFIRMI = SPACES OR LOW-VALUES",
        "CONFIRMI = 'Y' OR 'y'",
        "CONFIRMI = 'N' OR 'n'"
      ],
      "citation": [
        464,
        478,
        481,
        485
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CORPT0AI",
        "fields_used": [
          "MONTHLYI",
          "YEARLYI",
          "CUSTOMI",
          "SDTMMI",
          "SDTDDI",
          "SDTYYYYI",
          "EDTMMI",
          "EDTDDI",
          "EDTYYYYI",
          "CONFIRMI"
        ],
        "citation": [
          212,
          257,
          464
        ]
      },
      {
        "source": "JOB-DATA",
        "fields_used": [
          "JOB-LINES"
        ],
        "citation": [
          501
        ]
      },
      {
        "source": "EIBAID",
        "fields_used": [
          "DFHENTER",
          "DFHPF3"
        ],
        "citation": [
          184
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "JOBS TDQ",
        "fields_written": [
          "JCL-RECORD"
        ],
        "citation": [
          517
        ]
      },
      {
        "destination": "CORPT0AO",
        "fields_written": [
          "ERRMSGO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO"
        ],
        "citation": [
          560,
          613
        ]
      },
      {
        "destination": "JOB-DATA JCL symbolic parameters",
        "fields_written": [
          "PARM-START-DATE-1",
          "PARM-START-DATE-2",
          "PARM-END-DATE-1",
          "PARM-END-DATE-2"
        ],
        "citation": [
          221,
          429
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "SDTMMI/SDTDDI/SDTYYYYI",
        "output_field": "WS-START-DATE",
        "transformation_description": "Convert to numeric via NUMVAL-C, assemble YYYY-MM-DD, validate with CSUTLDTC",
        "citation": [
          305,
          381,
          388
        ]
      },
      {
        "input_field": "EDTMMI/EDTDDI/EDTYYYYI",
        "output_field": "WS-END-DATE",
        "transformation_description": "Convert to numeric via NUMVAL-C, assemble YYYY-MM-DD, validate with CSUTLDTC",
        "citation": [
          317,
          384,
          408
        ]
      },
      {
        "input_field": "JOB-LINES(WS-IDX)",
        "output_field": "JCL-RECORD",
        "transformation_description": "Copy JCL line to record for TDQ write, loop until /*EOF",
        "citation": [
          501,
          502
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CORPT00",
      "purpose": "Defines BMS map structures CORPT0AI (input) and CORPT0AO (output) for transaction report screen",
      "location": "WORKING_STORAGE",
      "citation": 140
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "Defines EIBAID for aid key detection (ENTER, PF3)",
      "location": "WORKING_STORAGE",
      "citation": 148
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "Defines BMS control areas for CICS map handling",
      "location": "WORKING_STORAGE",
      "citation": 149
    },
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Common definitions including CCDA-* constants for titles/messages",
      "location": "WORKING_STORAGE",
      "citation": 138
    },
    {
      "copybook_name": "CVTRA05Y",
      "purpose": "Transaction data structures (WS-CURDATE-DATA referenced)",
      "location": "WORKING_STORAGE",
      "citation": 146
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Common title definitions",
      "location": "WORKING_STORAGE",
      "citation": 142
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Common date working storage definitions (e.g., WS-CURDATE-DATA)",
      "location": "WORKING_STORAGE",
      "citation": 143
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Common message constants (e.g., CCDA-MSG-INVALID-KEY)",
      "location": "WORKING_STORAGE",
      "citation": 144
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Main control: initialize flags, handle first entry/reentry, process aid keys, send/receive screens",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "SEND-TRNRPT-SCREEN",
        "RECEIVE-TRNRPT-SCREEN",
        "PROCESS-ENTER-KEY"
      ],
      "citation": [
        163,
        202
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Process report selection: set dates for monthly/yearly/custom, validate inputs, submit job if valid",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SUBMIT-JOB-TO-INTRDR",
        "SEND-TRNRPT-SCREEN",
        "INITIALIZE-ALL-FIELDS"
      ],
      "citation": [
        208,
        456
      ]
    },
    {
      "paragraph_name": "SUBMIT-JOB-TO-INTRDR",
      "purpose": "Validate confirmation, loop to write JCL lines to TDQ 'JOBS'",
      "called_by": [
        "PROCESS-ENTER-KEY"
      ],
      "calls": [
        "SEND-TRNRPT-SCREEN",
        "INITIALIZE-ALL-FIELDS",
        "WIRTE-JOBSUB-TDQ"
      ],
      "citation": [
        462,
        510
      ]
    },
    {
      "paragraph_name": "WIRTE-JOBSUB-TDQ",
      "purpose": "Write single JCL record to TDQ with RESP check",
      "called_by": [
        "SUBMIT-JOB-TO-INTRDR"
      ],
      "calls": [
        "SEND-TRNRPT-SCREEN"
      ],
      "citation": [
        515,
        535
      ]
    },
    {
      "paragraph_name": "SEND-TRNRPT-SCREEN",
      "purpose": "Populate header, send map CORPT0A with optional ERASE",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY",
        "SUBMIT-JOB-TO-INTRDR"
      ],
      "calls": [
        "POPULATE-HEADER-INFO",
        "RETURN-TO-CICS"
      ],
      "citation": [
        556,
        578
      ]
    },
    {
      "paragraph_name": "RECEIVE-TRNRPT-SCREEN",
      "purpose": "Receive map into CORPT0AI with RESP",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        596,
        604
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "Invalid aid key (OTHER than ENTER/PF3)",
      "action": "Set error flag, display invalid key message, resend screen",
      "citation": [
        191,
        193
      ]
    },
    {
      "condition": "CSUTLDTC-RESULT-SEV-CD NOT '0000' and MSG-NUM NOT '2513'",
      "action": "Display invalid date message, set error, resend screen",
      "citation": [
        396,
        400,
        416
      ]
    },
    {
      "condition": "WRITEQ TD RESP NOT NORMAL",
      "action": "Display error message, set error flag, resend screen",
      "citation": [
        525,
        529
      ]
    },
    {
      "condition": "Date field empty or invalid numeric/range",
      "action": "Set specific error message, highlight field (MOVE -1 to L field), resend screen",
      "citation": [
        259,
        330,
        338
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID='CR00') COMMAREA(CARDDEMO-COMMAREA)",
      "purpose": "Return to CICS with transaction ID and commarea",
      "citation": 199
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
      "purpose": "Transfer control to prior program (e.g., COSGN00C)",
      "citation": 549
    },
    {
      "command": "WRITEQ TD",
      "resource": "QUEUE('JOBS')",
      "purpose": "Submit JCL to extra partition TDQ for job submission",
      "citation": 517
    },
    {
      "command": "SEND",
      "resource": "MAP('CORPT0A') MAPSET('CORPT00')",
      "purpose": "Send screen with ERASE or CURSOR",
      "citation": 563
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('CORPT0A') MAPSET('CORPT00')",
      "purpose": "Receive user input from screen",
      "citation": 598
    }
  ],
  "open_questions": [
    {
      "question": "Exact layout and validation details of CORPT0AI/O fields",
      "context": "Defined in unprovided CORPT00 copybook",
      "suggestion": "Analyze CORPT00 copybook or BMS source"
    },
    {
      "question": "Structure of CARDDEMO-COMMAREA and prior calling programs",
      "context": "Passed via DFHCOMMAREA, fields like CDEMO-PGM-REENTER used but undefined here",
      "suggestion": "Trace callers like COSGN00C or COMEN01C"
    },
    {
      "question": "Batch job PROC=TRANREPT details and output reports",
      "context": "JCL in JOB-DATA references AWS.M2.CARDDEMO.PROC(TRANREPT), processes TRANSACT file",
      "suggestion": "Analyze PROC and related batch programs"
    }
  ]
}