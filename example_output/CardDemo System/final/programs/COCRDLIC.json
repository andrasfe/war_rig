{
  "header": {
    "program_id": "COCRDLIC",
    "file_name": "COCRDLIC.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T15:40:45.434265",
    "iteration_count": 2,
    "final_status": "WITNESSED"
  },
  "purpose": {
    "summary": "CICS online program that browses and displays lists of credit card records from VSAM file CARDDAT, filtered optionally by account ID or card number entered on screen. Supports paging forward/backward with PF8/PF7, single record selection for view (S) or update (U), exit to menu with PF3, and XCTL transfers to detail view or update programs. Handles screen I/O via BMS map CCRDLIA and maintains paging context in COMMAREA.",
    "business_context": "Credit card management: inquire and select cards for detail view or maintenance, with optional account/card filtering.",
    "program_type": "ONLINE_CICS",
    "citations": [
      4,
      5,
      6,
      7,
      298,
      349,
      359,
      370,
      402,
      433,
      450,
      478,
      486,
      517,
      545,
      578
    ]
  },
  "inputs": [
    {
      "name": "CCRDLIAI",
      "io_type": "CICS_MAP",
      "description": "BMS map input fields: CC-ACCT-ID (account filter), CC-CARD-NUM (card filter), CRDSELxI (select codes S/U for 7 rows)",
      "copybook": "COCRDLI",
      "citation": [
        963,
        969,
        970,
        972,
        973,
        974,
        975,
        976,
        977,
        978
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Application COMMAREA with CARDDEMO-COMMAREA (context like CDEMO-ACCT-ID, CDEMO-FROM-PROGRAM) and WS-THIS-PROGCOMMAREA (paging keys WS-CA-LAST-CARDKEY, WS-CA-FIRST-CARDKEY, WS-CA-SCREEN-NUM)",
      "copybook": "COCOM01Y",
      "citation": [
        315,
        327,
        328,
        329,
        330
      ]
    },
    {
      "name": "CARDDAT",
      "io_type": "FILE_VSAM",
      "description": "VSAM KSDS file of credit card records, key WS-CARD-RID (CARDNUM + ACCT-ID), read via browse for listing",
      "copybook": "CVACT02Y",
      "citation": [
        1129,
        1146,
        1197,
        1273,
        1294,
        1300,
        1322
      ]
    },
    {
      "name": "EIB",
      "io_type": "PARAMETER",
      "description": "CICS execution interface block: EIBCALEN for COMMAREA length, EIBAID for PF key",
      "copybook": null,
      "citation": [
        315,
        371,
        372,
        373,
        374
      ]
    }
  ],
  "outputs": [
    {
      "name": "CCRDLIAO",
      "io_type": "CICS_MAP",
      "description": "BMS map output fields: titles, date/time, page no, screen rows ACCTNOxO/CRDNUMxO/CRDSTSxO/CRDSELxO, error/info messages ERRMSGO/INFOMSGO, next-prog/map",
      "copybook": "COCRDLI",
      "citation": [
        939,
        643,
        647,
        648,
        659,
        664,
        667,
        924,
        928
      ]
    },
    {
      "name": "WS-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated COMMAREA with context for reentry/paging and XCTL targets",
      "copybook": "COCOM01Y",
      "citation": [
        615,
        609,
        610,
        611,
        612
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COMEN01C",
      "call_type": "CICS_XCTL",
      "purpose": "Exit to main menu on PF3",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 402
    },
    {
      "program_name": "COCRDSLC",
      "call_type": "CICS_XCTL",
      "purpose": "Transfer to credit card detail view on 'S' select",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 538
    },
    {
      "program_name": "COCRDUPC",
      "call_type": "CICS_XCTL",
      "purpose": "Transfer to credit card update on 'U' select",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 566
    }
  ],
  "calling_context": {
    "called_by": [
      "COMEN01C"
    ],
    "entry_points": [
      "CCLI"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Account filter, if supplied, must be exactly 11-digit numeric",
      "logic_summary": "Check NOT NUMERIC or length via redefines, set error flag and message if invalid",
      "conditions": [
        "CC-ACCT-ID IS NOT NUMERIC"
      ],
      "citation": [
        1003,
        1017,
        1022
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Card filter, if supplied, must be exactly 16-digit numeric",
      "logic_summary": "Check NOT NUMERIC, set error flag and message if invalid",
      "conditions": [
        "CC-CARD-NUM IS NOT NUMERIC"
      ],
      "citation": [
        1036,
        1052,
        1058
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Exactly one row select allowed ('S' for view or 'U' for update)",
      "logic_summary": "Tally 'S'+'U' >1 sets error, invalid codes ('not S/U/blank') error",
      "conditions": [
        "I > 1",
        "NOT SELECT-OK(I)"
      ],
      "citation": [
        1073,
        1080,
        1084,
        1109
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Filter browse records to match account ID and/or card number if filters valid",
      "logic_summary": "Exclude if CARD-ACCT-ID != filter or CARD-NUM != filter",
      "conditions": [
        "FLG-ACCTFILTER-ISVALID AND CARD-ACCT-ID != CC-ACCT-ID",
        "FLG-CARDFILTER-ISVALID AND CARD-NUM != CC-CARD-NUM"
      ],
      "citation": [
        1382,
        1385,
        1386,
        1396,
        1397
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CARDDAT",
        "fields_used": [
          "CARD-NUM",
          "CARD-ACCT-ID",
          "CARD-ACTIVE-STATUS"
        ],
        "citation": [
          1166,
          1167,
          1169,
          1339,
          1340,
          1342
        ]
      },
      {
        "source": "CCRDLIAI",
        "fields_used": [
          "ACCTSIDI",
          "CARDSIDI",
          "CRDSELxI"
        ],
        "citation": [
          969,
          970,
          972
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "WS-SCREEN-ROWS",
        "fields_written": [
          "WS-ROW-ACCTNO",
          "WS-ROW-CARD-NUM",
          "WS-ROW-CARD-STATUS"
        ],
        "citation": [
          1165,
          1167,
          1170
        ]
      },
      {
        "destination": "CCRDLIAO",
        "fields_written": [
          "ACCTNOxO",
          "CRDNUMxO",
          "CRDSTSxO",
          "CRDSELxO"
        ],
        "citation": [
          683,
          685,
          686,
          692
        ]
      },
      {
        "destination": "WS-THIS-PROGCOMMAREA",
        "fields_written": [
          "WS-CA-FIRST-CARDKEY",
          "WS-CA-LAST-CARDKEY",
          "WS-CA-SCREEN-NUM"
        ],
        "citation": [
          1175,
          1176,
          1194,
          1195
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "CARD-NUM",
        "output_field": "WS-ROW-CARD-NUM / CRDNUMxO",
        "transformation_description": "Direct copy from file record to screen array row and map output",
        "citation": [
          1166,
          685
        ]
      },
      {
        "input_field": "CARD-ACCT-ID",
        "output_field": "WS-ROW-ACCTNO / ACCTNOxO",
        "transformation_description": "Direct copy from file record to screen array row and map output",
        "citation": [
          1167,
          684
        ]
      },
      {
        "input_field": "CC-ACCT-ID",
        "output_field": "CDEMO-ACCT-ID",
        "transformation_description": "Validated numeric move if input OK",
        "citation": [
          1027
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CVCRD01Y",
      "purpose": "Defines CARD-RECORD layout (inferred from usage)",
      "location": "WORKING_STORAGE",
      "citation": 221
    },
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Application COMMAREA CARDDEMO-COMMAREA with context fields like CDEMO-ACCT-ID, CDEMO-FROM-PROGRAM",
      "location": "WORKING_STORAGE",
      "citation": 227
    },
    {
      "copybook_name": "COCRDLI",
      "purpose": "BMS map definition for credit card list screen CCRDLIAI/O",
      "location": "WORKING_STORAGE",
      "citation": 276
    },
    {
      "copybook_name": "CVACT02Y",
      "purpose": "VSAM file record layout for CARDDAT",
      "location": "WORKING_STORAGE",
      "citation": 290
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "IBM BMS symbolic map constants (e.g. DFHBMFSE)",
      "location": "WORKING_STORAGE",
      "citation": 267
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "IBM AID constants (e.g. CCARD-AID-PFK03)",
      "location": "WORKING_STORAGE",
      "citation": 268
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Current date fields WS-CURDATE-DATA",
      "location": "WORKING_STORAGE",
      "citation": 279
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "0000-MAIN",
      "purpose": "Main control logic: initialize, handle COMMAREA, PF keys, input edits, dispatch to read/browse/send based on action",
      "called_by": [],
      "calls": [
        "YYYY-STORE-PFKEY",
        "2000-RECEIVE-MAP",
        "9000-READ-FORWARD",
        "1000-SEND-MAP",
        "9100-READ-BACKWARDS"
      ],
      "citation": [
        298,
        603
      ]
    },
    {
      "paragraph_name": "COMMON-RETURN",
      "purpose": "Prepare and issue CICS RETURN with TRANSID and updated COMMAREA",
      "called_by": [],
      "calls": [],
      "citation": [
        604,
        620
      ]
    },
    {
      "paragraph_name": "1000-SEND-MAP",
      "purpose": "Build and SEND map: init screen/array/attrs/message then send",
      "called_by": [],
      "calls": [
        "1100-SCREEN-INIT",
        "1200-SCREEN-ARRAY-INIT",
        "1250-SETUP-ARRAY-ATTRIBS",
        "1300-SETUP-SCREEN-ATTRS",
        "1400-SETUP-MESSAGE",
        "1500-SEND-SCREEN"
      ],
      "citation": [
        624,
        638
      ]
    },
    {
      "paragraph_name": "2000-RECEIVE-MAP",
      "purpose": "RECEIVE map into CCRDLIAI, then receive screen and edit inputs",
      "called_by": [],
      "calls": [
        "2100-RECEIVE-SCREEN",
        "2200-EDIT-INPUTS"
      ],
      "citation": [
        951,
        958
      ]
    },
    {
      "paragraph_name": "9000-READ-FORWARD",
      "purpose": "Forward browse: STARTBR GTEQ, loop READNEXT up to 7 records filtering, check next page, ENDBR",
      "called_by": [],
      "calls": [
        "9500-FILTER-RECORDS"
      ],
      "citation": [
        1123,
        1260
      ]
    },
    {
      "paragraph_name": "9100-READ-BACKWARDS",
      "purpose": "Backward page: STARTBR GTEQ last key, READPREV 8 times to get prior 7 filtering, ENDBR",
      "called_by": [],
      "calls": [
        "9500-FILTER-RECORDS"
      ],
      "citation": [
        1264,
        1373
      ]
    },
    {
      "paragraph_name": "9500-FILTER-RECORDS",
      "purpose": "Exclude record if doesn't match valid acct/card filters",
      "called_by": [],
      "calls": [],
      "citation": [
        1382,
        1408
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "WS-RESP-CD NOT DFHRESP(NORMAL) or DUPREC on READNEXT/READPREV/STARTBR",
      "action": "Set WS-ERROR-MSG with file error details, exit loop/browse",
      "citation": [
        1157,
        1223,
        1230,
        1250,
        1311,
        1364
      ]
    },
    {
      "condition": "INPUT-ERROR from edits (invalid numeric filters, multiple/invalid selects)",
      "action": "Set error message, protect select rows, resend map for correction",
      "citation": [
        419,
        587,
        1020,
        1054,
        1086,
        1110
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "SEND MAP",
      "resource": "CCRDLIA",
      "purpose": "Display credit card list screen with data, messages, cursor",
      "citation": 939
    },
    {
      "command": "RECEIVE MAP",
      "resource": "CCRDLIA",
      "purpose": "Receive user inputs from screen filters and selects",
      "citation": 963
    },
    {
      "command": "STARTBR",
      "resource": "CARDDAT",
      "purpose": "Initiate forward/backward browse GTEQ key",
      "citation": 1129
    },
    {
      "command": "READNEXT",
      "resource": "CARDDAT",
      "purpose": "Fetch next record in forward browse",
      "citation": 1146
    },
    {
      "command": "READPREV",
      "resource": "CARDDAT",
      "purpose": "Fetch previous record in backward browse",
      "citation": 1294
    },
    {
      "command": "ENDBR",
      "resource": "CARDDAT",
      "purpose": "Terminate browse",
      "citation": 1258
    },
    {
      "command": "XCTL",
      "resource": "COMEN01C",
      "purpose": "Transfer control to menu program",
      "citation": 402
    },
    {
      "command": "RETURN",
      "resource": "CCLI",
      "purpose": "Return to CICS with TRANSID and COMMAREA for reentrancy",
      "citation": 615
    }
  ],
  "open_questions": [
    {
      "question": "Exact fields in copybooks like CVACT02Y, COCOM01Y, COCRDLI?",
      "context": "Copybook sources unavailable; fields inferred from usage but not fully known",
      "suggestion": "Analyze referenced copybooks"
    },
    {
      "question": "Admin user check for listing all cards?",
      "context": "Comment lines 5-6 mention admin user but no explicit code found (perhaps in CSUSR01Y or commarea USRTYP)",
      "suggestion": "Check CSUSR01Y and user context logic"
    },
    {
      "question": "Full PF key mapping in YYYY-STORE-PFKEY?",
      "context": "COPY 'CSSTRPFY' at 1416; contents unknown",
      "suggestion": "Analyze CSSTRPFY"
    }
  ]
}