{
  "header": {
    "program_id": "CBTRN01C",
    "file_name": "CBTRN01C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T16:40:10.736539",
    "iteration_count": 2,
    "final_status": "WITNESSED"
  },
  "purpose": {
    "summary": "Batch COBOL program that validates daily transaction records by sequentially reading DALYTRAN-FILE, looking up card number in indexed XREF-FILE to obtain account ID, and validating account existence via keyed read of ACCOUNT-FILE, displaying success/error messages but performing no updates or writes despite header comment claiming to 'Post the records'. Files CUSTOMER-FILE, CARD-FILE, and TRANSACT-FILE are opened as INPUT and closed without any I/O operations.",
    "business_context": "CardDemo application serving transaction posting validation (actual posting absent)",
    "program_type": "BATCH",
    "citations": [
      2,
      3,
      4,
      5,
      29,
      40,
      52,
      164,
      172,
      176
    ]
  },
  "inputs": [
    {
      "name": "DALYTRAN-FILE",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Sequential daily transaction records with transaction ID (FD-TRAN-ID PIC X(16)) and customer data (FD-CUST-DATA PIC X(334)) including card number (DALYTRAN-CARD-NUM)",
      "copybook": "CVTRA06Y",
      "citation": [
        29,
        30,
        31,
        67,
        68,
        203,
        170
      ]
    },
    {
      "name": "XREF-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed cross-reference file keyed by card number (FD-XREF-CARD-NUM PIC X(16)) containing account ID (XREF-ACCT-ID) and customer ID (XREF-CUST-ID)",
      "copybook": "CVACT03Y",
      "citation": [
        40,
        41,
        42,
        43,
        78,
        229
      ]
    },
    {
      "name": "ACCOUNT-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed account master file keyed by account ID (FD-ACCT-ID PIC 9(11)) containing account data (FD-ACCT-DATA PIC X(289))",
      "copybook": "CVACT01Y",
      "citation": [
        52,
        53,
        54,
        55,
        88,
        243
      ]
    },
    {
      "name": "CUSTOMER-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed customer file keyed by customer ID (FD-CUST-ID PIC 9(09)) opened but never read",
      "copybook": "CVCUS01Y",
      "citation": [
        34,
        35,
        36,
        37,
        72
      ]
    },
    {
      "name": "CARD-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed card file keyed by card number (FD-CARD-NUM PIC X(16)) opened but never read",
      "copybook": "CVACT02Y",
      "citation": [
        46,
        47,
        48,
        49,
        83
      ]
    },
    {
      "name": "TRANSACT-FILE",
      "io_type": "FILE_VSAM",
      "description": "Indexed transaction output file keyed by transaction ID (FD-TRANS-ID PIC X(16)) opened as INPUT but never read or written",
      "copybook": "CVTRA05Y",
      "citation": [
        58,
        59,
        60,
        61,
        93
      ]
    }
  ],
  "outputs": [],
  "called_programs": [
    {
      "program_name": "CEE3ABD",
      "call_type": "STATIC_CALL",
      "purpose": "Abnormal program termination (abend) with user completion code 999",
      "parameters": [
        "ABCODE",
        "TIMING"
      ],
      "citation": 473
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": []
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Skip transaction processing if card number not found in XREF-FILE (INVALID KEY)",
      "logic_summary": "Display 'INVALID CARD NUMBER FOR XREF', set WS-XREF-READ-STATUS to 4, skip account read",
      "conditions": [
        "INVALID KEY on READ XREF-FILE"
      ],
      "citation": [
        231,
        232,
        233
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Display account not found if XREF valid but account missing (INVALID KEY on ACCOUNT-FILE)",
      "logic_summary": "After successful XREF, perform account read; on INVALID KEY display message and set WS-ACCT-READ-STATUS to 4 but continue processing next transaction",
      "conditions": [
        "WS-XREF-READ-STATUS = 0",
        "INVALID KEY on READ ACCOUNT-FILE"
      ],
      "citation": [
        173,
        245,
        246,
        247
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Terminate main loop on EOF of DALYTRAN-FILE",
      "logic_summary": "On READ status '10', set END-OF-DAILY-TRANS-FILE to 'Y'",
      "conditions": [
        "DALYTRAN-STATUS = '10'"
      ],
      "citation": [
        207,
        217
      ]
    },
    {
      "rule_id": "BR004",
      "description": "On successful XREF lookup, display validation details and proceed to account validation",
      "logic_summary": "Display 'SUCCESSFUL READ OF XREF', card number, account ID, customer ID",
      "conditions": [
        "NOT INVALID KEY on READ XREF-FILE"
      ],
      "citation": [
        235,
        236,
        237,
        238
      ]
    },
    {
      "rule_id": "BR005",
      "description": "On successful ACCOUNT-FILE read, display success message",
      "logic_summary": "Display 'SUCCESSFUL READ OF ACCOUNT FILE'",
      "conditions": [
        "NOT INVALID KEY on READ ACCOUNT-FILE"
      ],
      "citation": [
        249
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Abend on non-zero/non-EOF file status during DALYTRAN-FILE READ",
      "logic_summary": "Display error, show IO status, abend",
      "conditions": [
        "DALYTRAN-STATUS NOT = '00' or '10'"
      ],
      "citation": [
        219,
        221,
        222
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "DALYTRAN-FILE",
        "fields_used": [
          "DALYTRAN-CARD-NUM",
          "DALYTRAN-ID"
        ],
        "citation": [
          170,
          183
        ]
      },
      {
        "source": "XREF-FILE",
        "fields_used": [
          "XREF-ACCT-ID",
          "XREF-CUST-ID"
        ],
        "citation": [
          237
        ]
      },
      {
        "source": "ACCOUNT-FILE",
        "fields_used": [],
        "citation": [
          243
        ]
      }
    ],
    "writes_to": [],
    "transforms": [
      {
        "input_field": "DALYTRAN-CARD-NUM",
        "output_field": "XREF-CARD-NUM",
        "transformation_description": "Move card number from daily transaction record to XREF working storage key field",
        "citation": [
          171
        ]
      },
      {
        "input_field": "XREF-CARD-NUM",
        "output_field": "FD-XREF-CARD-NUM",
        "transformation_description": "Move to file description key for XREF-FILE keyed read",
        "citation": [
          228
        ]
      },
      {
        "input_field": "XREF-ACCT-ID",
        "output_field": "ACCT-ID",
        "transformation_description": "Move account ID from XREF record to ACCOUNT working storage key",
        "citation": [
          175
        ]
      },
      {
        "input_field": "ACCT-ID",
        "output_field": "FD-ACCT-ID",
        "transformation_description": "Move to file description key for ACCOUNT-FILE keyed read",
        "citation": [
          242
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CVTRA06Y",
      "purpose": "Defines DALYTRAN-RECORD structure populated on READ from DALYTRAN-FILE (includes DALYTRAN-CARD-NUM, DALYTRAN-ID)",
      "location": "WORKING_STORAGE",
      "citation": 99
    },
    {
      "copybook_name": "CVCUS01Y",
      "purpose": "Defines customer record structure for CUSTOMER-FILE (FD-CUSTFILE-REC); file opened but copybook fields unused",
      "location": "WORKING_STORAGE",
      "citation": 104
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "Defines CARD-XREF-RECORD structure (XREF-CARD-NUM, XREF-ACCT-ID, XREF-CUST-ID) populated on READ from XREF-FILE",
      "location": "WORKING_STORAGE",
      "citation": 109
    },
    {
      "copybook_name": "CVACT02Y",
      "purpose": "Defines card record structure for CARD-FILE (FD-CARDFILE-REC); file opened but copybook fields unused",
      "location": "WORKING_STORAGE",
      "citation": 114
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "Defines ACCOUNT-RECORD structure populated on READ from ACCOUNT-FILE",
      "location": "WORKING_STORAGE",
      "citation": 119
    },
    {
      "copybook_name": "CVTRA05Y",
      "purpose": "Defines output transaction record structure for TRANSACT-FILE (FD-TRANFILE-REC); file opened INPUT but never used",
      "location": "WORKING_STORAGE",
      "citation": 124
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Orchestrates file opens, main processing loop (read daily trans, lookup xref, read account, validate), file closes",
      "called_by": [],
      "calls": [
        "0000-DALYTRAN-OPEN",
        "0100-CUSTFILE-OPEN",
        "0200-XREFFILE-OPEN",
        "0300-CARDFILE-OPEN",
        "0400-ACCTFILE-OPEN",
        "0500-TRANFILE-OPEN",
        "1000-DALYTRAN-GET-NEXT",
        "2000-LOOKUP-XREF",
        "3000-READ-ACCOUNT",
        "9000-DALYTRAN-CLOSE",
        "9100-CUSTFILE-CLOSE",
        "9200-XREFFILE-CLOSE",
        "9300-CARDFILE-CLOSE",
        "9400-ACCTFILE-CLOSE",
        "9500-TRANFILE-CLOSE"
      ],
      "citation": [
        155,
        197
      ]
    },
    {
      "paragraph_name": "1000-DALYTRAN-GET-NEXT",
      "purpose": "Sequential READ DALYTRAN-FILE, set EOF flag on '10', abend on other errors",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "Z-DISPLAY-IO-STATUS",
        "Z-ABEND-PROGRAM"
      ],
      "citation": [
        202,
        225
      ]
    },
    {
      "paragraph_name": "2000-LOOKUP-XREF",
      "purpose": "Keyed READ XREF-FILE by card number, handle INVALID KEY vs success with displays",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        227,
        240
      ]
    },
    {
      "paragraph_name": "3000-READ-ACCOUNT",
      "purpose": "Keyed READ ACCOUNT-FILE by account ID, handle INVALID KEY vs success with displays",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        241,
        251
      ]
    },
    {
      "paragraph_name": "0000-DALYTRAN-OPEN",
      "purpose": "OPEN INPUT DALYTRAN-FILE, abend on error",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "Z-DISPLAY-IO-STATUS",
        "Z-ABEND-PROGRAM"
      ],
      "citation": [
        252,
        268
      ]
    },
    {
      "paragraph_name": "Z-ABEND-PROGRAM",
      "purpose": "CALL CEE3ABD to abend program",
      "called_by": [
        "0000-DALYTRAN-OPEN",
        "0100-CUSTFILE-OPEN",
        "0200-XREFFILE-OPEN",
        "0300-CARDFILE-OPEN",
        "0400-ACCTFILE-OPEN",
        "0500-TRANFILE-OPEN",
        "9000-DALYTRAN-CLOSE",
        "9100-CUSTFILE-CLOSE",
        "9200-XREFFILE-CLOSE",
        "9300-CARDFILE-CLOSE",
        "9400-ACCTFILE-CLOSE",
        "9500-TRANFILE-CLOSE",
        "1000-DALYTRAN-GET-NEXT"
      ],
      "calls": [],
      "citation": [
        469,
        475
      ]
    },
    {
      "paragraph_name": "Z-DISPLAY-IO-STATUS",
      "purpose": "Format and DISPLAY file status code numerically",
      "called_by": [
        "0000-DALYTRAN-OPEN",
        "0100-CUSTFILE-OPEN",
        "0200-XREFFILE-OPEN",
        "0300-CARDFILE-OPEN",
        "0400-ACCTFILE-OPEN",
        "0500-TRANFILE-OPEN",
        "9000-DALYTRAN-CLOSE",
        "9100-CUSTFILE-CLOSE",
        "9200-XREFFILE-CLOSE",
        "9300-CARDFILE-CLOSE",
        "9400-ACCTFILE-CLOSE",
        "9500-TRANFILE-CLOSE",
        "1000-DALYTRAN-GET-NEXT"
      ],
      "calls": [],
      "citation": [
        476,
        489
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "DALYTRAN-STATUS NOT = '00' and NOT = '10' on READ",
      "action": "DISPLAY error message, PERFORM Z-DISPLAY-IO-STATUS, PERFORM Z-ABEND-PROGRAM",
      "citation": [
        219,
        221,
        222
      ]
    },
    {
      "condition": "File STATUS NOT = '00' on any OPEN INPUT",
      "action": "DISPLAY file-specific error, PERFORM Z-DISPLAY-IO-STATUS, PERFORM Z-ABEND-PROGRAM",
      "citation": [
        258,
        263,
        265,
        277,
        282,
        284,
        295,
        300,
        302,
        313,
        318,
        320,
        331,
        336,
        338,
        349,
        354,
        356
      ]
    },
    {
      "condition": "File STATUS NOT = '00' on any CLOSE",
      "action": "DISPLAY file-specific error, PERFORM Z-DISPLAY-IO-STATUS, PERFORM Z-ABEND-PROGRAM",
      "citation": [
        367,
        372,
        374,
        385,
        390,
        392,
        403,
        408,
        410,
        421,
        426,
        428,
        439,
        444,
        446,
        457,
        462,
        464
      ]
    },
    {
      "condition": "INVALID KEY on READ XREF-FILE",
      "action": "DISPLAY 'INVALID CARD NUMBER FOR XREF', MOVE 4 TO WS-XREF-READ-STATUS, skip account read",
      "citation": [
        232,
        233
      ]
    },
    {
      "condition": "INVALID KEY on READ ACCOUNT-FILE",
      "action": "DISPLAY 'INVALID ACCOUNT NUMBER FOUND', MOVE 4 TO WS-ACCT-READ-STATUS, continue to next transaction",
      "citation": [
        246,
        247
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Full contents and field layouts of copybooks CVTRA06Y, CVCUS01Y, CVACT03Y, CVACT02Y, CVACT01Y, CVTRA05Y",
      "context": "Copybooks copied into WORKING-STORAGE but source unavailable; fields like DALYTRAN-CARD-NUM inferred from usage",
      "suggestion": "Provide copybook source code"
    },
    {
      "question": "Purpose of opening CUSTOMER-FILE, CARD-FILE, TRANSACT-FILE as INPUT without any READ/WRITE/REWRITE",
      "context": "Opened and closed in dedicated paragraphs (271-287, 307-323, 343-359) with error handling, but no I/O in main logic or elsewhere",
      "suggestion": "Possibly code incompleteness, future enhancement, or dependency on copybook logic; review JCL/PROC or runtime behavior"
    },
    {
      "question": "Why no transaction posting despite header comment 'Post the records from daily transaction file'",
      "context": "Program only validates via lookups/displays, no writes to TRANSACT-FILE or updates to ACCOUNT-FILE/CUSTOMER-FILE",
      "suggestion": "Likely incomplete implementation; check for missing WRITE/REWRITE logic or external posting mechanism"
    }
  ]
}