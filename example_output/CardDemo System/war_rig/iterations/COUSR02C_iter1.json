{
  "header": {
    "program_id": "COUSR02C",
    "file_name": "COUSR02C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T17:57:37.391653",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "CICS transaction CU02 program that displays the COUSR2A map for updating a user record from the USRSEC VSAM file. Handles loading existing user data on Enter, validates and updates fields (first name, last name, password, user type) on PF5/PF3, clears screen on PF4, and XCTLs back to prior program on PF3/PF12 or initial entry.",
    "business_context": "CardDemo application user security maintenance, updating users selected from a list screen",
    "program_type": "ONLINE_CICS",
    "citations": [
      2,
      5,
      37,
      82
    ]
  },
  "inputs": [
    {
      "name": "COUSR2AI",
      "io_type": "CICS_MAP",
      "description": "Input fields from user update screen: USRIDINI, FNAMEI, LNAMEI, PASSWDI, USRTYPEI, length attributes",
      "copybook": "COUSR02",
      "citation": [
        285,
        288
      ]
    },
    {
      "name": "USRSEC",
      "io_type": "FILE_VSAM",
      "description": "VSAM dataset containing user records with SEC-USR-ID key and fields SEC-USR-FNAME, SEC-USR-LNAME, SEC-USR-PWD, SEC-USR-TYPE",
      "copybook": "CSUSR01Y",
      "citation": [
        322,
        324
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Commarea from prior program with CDEMO-CU02-INFO including selected user ID (CDEMO-CU02-USR-SELECTED), from/to program/tran info",
      "copybook": "COCOM01Y",
      "citation": [
        94,
        50
      ]
    }
  ],
  "outputs": [
    {
      "name": "COUSR2AO",
      "io_type": "CICS_MAP",
      "description": "Output fields to user update screen: header (titles, date/time, tranid, pgmname), error message (ERRMSGO, ERRMSGC), data fields",
      "copybook": "COUSR02",
      "citation": [
        272,
        273
      ]
    },
    {
      "name": "USRSEC",
      "io_type": "FILE_VSAM",
      "description": "Updated user record with modified SEC-USR-FNAME, SEC-USR-LNAME, SEC-USR-PWD, SEC-USR-TYPE",
      "copybook": "CSUSR01Y",
      "citation": [
        360,
        362
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea passed to XCTL or RETURN with from/to program/tran context",
      "copybook": "COCOM01Y",
      "citation": [
        256,
        257
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Transfer control to previous screen (e.g., COSGN00C signon, COADM01C admin, or caller) after update or cancel",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 259
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CU02"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "User ID must not be blank or low-values when loading or updating user",
      "logic_summary": "EVALUATE checks USRIDINI OF COUSR2AI, sets WS-ERR-FLG='Y', positions cursor with -1 length",
      "conditions": [
        "USRIDINI OF COUSR2AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        146,
        180
      ]
    },
    {
      "rule_id": "BR002",
      "description": "First name, last name, password, user type must not be blank or low-values for update",
      "logic_summary": "EVALUATE chain checks each field in UPDATE-USER-INFO, sets error flag and positions cursor",
      "conditions": [
        "FNAMEI/LNAMEI/PASSWDI/USRTYPEI OF COUSR2AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        186,
        192,
        198,
        204
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Update only if at least one field differs from existing record",
      "logic_summary": "Compare input fields to SEC-USER-DATA fields, set USR-MODIFIED-YES if changed, REWRITE only if yes",
      "conditions": [
        "FNAMEI NOT = SEC-USR-FNAME",
        "LNAMEI NOT = SEC-USR-LNAME",
        "PASSWDI NOT = SEC-USR-PWD",
        "USRTYPEI NOT = SEC-USR-TYPE"
      ],
      "citation": [
        219,
        236
      ]
    },
    {
      "rule_id": "BR004",
      "description": "On READ NOTFND, display 'User ID NOT found' error",
      "logic_summary": "EVALUATE WS-RESP-CD after READ, set error and reposition cursor",
      "conditions": [
        "WS-RESP-CD = DFHRESP(NOTFND)"
      ],
      "citation": [
        341
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "USRSEC",
        "fields_used": [
          "SEC-USR-FNAME",
          "SEC-USR-LNAME",
          "SEC-USR-PWD",
          "SEC-USR-TYPE"
        ],
        "citation": [
          322,
          166
        ]
      },
      {
        "source": "COUSR2AI",
        "fields_used": [
          "USRIDINI",
          "FNAMEI",
          "LNAMEI",
          "PASSWDI",
          "USRTYPEI"
        ],
        "citation": [
          285,
          157
        ]
      },
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-CU02-USR-SELECTED"
        ],
        "citation": [
          94,
          99
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "USRSEC",
        "fields_written": [
          "SEC-USR-FNAME",
          "SEC-USR-LNAME",
          "SEC-USR-PWD",
          "SEC-USR-TYPE"
        ],
        "citation": [
          360,
          220
        ]
      },
      {
        "destination": "COUSR2AO",
        "fields_written": [
          "ERRMSGO",
          "ERRMSGC",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO"
        ],
        "citation": [
          270,
          300
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "USRIDINI OF COUSR2AI",
        "output_field": "SEC-USR-ID",
        "transformation_description": "Direct move to key for READ",
        "citation": [
          162
        ]
      },
      {
        "input_field": "FNAMEI OF COUSR2AI",
        "output_field": "SEC-USR-FNAME",
        "transformation_description": "Move if not equal to existing",
        "citation": [
          219
        ]
      },
      {
        "input_field": "SEC-USR-FNAME",
        "output_field": "FNAMEI OF COUSR2AI",
        "transformation_description": "Move from file to input map on load",
        "citation": [
          167
        ]
      },
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURDATEO OF COUSR2AO",
        "transformation_description": "Format MM-DD-YY from WS-CURDATE-DATA",
        "citation": [
          298,
          309
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Common commarea structure including CDEMO-CU02-INFO for transaction context (user selected, page, from/to programs)",
      "location": "WORKING_STORAGE",
      "citation": 49
    },
    {
      "copybook_name": "COUSR02",
      "purpose": "Defines BMS map input COUSR2AI and output COUSR2AO for user update screen fields and attributes",
      "location": "WORKING_STORAGE",
      "citation": 60
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Common title constants (CCDA-TITLE01, CCDA-TITLE02)",
      "location": "WORKING_STORAGE",
      "citation": 62
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Date/time working storage variables (WS-CURDATE-DATA, WS-CURTIME-* formats)",
      "location": "WORKING_STORAGE",
      "citation": 63
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Message constants (CCDA-MSG-INVALID-KEY)",
      "location": "WORKING_STORAGE",
      "citation": 64
    },
    {
      "copybook_name": "CSUSR01Y",
      "purpose": "User security record structure SEC-USER-DATA with SEC-USR-ID key and detail fields",
      "location": "WORKING_STORAGE",
      "citation": 65
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS AID keys (DFHENTER, DFHPF3, etc.)",
      "location": "WORKING_STORAGE",
      "citation": 67
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "CICS BMS color/attr constants (DFHRED, DFHGREEN, DFHNEUTR)",
      "location": "WORKING_STORAGE",
      "citation": 68
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Entry point: initialize flags/messages, handle first entry (XCTL back), reentry (receive map, process AID)",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-USRUPD-SCREEN",
        "RECEIVE-USRUPD-SCREEN",
        "UPDATE-USER-INFO",
        "CLEAR-CURRENT-SCREEN"
      ],
      "citation": [
        82,
        137
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Validate/load user by ID from screen, populate screen fields from file",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-USRUPD-SCREEN",
        "READ-USER-SEC-FILE"
      ],
      "citation": [
        143,
        173
      ]
    },
    {
      "paragraph_name": "UPDATE-USER-INFO",
      "purpose": "Validate screen fields, compare/load to file record, update if changed",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-USRUPD-SCREEN",
        "READ-USER-SEC-FILE",
        "UPDATE-USER-SEC-FILE"
      ],
      "citation": [
        177,
        245
      ]
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "purpose": "Set from context and XCTL to prior program",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        250,
        261
      ]
    },
    {
      "paragraph_name": "SEND-USRUPD-SCREEN",
      "purpose": "Populate header, send map with erase/cursor",
      "called_by": [
        "MAIN-PARA",
        "UPDATE-USER-INFO",
        "READ-USER-SEC-FILE"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        266,
        278
      ]
    },
    {
      "paragraph_name": "RECEIVE-USRUPD-SCREEN",
      "purpose": "Receive map into input area with resp codes",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        283,
        291
      ]
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "purpose": "Set screen header with titles, tranid, pgmname, formatted date/time",
      "called_by": [
        "SEND-USRUPD-SCREEN"
      ],
      "calls": [],
      "citation": [
        296,
        315
      ]
    },
    {
      "paragraph_name": "READ-USER-SEC-FILE",
      "purpose": "CICS READ UPDATE user record by RIDFLD, handle resp (normal/notfnd/other)",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "UPDATE-USER-INFO"
      ],
      "calls": [
        "SEND-USRUPD-SCREEN"
      ],
      "citation": [
        320,
        353
      ]
    },
    {
      "paragraph_name": "UPDATE-USER-SEC-FILE",
      "purpose": "CICS REWRITE user record, handle resp with success/error messages",
      "called_by": [
        "UPDATE-USER-INFO"
      ],
      "calls": [
        "SEND-USRUPD-SCREEN"
      ],
      "citation": [
        358,
        390
      ]
    },
    {
      "paragraph_name": "CLEAR-CURRENT-SCREEN",
      "purpose": "Initialize fields and resend screen",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-USRUPD-SCREEN"
      ],
      "citation": [
        395,
        399
      ]
    },
    {
      "paragraph_name": "INITIALIZE-ALL-FIELDS",
      "purpose": "Clear screen input fields and message",
      "called_by": [
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [],
      "citation": [
        403,
        411
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "USRIDINI/FNAMEI/etc. = SPACES OR LOW-VALUES",
      "action": "Set WS-ERR-FLG='Y', load error message to WS-MESSAGE, set field length -1 for cursor, PERFORM SEND-USRUPD-SCREEN",
      "citation": [
        147,
        181
      ]
    },
    {
      "condition": "WS-RESP-CD = DFHRESP(NOTFND) after READ",
      "action": "Set WS-ERR-FLG='Y', message 'User ID NOT found...', cursor to USRIDINL",
      "citation": [
        341
      ]
    },
    {
      "condition": "WS-RESP-CD NOT = DFHRESP(NORMAL) after READ/REWRITE",
      "action": "DISPLAY resp/reason, set error flag, generic message, cursor position",
      "citation": [
        347,
        384
      ]
    },
    {
      "condition": "EIBAID = OTHER",
      "action": "Set WS-ERR-FLG='Y', invalid key message",
      "citation": [
        128
      ]
    },
    {
      "condition": "No modifications detected",
      "action": "Message 'Please modify to update ...', set DFHRED color",
      "citation": [
        239
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "SEND",
      "resource": "MAP('COUSR2A') MAPSET('COUSR02') FROM(COUSR2AO)",
      "purpose": "Display update screen with populated data, header, error message, erase and cursor positioning",
      "citation": 272
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('COUSR2A') MAPSET('COUSR02') INTO(COUSR2AI)",
      "purpose": "Receive edited user fields and AID from screen",
      "citation": 285
    },
    {
      "command": "READ",
      "resource": "DATASET('USRSEC') INTO(SEC-USER-DATA) RIDFLD(SEC-USR-ID)",
      "purpose": "Read user record for display or update with UPDATE option",
      "citation": 322
    },
    {
      "command": "REWRITE",
      "resource": "DATASET('USRSEC') FROM(SEC-USER-DATA)",
      "purpose": "Rewrite modified user record",
      "citation": 360
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM) COMMAREA(CARDDEMO-COMMAREA)",
      "purpose": "Transfer to prior program preserving commarea",
      "citation": 259
    },
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID='CU02') COMMAREA(CARDDEMO-COMMAREA)",
      "purpose": "Restart own transaction after processing",
      "citation": 135
    }
  ],
  "open_questions": [
    {
      "question": "Exact field layouts and additional fields in copybooks (e.g., full SEC-USER-DATA in CSUSR01Y, all map fields in COUSR02)",
      "context": "Copybooks not inlined; inferred from usage but unconfirmed",
      "suggestion": "Analyze referenced copybook source files"
    },
    {
      "question": "Programs that call this via XCTL (e.g., user list screen pgm setting CDEMO-CU02-USR-SELECTED)",
      "context": "Inferred from commarea but not explicit",
      "suggestion": "Trace callers of CU02 transaction or XCTL sources"
    }
  ]
}