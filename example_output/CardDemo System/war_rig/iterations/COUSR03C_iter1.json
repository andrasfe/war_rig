{
  "header": {
    "program_id": "COUSR03C",
    "file_name": "COUSR03C.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T18:09:10.364325",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "CICS online program that displays a delete confirmation screen for a selected user ID from the USRSEC VSAM file, reads user details, populates the screen with name and type, and deletes the record upon PF5 key press. Handles navigation keys like PF3/PF12 to return to previous screens (COSGN00C or COADM01C) and PF4 to clear. Processes input from map and commarea passed from prior program.",
    "business_context": "User administration in CardDemo application: delete user security records",
    "program_type": "ONLINE_CICS",
    "citations": [
      3,
      5,
      37,
      82,
      213,
      305
    ]
  },
  "inputs": [
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Passed commarea containing prior program context, selected user ID from list screen (CDEMO-CU03-USR-SELECTED), page info, and navigation flags",
      "copybook": "COCOM01Y",
      "citation": [
        49,
        74,
        94,
        99
      ]
    },
    {
      "name": "COUSR3AI",
      "io_type": "CICS_MAP",
      "description": "Input map fields: user ID (USRIDINI), length (USRIDINL), first/last name, type from screen receive",
      "copybook": "COUSR03",
      "citation": [
        60,
        232
      ]
    },
    {
      "name": "USRSEC",
      "io_type": "FILE_VSAM",
      "description": "VSAM dataset read by user ID (SEC-USR-ID) to retrieve/populate user details (SEC-USR-FNAME, SEC-USR-LNAME, SEC-USR-TYPE)",
      "copybook": "CSUSR01Y",
      "citation": [
        38,
        65,
        269
      ]
    }
  ],
  "outputs": [
    {
      "name": "COUSR3AO",
      "io_type": "CICS_MAP",
      "description": "Output map for delete screen: header (titles, date/time, tranid, pgmname), error message (ERRMSGO), user details (FNAMEI, LNAMEI, USRTYPEI), cursor position",
      "copybook": "COUSR03",
      "citation": [
        60,
        219
      ]
    },
    {
      "name": "CARDDEMO-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea with current context passed to next program via XCTL or RETURN TRANSID",
      "copybook": "COCOM01Y",
      "citation": [
        49,
        136,
        207
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "COSGN00C",
      "call_type": "CICS_XCTL",
      "purpose": "Return to signon screen when no prior program or on PF12",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 92
    },
    {
      "program_name": "COADM01C",
      "call_type": "CICS_XCTL",
      "purpose": "Return to admin menu on PF3/PF12 when no prior program specified",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 113
    },
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Dynamic XCTL to previous program (set from CDEMO-FROM-PROGRAM) on PF3",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 206
    }
  ],
  "calling_context": {
    "called_by": [
      "COUSR03"
    ],
    "entry_points": [
      "CU03"
    ],
    "linkage_section": [
      "DFHCOMMAREA",
      "LK-COMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "User ID must not be empty or low-values before read or delete",
      "logic_summary": "EVALUATE TRUE sets error flag and message if empty",
      "conditions": [
        "USRIDINI OF COUSR3AI = SPACES OR LOW-VALUES"
      ],
      "citation": [
        145,
        177
      ]
    },
    {
      "rule_id": "BR002",
      "description": "On successful VSAM read, populate screen with user name/type and prompt for PF5 delete",
      "logic_summary": "If DFHRESP(NORMAL), move fields to input map and send screen",
      "conditions": [
        "WS-RESP-CD = DFHRESP(NORMAL)"
      ],
      "citation": [
        280,
        165
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Delete VSAM record only on PF5 after read confirms existence",
      "logic_summary": "Perform READ then DELETE, handle responses with messages",
      "conditions": [
        "EIBAID = DFHPF5",
        "NOT ERR-FLG-ON"
      ],
      "citation": [
        122,
        188,
        191
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Invalid AID keys set error and redisplay screen",
      "logic_summary": "WHEN OTHER in EVALUATE EIBAID sets error flag",
      "conditions": [
        "EIBAID NOT in (DFHENTER, DFHPF3, DFHPF4, DFHPF5, DFHPF12)"
      ],
      "citation": [
        127
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "USRSEC",
        "fields_used": [
          "SEC-USR-ID",
          "SEC-USR-FNAME",
          "SEC-USR-LNAME",
          "SEC-USR-TYPE"
        ],
        "citation": [
          160,
          269
        ]
      },
      {
        "source": "COUSR3AI",
        "fields_used": [
          "USRIDINI",
          "USRIDINL",
          "FNAMEI",
          "LNAMEI",
          "USRTYPEI"
        ],
        "citation": [
          102,
          144,
          232
        ]
      },
      {
        "source": "CARDDEMO-COMMAREA",
        "fields_used": [
          "CDEMO-CU03-USR-SELECTED",
          "CDEMO-FROM-PROGRAM",
          "CDEMO-PGM-REENTER"
        ],
        "citation": [
          94,
          99
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "COUSR3AO",
        "fields_written": [
          "ERRMSGO",
          "TITLE01O",
          "TITLE02O",
          "TRNNAMEO",
          "PGMNAMEO",
          "CURDATEO",
          "CURTIMEO",
          "ERRMSGC"
        ],
        "citation": [
          217,
          247,
          219
        ]
      },
      {
        "destination": "USRSEC",
        "fields_written": [],
        "citation": [
          307
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "FUNCTION CURRENT-DATE",
        "output_field": "CURDATEO OF COUSR3AO",
        "transformation_description": "Format current date as MM-DD-YY from WS-CURDATE-DATA",
        "citation": [
          245,
          256
        ]
      },
      {
        "input_field": "SEC-USR-FNAME",
        "output_field": "FNAMEI OF COUSR3AI",
        "transformation_description": "Move read VSAM first name to map input field for display",
        "citation": [
          165
        ]
      },
      {
        "input_field": "SEC-USR-ID",
        "output_field": "WS-MESSAGE",
        "transformation_description": "String 'User ' + SEC-USR-ID + ' has been deleted ...' on successful delete",
        "citation": [
          318
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Common commarea structure including CDEMO-CU03-INFO with user selection and navigation data",
      "location": "WORKING_STORAGE",
      "citation": 49
    },
    {
      "copybook_name": "COUSR03",
      "purpose": "BMS map structures COUSR3AI (input) and COUSR3AO (output) for delete screen fields",
      "location": "WORKING_STORAGE",
      "citation": 60
    },
    {
      "copybook_name": "COTTL01Y",
      "purpose": "Titles and literals (e.g. CCDA-TITLE01)",
      "location": "WORKING_STORAGE",
      "citation": 62
    },
    {
      "copybook_name": "CSDAT01Y",
      "purpose": "Date formatting fields (WS-CURDATE-DATA, WS-CURDATE-MM-DD-YY)",
      "location": "WORKING_STORAGE",
      "citation": 63
    },
    {
      "copybook_name": "CSMSG01Y",
      "purpose": "Message constants (e.g. CCDA-MSG-INVALID-KEY)",
      "location": "WORKING_STORAGE",
      "citation": 64
    },
    {
      "copybook_name": "CSUSR01Y",
      "purpose": "VSAM user record structure SEC-USER-DATA with SEC-USR-ID, SEC-USR-FNAME, etc.",
      "location": "WORKING_STORAGE",
      "citation": 65
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS AID keys (EIBAID, DFHENTER, DFHPF3, etc.)",
      "location": "WORKING_STORAGE",
      "citation": 67
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "BMS constants (DFHNEUTR, DFHGREEN, etc.)",
      "location": "WORKING_STORAGE",
      "citation": 68
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "MAIN-PARA",
      "purpose": "Entry point: initialize flags, handle first entry or reentry, process AID keys, perform actions, return with TRANSID",
      "called_by": [],
      "calls": [
        "RETURN-TO-PREV-SCREEN",
        "PROCESS-ENTER-KEY",
        "SEND-USRDEL-SCREEN",
        "RECEIVE-USRDEL-SCREEN",
        "CLEAR-CURRENT-SCREEN",
        "DELETE-USER-INFO"
      ],
      "citation": [
        82,
        138
      ]
    },
    {
      "paragraph_name": "PROCESS-ENTER-KEY",
      "purpose": "Validate user ID input, read VSAM if valid, populate screen with details",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-USRDEL-SCREEN",
        "READ-USER-SEC-FILE"
      ],
      "citation": [
        142,
        171
      ]
    },
    {
      "paragraph_name": "DELETE-USER-INFO",
      "purpose": "Validate user ID, read VSAM, then delete record",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "SEND-USRDEL-SCREEN",
        "READ-USER-SEC-FILE",
        "DELETE-USER-SEC-FILE"
      ],
      "citation": [
        174,
        194
      ]
    },
    {
      "paragraph_name": "RETURN-TO-PREV-SCREEN",
      "purpose": "Set XCTL target to prior or default program, XCTL with commarea",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        197,
        209
      ]
    },
    {
      "paragraph_name": "SEND-USRDEL-SCREEN",
      "purpose": "Populate header, move message, send map COUSR3A ERASE CURSOR",
      "called_by": [
        "MAIN-PARA",
        "PROCESS-ENTER-KEY",
        "DELETE-USER-INFO",
        "READ-USER-SEC-FILE",
        "DELETE-USER-SEC-FILE"
      ],
      "calls": [
        "POPULATE-HEADER-INFO"
      ],
      "citation": [
        213,
        227
      ]
    },
    {
      "paragraph_name": "RECEIVE-USRDEL-SCREEN",
      "purpose": "Receive map COUSR3A into COUSR3AI with RESP codes",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [],
      "citation": [
        230,
        240
      ]
    },
    {
      "paragraph_name": "POPULATE-HEADER-INFO",
      "purpose": "Format current date/time, move titles/tranid/pgmname to map header",
      "called_by": [
        "SEND-USRDEL-SCREEN"
      ],
      "calls": [],
      "citation": [
        243,
        264
      ]
    },
    {
      "paragraph_name": "READ-USER-SEC-FILE",
      "purpose": "CICS READ VSAM USRSEC UPDATE with RIDFLD, handle RESP/NOTFND/OTHER",
      "called_by": [
        "PROCESS-ENTER-KEY",
        "DELETE-USER-INFO"
      ],
      "calls": [
        "SEND-USRDEL-SCREEN"
      ],
      "citation": [
        267,
        301
      ]
    },
    {
      "paragraph_name": "DELETE-USER-SEC-FILE",
      "purpose": "CICS DELETE VSAM USRSEC, handle RESP/NORMAL/NOTFND/OTHER with messages",
      "called_by": [
        "DELETE-USER-INFO"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-USRDEL-SCREEN"
      ],
      "citation": [
        305,
        338
      ]
    },
    {
      "paragraph_name": "CLEAR-CURRENT-SCREEN",
      "purpose": "Clear fields and resend screen",
      "called_by": [
        "MAIN-PARA"
      ],
      "calls": [
        "INITIALIZE-ALL-FIELDS",
        "SEND-USRDEL-SCREEN"
      ],
      "citation": [
        341,
        346
      ]
    },
    {
      "paragraph_name": "INITIALIZE-ALL-FIELDS",
      "purpose": "Set input lengths to -1, spaces to user fields and message",
      "called_by": [
        "DELETE-USER-SEC-FILE",
        "CLEAR-CURRENT-SCREEN"
      ],
      "calls": [],
      "citation": [
        349,
        357
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "USRIDINI empty or low-values",
      "action": "Set WS-ERR-FLG 'Y', message 'User ID can NOT be empty...', resend screen",
      "citation": [
        146,
        178
      ]
    },
    {
      "condition": "VSAM READ RESP NOTFND",
      "action": "Set error flag, message 'User ID NOT found...', resend screen",
      "citation": [
        288
      ]
    },
    {
      "condition": "VSAM READ/DELETE RESP OTHER",
      "action": "DISPLAY RESP/REAS, set error flag, message 'Unable to lookup/update User...', resend screen",
      "citation": [
        294,
        330
      ]
    },
    {
      "condition": "Invalid EIBAID",
      "action": "Set WS-ERR-FLG 'Y', move CCDA-MSG-INVALID-KEY to message, resend screen",
      "citation": [
        127
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "RETURN",
      "resource": "TRANSID(WS-TRANID)",
      "purpose": "Return to CICS with same transaction ID and commarea",
      "citation": 134
    },
    {
      "command": "SEND",
      "resource": "MAP('COUSR3A') MAPSET('COUSR03')",
      "purpose": "Send delete screen map ERASE CURSOR from COUSR3AO",
      "citation": 219
    },
    {
      "command": "RECEIVE",
      "resource": "MAP('COUSR3A') MAPSET('COUSR03')",
      "purpose": "Receive map into COUSR3AI with RESP codes",
      "citation": 232
    },
    {
      "command": "READ",
      "resource": "DATASET(WS-USRSEC-FILE)",
      "purpose": "Read VSAM record by RIDFLD(SEC-USR-ID) UPDATE",
      "citation": 269
    },
    {
      "command": "DELETE",
      "resource": "DATASET(WS-USRSEC-FILE)",
      "purpose": "Delete VSAM record",
      "citation": 307
    },
    {
      "command": "XCTL",
      "resource": "PROGRAM(CDEMO-TO-PROGRAM)",
      "purpose": "Transfer control to previous program with commarea",
      "citation": 206
    }
  ],
  "open_questions": [
    {
      "question": "Exact structure of SEC-USER-DATA and field lengths",
      "context": "Inferred from CSUSR01Y copybook usage but not visible in source",
      "suggestion": "Analyze CSUSR01Y copybook"
    },
    {
      "question": "Full list of programs calling this (beyond COUSR03 inference)",
      "context": "Inferred from commarea fields like CDEMO-CU03-USR-SELECTED",
      "suggestion": "Trace callers via preprocessor or JCL"
    }
  ]
}