{
  "header": {
    "program_id": "COCRDUPC",
    "file_name": "COCRDUPC.cbl",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T15:44:26.861497",
    "iteration_count": 1,
    "final_status": null
  },
  "purpose": {
    "summary": "CICS online program for updating credit card details. Receives user input via map for account ID, card number, embossed name, active status, and expiry date; validates inputs; reads matching record from VSAM file CARDDAT using card number as key; populates screen with data; allows edits; confirms changes via PF5; rewrites record if confirmed and no conflicts.",
    "business_context": "Credit card maintenance process: allows users to search by account/card, view/edit details (name, status, expiry), and commit updates to database.",
    "program_type": "ONLINE_CICS",
    "citations": [
      4,
      24,
      367,
      492,
      579,
      1349,
      1382,
      1427,
      1477
    ]
  },
  "inputs": [
    {
      "name": "CCRDUPAI",
      "io_type": "CICS_MAP",
      "description": "Screen input fields: ACCTSIDI (account ID), CARDSIDI (card number), CRDNAMEI (embossed name), CRDSTCDI (status), EXPMONI (expiry month), EXPYEARI (expiry year), EXPDAYI (expiry day)",
      "copybook": "COCRDUP",
      "citation": [
        579,
        588,
        598,
        607,
        614,
        621,
        630
      ]
    },
    {
      "name": "DFHCOMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Program communication area containing CARDDEMO-COMMAREA and WS-THIS-PROGCOMMAREA with prior context, old/new details, action flags",
      "copybook": "COCOM01Y",
      "citation": [
        396,
        397
      ]
    },
    {
      "name": "CARDDAT",
      "io_type": "FILE_VSAM",
      "description": "Credit card record read by card number key for display and update",
      "copybook": "CVCRD01Y",
      "citation": [
        1382,
        1427
      ]
    },
    {
      "name": "DFHAID",
      "io_type": "CICS_COMMAREA",
      "description": "Attention identifier for PF keys and enter",
      "copybook": "DFHAID",
      "citation": [
        414,
        416,
        418
      ]
    }
  ],
  "outputs": [
    {
      "name": "CCRDUPAO",
      "io_type": "CICS_MAP",
      "description": "Screen output fields populated with titles, dates, input echoes, error/info messages, data for edit",
      "copybook": "COCRDUP",
      "citation": [
        1329
      ]
    },
    {
      "name": "CARDDAT",
      "io_type": "FILE_VSAM",
      "description": "Rewritten credit card record with updated name, expiry date, status",
      "copybook": "CVCRD01Y",
      "citation": [
        1477
      ]
    },
    {
      "name": "WS-COMMAREA",
      "io_type": "CICS_COMMAREA",
      "description": "Updated commarea with new action flags, old/new details for next invocation",
      "copybook": "COCOM01Y",
      "citation": [
        549,
        554
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CDEMO-TO-PROGRAM",
      "call_type": "CICS_XCTL",
      "purpose": "Exit to calling menu or list program on PF3 or after update",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 473
    },
    {
      "program_name": "COMEN01C",
      "call_type": "CICS_XCTL",
      "purpose": "Default menu on exit if no from-program specified",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 236
    },
    {
      "program_name": "COCRDLIC",
      "call_type": "CICS_XCTL",
      "purpose": "Credit card list screen on exit after list-originated update",
      "parameters": [
        "CARDDEMO-COMMAREA"
      ],
      "citation": 227
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [
      "CCUP"
    ],
    "linkage_section": [
      "DFHCOMMAREA"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Account ID must be 11-digit numeric non-zero if provided",
      "logic_summary": "Check NUMERIC, length implicit, >0; else error message",
      "conditions": [
        "CC-ACCT-ID NOT NUMERIC",
        "CC-ACCT-ID-N = ZEROS"
      ],
      "citation": [
        740,
        724,
        753
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Card number must be 16-digit numeric non-zero if provided",
      "logic_summary": "Check NUMERIC, length implicit, >0; else error",
      "conditions": [
        "CC-CARD-NUM NOT NUMERIC",
        "CC-CARD-NUM-N = ZEROS"
      ],
      "citation": [
        784,
        768,
        796
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Embossed name must be alphabetic only (A-Za-z spaces)",
      "logic_summary": "INSPECT CONVERTING non-alpha to spaces, then TRIM length=0 error",
      "conditions": [
        "INSPECT non-alpha",
        "LENGTH(TRIM)=0"
      ],
      "citation": [
        824,
        828
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Card status must be 'Y' or 'N'",
      "logic_summary": "Check against VALUES 'Y','N'",
      "conditions": [
        "NOT FLG-YES-NO-VALID"
      ],
      "citation": [
        861,
        863
      ]
    },
    {
      "rule_id": "BR005",
      "description": "Expiry month 01-12",
      "logic_summary": "88 VALID-MONTH 1 THRU 12",
      "conditions": [
        "NOT VALID-MONTH"
      ],
      "citation": [
        895,
        898
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Expiry year 1950-2099",
      "logic_summary": "88 VALID-YEAR 1950 THRU 2099",
      "conditions": [
        "NOT VALID-YEAR"
      ],
      "citation": [
        932,
        934
      ]
    },
    {
      "rule_id": "BR007",
      "description": "No changes if new=old (uppercased); prompt no save",
      "logic_summary": "UPPER-CASE compare carDDATA",
      "conditions": [
        "UPPER(new)=UPPER(old)"
      ],
      "citation": [
        680
      ]
    },
    {
      "rule_id": "BR008",
      "description": "Check for concurrent change before rewrite",
      "logic_summary": "Compare fetched CARD- fields to CCUP-OLD- after relock",
      "conditions": [
        "Fields differ"
      ],
      "citation": [
        1499,
        1503
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "CCRDUPAI",
        "fields_used": [
          "ACCTSIDI",
          "CARDSIDI",
          "CRDNAMEI",
          "CRDSTCDI",
          "EXPMONI",
          "EXPYEARI"
        ],
        "citation": [
          594,
          603,
          611,
          618,
          627,
          634
        ]
      },
      {
        "source": "CARDDAT",
        "fields_used": [
          "CARD-EMBOSSED-NAME",
          "CARD-EXPIRAION-DATE",
          "CARD-ACTIVE-STATUS",
          "CARD-CVV-CD"
        ],
        "citation": [
          1354,
          1361,
          1367
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "CARDDAT",
        "fields_written": [
          "CARD-UPDATE-EMBOSSED-NAME",
          "CARD-UPDATE-EXPIRAION-DATE",
          "CARD-UPDATE-ACTIVE-STATUS"
        ],
        "citation": [
          1466,
          1473,
          1475
        ]
      },
      {
        "destination": "CCRDUPAO",
        "fields_written": [
          "ACCTSIDO",
          "CARDSIDO",
          "CRDNAMEO",
          "CRDSTCDO",
          "EXPMONO",
          "EXPYEARO",
          "ERRMSGO",
          "INFOMSGO"
        ],
        "citation": [
          1090,
          1096,
          1108,
          1161,
          1163
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "CCUP-NEW-CRDNAME",
        "output_field": "CARD-UPDATE-EMBOSSED-NAME",
        "transformation_description": "Direct move after alpha validation",
        "citation": [
          1466
        ]
      },
      {
        "input_field": "CCUP-NEW-EXPYEAR,EXPMON,EXPDAY",
        "output_field": "CARD-UPDATE-EXPIRAION-DATE",
        "transformation_description": "STRING year-'mon-'day DELIMITED BY SIZE",
        "citation": [
          1467
        ]
      },
      {
        "input_field": "CARD-EMBOSSED-NAME",
        "output_field": "CCUP-OLD-CRDNAME",
        "transformation_description": "INSPECT upper case then substring move",
        "citation": [
          1356,
          1360
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "CVCRD01Y",
      "purpose": "Defines CARD-RECORD layout for VSAM CARDDAT file",
      "location": "WORKING_STORAGE",
      "citation": 268
    },
    {
      "copybook_name": "COCOM01Y",
      "purpose": "Application commarea CARDDEMO-COMMAREA with context, from/to programs, acct/card keys",
      "location": "WORKING_STORAGE",
      "citation": 272
    },
    {
      "copybook_name": "COCRDUP",
      "purpose": "BMS map CCRDUPA/AI/AO for screen input/output fields",
      "location": "WORKING_STORAGE",
      "citation": 334
    },
    {
      "copybook_name": "DFHBMSCA",
      "purpose": "CICS BMS symbolic map constants (DFHBMPRF etc.)",
      "location": "WORKING_STORAGE",
      "citation": 327
    },
    {
      "copybook_name": "DFHAID",
      "purpose": "CICS AID keys (CCARD-AID-*)",
      "location": "WORKING_STORAGE",
      "citation": 328
    },
    {
      "copybook_name": "CVACT02Y",
      "purpose": "Card record layout (commented CVACT02Y line 353, but uses CARD-RECORD from CVCRD01Y)",
      "location": "WORKING_STORAGE",
      "citation": 353
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "0000-MAIN",
      "purpose": "Main control: handle abend, init vars/commarea, store PFkey, validate AID, evaluate action and PERFORM subflows",
      "called_by": [],
      "calls": [
        "YYYY-STORE-PFKEY",
        "9000-READ-DATA",
        "3000-SEND-MAP",
        "1000-PROCESS-INPUTS",
        "2000-DECIDE-ACTION"
      ],
      "citation": [
        367,
        545
      ]
    },
    {
      "paragraph_name": "1000-PROCESS-INPUTS",
      "purpose": "Receive map, edit inputs, set next-map/prog/error msg",
      "called_by": [
        "0000-MAIN"
      ],
      "calls": [
        "1100-RECEIVE-MAP",
        "1200-EDIT-MAP-INPUTS"
      ],
      "citation": [
        564,
        574
      ]
    },
    {
      "paragraph_name": "2000-DECIDE-ACTION",
      "purpose": "Branch on flags/AID: read data, process write, handle errors/exit",
      "called_by": [
        "0000-MAIN"
      ],
      "calls": [
        "9000-READ-DATA",
        "9200-WRITE-PROCESSING",
        "ABEND-ROUTINE"
      ],
      "citation": [
        948,
        1028
      ]
    },
    {
      "paragraph_name": "3000-SEND-MAP",
      "purpose": "Build and send screen map with init, vars, info, attrs",
      "called_by": [
        "0000-MAIN"
      ],
      "calls": [
        "3100-SCREEN-INIT",
        "3200-SETUP-SCREEN-VARS",
        "3250-SETUP-INFOMSG",
        "3300-SETUP-SCREEN-ATTRS",
        "3400-SEND-SCREEN"
      ],
      "citation": [
        1035,
        1047
      ]
    },
    {
      "paragraph_name": "9000-READ-DATA",
      "purpose": "Init old details, read VSAM by acct/card",
      "called_by": [
        "0000-MAIN",
        "2000-DECIDE-ACTION"
      ],
      "calls": [
        "9100-GETCARD-BYACCTCARD"
      ],
      "citation": [
        1343,
        1371
      ]
    },
    {
      "paragraph_name": "9200-WRITE-PROCESSING",
      "purpose": "Read-update lock VSAM, check changes, build update rec, REWRITE",
      "called_by": [
        "2000-DECIDE-ACTION"
      ],
      "calls": [
        "9300-CHECK-CHANGE-IN-REC"
      ],
      "citation": [
        1420,
        1493
      ]
    },
    {
      "paragraph_name": "ABEND-ROUTINE",
      "purpose": "Send abend message, cancel handle, ABEND 9999",
      "called_by": [
        "0000-MAIN"
      ],
      "calls": [],
      "citation": [
        1531,
        1553
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "Invalid AID/PFkey",
      "action": "Set to ENTER, reposition cursor",
      "citation": [
        413,
        423
      ]
    },
    {
      "condition": "FILE READ RESP NOT NORMAL",
      "action": "Set error flags/messages: NOTFND=combo not found, else file error msg",
      "citation": [
        1392
      ]
    },
    {
      "condition": "UPDATE READ RESP NOT NORMAL",
      "action": "Could not lock, error msg",
      "citation": [
        1441
      ]
    },
    {
      "condition": "REWRITE RESP NOT NORMAL",
      "action": "Set update failed flag/msg",
      "citation": [
        1488
      ]
    },
    {
      "condition": "Any abend",
      "action": "Send ABEND-DATA mapless, ABEND 9999",
      "citation": [
        370,
        1539,
        1550
      ]
    },
    {
      "condition": "Data changed since fetch",
      "action": "Refresh old details, show again",
      "citation": [
        1453,
        1511
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [
    {
      "command": "HANDLE ABEND",
      "resource": "ABEND-ROUTINE",
      "purpose": "Catch unhandled exceptions to abend routine",
      "citation": 370
    },
    {
      "command": "RECEIVE MAP",
      "resource": "CCRDUPA",
      "purpose": "Receive screen input into CCRDUPAI",
      "citation": 579
    },
    {
      "command": "SEND MAP",
      "resource": "CCRDUPA",
      "purpose": "Send screen output from CCRDUPAO with cursor/erase/freekb",
      "citation": 1329
    },
    {
      "command": "READ FILE",
      "resource": "CARDDAT",
      "purpose": "Read card record by cardnum RIDFLD",
      "citation": 1382
    },
    {
      "command": "READ FILE UPDATE",
      "resource": "CARDDAT",
      "purpose": "Lock card record for rewrite",
      "citation": 1427
    },
    {
      "command": "REWRITE FILE",
      "resource": "CARDDAT",
      "purpose": "Update card record",
      "citation": 1478
    },
    {
      "command": "XCTL PROGRAM",
      "resource": "CDEMO-TO-PROGRAM",
      "purpose": "Transfer control to menu/list on exit",
      "citation": 473
    },
    {
      "command": "RETURN TRANSID",
      "resource": "CCUP",
      "purpose": "Return to CICS with updated commarea for re-entry",
      "citation": 554
    }
  ],
  "open_questions": [
    {
      "question": "Exact VSAM key structure for CARDDAT",
      "context": "Code sets WS-CARD-RID-ACCT-ID but READ RIDFLD only CARDNUM (16 bytes), KEYLENGTH=16; assumes cardnum unique despite acct context?",
      "suggestion": "Review file definition or DDNAME clustering"
    },
    {
      "question": "Full called_by programs",
      "context": "XCTL to dynamic CDEMO-TO-PROGRAM (menu COCRDLIC etc.); no static callers visible",
      "suggestion": "Trace commarea from callers like COMEN01C"
    },
    {
      "question": "CVV update handling",
      "context": "Sets CARD-UPDATE-CVV-CD from input? But input map lacks CVV field; copies old CVV",
      "suggestion": "Confirm if CVV editable (code: MOVE CCUP-NEW-CVV-CD but new lacks CVV input)"
    }
  ]
}