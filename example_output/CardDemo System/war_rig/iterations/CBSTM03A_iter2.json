{
  "header": {
    "program_id": "CBSTM03A",
    "file_name": "CBSTM03A.CBL",
    "file_type": "COBOL",
    "analyzed_by": "WAR_RIG",
    "analyzed_at": "2026-01-18T18:02:21.124408",
    "iteration_count": 2,
    "final_status": null
  },
  "purpose": {
    "summary": "Generates customer account statements in plain text and HTML formats for reporting or billing, using cross-reference data to link transactions to customers and accounts.",
    "business_context": "Part of CardDemo application to produce statements from transaction history.",
    "program_type": "BATCH",
    "citations": [
      5,
      6,
      7,
      8,
      9,
      26,
      316
    ]
  },
  "inputs": [
    {
      "name": "TRNXFILE",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Transaction records containing card number, transaction ID, description, amount, read sequentially and grouped into memory table by card.",
      "copybook": "CVACT01Y",
      "citation": [
        730,
        746,
        833,
        839
      ]
    },
    {
      "name": "XREFFILE",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Cross-reference records linking card numbers to customer and account IDs, read sequentially to drive statement generation.",
      "copybook": "COSTM01",
      "citation": [
        345,
        347,
        351,
        364
      ]
    },
    {
      "name": "CUSTFILE",
      "io_type": "FILE_VSAM",
      "description": "Customer master records with name, address, FICO score, read by customer ID key.",
      "copybook": "CUSTREC",
      "citation": [
        368,
        370,
        372,
        377,
        388
      ]
    },
    {
      "name": "ACCTFILE",
      "io_type": "FILE_VSAM",
      "description": "Account records with ID and current balance, read by account ID key.",
      "copybook": "CVACT03Y",
      "citation": [
        392,
        394,
        396,
        401,
        412
      ]
    }
  ],
  "outputs": [
    {
      "name": "STMT-FILE",
      "io_type": "FILE_SEQUENTIAL",
      "description": "Plain text account statements with fixed format lines for header, customer details, account info, transaction list, and totals.",
      "copybook": null,
      "citation": [
        293,
        460,
        487,
        489,
        679,
        435
      ]
    },
    {
      "name": "HTML-FILE",
      "io_type": "FILE_SEQUENTIAL",
      "description": "HTML account statements using tables with styled rows for header, basic details, and transaction rows.",
      "copybook": null,
      "citation": [
        293,
        461,
        486,
        508,
        558,
        681
      ]
    }
  ],
  "called_programs": [
    {
      "program_name": "CBSTM03B",
      "call_type": "STATIC_CALL",
      "purpose": "Universal file handler for OPEN, CLOSE, READ, READ key operations on all input files via DDNAME.",
      "parameters": [
        "WS-M03B-AREA"
      ],
      "citation": 351
    },
    {
      "program_name": "CEE3ABD",
      "call_type": "STATIC_CALL",
      "purpose": "Language Environment abend routine called on all errors.",
      "parameters": [],
      "citation": 923
    }
  ],
  "calling_context": {
    "called_by": [],
    "entry_points": [],
    "linkage_section": [
      "PSA-BLOCK",
      "TCB-BLOCK",
      "TIOT-BLOCK",
      "TIOT-ENTRY"
    ]
  },
  "business_rules": [
    {
      "rule_id": "BR001",
      "description": "Pre-load all transactions into 2D table WS-TRNX-TABLE (51 cards x 10 trans max) grouped by card number before processing statements.",
      "logic_summary": "Initial sequential read loop in 8500-READTRNX-READ detects card changes via WS-SAVE-CARD to increment CR-CNT/TR-CNT and store.",
      "conditions": [
        "WS-SAVE-CARD = TRNX-CARD-NUM",
        "WS-M03B-RC = '00'"
      ],
      "citation": [
        756,
        757,
        819,
        822,
        827,
        850
      ]
    },
    {
      "rule_id": "BR002",
      "description": "Generate one statement per XREFFILE record by matching card to customer/account and listing only matching transactions from table.",
      "logic_summary": "Main loop reads XREFFILE seq, key reads CUST/ACCT, searches table for XREF-CARD-NUM matches, sums/writes trans.",
      "conditions": [
        "END-OF-FILE = 'N'",
        "XREF-CARD-NUM = WS-CARD-NUM (CR-JMP)"
      ],
      "citation": [
        317,
        319,
        321,
        322,
        417,
        420
      ]
    },
    {
      "rule_id": "BR003",
      "description": "Dynamically sequence initial file opens using ALTER verb based on WS-FL-DD flag.",
      "logic_summary": "EVALUATE sets ALTER target for 8100-FILE-OPEN: TRNXFILE (load table) -> XREFFILE -> CUSTFILE -> ACCTFILE -> MAINLINE.",
      "conditions": [
        "WS-FL-DD = 'TRNXFILE'",
        "WS-FL-DD = 'XREFFILE'",
        "WS-FL-DD = 'CUSTFILE'",
        "WS-FL-DD = 'ACCTFILE'"
      ],
      "citation": [
        298,
        300,
        302,
        306,
        309,
        761,
        779,
        797,
        815
      ]
    },
    {
      "rule_id": "BR004",
      "description": "Format customer name and address by concatenating fields with spaces.",
      "logic_summary": "STRING first/middle/last names into ST-NAME; addr lines/state/zip into ST-ADD3.",
      "conditions": [
        "DELIMITED BY ' ' or SIZE"
      ],
      "citation": [
        462,
        472
      ]
    },
    {
      "rule_id": "BR005",
      "description": "Accumulate and display total transaction amount for matching transactions only.",
      "logic_summary": "ADD TRNX-AMT to WS-TOTAL-AMT in inner loop, move to ST-TOTAL-TRAMT.",
      "conditions": [
        "TR-JMP <= WS-TRCT (CR-JMP)"
      ],
      "citation": [
        422,
        428,
        429,
        433
      ]
    },
    {
      "rule_id": "BR006",
      "description": "Limit table to 51 cards x 10 transactions; no explicit overflow check.",
      "logic_summary": "OCCURS 51 TIMES / 10 TIMES; counters CR-CNT up to 51, TR-CNT up to 10.",
      "conditions": [
        "CR-JMP > CR-CNT",
        "TR-JMP > WS-TRCT (CR-JMP)"
      ],
      "citation": [
        226,
        417,
        422
      ]
    }
  ],
  "data_flow": {
    "reads_from": [
      {
        "source": "XREFFILE",
        "fields_used": [
          "XREF-CUST-ID",
          "XREF-ACCT-ID",
          "XREF-CARD-NUM"
        ],
        "citation": [
          372,
          396,
          419
        ]
      },
      {
        "source": "CUSTFILE",
        "fields_used": [
          "CUST-FIRST-NAME",
          "CUST-MIDDLE-NAME",
          "CUST-LAST-NAME",
          "CUST-ADDR-LINE-1",
          "CUST-ADDR-LINE-2",
          "CUST-ADDR-LINE-3",
          "CUST-ADDR-STATE-CD",
          "CUST-ADDR-COUNTRY-CD",
          "CUST-ADDR-ZIP",
          "CUST-FICO-CREDIT-SCORE"
        ],
        "citation": [
          462,
          470,
          472,
          485
        ]
      },
      {
        "source": "ACCTFILE",
        "fields_used": [
          "ACCT-ID",
          "ACCT-CURR-BAL"
        ],
        "citation": [
          483,
          484
        ]
      },
      {
        "source": "TRNXFILE",
        "fields_used": [
          "TRNX-CARD-NUM",
          "TRNX-ID",
          "TRNX-REST",
          "TRNX-DESC",
          "TRNX-AMT"
        ],
        "citation": [
          757,
          827,
          829,
          676,
          677
        ]
      }
    ],
    "writes_to": [
      {
        "destination": "STMT-FILE",
        "fields_written": [
          "ST-NAME",
          "ST-ADD1",
          "ST-ADD2",
          "ST-ADD3",
          "ST-ACCT-ID",
          "ST-CURR-BAL",
          "ST-FICO-SCORE",
          "ST-TRANID",
          "ST-TRANDT",
          "ST-TRANAMT",
          "ST-TOTAL-TRAMT"
        ],
        "citation": [
          469,
          471,
          481,
          483,
          484,
          485,
          676,
          679,
          433
        ]
      },
      {
        "destination": "HTML-FILE",
        "fields_written": [
          "HTML-FIXED-LN (88 levels like HTML-L01 to L80)",
          "HTML-L11 (L11-ACCT)",
          "L23-NAME",
          "HTML-ADDR-LN",
          "HTML-BSIC-LN",
          "HTML-TRAN-LN"
        ],
        "citation": [
          508,
          529,
          560,
          568,
          614,
          687
        ]
      }
    ],
    "transforms": [
      {
        "input_field": "CUST-FIRST-NAME, CUST-MIDDLE-NAME, CUST-LAST-NAME",
        "output_field": "ST-NAME, L23-NAME",
        "transformation_description": "STRING with spaces between names delimited by space/SIZE.",
        "citation": [
          462,
          560
        ]
      },
      {
        "input_field": "CUST-ADDR-LINE-3, CUST-ADDR-STATE-CD, CUST-ADDR-COUNTRY-CD, CUST-ADDR-ZIP",
        "output_field": "ST-ADD3",
        "transformation_description": "STRING address parts with spaces delimited by space/SIZE.",
        "citation": [
          472
        ]
      },
      {
        "input_field": "CUST-ADDR-LINE-1/2",
        "output_field": "ST-ADD1, ST-ADD2, HTML-ADDR-LN",
        "transformation_description": "Direct move for lines 1/2; STRING into HTML-ADDR-LN with <p> tags.",
        "citation": [
          470,
          570,
          578
        ]
      },
      {
        "input_field": "TRNX-AMT (matches)",
        "output_field": "WS-TOTAL-AMT -> ST-TOTAL-TRAMT, ST-TRANAMT",
        "transformation_description": "Sum matching amounts; edited PIC Z(9).99-.",
        "citation": [
          429,
          433,
          678
        ]
      },
      {
        "input_field": "Account/Customer fields",
        "output_field": "HTML-BSIC-LN, HTML-TRAN-LN",
        "transformation_description": "STRING into dynamic lines with <p> labels and </p>.",
        "citation": [
          614,
          687,
          699,
          711
        ]
      }
    ]
  },
  "copybooks_used": [
    {
      "copybook_name": "COSTM01",
      "purpose": "CARD-XREF-RECORD for cross-ref fields like XREF-CUST-ID, XREF-ACCT-ID, XREF-CARD-NUM.",
      "location": "WORKING_STORAGE",
      "citation": 51
    },
    {
      "copybook_name": "CVACT03Y",
      "purpose": "ACCOUNT-RECORD for ACCT-ID, ACCT-CURR-BAL.",
      "location": "WORKING_STORAGE",
      "citation": 53
    },
    {
      "copybook_name": "CUSTREC",
      "purpose": "CUSTOMER-RECORD for names, addresses, FICO score.",
      "location": "WORKING_STORAGE",
      "citation": 55
    },
    {
      "copybook_name": "CVACT01Y",
      "purpose": "TRNX-RECORD for transaction fields like TRNX-CARD-NUM, TRNX-ID, TRNX-REST, AMT.",
      "location": "WORKING_STORAGE",
      "citation": 57
    }
  ],
  "paragraphs": [
    {
      "paragraph_name": "0000-START",
      "purpose": "Dispatch point using EVALUATE/ALTER/GO TO for sequenced file opens based on WS-FL-DD.",
      "called_by": [],
      "calls": [
        "8100-FILE-OPEN"
      ],
      "citation": [
        296,
        315
      ]
    },
    {
      "paragraph_name": "1000-MAINLINE",
      "purpose": "Main loop: process each xref record with cust/acct reads, statement creation, trans matching.",
      "called_by": [
        "8400-ACCTFILE-OPEN"
      ],
      "calls": [
        "1000-XREFFILE-GET-NEXT",
        "2000-CUSTFILE-GET",
        "3000-ACCTFILE-GET",
        "5000-CREATE-STATEMENT",
        "4000-TRNXFILE-GET"
      ],
      "citation": [
        316,
        328
      ]
    },
    {
      "paragraph_name": "1000-XREFFILE-GET-NEXT",
      "purpose": "Sequential read next xref record via CBSTM03B.",
      "called_by": [
        "1000-MAINLINE"
      ],
      "calls": [
        "9999-ABEND-PROGRAM"
      ],
      "citation": [
        345,
        366
      ]
    },
    {
      "paragraph_name": "2000-CUSTFILE-GET",
      "purpose": "Key read customer record using XREF-CUST-ID.",
      "called_by": [
        "1000-MAINLINE"
      ],
      "calls": [
        "9999-ABEND-PROGRAM"
      ],
      "citation": [
        368,
        389
      ]
    },
    {
      "paragraph_name": "3000-ACCTFILE-GET",
      "purpose": "Key read account record using XREF-ACCT-ID.",
      "called_by": [
        "1000-MAINLINE"
      ],
      "calls": [
        "9999-ABEND-PROGRAM"
      ],
      "citation": [
        392,
        413
      ]
    },
    {
      "paragraph_name": "4000-TRNXFILE-GET",
      "purpose": "Match and output transactions from table for current card, sum total.",
      "called_by": [
        "1000-MAINLINE"
      ],
      "calls": [
        "6000-WRITE-TRANS"
      ],
      "citation": [
        416,
        455
      ]
    },
    {
      "paragraph_name": "5000-CREATE-STATEMENT",
      "purpose": "Format and write statement headers to both files.",
      "called_by": [
        "1000-MAINLINE"
      ],
      "calls": [
        "5100-WRITE-HTML-HEADER",
        "5200-WRITE-HTML-NMADBS"
      ],
      "citation": [
        458,
        503
      ]
    },
    {
      "paragraph_name": "8100-FILE-OPEN",
      "purpose": "Altered dynamic entry for file open sequence.",
      "called_by": [
        "0000-START"
      ],
      "calls": [
        "8100-TRNXFILE-OPEN",
        "8200-XREFFILE-OPEN",
        "8300-CUSTFILE-OPEN",
        "8400-ACCTFILE-OPEN"
      ],
      "citation": [
        726,
        729
      ]
    },
    {
      "paragraph_name": "8500-READTRNX-READ",
      "purpose": "Loop to sequentially read and index all TRNXFILE records into table.",
      "called_by": [],
      "calls": [
        "9999-ABEND-PROGRAM"
      ],
      "citation": [
        818,
        852
      ]
    },
    {
      "paragraph_name": "9999-ABEND-PROGRAM",
      "purpose": "Abend on any file error.",
      "called_by": [],
      "calls": [],
      "citation": [
        921,
        924
      ]
    }
  ],
  "error_handling": [
    {
      "condition": "File OPEN RC NOT = '00' or '04'",
      "action": "DISPLAY error, PERFORM 9999-ABEND-PROGRAM",
      "citation": [
        736,
        771,
        789,
        807
      ]
    },
    {
      "condition": "File READ/READ-K RC NOT = '00' (or '10' for seq EOF)",
      "action": "DISPLAY error, PERFORM 9999-ABEND-PROGRAM",
      "citation": [
        353,
        379,
        403,
        837,
        846
      ]
    },
    {
      "condition": "File CLOSE RC NOT = '00' or '04'",
      "action": "DISPLAY error, PERFORM 9999-ABEND-PROGRAM",
      "citation": [
        862,
        878,
        894,
        910
      ]
    },
    {
      "condition": "XREFFILE READ RC = '10'",
      "action": "Set END-OF-FILE = 'Y' to exit main loop",
      "citation": [
        357
      ]
    },
    {
      "condition": "Table overflow implied (CR-CNT >51 or TR-CNT >10)",
      "action": "No explicit handling; potential index error",
      "citation": [
        226,
        422
      ]
    }
  ],
  "sql_operations": [],
  "cics_operations": [],
  "open_questions": [
    {
      "question": "Exact field layouts in copybooks (e.g., offsets for XREF-CUST-ID)",
      "context": "Copybooks not provided; fields inferred from usage like MOVE XREF-CUST-ID",
      "suggestion": "Obtain copybook sources"
    },
    {
      "question": "File organizations/access modes confirmed in CBSTM03B?",
      "context": "Inferred VSAM KSDS for key reads, SEQ for others; no explicit SELECT details",
      "suggestion": "Analyze CBSTM03B or JCL DD statements"
    },
    {
      "question": "Business meaning of XREFFILE structure",
      "context": "Links cards to cust/acct but why separate file?",
      "suggestion": "Business documentation or data samples"
    }
  ]
}